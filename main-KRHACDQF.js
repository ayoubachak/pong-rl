var aY=Object.create;var hx=Object.defineProperty,lY=Object.defineProperties,uY=Object.getOwnPropertyDescriptor,cY=Object.getOwnPropertyDescriptors,pY=Object.getOwnPropertyNames,YR=Object.getOwnPropertySymbols,fY=Object.getPrototypeOf,QR=Object.prototype.hasOwnProperty,dY=Object.prototype.propertyIsEnumerable;var ZR=(t,n,e)=>n in t?hx(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,me=(t,n)=>{for(var e in n||={})QR.call(n,e)&&ZR(t,e,n[e]);if(YR)for(var e of YR(n))dY.call(n,e)&&ZR(t,e,n[e]);return t},pt=(t,n)=>lY(t,cY(n));var $o=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports),Po=(t,n)=>{for(var e in n)hx(t,e,{get:n[e],enumerable:!0})},hY=(t,n,e,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of pY(n))!QR.call(t,o)&&o!==e&&hx(t,o,{get:()=>n[o],enumerable:!(r=uY(n,o))||r.enumerable});return t};var am=(t,n,e)=>(e=t!=null?aY(fY(t)):{},hY(n||!t||!t.__esModule?hx(e,"default",{value:t,enumerable:!0}):e,t));var B=(t,n,e)=>new Promise((r,o)=>{var i=l=>{try{a(e.next(l))}catch(u){o(u)}},s=l=>{try{a(e.throw(l))}catch(u){o(u)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(i,s);a((e=e.apply(t,n)).next())});var rL=$o((FPe,nL)=>{"use strict";nL.exports=Xt;var Yo=null;try{Yo=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Xt(t,n,e){this.low=t|0,this.high=n|0,this.unsigned=!!e}Xt.prototype.__isLong__;Object.defineProperty(Xt.prototype,"__isLong__",{value:!0});function no(t){return(t&&t.__isLong__)===!0}Xt.isLong=no;var qP={},KP={};function Yc(t,n){var e,r,o;return n?(t>>>=0,(o=0<=t&&t<256)&&(r=KP[t],r)?r:(e=Yt(t,(t|0)<0?-1:0,!0),o&&(KP[t]=e),e)):(t|=0,(o=-128<=t&&t<128)&&(r=qP[t],r)?r:(e=Yt(t,t<0?-1:0,!1),o&&(qP[t]=e),e))}Xt.fromInt=Yc;function Zo(t,n){if(isNaN(t))return n?Xc:Qo;if(n){if(t<0)return Xc;if(t>=QP)return tL}else{if(t<=-YP)return to;if(t+1>=YP)return eL}return t<0?Zo(-t,n).neg():Yt(t%Vd|0,t/Vd|0,n)}Xt.fromNumber=Zo;function Yt(t,n,e){return new Xt(t,n,e)}Xt.fromBits=Yt;var s0=Math.pow;function WN(t,n,e){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return Qo;if(typeof n=="number"?(e=n,n=!1):n=!!n,e=e||10,e<2||36<e)throw RangeError("radix");var r;if((r=t.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return WN(t.substring(1),n,e).neg();for(var o=Zo(s0(e,8)),i=Qo,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),l=parseInt(t.substring(s,s+a),e);if(a<8){var u=Zo(s0(e,a));i=i.mul(u).add(Zo(l))}else i=i.mul(o),i=i.add(Zo(l))}return i.unsigned=n,i}Xt.fromString=WN;function Ni(t,n){return typeof t=="number"?Zo(t,n):typeof t=="string"?WN(t,n):Yt(t.low,t.high,typeof n=="boolean"?n:t.unsigned)}Xt.fromValue=Ni;var XP=65536,tse=1<<24,Vd=XP*XP,QP=Vd*Vd,YP=QP/2,ZP=Yc(tse),Qo=Yc(0);Xt.ZERO=Qo;var Xc=Yc(0,!0);Xt.UZERO=Xc;var Ld=Yc(1);Xt.ONE=Ld;var JP=Yc(1,!0);Xt.UONE=JP;var GN=Yc(-1);Xt.NEG_ONE=GN;var eL=Yt(-1,2147483647,!1);Xt.MAX_VALUE=eL;var tL=Yt(-1,-1,!0);Xt.MAX_UNSIGNED_VALUE=tL;var to=Yt(0,-2147483648,!1);Xt.MIN_VALUE=to;var ce=Xt.prototype;ce.toInt=function(){return this.unsigned?this.low>>>0:this.low};ce.toNumber=function(){return this.unsigned?(this.high>>>0)*Vd+(this.low>>>0):this.high*Vd+(this.low>>>0)};ce.toString=function(n){if(n=n||10,n<2||36<n)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(to)){var e=Zo(n),r=this.div(e),o=r.mul(e).sub(this);return r.toString(n)+o.toInt().toString(n)}else return"-"+this.neg().toString(n);for(var i=Zo(s0(n,6),this.unsigned),s=this,a="";;){var l=s.div(i),u=s.sub(l.mul(i)).toInt()>>>0,c=u.toString(n);if(s=l,s.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};ce.getHighBits=function(){return this.high};ce.getHighBitsUnsigned=function(){return this.high>>>0};ce.getLowBits=function(){return this.low};ce.getLowBitsUnsigned=function(){return this.low>>>0};ce.getNumBitsAbs=function(){if(this.isNegative())return this.eq(to)?64:this.neg().getNumBitsAbs();for(var n=this.high!=0?this.high:this.low,e=31;e>0&&(n&1<<e)==0;e--);return this.high!=0?e+33:e+1};ce.isZero=function(){return this.high===0&&this.low===0};ce.eqz=ce.isZero;ce.isNegative=function(){return!this.unsigned&&this.high<0};ce.isPositive=function(){return this.unsigned||this.high>=0};ce.isOdd=function(){return(this.low&1)===1};ce.isEven=function(){return(this.low&1)===0};ce.equals=function(n){return no(n)||(n=Ni(n)),this.unsigned!==n.unsigned&&this.high>>>31===1&&n.high>>>31===1?!1:this.high===n.high&&this.low===n.low};ce.eq=ce.equals;ce.notEquals=function(n){return!this.eq(n)};ce.neq=ce.notEquals;ce.ne=ce.notEquals;ce.lessThan=function(n){return this.comp(n)<0};ce.lt=ce.lessThan;ce.lessThanOrEqual=function(n){return this.comp(n)<=0};ce.lte=ce.lessThanOrEqual;ce.le=ce.lessThanOrEqual;ce.greaterThan=function(n){return this.comp(n)>0};ce.gt=ce.greaterThan;ce.greaterThanOrEqual=function(n){return this.comp(n)>=0};ce.gte=ce.greaterThanOrEqual;ce.ge=ce.greaterThanOrEqual;ce.compare=function(n){if(no(n)||(n=Ni(n)),this.eq(n))return 0;var e=this.isNegative(),r=n.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?n.high>>>0>this.high>>>0||n.high===this.high&&n.low>>>0>this.low>>>0?-1:1:this.sub(n).isNegative()?-1:1};ce.comp=ce.compare;ce.negate=function(){return!this.unsigned&&this.eq(to)?to:this.not().add(Ld)};ce.neg=ce.negate;ce.add=function(n){no(n)||(n=Ni(n));var e=this.high>>>16,r=this.high&65535,o=this.low>>>16,i=this.low&65535,s=n.high>>>16,a=n.high&65535,l=n.low>>>16,u=n.low&65535,c=0,p=0,f=0,d=0;return d+=i+u,f+=d>>>16,d&=65535,f+=o+l,p+=f>>>16,f&=65535,p+=r+a,c+=p>>>16,p&=65535,c+=e+s,c&=65535,Yt(f<<16|d,c<<16|p,this.unsigned)};ce.subtract=function(n){return no(n)||(n=Ni(n)),this.add(n.neg())};ce.sub=ce.subtract;ce.multiply=function(n){if(this.isZero())return Qo;if(no(n)||(n=Ni(n)),Yo){var e=Yo.mul(this.low,this.high,n.low,n.high);return Yt(e,Yo.get_high(),this.unsigned)}if(n.isZero())return Qo;if(this.eq(to))return n.isOdd()?to:Qo;if(n.eq(to))return this.isOdd()?to:Qo;if(this.isNegative())return n.isNegative()?this.neg().mul(n.neg()):this.neg().mul(n).neg();if(n.isNegative())return this.mul(n.neg()).neg();if(this.lt(ZP)&&n.lt(ZP))return Zo(this.toNumber()*n.toNumber(),this.unsigned);var r=this.high>>>16,o=this.high&65535,i=this.low>>>16,s=this.low&65535,a=n.high>>>16,l=n.high&65535,u=n.low>>>16,c=n.low&65535,p=0,f=0,d=0,h=0;return h+=s*c,d+=h>>>16,h&=65535,d+=i*c,f+=d>>>16,d&=65535,d+=s*u,f+=d>>>16,d&=65535,f+=o*c,p+=f>>>16,f&=65535,f+=i*u,p+=f>>>16,f&=65535,f+=s*l,p+=f>>>16,f&=65535,p+=r*c+o*u+i*l+s*a,p&=65535,Yt(d<<16|h,p<<16|f,this.unsigned)};ce.mul=ce.multiply;ce.divide=function(n){if(no(n)||(n=Ni(n)),n.isZero())throw Error("division by zero");if(Yo){if(!this.unsigned&&this.high===-2147483648&&n.low===-1&&n.high===-1)return this;var e=(this.unsigned?Yo.div_u:Yo.div_s)(this.low,this.high,n.low,n.high);return Yt(e,Yo.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Xc:Qo;var r,o,i;if(this.unsigned){if(n.unsigned||(n=n.toUnsigned()),n.gt(this))return Xc;if(n.gt(this.shru(1)))return JP;i=Xc}else{if(this.eq(to)){if(n.eq(Ld)||n.eq(GN))return to;if(n.eq(to))return Ld;var s=this.shr(1);return r=s.div(n).shl(1),r.eq(Qo)?n.isNegative()?Ld:GN:(o=this.sub(n.mul(r)),i=r.add(o.div(n)),i)}else if(n.eq(to))return this.unsigned?Xc:Qo;if(this.isNegative())return n.isNegative()?this.neg().div(n.neg()):this.neg().div(n).neg();if(n.isNegative())return this.div(n.neg()).neg();i=Qo}for(o=this;o.gte(n);){r=Math.max(1,Math.floor(o.toNumber()/n.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),l=a<=48?1:s0(2,a-48),u=Zo(r),c=u.mul(n);c.isNegative()||c.gt(o);)r-=l,u=Zo(r,this.unsigned),c=u.mul(n);u.isZero()&&(u=Ld),i=i.add(u),o=o.sub(c)}return i};ce.div=ce.divide;ce.modulo=function(n){if(no(n)||(n=Ni(n)),Yo){var e=(this.unsigned?Yo.rem_u:Yo.rem_s)(this.low,this.high,n.low,n.high);return Yt(e,Yo.get_high(),this.unsigned)}return this.sub(this.div(n).mul(n))};ce.mod=ce.modulo;ce.rem=ce.modulo;ce.not=function(){return Yt(~this.low,~this.high,this.unsigned)};ce.and=function(n){return no(n)||(n=Ni(n)),Yt(this.low&n.low,this.high&n.high,this.unsigned)};ce.or=function(n){return no(n)||(n=Ni(n)),Yt(this.low|n.low,this.high|n.high,this.unsigned)};ce.xor=function(n){return no(n)||(n=Ni(n)),Yt(this.low^n.low,this.high^n.high,this.unsigned)};ce.shiftLeft=function(n){return no(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?Yt(this.low<<n,this.high<<n|this.low>>>32-n,this.unsigned):Yt(0,this.low<<n-32,this.unsigned)};ce.shl=ce.shiftLeft;ce.shiftRight=function(n){return no(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?Yt(this.low>>>n|this.high<<32-n,this.high>>n,this.unsigned):Yt(this.high>>n-32,this.high>=0?0:-1,this.unsigned)};ce.shr=ce.shiftRight;ce.shiftRightUnsigned=function(n){if(no(n)&&(n=n.toInt()),n&=63,n===0)return this;var e=this.high;if(n<32){var r=this.low;return Yt(r>>>n|e<<32-n,e>>>n,this.unsigned)}else return n===32?Yt(e,0,this.unsigned):Yt(e>>>n-32,0,this.unsigned)};ce.shru=ce.shiftRightUnsigned;ce.shr_u=ce.shiftRightUnsigned;ce.toSigned=function(){return this.unsigned?Yt(this.low,this.high,!1):this};ce.toUnsigned=function(){return this.unsigned?this:Yt(this.low,this.high,!0)};ce.toBytes=function(n){return n?this.toBytesLE():this.toBytesBE()};ce.toBytesLE=function(){var n=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,n&255,n>>>8&255,n>>>16&255,n>>>24]};ce.toBytesBE=function(){var n=this.high,e=this.low;return[n>>>24,n>>>16&255,n>>>8&255,n&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};Xt.fromBytes=function(n,e,r){return r?Xt.fromBytesLE(n,e):Xt.fromBytesBE(n,e)};Xt.fromBytesLE=function(n,e){return new Xt(n[0]|n[1]<<8|n[2]<<16|n[3]<<24,n[4]|n[5]<<8|n[6]<<16|n[7]<<24,e)};Xt.fromBytesBE=function(n,e){return new Xt(n[4]<<24|n[5]<<16|n[6]<<8|n[7],n[0]<<24|n[1]<<16|n[2]<<8|n[3],e)}});var qL=$o((qd,jL)=>{"use strict";var Use=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ip=Use();jL.exports=qd=ip.fetch;ip.fetch&&(qd.default=ip.fetch.bind(ip));qd.Headers=ip.Headers;qd.Request=ip.Request;qd.Response=ip.Response});var KL=$o(()=>{"use strict"});var yV=$o((gV,BD)=>{"use strict";(function(t,n,e){function r(a){var l=this,u=s();l.next=function(){var c=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=c-(l.c=c|0)},l.c=1,l.s0=u(" "),l.s1=u(" "),l.s2=u(" "),l.s0-=u(a),l.s0<0&&(l.s0+=1),l.s1-=u(a),l.s1<0&&(l.s1+=1),l.s2-=u(a),l.s2<0&&(l.s2+=1),u=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var u=new r(a),c=l&&l.state,p=u.next;return p.int32=function(){return u.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,c&&(typeof c=="object"&&o(c,u),p.state=function(){return o(u,{})}),p}function s(){var a=4022871197,l=function(u){u=String(u);for(var c=0;c<u.length;c++){a+=u.charCodeAt(c);var p=.02519603282416938*a;a=p>>>0,p-=a,p*=a,a=p>>>0,p-=a,a+=p*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(gV,typeof BD=="object"&&BD,typeof define=="function"&&define)});var vV=$o((xV,zD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var c=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^c^c>>>8},s===(s|0)?a.x=s:l+=s;for(var u=0;u<l.length+64;u++)a.x^=l.charCodeAt(u)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(typeof u=="object"&&o(u,l),c.state=function(){return o(l,{})}),c}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(xV,typeof zD=="object"&&zD,typeof define=="function"&&define)});var wV=$o((bV,UD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var c=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(c^c<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var u=0;u<l.length+64;u++)a.x^=l.charCodeAt(u)|0,u==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(typeof u=="object"&&o(u,l),c.state=function(){return o(l,{})}),c}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(bV,typeof UD=="object"&&UD,typeof define=="function"&&define)});var SV=$o((CV,GD)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var u=a.x,c=a.i,p,f,d;return p=u[c],p^=p>>>7,f=p^p<<24,p=u[c+1&7],f^=p^p>>>10,p=u[c+3&7],f^=p^p>>>3,p=u[c+4&7],f^=p^p<<7,p=u[c+7&7],p=p^p<<13,f^=p^p<<9,u[c]=f,a.i=c+1&7,f};function l(u,c){var p,f,d=[];if(c===(c|0))f=d[0]=c;else for(c=""+c,p=0;p<c.length;++p)d[p&7]=d[p&7]<<15^c.charCodeAt(p)+d[p+1&7]<<13;for(;d.length<8;)d.push(0);for(p=0;p<8&&d[p]===0;++p);for(p==8?f=d[7]=-1:f=d[p],u.x=d,u.i=0,p=256;p>0;--p)u.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(u.x&&o(u,l),c.state=function(){return o(l,{})}),c}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(CV,typeof GD=="object"&&GD,typeof define=="function"&&define)});var EV=$o((IV,WD)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var u=a.w,c=a.X,p=a.i,f,d;return a.w=u=u+1640531527|0,d=c[p+34&127],f=c[p=p+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,d=c[p]=d^f,a.i=p,d+(u^u>>>16)|0};function l(u,c){var p,f,d,h,m,g=[],y=128;for(c===(c|0)?(f=c,c=null):(c=c+"\0",f=0,y=Math.max(y,c.length)),d=0,h=-32;h<y;++h)c&&(f^=c.charCodeAt((h+32)%c.length)),h===0&&(m=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,h>=0&&(m=m+1640531527|0,p=g[h&127]^=f+m,d=p==0?d+1:0);for(d>=128&&(g[(c&&c.length||0)&127]=-1),d=127,h=4*128;h>0;--h)f=g[d+34&127],p=g[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,g[d]=f^p;u.w=m,u.X=g,u.i=d}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(u.X&&o(u,l),c.state=function(){return o(l,{})}),c}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(IV,typeof WD=="object"&&WD,typeof define=="function"&&define)});var _V=$o((TV,HD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var c=a.b,p=a.c,f=a.d,d=a.a;return c=c<<25^c>>>7^p,p=p-f|0,f=f<<24^f>>>8^d,d=d-c|0,a.b=c=c<<20^c>>>12^p,a.c=p=p-f|0,a.d=f<<16^p>>>16^d,a.a=d-c|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var u=0;u<l.length+20;u++)a.b^=l.charCodeAt(u)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(typeof u=="object"&&o(u,l),c.state=function(){return o(l,{})}),c}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(TV,typeof HD=="object"&&HD,typeof define=="function"&&define)});var NV=$o(()=>{"use strict"});var kV=$o((DV,_0)=>{"use strict";(function(t,n,e){var r=256,o=6,i=52,s="random",a=e.pow(r,o),l=e.pow(2,i),u=l*2,c=r-1,p;function f(b,w,C){var N=[];w=w==!0?{entropy:!0}:w||{};var D=g(m(w.entropy?[b,x(n)]:b??y(),3),N),k=new d(N),O=function(){for(var $=k.g(o),V=a,G=0;$<l;)$=($+G)*r,V*=r,G=k.g(1);for(;$>=u;)$/=2,V/=2,G>>>=1;return($+G)/V};return O.int32=function(){return k.g(4)|0},O.quick=function(){return k.g(4)/4294967296},O.double=O,g(x(k.S),n),(w.pass||C||function($,V,G,W){return W&&(W.S&&h(W,k),$.state=function(){return h(k,{})}),G?(e[s]=$,V):$})(O,D,"global"in w?w.global:this==e,w.state)}function d(b){var w,C=b.length,N=this,D=0,k=N.i=N.j=0,O=N.S=[];for(C||(b=[C++]);D<r;)O[D]=D++;for(D=0;D<r;D++)O[D]=O[k=c&k+b[D%C]+(w=O[D])],O[k]=w;(N.g=function($){for(var V,G=0,W=N.i,H=N.j,j=N.S;$--;)V=j[W=c&W+1],G=G*r+j[c&(j[W]=j[H=c&H+V])+(j[H]=V)];return N.i=W,N.j=H,G})(r)}function h(b,w){return w.i=b.i,w.j=b.j,w.S=b.S.slice(),w}function m(b,w){var C=[],N=typeof b,D;if(w&&N=="object")for(D in b)try{C.push(m(b[D],w-1))}catch{}return C.length?C:N=="string"?b:b+"\0"}function g(b,w){for(var C=b+"",N,D=0;D<C.length;)w[c&D]=c&(N^=w[c&D]*19)+C.charCodeAt(D++);return x(w)}function y(){try{var b;return p&&(b=p.randomBytes)?b=b(r):(b=new Uint8Array(r),(t.crypto||t.msCrypto).getRandomValues(b)),x(b)}catch{var w=t.navigator,C=w&&w.plugins;return[+new Date,t,C,t.screen,x(n)]}}function x(b){return String.fromCharCode.apply(0,b)}if(g(e.random(),n),typeof _0=="object"&&_0.exports){_0.exports=f;try{p=NV()}catch{}}else typeof define=="function"&&define.amd?define(function(){return f}):e["seed"+s]=f})(typeof self<"u"?self:DV,[],Math)});var qg=$o((v8e,AV)=>{"use strict";var lue=yV(),uue=vV(),cue=wV(),pue=SV(),fue=EV(),due=_V(),gp=kV();gp.alea=lue;gp.xor128=uue;gp.xorwow=cue;gp.xorshift7=pue;gp.xor4096=fue;gp.tychei=due;AV.exports=gp});function ZI(t,n){return Object.is(t,n)}var Fn=null,mx=!1,QI=1,Lo=Symbol("SIGNAL");function st(t){let n=Fn;return Fn=t,n}function JI(){return Fn}var um={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function cm(t){if(mx)throw new Error("");if(Fn===null)return;Fn.consumerOnSignalRead(t);let n=Fn.nextProducerIndex++;if(vx(Fn),n<Fn.producerNode.length&&Fn.producerNode[n]!==t&&lm(Fn)){let e=Fn.producerNode[n];xx(e,Fn.producerIndexOfThis[n])}Fn.producerNode[n]!==t&&(Fn.producerNode[n]=t,Fn.producerIndexOfThis[n]=lm(Fn)?eM(t,Fn,n):0),Fn.producerLastReadVersion[n]=t.version}function JR(){QI++}function eE(t){if(!(lm(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===QI)){if(!t.producerMustRecompute(t)&&!oE(t)){YI(t);return}t.producerRecomputeValue(t),YI(t)}}function tE(t){if(t.liveConsumerNode===void 0)return;let n=mx;mx=!0;try{for(let e of t.liveConsumerNode)e.dirty||mY(e)}finally{mx=n}}function nE(){return Fn?.consumerAllowSignalWrites!==!1}function mY(t){t.dirty=!0,tE(t),t.consumerMarkedDirty?.(t)}function YI(t){t.dirty=!1,t.lastCleanEpoch=QI}function yx(t){return t&&(t.nextProducerIndex=0),st(t)}function rE(t,n){if(st(n),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(lm(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)xx(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function oE(t){vx(t);for(let n=0;n<t.producerNode.length;n++){let e=t.producerNode[n],r=t.producerLastReadVersion[n];if(r!==e.version||(eE(e),r!==e.version))return!0}return!1}function iE(t){if(vx(t),lm(t))for(let n=0;n<t.producerNode.length;n++)xx(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function eM(t,n,e){if(tM(t),t.liveConsumerNode.length===0&&nM(t))for(let r=0;r<t.producerNode.length;r++)t.producerIndexOfThis[r]=eM(t.producerNode[r],t,r);return t.liveConsumerIndexOfThis.push(e),t.liveConsumerNode.push(n)-1}function xx(t,n){if(tM(t),t.liveConsumerNode.length===1&&nM(t))for(let r=0;r<t.producerNode.length;r++)xx(t.producerNode[r],t.producerIndexOfThis[r]);let e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){let r=t.liveConsumerIndexOfThis[n],o=t.liveConsumerNode[n];vx(o),o.producerIndexOfThis[r]=n}}function lm(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function vx(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function tM(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function nM(t){return t.producerNode!==void 0}function sE(t,n){let e=Object.create(gY);e.computation=t,n!==void 0&&(e.equal=n);let r=()=>{if(eE(e),cm(e),e.value===gx)throw e.error;return e.value};return r[Lo]=e,r}var KI=Symbol("UNSET"),XI=Symbol("COMPUTING"),gx=Symbol("ERRORED"),gY=pt(me({},um),{value:KI,dirty:!0,error:null,equal:ZI,kind:"computed",producerMustRecompute(t){return t.value===KI||t.value===XI},producerRecomputeValue(t){if(t.value===XI)throw new Error("Detected cycle in computations.");let n=t.value;t.value=XI;let e=yx(t),r,o=!1;try{r=t.computation(),st(null),o=n!==KI&&n!==gx&&r!==gx&&t.equal(n,r)}catch(i){r=gx,t.error=i}finally{rE(t,e)}if(o){t.value=n;return}t.value=r,t.version++}});function yY(){throw new Error}var rM=yY;function oM(t){rM(t)}function aE(t){rM=t}var xY=null;function lE(t,n){let e=Object.create(bx);e.value=t,n!==void 0&&(e.equal=n);let r=()=>(cm(e),e.value);return r[Lo]=e,r}function pm(t,n){nE()||oM(t),t.equal(t.value,n)||(t.value=n,vY(t))}function uE(t,n){nE()||oM(t),pm(t,n(t.value))}var bx=pt(me({},um),{equal:ZI,value:void 0,kind:"signal"});function vY(t){t.version++,JR(),tE(t),xY?.()}function cE(t){let n=st(null);try{return t()}finally{st(n)}}var pE;function fm(){return pE}function Ns(t){let n=pE;return pE=t,n}var wx=Symbol("NotFound");function Ue(t){return typeof t=="function"}function Jp(t){let e=t(r=>{Error.call(r),r.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Cx=Jp(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((r,o)=>`${o+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function dm(t,n){if(t){let e=t.indexOf(n);0<=e&&t.splice(e,1)}}var Cn=class t{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let i of e)i.remove(this);else e.remove(this);let{initialTeardown:r}=this;if(Ue(r))try{r()}catch(i){n=i instanceof Cx?i.errors:[i]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let i of o)try{iM(i)}catch(s){n=n??[],s instanceof Cx?n=[...n,...s.errors]:n.push(s)}}if(n)throw new Cx(n)}}add(n){var e;if(n&&n!==this)if(this.closed)iM(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}}_hasParent(n){let{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){let{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&dm(e,n)}remove(n){let{_finalizers:e}=this;e&&dm(e,n),n instanceof t&&n._removeParent(this)}};Cn.EMPTY=(()=>{let t=new Cn;return t.closed=!0,t})();var fE=Cn.EMPTY;function Sx(t){return t instanceof Cn||t&&"closed"in t&&Ue(t.remove)&&Ue(t.add)&&Ue(t.unsubscribe)}function iM(t){Ue(t)?t():t.unsubscribe()}var gi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var ef={setTimeout(t,n,...e){let{delegate:r}=ef;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){let{delegate:n}=ef;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Ix(t){ef.setTimeout(()=>{let{onUnhandledError:n}=gi;if(n)n(t);else throw t})}function hm(){}var sM=dE("C",void 0,void 0);function aM(t){return dE("E",void 0,t)}function lM(t){return dE("N",t,void 0)}function dE(t,n,e){return{kind:t,value:n,error:e}}var uc=null;function tf(t){if(gi.useDeprecatedSynchronousErrorHandling){let n=!uc;if(n&&(uc={errorThrown:!1,error:null}),t(),n){let{errorThrown:e,error:r}=uc;if(uc=null,e)throw r}}else t()}function uM(t){gi.useDeprecatedSynchronousErrorHandling&&uc&&(uc.errorThrown=!0,uc.error=t)}var cc=class extends Cn{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Sx(n)&&n.add(this)):this.destination=EY}static create(n,e,r){return new nf(n,e,r)}next(n){this.isStopped?mE(lM(n),this):this._next(n)}error(n){this.isStopped?mE(aM(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?mE(sM,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},SY=Function.prototype.bind;function hE(t,n){return SY.call(t,n)}var gE=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){Ex(r)}}error(n){let{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){Ex(r)}else Ex(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){Ex(e)}}},nf=class extends cc{constructor(n,e,r){super();let o;if(Ue(n)||!n)o={next:n??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&gi.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&hE(n.next,i),error:n.error&&hE(n.error,i),complete:n.complete&&hE(n.complete,i)}):o=n}this.destination=new gE(o)}};function Ex(t){gi.useDeprecatedSynchronousErrorHandling?uM(t):Ix(t)}function IY(t){throw t}function mE(t,n){let{onStoppedNotification:e}=gi;e&&ef.setTimeout(()=>e(t,n))}var EY={closed:!0,next:hm,error:IY,complete:hm};var rf=typeof Symbol=="function"&&Symbol.observable||"@@observable";function bo(t){return t}function yE(...t){return xE(t)}function xE(t){return t.length===0?bo:t.length===1?t[0]:function(e){return t.reduce((r,o)=>o(r),e)}}var _t=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){let r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,o){let i=_Y(e)?e:new nf(e,r,o);return tf(()=>{let{operator:s,source:a}=this;i.add(s?s.call(i,a):a?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return r=cM(r),new r((o,i)=>{let s=new nf({next:a=>{try{e(a)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});this.subscribe(s)})}_subscribe(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)}[rf](){return this}pipe(...e){return xE(e)(this)}toPromise(e){return e=cM(e),new e((r,o)=>{let i;this.subscribe(s=>i=s,s=>o(s),()=>r(i))})}}return t.create=n=>new t(n),t})();function cM(t){var n;return(n=t??gi.Promise)!==null&&n!==void 0?n:Promise}function TY(t){return t&&Ue(t.next)&&Ue(t.error)&&Ue(t.complete)}function _Y(t){return t&&t instanceof cc||TY(t)&&Sx(t)}function vE(t){return Ue(t?.lift)}function ht(t){return n=>{if(vE(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function at(t,n,e,r,o){return new bE(t,n,e,r,o)}var bE=class extends cc{constructor(n,e,r,o,i,s){super(n),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(l){n.error(l)}}:super._next,this._error=o?function(a){try{o(a)}catch(l){n.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){n.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function of(){return ht((t,n)=>{let e=null;t._refCount++;let r=at(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){e=null;return}let o=t._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}var sf=class extends _t{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,vE(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Cn;let e=this.getSubject();n.add(this.source.subscribe(at(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Cn.EMPTY)}return n}refCount(){return of()(this)}};var pM=Jp(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Sn=(()=>{class t extends _t{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let r=new Tx(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new pM}next(e){tf(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(e)}})}error(e){tf(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){tf(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:r,isStopped:o,observers:i}=this;return r||o?fE:(this.currentObservers=null,i.push(e),new Cn(()=>{this.currentObservers=null,dm(i,e)}))}_checkFinalizedStatuses(e){let{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){let e=new _t;return e.source=this,e}}return t.create=(n,e)=>new Tx(n,e),t})(),Tx=class extends Sn{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.next)===null||r===void 0||r.call(e,n)}error(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.error)===null||r===void 0||r.call(e,n)}complete(){var n,e;(e=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||e===void 0||e.call(n)}_subscribe(n){var e,r;return(r=(e=this.source)===null||e===void 0?void 0:e.subscribe(n))!==null&&r!==void 0?r:fE}};var ir=class extends Sn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){let{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}};var qr=new _t(t=>t.complete());function fM(t){return t&&Ue(t.schedule)}function dM(t){return t[t.length-1]}function _x(t){return Ue(dM(t))?t.pop():void 0}function El(t){return fM(dM(t))?t.pop():void 0}function mM(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(c){try{u(r.next(c))}catch(p){s(p)}}function l(c){try{u(r.throw(c))}catch(p){s(p)}}function u(c){c.done?i(c.value):o(c.value).then(a,l)}u((r=r.apply(t,n||[])).next())})}function hM(t){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function pc(t){return this instanceof pc?(this.v=t,this):new pc(t)}function gM(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(t,n||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(d){return function(h){return Promise.resolve(h).then(d,p)}}function a(d,h){r[d]&&(o[d]=function(m){return new Promise(function(g,y){i.push([d,m,g,y])>1||l(d,m)})},h&&(o[d]=h(o[d])))}function l(d,h){try{u(r[d](h))}catch(m){f(i[0][3],m)}}function u(d){d.value instanceof pc?Promise.resolve(d.value.v).then(c,p):f(i[0][2],d)}function c(d){l("next",d)}function p(d){l("throw",d)}function f(d,h){d(h),i.shift(),i.length&&l(i[0][0],i[0][1])}}function yM(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],e;return n?n.call(t):(t=typeof hM=="function"?hM(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(s){return new Promise(function(a,l){s=t[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(u){i({value:u,done:a})},s)}}var Nx=t=>t&&typeof t.length=="number"&&typeof t!="function";function Dx(t){return Ue(t?.then)}function kx(t){return Ue(t[rf])}function Ax(t){return Symbol.asyncIterator&&Ue(t?.[Symbol.asyncIterator])}function Rx(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function NY(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Mx=NY();function Ox(t){return Ue(t?.[Mx])}function Fx(t){return gM(this,arguments,function*(){let e=t.getReader();try{for(;;){let{value:r,done:o}=yield pc(e.read());if(o)return yield pc(void 0);yield yield pc(r)}}finally{e.releaseLock()}})}function $x(t){return Ue(t?.getReader)}function In(t){if(t instanceof _t)return t;if(t!=null){if(kx(t))return DY(t);if(Nx(t))return kY(t);if(Dx(t))return AY(t);if(Ax(t))return xM(t);if(Ox(t))return RY(t);if($x(t))return MY(t)}throw Rx(t)}function DY(t){return new _t(n=>{let e=t[rf]();if(Ue(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function kY(t){return new _t(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}function AY(t){return new _t(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,Ix)})}function RY(t){return new _t(n=>{for(let e of t)if(n.next(e),n.closed)return;n.complete()})}function xM(t){return new _t(n=>{OY(t,n).catch(e=>n.error(e))})}function MY(t){return xM(Fx(t))}function OY(t,n){var e,r,o,i;return mM(this,void 0,void 0,function*(){try{for(e=yM(t);r=yield e.next(),!r.done;){let s=r.value;if(n.next(s),n.closed)return}}catch(s){o={error:s}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}n.complete()})}function Kr(t,n,e,r=0,o=!1){let i=n.schedule(function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function Px(t,n=0){return ht((e,r)=>{e.subscribe(at(r,o=>Kr(r,t,()=>r.next(o),n),()=>Kr(r,t,()=>r.complete(),n),o=>Kr(r,t,()=>r.error(o),n)))})}function Lx(t,n=0){return ht((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function vM(t,n){return In(t).pipe(Lx(n),Px(n))}function bM(t,n){return In(t).pipe(Lx(n),Px(n))}function wM(t,n){return new _t(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}function CM(t,n){return new _t(e=>{let r;return Kr(e,n,()=>{r=t[Mx](),Kr(e,n,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(s){e.error(s);return}i?e.complete():e.next(o)},0,!0)}),()=>Ue(r?.return)&&r.return()})}function Vx(t,n){if(!t)throw new Error("Iterable cannot be null");return new _t(e=>{Kr(e,n,()=>{let r=t[Symbol.asyncIterator]();Kr(e,n,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function SM(t,n){return Vx(Fx(t),n)}function IM(t,n){if(t!=null){if(kx(t))return vM(t,n);if(Nx(t))return wM(t,n);if(Dx(t))return bM(t,n);if(Ax(t))return Vx(t,n);if(Ox(t))return CM(t,n);if($x(t))return SM(t,n)}throw Rx(t)}function fn(t,n){return n?IM(t,n):In(t)}function Ge(...t){let n=El(t);return fn(t,n)}function af(t,n){let e=Ue(t)?t:()=>t,r=o=>o.error(e());return new _t(n?o=>n.schedule(r,0,o):r)}function wE(t){return!!t&&(t instanceof _t||Ue(t.lift)&&Ue(t.subscribe))}var Ds=Jp(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function ft(t,n){return ht((e,r)=>{let o=0;e.subscribe(at(r,i=>{r.next(t.call(n,i,o++))}))})}var{isArray:FY}=Array;function $Y(t,n){return FY(n)?t(...n):t(n)}function Bx(t){return ft(n=>$Y(t,n))}var{isArray:PY}=Array,{getPrototypeOf:LY,prototype:VY,keys:BY}=Object;function zx(t){if(t.length===1){let n=t[0];if(PY(n))return{args:n,keys:null};if(zY(n)){let e=BY(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}function zY(t){return t&&typeof t=="object"&&LY(t)===VY}function Ux(t,n){return t.reduce((e,r,o)=>(e[r]=n[o],e),{})}function Gx(...t){let n=El(t),e=_x(t),{args:r,keys:o}=zx(t);if(r.length===0)return fn([],n);let i=new _t(UY(r,n,o?s=>Ux(o,s):bo));return e?i.pipe(Bx(e)):i}function UY(t,n,e=bo){return r=>{EM(n,()=>{let{length:o}=t,i=new Array(o),s=o,a=o;for(let l=0;l<o;l++)EM(n,()=>{let u=fn(t[l],n),c=!1;u.subscribe(at(r,p=>{i[l]=p,c||(c=!0,a--),a||r.next(e(i.slice()))},()=>{--s||r.complete()}))},r)},r)}}function EM(t,n,e){t?Kr(e,t,n):n()}function TM(t,n,e,r,o,i,s,a){let l=[],u=0,c=0,p=!1,f=()=>{p&&!l.length&&!u&&n.complete()},d=m=>u<r?h(m):l.push(m),h=m=>{i&&n.next(m),u++;let g=!1;In(e(m,c++)).subscribe(at(n,y=>{o?.(y),i?d(y):n.next(y)},()=>{g=!0},void 0,()=>{if(g)try{for(u--;l.length&&u<r;){let y=l.shift();s?Kr(n,s,()=>h(y)):h(y)}f()}catch(y){n.error(y)}}))};return t.subscribe(at(n,d,()=>{p=!0,f()})),()=>{a?.()}}function $n(t,n,e=1/0){return Ue(n)?$n((r,o)=>ft((i,s)=>n(r,i,o,s))(In(t(r,o))),e):(typeof n=="number"&&(e=n),ht((r,o)=>TM(r,o,t,e)))}function _M(t=1/0){return $n(bo,t)}function NM(){return _M(1)}function lf(...t){return NM()(fn(t,El(t)))}function Wx(t){return new _t(n=>{In(t()).subscribe(n)})}function CE(...t){let n=_x(t),{args:e,keys:r}=zx(t),o=new _t(i=>{let{length:s}=e;if(!s){i.complete();return}let a=new Array(s),l=s,u=s;for(let c=0;c<s;c++){let p=!1;In(e[c]).subscribe(at(i,f=>{p||(p=!0,u--),a[c]=f},()=>l--,void 0,()=>{(!l||!p)&&(u||i.next(r?Ux(r,a):a),i.complete())}))}});return n?o.pipe(Bx(n)):o}function yi(t,n){return ht((e,r)=>{let o=0;e.subscribe(at(r,i=>t.call(n,i,o++)&&r.next(i)))})}function Tl(t){return ht((n,e)=>{let r=null,o=!1,i;r=n.subscribe(at(e,void 0,void 0,s=>{i=In(t(s,Tl(t)(n))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function DM(t,n,e,r,o){return(i,s)=>{let a=e,l=n,u=0;i.subscribe(at(s,c=>{let p=u++;l=a?t(l,c,p):(a=!0,c),r&&s.next(l)},o&&(()=>{a&&s.next(l),s.complete()})))}}function uf(t,n){return Ue(n)?$n(t,n,1):$n(t,1)}function _l(t){return ht((n,e)=>{let r=!1;n.subscribe(at(e,o=>{r=!0,e.next(o)},()=>{r||e.next(t),e.complete()}))})}function ks(t){return t<=0?()=>qr:ht((n,e)=>{let r=0;n.subscribe(at(e,o=>{++r<=t&&(e.next(o),t<=r&&e.complete())}))})}function Hx(t=GY){return ht((n,e)=>{let r=!1;n.subscribe(at(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(t())))})}function GY(){return new Ds}function mm(t){return ht((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}function As(t,n){let e=arguments.length>=2;return r=>r.pipe(t?yi((o,i)=>t(o,i,r)):bo,ks(1),e?_l(n):Hx(()=>new Ds))}function cf(t){return t<=0?()=>qr:ht((n,e)=>{let r=[];n.subscribe(at(e,o=>{r.push(o),t<r.length&&r.shift()},()=>{for(let o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function SE(t,n){let e=arguments.length>=2;return r=>r.pipe(t?yi((o,i)=>t(o,i,r)):bo,cf(1),e?_l(n):Hx(()=>new Ds))}function IE(t,n){return ht(DM(t,n,arguments.length>=2,!0))}function EE(...t){let n=El(t);return ht((e,r)=>{(n?lf(t,e,n):lf(t,e)).subscribe(r)})}function xi(t,n){return ht((e,r)=>{let o=null,i=0,s=!1,a=()=>s&&!o&&r.complete();e.subscribe(at(r,l=>{o?.unsubscribe();let u=0,c=i++;In(t(l,c)).subscribe(o=at(r,p=>r.next(n?n(l,p,c,u++):p),()=>{o=null,a()}))},()=>{s=!0,a()}))})}function TE(t){return ht((n,e)=>{In(t).subscribe(at(e,()=>e.complete(),hm)),!e.closed&&n.subscribe(e)})}function sr(t,n,e){let r=Ue(t)||n||e?{next:t,error:n,complete:e}:t;return r?ht((o,i)=>{var s;(s=r.subscribe)===null||s===void 0||s.call(r);let a=!0;o.subscribe(at(i,l=>{var u;(u=r.next)===null||u===void 0||u.call(r,l),i.next(l)},()=>{var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),i.complete()},l=>{var u;a=!1,(u=r.error)===null||u===void 0||u.call(r,l),i.error(l)},()=>{var l,u;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(u=r.finalize)===null||u===void 0||u.call(r)}))}):bo}var WY="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",Ne=class extends Error{code;constructor(n,e){super(jY(n,e)),this.code=n}};function HY(t){return`NG0${Math.abs(t)}`}function jY(t,n){return`${HY(t)}${n?": "+n:""}`}var xO=Symbol("InputSignalNode#UNSET"),qY=pt(me({},bx),{transformFn:void 0,applyValueToInputSignal(t,n){pm(t,n)}});function vO(t,n){let e=Object.create(qY);e.value=t,e.transformFn=n?.transform;function r(){if(cm(e),e.value===xO){let o=null;throw new Ne(-950,o)}return e.value}return r[Lo]=e,r}function Am(t){return{toString:t}.toString()}var jx="__parameters__";function KY(t){return function(...e){if(t){let r=t(...e);for(let o in r)this[o]=r[o]}}}function bO(t,n,e){return Am(()=>{let r=KY(n);function o(...i){if(this instanceof o)return r.apply(this,i),this;let s=new o(...i);return a.annotation=s,a;function a(l,u,c){let p=l.hasOwnProperty(jx)?l[jx]:Object.defineProperty(l,jx,{value:[]})[jx];for(;p.length<=c;)p.push(null);return(p[c]=p[c]||[]).push(s),l}}return o.prototype.ngMetadataName=t,o.annotationCls=o,o})}var ym=globalThis;function zt(t){for(let n in t)if(t[n]===zt)return n;throw Error("Could not find renamed property on target object.")}function XY(t,n){for(let e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Yr(t){if(typeof t=="string")return t;if(Array.isArray(t))return`[${t.map(Yr).join(", ")}]`;if(t==null)return""+t;let n=t.overriddenName||t.name;if(n)return`${n}`;let e=t.toString();if(e==null)return""+e;let r=e.indexOf(`
`);return r>=0?e.slice(0,r):e}function kM(t,n){return t?n?`${t} ${n}`:t:n||""}var YY=zt({__forward_ref__:zt});function Uo(t){return t.__forward_ref__=Uo,t.toString=function(){return Yr(this())},t}function Rr(t){return wO(t)?t():t}function wO(t){return typeof t=="function"&&t.hasOwnProperty(YY)&&t.__forward_ref__===Uo}function Pe(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Tc(t){return{providers:t.providers||[],imports:t.imports||[]}}function Iv(t){return AM(t,SO)||AM(t,IO)}function CO(t){return Iv(t)!==null}function AM(t,n){return t.hasOwnProperty(n)?t[n]:null}function ZY(t){let n=t&&(t[SO]||t[IO]);return n||null}function RM(t){return t&&(t.hasOwnProperty(MM)||t.hasOwnProperty(QY))?t[MM]:null}var SO=zt({\u0275prov:zt}),MM=zt({\u0275inj:zt}),IO=zt({ngInjectableDef:zt}),QY=zt({ngInjectorDef:zt}),ke=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,e){this._desc=n,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=Pe({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function EO(t){return t&&!!t.\u0275providers}var JY=zt({\u0275cmp:zt}),eZ=zt({\u0275dir:zt}),tZ=zt({\u0275pipe:zt}),nZ=zt({\u0275mod:zt}),ev=zt({\u0275fac:zt}),bm=zt({__NG_ELEMENT_ID__:zt}),OM=zt({__NG_ENV_ID__:zt});function wm(t){return typeof t=="string"?t:t==null?"":String(t)}function rZ(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():wm(t)}function TO(t,n){throw new Ne(-200,t)}function $T(t,n){throw new Ne(-201,!1)}var Ye=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(Ye||{}),UE;function _O(){return UE}function Xr(t){let n=UE;return UE=t,n}function NO(t,n,e){let r=Iv(t);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(e&Ye.Optional)return null;if(n!==void 0)return n;$T(t,"Injector")}var oZ={},dc=oZ,GE="__NG_DI_FLAG__",tv=class{injector;constructor(n){this.injector=n}retrieve(n,e){let r=e;return this.injector.get(n,r.optional?wx:dc,r)}},nv="ngTempTokenPath",iZ="ngTokenPath",sZ=/\n/gm,aZ="\u0275",FM="__source";function lZ(t,n=Ye.Default){if(fm()===void 0)throw new Ne(-203,!1);if(fm()===null)return NO(t,void 0,n);{let e=fm(),r;return e instanceof tv?r=e.injector:r=e,r.get(t,n&Ye.Optional?null:void 0,n)}}function nt(t,n=Ye.Default){return(_O()||lZ)(Rr(t),n)}function ge(t,n=Ye.Default){return nt(t,Ev(n))}function Ev(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function WE(t){let n=[];for(let e=0;e<t.length;e++){let r=Rr(t[e]);if(Array.isArray(r)){if(r.length===0)throw new Ne(900,!1);let o,i=Ye.Default;for(let s=0;s<r.length;s++){let a=r[s],l=uZ(a);typeof l=="number"?l===-1?o=a.token:i|=l:o=a}n.push(nt(o,i))}else n.push(nt(r))}return n}function DO(t,n){return t[GE]=n,t.prototype[GE]=n,t}function uZ(t){return t[GE]}function cZ(t,n,e,r){let o=t[nv];throw n[FM]&&o.unshift(n[FM]),t.message=pZ(`
`+t.message,o,e,r),t[iZ]=o,t[nv]=null,t}function pZ(t,n,e,r=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==aZ?t.slice(2):t;let o=Yr(n);if(Array.isArray(n))o=n.map(Yr).join(" -> ");else if(typeof n=="object"){let i=[];for(let s in n)if(n.hasOwnProperty(s)){let a=n[s];i.push(s+":"+(typeof a=="string"?JSON.stringify(a):Yr(a)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${t.replace(sZ,`
  `)}`}var fZ=DO(bO("Optional"),8);var dZ=DO(bO("SkipSelf"),4);function mc(t,n){let e=t.hasOwnProperty(ev);return e?t[ev]:null}function hZ(t,n,e){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){let o=t[r],i=n[r];if(e&&(o=e(o),i=e(i)),i!==o)return!1}return!0}function mZ(t){return t.flat(Number.POSITIVE_INFINITY)}function PT(t,n){t.forEach(e=>Array.isArray(e)?PT(e,n):n(e))}function kO(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function rv(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function gZ(t,n,e,r){let o=t.length;if(o==n)t.push(e,r);else if(o===1)t.push(r,t[0]),t[0]=e;else{for(o--,t.push(t[o-1],t[o]);o>n;){let i=o-2;t[o]=t[i],o--}t[n]=e,t[n+1]=r}}function yZ(t,n,e){let r=Rm(t,n);return r>=0?t[r|1]=e:(r=~r,gZ(t,r,n,e)),r}function _E(t,n){let e=Rm(t,n);if(e>=0)return t[e|1]}function Rm(t,n){return xZ(t,n,1)}function xZ(t,n,e){let r=0,o=t.length>>e;for(;o!==r;){let i=r+(o-r>>1),s=t[i<<e];if(n===s)return i<<e;s>n?o=i:r=i+1}return~(o<<e)}var gc={},Vo=[],Cm=new ke(""),AO=new ke("",-1),RO=new ke(""),ov=class{get(n,e=dc){if(e===dc){let r=new Error(`NullInjectorError: No provider for ${Yr(n)}!`);throw r.name="NullInjectorError",r}return e}};function MO(t,n){let e=t[nZ]||null;if(!e&&n===!0)throw new Error(`Type ${Yr(t)} does not have '\u0275mod' property.`);return e}function mf(t){return t[JY]||null}function vZ(t){return t[eZ]||null}function bZ(t){return t[tZ]||null}function LT(t){return{\u0275providers:t}}function wZ(...t){return{\u0275providers:OO(!0,t),\u0275fromNgModule:!0}}function OO(t,...n){let e=[],r=new Set,o,i=s=>{e.push(s)};return PT(n,s=>{let a=s;HE(a,i,[],r)&&(o||=[],o.push(a))}),o!==void 0&&FO(o,i),e}function FO(t,n){for(let e=0;e<t.length;e++){let{ngModule:r,providers:o}=t[e];VT(o,i=>{n(i,r)})}}function HE(t,n,e,r){if(t=Rr(t),!t)return!1;let o=null,i=RM(t),s=!i&&mf(t);if(!i&&!s){let l=t.ngModule;if(i=RM(l),i)o=l;else return!1}else{if(s&&!s.standalone)return!1;o=t}let a=r.has(o);if(s){if(a)return!1;if(r.add(o),s.dependencies){let l=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let u of l)HE(u,n,e,r)}}else if(i){if(i.imports!=null&&!a){r.add(o);let u;try{PT(i.imports,c=>{HE(c,n,e,r)&&(u||=[],u.push(c))})}finally{}u!==void 0&&FO(u,n)}if(!a){let u=mc(o)||(()=>new o);n({provide:o,useFactory:u,deps:Vo},o),n({provide:RO,useValue:o,multi:!0},o),n({provide:Cm,useValue:()=>nt(o),multi:!0},o)}let l=i.providers;if(l!=null&&!a){let u=t;VT(l,c=>{n(c,u)})}}else return!1;return o!==t&&t.providers!==void 0}function VT(t,n){for(let e of t)EO(e)&&(e=e.\u0275providers),Array.isArray(e)?VT(e,n):n(e)}var CZ=zt({provide:String,useValue:zt});function $O(t){return t!==null&&typeof t=="object"&&CZ in t}function SZ(t){return!!(t&&t.useExisting)}function IZ(t){return!!(t&&t.useFactory)}function gf(t){return typeof t=="function"}function EZ(t){return!!t.useClass}var Tv=new ke(""),Kx={},$M={},NE;function BT(){return NE===void 0&&(NE=new ov),NE}var zo=class{},Sm=class extends zo{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,qE(n,s=>this.processProvider(s)),this.records.set(AO,pf(void 0,this)),o.has("environment")&&this.records.set(zo,pf(void 0,this));let i=this.records.get(Tv);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(RO,Vo,Ye.Self))}retrieve(n,e){let r=e;return this.get(n,r.optional?wx:dc,r)}destroy(){xm(this),this._destroyed=!0;let n=st(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of e)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),st(n)}}onDestroy(n){return xm(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){xm(this);let e=Ns(this),r=Xr(void 0),o;try{return n()}finally{Ns(e),Xr(r)}}get(n,e=dc,r=Ye.Default){if(xm(this),n.hasOwnProperty(OM))return n[OM](this);r=Ev(r);let o,i=Ns(this),s=Xr(void 0);try{if(!(r&Ye.SkipSelf)){let l=this.records.get(n);if(l===void 0){let u=kZ(n)&&Iv(n);u&&this.injectableDefInScope(u)?l=pf(jE(n),Kx):l=null,this.records.set(n,l)}if(l!=null)return this.hydrate(n,l,r)}let a=r&Ye.Self?BT():this.parent;return e=r&Ye.Optional&&e===dc?null:e,a.get(n,e)}catch(a){if(a.name==="NullInjectorError"){if((a[nv]=a[nv]||[]).unshift(Yr(n)),i)throw a;return cZ(a,n,"R3InjectorError",this.source)}else throw a}finally{Xr(s),Ns(i)}}resolveInjectorInitializers(){let n=st(null),e=Ns(this),r=Xr(void 0),o;try{let i=this.get(Cm,Vo,Ye.Self);for(let s of i)s()}finally{Ns(e),Xr(r),st(n)}}toString(){let n=[],e=this.records;for(let r of e.keys())n.push(Yr(r));return`R3Injector[${n.join(", ")}]`}processProvider(n){n=Rr(n);let e=gf(n)?n:Rr(n&&n.provide),r=_Z(n);if(!gf(n)&&n.multi===!0){let o=this.records.get(e);o||(o=pf(void 0,Kx,!0),o.factory=()=>WE(o.multi),this.records.set(e,o)),e=n,o.multi.push(n)}this.records.set(e,r)}hydrate(n,e,r){let o=st(null);try{return e.value===$M?TO(Yr(n)):e.value===Kx&&(e.value=$M,e.value=e.factory(void 0,r)),typeof e.value=="object"&&e.value&&DZ(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{st(o)}}injectableDefInScope(n){if(!n.providedIn)return!1;let e=Rr(n.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){let e=this._onDestroyHooks.indexOf(n);e!==-1&&this._onDestroyHooks.splice(e,1)}};function jE(t){let n=Iv(t),e=n!==null?n.factory:mc(t);if(e!==null)return e;if(t instanceof ke)throw new Ne(204,!1);if(t instanceof Function)return TZ(t);throw new Ne(204,!1)}function TZ(t){if(t.length>0)throw new Ne(204,!1);let e=ZY(t);return e!==null?()=>e.factory(t):()=>new t}function _Z(t){if($O(t))return pf(void 0,t.useValue);{let n=PO(t);return pf(n,Kx)}}function PO(t,n,e){let r;if(gf(t)){let o=Rr(t);return mc(o)||jE(o)}else if($O(t))r=()=>Rr(t.useValue);else if(IZ(t))r=()=>t.useFactory(...WE(t.deps||[]));else if(SZ(t))r=(o,i)=>nt(Rr(t.useExisting),i!==void 0&&i&Ye.Optional?Ye.Optional:void 0);else{let o=Rr(t&&(t.useClass||t.provide));if(NZ(t))r=()=>new o(...WE(t.deps));else return mc(o)||jE(o)}return r}function xm(t){if(t.destroyed)throw new Ne(205,!1)}function pf(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function NZ(t){return!!t.deps}function DZ(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function kZ(t){return typeof t=="function"||typeof t=="object"&&t instanceof ke}function qE(t,n){for(let e of t)Array.isArray(e)?qE(e,n):e&&EO(e)?qE(e.\u0275providers,n):n(e)}function Ci(t,n){let e;t instanceof Sm?(xm(t),e=t):e=new tv(t);let r,o=Ns(e),i=Xr(void 0);try{return n()}finally{Ns(o),Xr(i)}}function AZ(){return _O()!==void 0||fm()!=null}function RZ(t){return typeof t=="function"}var $s=0,tt=1,We=2,yr=3,bi=4,Si=5,iv=6,sv=7,Zr=8,yf=9,kl=10,Pn=11,Im=12,PM=13,Cf=14,ji=15,yc=16,ff=17,Rs=18,_v=19,LO=20,Nl=21,DE=22,av=23,Bo=24,kE=25,wi=26,VO=1;var xc=7,lv=8,xf=9,wo=10;function Dl(t){return Array.isArray(t)&&typeof t[VO]=="object"}function Ps(t){return Array.isArray(t)&&t[VO]===!0}function BO(t){return(t.flags&4)!==0}function Sf(t){return t.componentOffset>-1}function zT(t){return(t.flags&1)===1}function qi(t){return!!t.template}function uv(t){return(t[We]&512)!==0}function If(t){return(t[We]&256)===256}var KE=class{previousValue;currentValue;firstChange;constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}};function zO(t,n,e,r){n!==null?n.applyValueToInputSignal(n,r):t[e]=r}var Ef=(()=>{let t=()=>UO;return t.ngInherit=!0,t})();function UO(t){return t.type.prototype.ngOnChanges&&(t.setInput=OZ),MZ}function MZ(){let t=WO(this),n=t?.current;if(n){let e=t.previous;if(e===gc)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function OZ(t,n,e,r,o){let i=this.declaredInputs[r],s=WO(t)||FZ(t,{previous:gc,current:null}),a=s.current||(s.current={}),l=s.previous,u=l[i];a[i]=new KE(u&&u.currentValue,e,l===gc),zO(t,n,o,e)}var GO="__ngSimpleChanges__";function WO(t){return t[GO]||null}function FZ(t,n){return t[GO]=n}var LM=null;var qt=function(t,n=null,e){LM?.(t,n,e)},$Z="svg",PZ="math";function Ki(t){for(;Array.isArray(t);)t=t[$s];return t}function HO(t,n){return Ki(n[t])}function Zi(t,n){return Ki(n[t.index])}function jO(t,n){return t.data[n]}function LZ(t,n){return t[n]}function VZ(t,n,e,r){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=r}function Xi(t,n){let e=n[t];return Dl(e)?e:e[$s]}function BZ(t){return(t[We]&4)===4}function UT(t){return(t[We]&128)===128}function zZ(t){return Ps(t[yr])}function cv(t,n){return n==null?null:t[n]}function qO(t){t[ff]=0}function KO(t){t[We]&1024||(t[We]|=1024,UT(t)&&Dv(t))}function UZ(t,n){for(;t>0;)n=n[Cf],t--;return n}function Nv(t){return!!(t[We]&9216||t[Bo]?.dirty)}function XE(t){t[kl].changeDetectionScheduler?.notify(8),t[We]&64&&(t[We]|=1024),Nv(t)&&Dv(t)}function Dv(t){t[kl].changeDetectionScheduler?.notify(0);let n=vc(t);for(;n!==null&&!(n[We]&8192||(n[We]|=8192,!UT(n)));)n=vc(n)}function XO(t,n){if(If(t))throw new Ne(911,!1);t[Nl]===null&&(t[Nl]=[]),t[Nl].push(n)}function GZ(t,n){if(t[Nl]===null)return;let e=t[Nl].indexOf(n);e!==-1&&t[Nl].splice(e,1)}function vc(t){let n=t[yr];return Ps(n)?n[yr]:n}function GT(t){return t[sv]??=[]}function WT(t){return t.cleanup??=[]}function WZ(t,n,e,r){let o=GT(n);o.push(e),t.firstCreatePass&&WT(t).push(r,o.length-1)}var rt={lFrame:o2(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var YE=!1;function HZ(){return rt.lFrame.elementDepthCount}function jZ(){rt.lFrame.elementDepthCount++}function qZ(){rt.lFrame.elementDepthCount--}function YO(){return rt.bindingsEnabled}function KZ(){return rt.skipHydrationRootTNode!==null}function XZ(t){return rt.skipHydrationRootTNode===t}function YZ(){rt.skipHydrationRootTNode=null}function Mt(){return rt.lFrame.lView}function xr(){return rt.lFrame.tView}function He(t){return rt.lFrame.contextLView=t,t[Zr]}function je(t){return rt.lFrame.contextLView=null,t}function Go(){let t=ZO();for(;t!==null&&t.type===64;)t=t.parent;return t}function ZO(){return rt.lFrame.currentTNode}function ZZ(){let t=rt.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}function Mm(t,n){let e=rt.lFrame;e.currentTNode=t,e.isParent=n}function QO(){return rt.lFrame.isParent}function QZ(){rt.lFrame.isParent=!1}function JO(){return YE}function VM(t){let n=YE;return YE=t,n}function JZ(){let t=rt.lFrame,n=t.bindingRootIndex;return n===-1&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function eQ(){return rt.lFrame.bindingIndex}function tQ(t){return rt.lFrame.bindingIndex=t}function kv(){return rt.lFrame.bindingIndex++}function e2(t){let n=rt.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function nQ(){return rt.lFrame.inI18n}function rQ(t,n){let e=rt.lFrame;e.bindingIndex=e.bindingRootIndex=t,ZE(n)}function oQ(){return rt.lFrame.currentDirectiveIndex}function ZE(t){rt.lFrame.currentDirectiveIndex=t}function iQ(t){let n=rt.lFrame.currentDirectiveIndex;return n===-1?null:t[n]}function t2(){return rt.lFrame.currentQueryIndex}function HT(t){rt.lFrame.currentQueryIndex=t}function sQ(t){let n=t[tt];return n.type===2?n.declTNode:n.type===1?t[Si]:null}function n2(t,n,e){if(e&Ye.SkipSelf){let o=n,i=t;for(;o=o.parent,o===null&&!(e&Ye.Host);)if(o=sQ(i),o===null||(i=i[Cf],o.type&10))break;if(o===null)return!1;n=o,t=i}let r=rt.lFrame=r2();return r.currentTNode=n,r.lView=t,!0}function jT(t){let n=r2(),e=t[tt];rt.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function r2(){let t=rt.lFrame,n=t===null?null:t.child;return n===null?o2(t):n}function o2(t){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=n),n}function i2(){let t=rt.lFrame;return rt.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var s2=i2;function qT(){let t=i2();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function aQ(t){return(rt.lFrame.contextLView=UZ(t,rt.lFrame.contextLView))[Zr]}function _c(){return rt.lFrame.selectedIndex}function bc(t){rt.lFrame.selectedIndex=t}function KT(){let t=rt.lFrame;return jO(t.tView,t.selectedIndex)}function lQ(){return rt.lFrame.currentNamespace}var a2=!0;function XT(){return a2}function YT(t){a2=t}function uQ(t,n,e){let{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=n.type.prototype;if(r){let s=UO(n);(e.preOrderHooks??=[]).push(t,s),(e.preOrderCheckHooks??=[]).push(t,s)}o&&(e.preOrderHooks??=[]).push(0-t,o),i&&((e.preOrderHooks??=[]).push(t,i),(e.preOrderCheckHooks??=[]).push(t,i))}function l2(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){let i=t.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:u,ngOnDestroy:c}=i;s&&(t.contentHooks??=[]).push(-e,s),a&&((t.contentHooks??=[]).push(e,a),(t.contentCheckHooks??=[]).push(e,a)),l&&(t.viewHooks??=[]).push(-e,l),u&&((t.viewHooks??=[]).push(e,u),(t.viewCheckHooks??=[]).push(e,u)),c!=null&&(t.destroyHooks??=[]).push(e,c)}}function Xx(t,n,e){u2(t,n,3,e)}function Yx(t,n,e,r){(t[We]&3)===e&&u2(t,n,e,r)}function AE(t,n){let e=t[We];(e&3)===n&&(e&=16383,e+=1,t[We]=e)}function u2(t,n,e,r){let o=r!==void 0?t[ff]&65535:0,i=r??-1,s=n.length-1,a=0;for(let l=o;l<s;l++)if(typeof n[l+1]=="number"){if(a=n[l],r!=null&&a>=r)break}else n[l]<0&&(t[ff]+=65536),(a<i||i==-1)&&(cQ(t,e,n,l),t[ff]=(t[ff]&4294901760)+l+2),l++}function BM(t,n){qt(4,t,n);let e=st(null);try{n.call(t)}finally{st(e),qt(5,t,n)}}function cQ(t,n,e,r){let o=e[r]<0,i=e[r+1],s=o?-e[r]:e[r],a=t[s];o?t[We]>>14<t[ff]>>16&&(t[We]&3)===n&&(t[We]+=16384,BM(a,i)):BM(a,i)}var hf=-1,wc=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,e,r){this.factory=n,this.canSeeViewProviders=e,this.injectImpl=r}};function pQ(t){return(t.flags&8)!==0}function fQ(t){return(t.flags&16)!==0}function dQ(t,n,e){let r=0;for(;r<e.length;){let o=e[r];if(typeof o=="number"){if(o!==0)break;r++;let i=e[r++],s=e[r++],a=e[r++];t.setAttribute(n,s,a,i)}else{let i=o,s=e[++r];mQ(i)?t.setProperty(n,i,s):t.setAttribute(n,i,s),r++}}return r}function hQ(t){return t===3||t===4||t===6}function mQ(t){return t.charCodeAt(0)===64}function Em(t,n){if(!(n===null||n.length===0))if(t===null||t.length===0)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){let o=n[r];typeof o=="number"?e=o:e===0||(e===-1||e===2?zM(t,e,o,null,n[++r]):zM(t,e,o,null,null))}}return t}function zM(t,n,e,r,o){let i=0,s=t.length;if(n===-1)s=-1;else for(;i<t.length;){let a=t[i++];if(typeof a=="number"){if(a===n){s=-1;break}else if(a>n){s=i-1;break}}}for(;i<t.length;){let a=t[i];if(typeof a=="number")break;if(a===e){o!==null&&(t[i+1]=o);return}i++,o!==null&&i++}s!==-1&&(t.splice(s,0,n),i=s+1),t.splice(i++,0,e),o!==null&&t.splice(i++,0,o)}function c2(t){return t!==hf}function pv(t){return t&32767}function gQ(t){return t>>16}function fv(t,n){let e=gQ(t),r=n;for(;e>0;)r=r[Cf],e--;return r}var QE=!0;function dv(t){let n=QE;return QE=t,n}var yQ=256,p2=yQ-1,f2=5,xQ=0,Hi={};function vQ(t,n,e){let r;typeof e=="string"?r=e.charCodeAt(0)||0:e.hasOwnProperty(bm)&&(r=e[bm]),r==null&&(r=e[bm]=xQ++);let o=r&p2,i=1<<o;n.data[t+(o>>f2)]|=i}function hv(t,n){let e=d2(t,n);if(e!==-1)return e;let r=n[tt];r.firstCreatePass&&(t.injectorIndex=n.length,RE(r.data,t),RE(n,null),RE(r.blueprint,null));let o=ZT(t,n),i=t.injectorIndex;if(c2(o)){let s=pv(o),a=fv(o,n),l=a[tt].data;for(let u=0;u<8;u++)n[i+u]=a[s+u]|l[s+u]}return n[i+8]=o,i}function RE(t,n){t.push(0,0,0,0,0,0,0,0,n)}function d2(t,n){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||n[t.injectorIndex+8]===null?-1:t.injectorIndex}function ZT(t,n){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let e=0,r=null,o=n;for(;o!==null;){if(r=x2(o),r===null)return hf;if(e++,o=o[Cf],r.injectorIndex!==-1)return r.injectorIndex|e<<16}return hf}function JE(t,n,e){vQ(t,n,e)}function h2(t,n,e){if(e&Ye.Optional||t!==void 0)return t;$T(n,"NodeInjector")}function m2(t,n,e,r){if(e&Ye.Optional&&r===void 0&&(r=null),(e&(Ye.Self|Ye.Host))===0){let o=t[yf],i=Xr(void 0);try{return o?o.get(n,r,e&Ye.Optional):NO(n,r,e&Ye.Optional)}finally{Xr(i)}}return h2(r,n,e)}function g2(t,n,e,r=Ye.Default,o){if(t!==null){if(n[We]&2048&&!(r&Ye.Self)){let s=SQ(t,n,e,r,Hi);if(s!==Hi)return s}let i=y2(t,n,e,r,Hi);if(i!==Hi)return i}return m2(n,e,r,o)}function y2(t,n,e,r,o){let i=wQ(e);if(typeof i=="function"){if(!n2(n,t,r))return r&Ye.Host?h2(o,e,r):m2(n,e,r,o);try{let s;if(s=i(r),s==null&&!(r&Ye.Optional))$T(e);else return s}finally{s2()}}else if(typeof i=="number"){let s=null,a=d2(t,n),l=hf,u=r&Ye.Host?n[ji][Si]:null;for((a===-1||r&Ye.SkipSelf)&&(l=a===-1?ZT(t,n):n[a+8],l===hf||!GM(r,!1)?a=-1:(s=n[tt],a=pv(l),n=fv(l,n)));a!==-1;){let c=n[tt];if(UM(i,a,c.data)){let p=bQ(a,n,e,s,r,u);if(p!==Hi)return p}l=n[a+8],l!==hf&&GM(r,n[tt].data[a+8]===u)&&UM(i,a,n)?(s=c,a=pv(l),n=fv(l,n)):a=-1}}return o}function bQ(t,n,e,r,o,i){let s=n[tt],a=s.data[t+8],l=r==null?Sf(a)&&QE:r!=s&&(a.type&3)!==0,u=o&Ye.Host&&i===a,c=Zx(a,s,e,l,u);return c!==null?Tm(n,s,c,a,o):Hi}function Zx(t,n,e,r,o){let i=t.providerIndexes,s=n.data,a=i&1048575,l=t.directiveStart,u=t.directiveEnd,c=i>>20,p=r?a:a+c,f=o?a+c:u;for(let d=p;d<f;d++){let h=s[d];if(d<l&&e===h||d>=l&&h.type===e)return d}if(o){let d=s[l];if(d&&qi(d)&&d.type===e)return l}return null}function Tm(t,n,e,r,o){let i=t[e],s=n.data;if(i instanceof wc){let a=i;a.resolving&&TO(rZ(s[e]));let l=dv(a.canSeeViewProviders);a.resolving=!0;let u,c=a.injectImpl?Xr(a.injectImpl):null,p=n2(t,r,Ye.Default);try{i=t[e]=a.factory(void 0,o,s,t,r),n.firstCreatePass&&e>=r.directiveStart&&uQ(e,s[e],n)}finally{c!==null&&Xr(c),dv(l),a.resolving=!1,s2()}}return i}function wQ(t){if(typeof t=="string")return t.charCodeAt(0)||0;let n=t.hasOwnProperty(bm)?t[bm]:void 0;return typeof n=="number"?n>=0?n&p2:CQ:n}function UM(t,n,e){let r=1<<t;return!!(e[n+(t>>f2)]&r)}function GM(t,n){return!(t&Ye.Self)&&!(t&Ye.Host&&n)}var hc=class{_tNode;_lView;constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return g2(this._tNode,this._lView,n,Ev(r),e)}};function CQ(){return new hc(Go(),Mt())}function Wo(t){return Am(()=>{let n=t.prototype.constructor,e=n[ev]||eT(n),r=Object.prototype,o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==r;){let i=o[ev]||eT(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function eT(t){return wO(t)?()=>{let n=eT(Rr(t));return n&&n()}:mc(t)}function SQ(t,n,e,r,o){let i=t,s=n;for(;i!==null&&s!==null&&s[We]&2048&&!uv(s);){let a=y2(i,s,e,r|Ye.Self,Hi);if(a!==Hi)return a;let l=i.parent;if(!l){let u=s[LO];if(u){let c=u.get(e,Hi,r);if(c!==Hi)return c}l=x2(s),s=s[Cf]}i=l}return o}function x2(t){let n=t[tt],e=n.type;return e===2?n.declTNode:e===1?t[Si]:null}function WM(t,n=null,e=null,r){let o=v2(t,n,e,r);return o.resolveInjectorInitializers(),o}function v2(t,n=null,e=null,r,o=new Set){let i=[e||Vo,wZ(t)];return r=r||(typeof t=="object"?void 0:Yr(t)),new Sm(i,n||BT(),r||null,o)}var Ms=class t{static THROW_IF_NOT_FOUND=dc;static NULL=new ov;static create(n,e){if(Array.isArray(n))return WM({name:""},e,n,"");{let r=n.name??"";return WM({name:r},n.parent,n.providers,r)}}static \u0275prov=Pe({token:t,providedIn:"any",factory:()=>nt(AO)});static __NG_ELEMENT_ID__=-1};var IQ=new ke("");IQ.__NG_ELEMENT_ID__=t=>{let n=Go();if(n===null)throw new Ne(204,!1);if(n.type&2)return n.value;if(t&Ye.Optional)return null;throw new Ne(204,!1)};var b2=!1,Av=(()=>{class t{static __NG_ELEMENT_ID__=EQ;static __NG_ENV_ID__=e=>e}return t})(),tT=class extends Av{_lView;constructor(n){super(),this._lView=n}onDestroy(n){let e=this._lView;return If(e)?(n(),()=>{}):(XO(e,n),()=>GZ(e,n))}};function EQ(){return new tT(Mt())}var _m=class{},QT=new ke("",{providedIn:"root",factory:()=>!1});var w2=new ke(""),C2=new ke(""),Tf=(()=>{class t{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new ir(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=Pe({token:t,providedIn:"root",factory:()=>new t})}return t})();var nT=class extends Sn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,AZ()&&(this.destroyRef=ge(Av,{optional:!0})??void 0,this.pendingTasks=ge(Tf,{optional:!0})??void 0)}emit(n){let e=st(null);try{super.next(n)}finally{st(e)}}subscribe(n,e,r){let o=n,i=e||(()=>null),s=r;if(n&&typeof n=="object"){let l=n;o=l.next?.bind(l),i=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(i=this.wrapInTimeout(i),o&&(o=this.wrapInTimeout(o)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:o,error:i,complete:s});return n instanceof Cn&&n.add(a),a}wrapInTimeout(n){return e=>{let r=this.pendingTasks?.add();setTimeout(()=>{try{n(e)}finally{r!==void 0&&this.pendingTasks?.remove(r)}})}}},Jt=nT;function mv(...t){}function S2(t){let n,e;function r(){t=mv;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),n!==void 0&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{t(),r()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{t(),r()})),()=>r()}function HM(t){return queueMicrotask(()=>t()),()=>{t=mv}}var JT="isAngularZone",gv=JT+"_ID",TQ=0,Zn=class t{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Jt(!1);onMicrotaskEmpty=new Jt(!1);onStable=new Jt(!1);onError=new Jt(!1);constructor(n){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:i=b2}=n;if(typeof Zone>"u")throw new Ne(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!o&&r,s.shouldCoalesceRunChangeDetection=o,s.callbackScheduled=!1,s.scheduleInRootZone=i,DQ(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(JT)===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new Ne(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new Ne(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,o){let i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+o,n,_Q,mv,mv);try{return i.runTask(s,e,r)}finally{i.cancelTask(s)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}},_Q={};function e_(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function NQ(t){if(t.isCheckStableRunning||t.callbackScheduled)return;t.callbackScheduled=!0;function n(){S2(()=>{t.callbackScheduled=!1,rT(t),t.isCheckStableRunning=!0,e_(t),t.isCheckStableRunning=!1})}t.scheduleInRootZone?Zone.root.run(()=>{n()}):t._outer.run(()=>{n()}),rT(t)}function DQ(t){let n=()=>{NQ(t)},e=TQ++;t._inner=t._inner.fork({name:"angular",properties:{[JT]:!0,[gv]:e,[gv+e]:!0},onInvokeTask:(r,o,i,s,a,l)=>{if(kQ(l))return r.invokeTask(i,s,a,l);try{return jM(t),r.invokeTask(i,s,a,l)}finally{(t.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&n(),qM(t)}},onInvoke:(r,o,i,s,a,l,u)=>{try{return jM(t),r.invoke(i,s,a,l,u)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!AQ(l)&&n(),qM(t)}},onHasTask:(r,o,i,s)=>{r.hasTask(i,s),o===i&&(s.change=="microTask"?(t._hasPendingMicrotasks=s.microTask,rT(t),e_(t)):s.change=="macroTask"&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(r,o,i,s)=>(r.handleError(i,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}function rT(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.callbackScheduled===!0?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function jM(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function qM(t){t._nesting--,e_(t)}var oT=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Jt;onMicrotaskEmpty=new Jt;onStable=new Jt;onError=new Jt;run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,o){return n.apply(e,r)}};function kQ(t){return I2(t,"__ignore_ng_zone__")}function AQ(t){return I2(t,"__scheduler_tick__")}function I2(t,n){return!Array.isArray(t)||t.length!==1?!1:t[0]?.data?.[n]===!0}var Os=class{_console=console;handleError(n){this._console.error("ERROR",n)}},RQ=new ke("",{providedIn:"root",factory:()=>{let t=ge(Zn),n=ge(Os);return e=>t.runOutsideAngular(()=>n.handleError(e))}});function KM(t,n){return vO(t,n)}function MQ(t){return vO(xO,t)}var E2=(KM.required=MQ,KM);function OQ(){return _f(Go(),Mt())}function _f(t,n){return new Qi(Zi(t,n))}var Qi=(()=>{class t{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=OQ}return t})();function FQ(t){return t instanceof Qi?t.nativeElement:t}function $Q(t){return typeof t=="function"&&t[Lo]!==void 0}function Rv(t,n){let e=lE(t,n?.equal),r=e[Lo];return e.set=o=>pm(r,o),e.update=o=>uE(r,o),e.asReadonly=PQ.bind(e),e}function PQ(){let t=this[Lo];if(t.readonlyFn===void 0){let n=()=>this();n[Lo]=t,t.readonlyFn=n}return t.readonlyFn}function T2(t){return $Q(t)&&typeof t.set=="function"}function LQ(){return this._results[Symbol.iterator]()}var iT=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new Sn}constructor(n=!1){this._emitDistinctChangesOnly=n}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){this.dirty=!1;let r=mZ(n);(this._changesDetected=!hZ(this._results,r,e))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=LQ};function _2(t){return(t.flags&128)===128}var N2=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(N2||{}),D2=new Map,VQ=0;function BQ(){return VQ++}function zQ(t){D2.set(t[_v],t)}function sT(t){D2.delete(t[_v])}var XM="__ngContext__";function Om(t,n){Dl(n)?(t[XM]=n[_v],zQ(n)):t[XM]=n}function k2(t){return R2(t[Im])}function A2(t){return R2(t[bi])}function R2(t){for(;t!==null&&!Ps(t);)t=t[bi];return t}var aT;function M2(t){aT=t}function UQ(){if(aT!==void 0)return aT;if(typeof document<"u")return document;throw new Ne(210,!1)}var t_=new ke("",{providedIn:"root",factory:()=>GQ}),GQ="ng",n_=new ke(""),Fm=new ke("",{providedIn:"platform",factory:()=>"unknown"});var r_=new ke("",{providedIn:"root",factory:()=>UQ().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var WQ="h",HQ="b";var O2=!1,jQ=new ke("",{providedIn:"root",factory:()=>O2});var F2=function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t}(F2||{}),Mv=new ke(""),YM=new Set;function o_(t){YM.has(t)||(YM.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}var qQ=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=Pe({token:t,providedIn:"root",factory:()=>new t})}return t})();var KQ=(t,n,e,r)=>{};function XQ(t,n,e,r){KQ(t,n,e,r)}var YQ=()=>null;function $2(t,n,e=!1){return YQ(t,n,e)}function P2(t,n){let e=t.contentQueries;if(e!==null){let r=st(null);try{for(let o=0;o<e.length;o+=2){let i=e[o],s=e[o+1];if(s!==-1){let a=t.data[s];HT(i),a.contentQueries(2,n[s],s)}}}finally{st(r)}}}function lT(t,n,e){HT(0);let r=st(null);try{n(t,e)}finally{st(r)}}function L2(t,n,e){if(BO(n)){let r=st(null);try{let o=n.directiveStart,i=n.directiveEnd;for(let s=o;s<i;s++){let a=t.data[s];if(a.contentQueries){let l=e[s];a.contentQueries(1,l,s)}}}finally{st(r)}}}var Yi=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Yi||{});var uT=class{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${WY})`}};function ZQ(t){return t instanceof uT?t.changingThisBreaksApplicationSecurity:t}function V2(t){return t instanceof Function?t():t}function QQ(t,n,e){let r=t.length;for(;;){let o=t.indexOf(n,e);if(o===-1)return o;if(o===0||t.charCodeAt(o-1)<=32){let i=n.length;if(o+i===r||t.charCodeAt(o+i)<=32)return o}e=o+1}}var B2="ng-template";function JQ(t,n,e,r){let o=0;if(r){for(;o<n.length&&typeof n[o]=="string";o+=2)if(n[o]==="class"&&QQ(n[o+1].toLowerCase(),e,0)!==-1)return!0}else if(i_(t))return!1;if(o=n.indexOf(1,o),o>-1){let i;for(;++o<n.length&&typeof(i=n[o])=="string";)if(i.toLowerCase()===e)return!0}return!1}function i_(t){return t.type===4&&t.value!==B2}function eJ(t,n,e){let r=t.type===4&&!e?B2:t.value;return n===r}function tJ(t,n,e){let r=4,o=t.attrs,i=o!==null?oJ(o):0,s=!1;for(let a=0;a<n.length;a++){let l=n[a];if(typeof l=="number"){if(!s&&!vi(r)&&!vi(l))return!1;if(s&&vi(l))continue;s=!1,r=l|r&1;continue}if(!s)if(r&4){if(r=2|r&1,l!==""&&!eJ(t,l,e)||l===""&&n.length===1){if(vi(r))return!1;s=!0}}else if(r&8){if(o===null||!JQ(t,o,l,e)){if(vi(r))return!1;s=!0}}else{let u=n[++a],c=nJ(l,o,i_(t),e);if(c===-1){if(vi(r))return!1;s=!0;continue}if(u!==""){let p;if(c>i?p="":p=o[c+1].toLowerCase(),r&2&&u!==p){if(vi(r))return!1;s=!0}}}}return vi(r)||s}function vi(t){return(t&1)===0}function nJ(t,n,e,r){if(n===null)return-1;let o=0;if(r||!e){let i=!1;for(;o<n.length;){let s=n[o];if(s===t)return o;if(s===3||s===6)i=!0;else if(s===1||s===2){let a=n[++o];for(;typeof a=="string";)a=n[++o];continue}else{if(s===4)break;if(s===0){o+=4;continue}}o+=i?1:2}return-1}else return iJ(n,t)}function rJ(t,n,e=!1){for(let r=0;r<n.length;r++)if(tJ(t,n[r],e))return!0;return!1}function oJ(t){for(let n=0;n<t.length;n++){let e=t[n];if(hQ(e))return n}return t.length}function iJ(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){let r=t[e];if(typeof r=="number")return-1;if(r===n)return e;e++}return-1}function ZM(t,n){return t?":not("+n.trim()+")":n}function sJ(t){let n=t[0],e=1,r=2,o="",i=!1;for(;e<t.length;){let s=t[e];if(typeof s=="string")if(r&2){let a=t[++e];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else r&8?o+="."+s:r&4&&(o+=" "+s);else o!==""&&!vi(s)&&(n+=ZM(i,o),o=""),r=s,i=i||!vi(r);e++}return o!==""&&(n+=ZM(i,o)),n}function aJ(t){return t.map(sJ).join(",")}function lJ(t){let n=[],e=[],r=1,o=2;for(;r<t.length;){let i=t[r];if(typeof i=="string")o===2?i!==""&&n.push(i,t[++r]):o===8&&e.push(i);else{if(!vi(o))break;o=i}r++}return e.length&&n.push(1,...e),n}var Ls={};function uJ(t,n){return t.createText(n)}function cJ(t,n,e){t.setValue(n,e)}function z2(t,n,e){return t.createElement(n,e)}function yv(t,n,e,r,o){t.insertBefore(n,e,r,o)}function U2(t,n,e){t.appendChild(n,e)}function QM(t,n,e,r,o){r!==null?yv(t,n,e,r,o):U2(t,n,e)}function pJ(t,n,e){t.removeChild(null,n,e)}function fJ(t,n,e){t.setAttribute(n,"style",e)}function dJ(t,n,e){e===""?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function G2(t,n,e){let{mergedAttrs:r,classes:o,styles:i}=e;r!==null&&dQ(t,n,r),o!==null&&dJ(t,n,o),i!==null&&fJ(t,n,i)}function s_(t,n,e,r,o,i,s,a,l,u,c){let p=wi+r,f=p+o,d=hJ(p,f),h=typeof u=="function"?u():u;return d[tt]={type:t,blueprint:d,template:e,queries:null,viewQuery:a,declTNode:n,data:d.slice().fill(null,p),bindingStartIndex:p,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:l,consts:h,incompleteFirstPass:!1,ssrId:c}}function hJ(t,n){let e=[];for(let r=0;r<n;r++)e.push(r<t?null:Ls);return e}function mJ(t){let n=t.tView;return n===null||n.incompleteFirstPass?t.tView=s_(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function a_(t,n,e,r,o,i,s,a,l,u,c){let p=n.blueprint.slice();return p[$s]=o,p[We]=r|4|128|8|64|1024,(u!==null||t&&t[We]&2048)&&(p[We]|=2048),qO(p),p[yr]=p[Cf]=t,p[Zr]=e,p[kl]=s||t&&t[kl],p[Pn]=a||t&&t[Pn],p[yf]=l||t&&t[yf]||null,p[Si]=i,p[_v]=BQ(),p[iv]=c,p[LO]=u,p[ji]=n.type==2?t[ji]:p,p}function gJ(t,n,e){let r=Zi(n,t),o=mJ(e),i=t[kl].rendererFactory,s=l_(t,a_(t,o,null,W2(e),r,n,null,i.createRenderer(r,e),null,null,null));return t[n.index]=s}function W2(t){let n=16;return t.signals?n=4096:t.onPush&&(n=64),n}function H2(t,n,e,r){if(e===0)return-1;let o=n.length;for(let i=0;i<e;i++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function l_(t,n){return t[Im]?t[PM][bi]=n:t[Im]=n,t[PM]=n,n}function he(t=1){j2(xr(),Mt(),_c()+t,!1)}function j2(t,n,e,r){if(!r)if((n[We]&3)===3){let i=t.preOrderCheckHooks;i!==null&&Xx(n,i,e)}else{let i=t.preOrderHooks;i!==null&&Yx(n,i,0,e)}bc(e)}var Ov=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(Ov||{});function cT(t,n,e,r){let o=st(null);try{let[i,s,a]=t.inputs[e],l=null;(s&Ov.SignalBased)!==0&&(l=n[i][Lo]),l!==null&&l.transformFn!==void 0?r=l.transformFn(r):a!==null&&(r=a.call(n,r)),t.setInput!==null?t.setInput(n,l,r,e,i):zO(n,l,i,r)}finally{st(o)}}function q2(t,n,e,r,o){let i=_c(),s=r&2;try{bc(-1),s&&n.length>wi&&j2(t,n,wi,!1),qt(s?2:0,o),e(r,o)}finally{bc(i),qt(s?3:1,o)}}function u_(t,n,e){CJ(t,n,e),(e.flags&64)===64&&SJ(t,n,e)}function K2(t,n,e=Zi){let r=n.localNames;if(r!==null){let o=n.index+1;for(let i=0;i<r.length;i+=2){let s=r[i+1],a=s===-1?e(n,t):t[s];t[o++]=a}}}function yJ(t,n,e,r){let i=r.get(jQ,O2)||e===Yi.ShadowDom,s=t.selectRootElement(n,i);return xJ(s),s}function xJ(t){vJ(t)}var vJ=()=>null;function bJ(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function X2(t,n,e,r,o,i,s,a){if(!a&&c_(n,t,e,r,o)){Sf(n)&&wJ(e,n.index);return}if(n.type&3){let l=Zi(n,e);r=bJ(r),o=s!=null?s(o,n.value||"",r):o,i.setProperty(l,r,o)}else n.type&12}function wJ(t,n){let e=Xi(n,t);e[We]&16||(e[We]|=64)}function CJ(t,n,e){let r=e.directiveStart,o=e.directiveEnd;Sf(e)&&gJ(n,e,t.data[r+e.componentOffset]),t.firstCreatePass||hv(e,n);let i=e.initialInputs;for(let s=r;s<o;s++){let a=t.data[s],l=Tm(n,t,s,e);if(Om(l,n),i!==null&&_J(n,s-r,l,a,e,i),qi(a)){let u=Xi(e.index,n);u[Zr]=Tm(n,t,s,e)}}}function SJ(t,n,e){let r=e.directiveStart,o=e.directiveEnd,i=e.index,s=oQ();try{bc(i);for(let a=r;a<o;a++){let l=t.data[a],u=n[a];ZE(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&IJ(l,u)}}finally{bc(-1),ZE(s)}}function IJ(t,n){t.hostBindings!==null&&t.hostBindings(1,n)}function Y2(t,n){let e=t.directiveRegistry,r=null;if(e)for(let o=0;o<e.length;o++){let i=e[o];rJ(n,i.selectors,!1)&&(r??=[],qi(i)?r.unshift(i):r.push(i))}return r}function EJ(t,n,e,r,o,i){let s=Zi(t,n);TJ(n[Pn],s,i,t.value,e,r,o)}function TJ(t,n,e,r,o,i,s){if(i==null)t.removeAttribute(n,o,e);else{let a=s==null?wm(i):s(i,r||"",o);t.setAttribute(n,o,a,e)}}function _J(t,n,e,r,o,i){let s=i[n];if(s!==null)for(let a=0;a<s.length;a+=2){let l=s[a],u=s[a+1];cT(r,e,l,u)}}function NJ(t,n){let e=t[yf],r=e?e.get(Os,null):null;r&&r.handleError(n)}function c_(t,n,e,r,o){let i=t.inputs?.[r],s=t.hostDirectiveInputs?.[r],a=!1;if(s)for(let l=0;l<s.length;l+=2){let u=s[l],c=s[l+1],p=n.data[u];cT(p,e[u],c,o),a=!0}if(i)for(let l of i){let u=e[l],c=n.data[l];cT(c,u,r,o),a=!0}return a}function DJ(t,n){let e=Xi(n,t),r=e[tt];kJ(r,e);let o=e[$s];o!==null&&e[iv]===null&&(e[iv]=$2(o,e[yf])),qt(18),p_(r,e,e[Zr]),qt(19,e[Zr])}function kJ(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}function p_(t,n,e){jT(n);try{let r=t.viewQuery;r!==null&&lT(1,r,e);let o=t.template;o!==null&&q2(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),n[Rs]?.finishViewCreation(t),t.staticContentQueries&&P2(t,n),t.staticViewQueries&&lT(2,t.viewQuery,e);let i=t.components;i!==null&&AJ(n,i)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[We]&=-5,qT()}}function AJ(t,n){for(let e=0;e<n.length;e++)DJ(t,n[e])}function RJ(t,n,e,r){let o=st(null);try{let i=n.tView,a=t[We]&4096?4096:16,l=a_(t,i,e,a,null,n,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),u=t[n.index];l[yc]=u;let c=t[Rs];return c!==null&&(l[Rs]=c.createEmbeddedView(i)),p_(i,l,e),l}finally{st(o)}}function JM(t,n){return!n||n.firstChild===null||_2(t)}var MJ;function f_(t,n){return MJ(t,n)}var Fs=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Fs||{});function Z2(t){return(t.flags&32)===32}function df(t,n,e,r,o){if(r!=null){let i,s=!1;Ps(r)?i=r:Dl(r)&&(s=!0,r=r[$s]);let a=Ki(r);t===0&&e!==null?o==null?U2(n,e,a):yv(n,e,a,o||null,!0):t===1&&e!==null?yv(n,e,a,o||null,!0):t===2?pJ(n,a,s):t===3&&n.destroyNode(a),i!=null&&HJ(n,t,i,e,o)}}function OJ(t,n){Q2(t,n),n[$s]=null,n[Si]=null}function FJ(t,n,e,r,o,i){r[$s]=o,r[Si]=n,Fv(t,r,e,1,o,i)}function Q2(t,n){n[kl].changeDetectionScheduler?.notify(9),Fv(t,n,n[Pn],2,null,null)}function $J(t){let n=t[Im];if(!n)return ME(t[tt],t);for(;n;){let e=null;if(Dl(n))e=n[Im];else{let r=n[wo];r&&(e=r)}if(!e){for(;n&&!n[bi]&&n!==t;)Dl(n)&&ME(n[tt],n),n=n[yr];n===null&&(n=t),Dl(n)&&ME(n[tt],n),e=n&&n[bi]}n=e}}function d_(t,n){let e=t[xf],r=e.indexOf(n);e.splice(r,1)}function J2(t,n){if(If(n))return;let e=n[Pn];e.destroyNode&&Fv(t,n,e,3,null,null),$J(n)}function ME(t,n){if(If(n))return;let e=st(null);try{n[We]&=-129,n[We]|=256,n[Bo]&&iE(n[Bo]),LJ(t,n),PJ(t,n),n[tt].type===1&&n[Pn].destroy();let r=n[yc];if(r!==null&&Ps(n[yr])){r!==n[yr]&&d_(r,n);let o=n[Rs];o!==null&&o.detachView(t)}sT(n)}finally{st(e)}}function PJ(t,n){let e=t.cleanup,r=n[sv];if(e!==null)for(let s=0;s<e.length-1;s+=2)if(typeof e[s]=="string"){let a=e[s+3];a>=0?r[a]():r[-a].unsubscribe(),s+=2}else{let a=r[e[s+1]];e[s].call(a)}r!==null&&(n[sv]=null);let o=n[Nl];if(o!==null){n[Nl]=null;for(let s=0;s<o.length;s++){let a=o[s];a()}}let i=n[av];if(i!==null){n[av]=null;for(let s of i)s.destroy()}}function LJ(t,n){let e;if(t!=null&&(e=t.destroyHooks)!=null)for(let r=0;r<e.length;r+=2){let o=n[e[r]];if(!(o instanceof wc)){let i=e[r+1];if(Array.isArray(i))for(let s=0;s<i.length;s+=2){let a=o[i[s]],l=i[s+1];qt(4,a,l);try{l.call(a)}finally{qt(5,a,l)}}else{qt(4,o,i);try{i.call(o)}finally{qt(5,o,i)}}}}}function VJ(t,n,e){return BJ(t,n.parent,e)}function BJ(t,n,e){let r=n;for(;r!==null&&r.type&168;)n=r,r=n.parent;if(r===null)return e[$s];if(Sf(r)){let{encapsulation:o}=t.data[r.directiveStart+r.componentOffset];if(o===Yi.None||o===Yi.Emulated)return null}return Zi(r,e)}function zJ(t,n,e){return GJ(t,n,e)}function UJ(t,n,e){return t.type&40?Zi(t,e):null}var GJ=UJ,eO;function h_(t,n,e,r){let o=VJ(t,r,n),i=n[Pn],s=r.parent||n[Si],a=zJ(s,r,n);if(o!=null)if(Array.isArray(e))for(let l=0;l<e.length;l++)QM(i,o,e[l],a,!1);else QM(i,o,e,a,!1);eO!==void 0&&eO(i,r,n,e,o)}function vm(t,n){if(n!==null){let e=n.type;if(e&3)return Zi(n,t);if(e&4)return pT(-1,t[n.index]);if(e&8){let r=n.child;if(r!==null)return vm(t,r);{let o=t[n.index];return Ps(o)?pT(-1,o):Ki(o)}}else{if(e&128)return vm(t,n.next);if(e&32)return f_(n,t)()||Ki(t[n.index]);{let r=eF(t,n);if(r!==null){if(Array.isArray(r))return r[0];let o=vc(t[ji]);return vm(o,r)}else return vm(t,n.next)}}}return null}function eF(t,n){if(n!==null){let r=t[ji][Si],o=n.projection;return r.projection[o]}return null}function pT(t,n){let e=wo+t+1;if(e<n.length){let r=n[e],o=r[tt].firstChild;if(o!==null)return vm(r,o)}return n[xc]}function m_(t,n,e,r,o,i,s){for(;e!=null;){if(e.type===128){e=e.next;continue}let a=r[e.index],l=e.type;if(s&&n===0&&(a&&Om(Ki(a),r),e.flags|=2),!Z2(e))if(l&8)m_(t,n,e.child,r,o,i,!1),df(n,t,o,a,i);else if(l&32){let u=f_(e,r),c;for(;c=u();)df(n,t,o,c,i);df(n,t,o,a,i)}else l&16?WJ(t,n,r,e,o,i):df(n,t,o,a,i);e=s?e.projectionNext:e.next}}function Fv(t,n,e,r,o,i){m_(e,r,t.firstChild,n,o,i,!1)}function WJ(t,n,e,r,o,i){let s=e[ji],l=s[Si].projection[r.projection];if(Array.isArray(l))for(let u=0;u<l.length;u++){let c=l[u];df(n,t,o,c,i)}else{let u=l,c=s[yr];_2(r)&&(u.flags|=128),m_(t,n,u,c,o,i,!0)}}function HJ(t,n,e,r,o){let i=e[xc],s=Ki(e);i!==s&&df(n,t,r,i,o);for(let a=wo;a<e.length;a++){let l=e[a];Fv(l[tt],l,t,n,r,i)}}function jJ(t,n,e,r,o){if(n)o?t.addClass(e,r):t.removeClass(e,r);else{let i=r.indexOf("-")===-1?void 0:Fs.DashCase;o==null?t.removeStyle(e,r,i):(typeof o=="string"&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=Fs.Important),t.setStyle(e,r,o,i))}}function xv(t,n,e,r,o=!1){for(;e!==null;){if(e.type===128){e=o?e.projectionNext:e.next;continue}let i=n[e.index];i!==null&&r.push(Ki(i)),Ps(i)&&qJ(i,r);let s=e.type;if(s&8)xv(t,n,e.child,r);else if(s&32){let a=f_(e,n),l;for(;l=a();)r.push(l)}else if(s&16){let a=eF(n,e);if(Array.isArray(a))r.push(...a);else{let l=vc(n[ji]);xv(l[tt],l,a,r,!0)}}e=o?e.projectionNext:e.next}return r}function qJ(t,n){for(let e=wo;e<t.length;e++){let r=t[e],o=r[tt].firstChild;o!==null&&xv(r[tt],r,o,n)}t[xc]!==t[$s]&&n.push(t[xc])}function tF(t){if(t[kE]!==null){for(let n of t[kE])n.impl.addSequence(n);t[kE].length=0}}var nF=[];function KJ(t){return t[Bo]??XJ(t)}function XJ(t){let n=nF.pop()??Object.create(ZJ);return n.lView=t,n}function YJ(t){t.lView[Bo]!==t&&(t.lView=null,nF.push(t))}var ZJ=pt(me({},um),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{Dv(t.lView)},consumerOnSignalRead(){this.lView[Bo]=this}});function QJ(t){let n=t[Bo]??Object.create(JJ);return n.lView=t,n}var JJ=pt(me({},um),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let n=vc(t.lView);for(;n&&!rF(n[tt]);)n=vc(n);n&&KO(n)},consumerOnSignalRead(){this.lView[Bo]=this}});function rF(t){return t.type!==2}function oF(t){if(t[av]===null)return;let n=!0;for(;n;){let e=!1;for(let r of t[av])r.dirty&&(e=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));n=e&&!!(t[We]&8192)}}var eee=100;function iF(t,n=!0,e=0){let o=t[kl].rendererFactory,i=!1;i||o.begin?.();try{tee(t,e)}catch(s){throw n&&NJ(t,s),s}finally{i||o.end?.()}}function tee(t,n){let e=JO();try{VM(!0),fT(t,n);let r=0;for(;Nv(t);){if(r===eee)throw new Ne(103,!1);r++,fT(t,1)}}finally{VM(e)}}function nee(t,n,e,r){if(If(n))return;let o=n[We],i=!1,s=!1;jT(n);let a=!0,l=null,u=null;i||(rF(t)?(u=KJ(n),l=yx(u)):JI()===null?(a=!1,u=QJ(n),l=yx(u)):n[Bo]&&(iE(n[Bo]),n[Bo]=null));try{qO(n),tQ(t.bindingStartIndex),e!==null&&q2(t,n,e,2,r);let c=(o&3)===3;if(!i)if(c){let d=t.preOrderCheckHooks;d!==null&&Xx(n,d,null)}else{let d=t.preOrderHooks;d!==null&&Yx(n,d,0,null),AE(n,0)}if(s||ree(n),oF(n),sF(n,0),t.contentQueries!==null&&P2(t,n),!i)if(c){let d=t.contentCheckHooks;d!==null&&Xx(n,d)}else{let d=t.contentHooks;d!==null&&Yx(n,d,1),AE(n,1)}iee(t,n);let p=t.components;p!==null&&lF(n,p,0);let f=t.viewQuery;if(f!==null&&lT(2,f,r),!i)if(c){let d=t.viewCheckHooks;d!==null&&Xx(n,d)}else{let d=t.viewHooks;d!==null&&Yx(n,d,2),AE(n,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),n[DE]){for(let d of n[DE])d();n[DE]=null}i||(tF(n),n[We]&=-73)}catch(c){throw i||Dv(n),c}finally{u!==null&&(rE(u,l),a&&YJ(u)),qT()}}function sF(t,n){for(let e=k2(t);e!==null;e=A2(e))for(let r=wo;r<e.length;r++){let o=e[r];aF(o,n)}}function ree(t){for(let n=k2(t);n!==null;n=A2(n)){if(!(n[We]&2))continue;let e=n[xf];for(let r=0;r<e.length;r++){let o=e[r];KO(o)}}}function oee(t,n,e){qt(18);let r=Xi(n,t);aF(r,e),qt(19,r[Zr])}function aF(t,n){UT(t)&&fT(t,n)}function fT(t,n){let r=t[tt],o=t[We],i=t[Bo],s=!!(n===0&&o&16);if(s||=!!(o&64&&n===0),s||=!!(o&1024),s||=!!(i?.dirty&&oE(i)),s||=!1,i&&(i.dirty=!1),t[We]&=-9217,s)nee(r,t,r.template,t[Zr]);else if(o&8192){oF(t),sF(t,1);let a=r.components;a!==null&&lF(t,a,1),tF(t)}}function lF(t,n,e){for(let r=0;r<n.length;r++)oee(t,n[r],e)}function iee(t,n){let e=t.hostBindingOpCodes;if(e!==null)try{for(let r=0;r<e.length;r++){let o=e[r];if(o<0)bc(~o);else{let i=o,s=e[++r],a=e[++r];rQ(s,i);let l=n[i];qt(24,l),a(2,l),qt(25,l)}}}finally{bc(-1)}}function g_(t,n){let e=JO()?64:1088;for(t[kl].changeDetectionScheduler?.notify(n);t;){t[We]|=e;let r=vc(t);if(uv(t)&&!r)return t;t=r}return null}function uF(t,n,e,r){return[t,!0,0,n,null,r,null,e,null,null]}function see(t,n,e,r=!0){let o=n[tt];if(aee(o,n,t,e),r){let s=pT(e,t),a=n[Pn],l=a.parentNode(t[xc]);l!==null&&FJ(o,t[Si],a,n,l,s)}let i=n[iv];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function dT(t,n){if(t.length<=wo)return;let e=wo+n,r=t[e];if(r){let o=r[yc];o!==null&&o!==t&&d_(o,r),n>0&&(t[e-1][bi]=r[bi]);let i=rv(t,wo+n);OJ(r[tt],r);let s=i[Rs];s!==null&&s.detachView(i[tt]),r[yr]=null,r[bi]=null,r[We]&=-129}return r}function aee(t,n,e,r){let o=wo+r,i=e.length;r>0&&(e[o-1][bi]=n),r<i-wo?(n[bi]=e[o],kO(e,wo+r,n)):(e.push(n),n[bi]=null),n[yr]=e;let s=n[yc];s!==null&&e!==s&&cF(s,n);let a=n[Rs];a!==null&&a.insertView(t),XE(n),n[We]|=128}function cF(t,n){let e=t[xf],r=n[yr];if(Dl(r))t[We]|=2;else{let o=r[yr][ji];n[ji]!==o&&(t[We]|=2)}e===null?t[xf]=[n]:e.push(n)}var Nm=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let n=this._lView,e=n[tt];return xv(e,n,e.firstChild,[])}constructor(n,e,r=!0){this._lView=n,this._cdRefInjectingView=e,this.notifyErrorHandler=r}get context(){return this._lView[Zr]}set context(n){this._lView[Zr]=n}get destroyed(){return If(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[yr];if(Ps(n)){let e=n[lv],r=e?e.indexOf(this):-1;r>-1&&(dT(n,r),rv(e,r))}this._attachedToViewContainer=!1}J2(this._lView[tt],this._lView)}onDestroy(n){XO(this._lView,n)}markForCheck(){g_(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[We]&=-129}reattach(){XE(this._lView),this._lView[We]|=128}detectChanges(){this._lView[We]|=1024,iF(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ne(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let n=uv(this._lView),e=this._lView[yc];e!==null&&!n&&d_(e,this._lView),Q2(this._lView[tt],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Ne(902,!1);this._appRef=n;let e=uv(this._lView),r=this._lView[yc];r!==null&&!e&&cF(r,this._lView),XE(this._lView)}};var Cc=(()=>{class t{static __NG_ELEMENT_ID__=cee}return t})(),lee=Cc,uee=class extends lee{_declarationLView;_declarationTContainer;elementRef;constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,r){let o=RJ(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:e,dehydratedView:r});return new Nm(o)}};function cee(){return y_(Go(),Mt())}function y_(t,n){return t.type&4?new uee(n,t,_f(t,n)):null}function x_(t,n,e,r,o){let i=t.data[n];if(i===null)i=pee(t,n,e,r,o),nQ()&&(i.flags|=32);else if(i.type&64){i.type=e,i.value=r,i.attrs=o;let s=ZZ();i.injectorIndex=s===null?-1:s.injectorIndex}return Mm(i,!0),i}function pee(t,n,e,r,o){let i=ZO(),s=QO(),a=s?i:i&&i.parent,l=t.data[n]=dee(t,a,e,n,r,o);return fee(t,l,i,s),l}function fee(t,n,e,r){t.firstChild===null&&(t.firstChild=n),e!==null&&(r?e.child==null&&n.parent!==null&&(e.child=n):e.next===null&&(e.next=n,n.prev=e))}function dee(t,n,e,r,o,i){let s=n?n.injectorIndex:-1,a=0;return KZ()&&(a|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var DOe=new RegExp(`^(\\d+)*(${HQ}|${WQ})*(.*)`);var hee=()=>null;function tO(t,n){return hee(t,n)}var mee=class{},pF=class{},hT=class{resolveComponentFactory(n){throw Error(`No component factory found for ${Yr(n)}.`)}},$v=class{static NULL=new hT},vf=class{},Nf=(()=>{class t{destroyNode=null;static __NG_ELEMENT_ID__=()=>gee()}return t})();function gee(){let t=Mt(),n=Go(),e=Xi(n.index,t);return(Dl(e)?e:t)[Pn]}var yee=(()=>{class t{static \u0275prov=Pe({token:t,providedIn:"root",factory:()=>null})}return t})();var OE={},mT=class{injector;parentInjector;constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=Ev(r);let o=this.injector.get(n,OE,r);return o!==OE||e===OE?o:this.parentInjector.get(n,e,r)}};function nO(t,n,e){let r=e?t.styles:null,o=e?t.classes:null,i=0;if(n!==null)for(let s=0;s<n.length;s++){let a=n[s];if(typeof a=="number")i=a;else if(i==1)o=kM(o,a);else if(i==2){let l=a,u=n[++s];r=kM(r,l+": "+u+";")}}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=o:t.classesWithoutHost=o}function xt(t,n=Ye.Default){let e=Mt();if(e===null)return nt(t,n);let r=Go();return g2(r,e,Rr(t),n)}function fF(t,n,e,r,o){let i=r===null?null:{"":-1},s=o(t,e);if(s!==null){let a,l=null,u=null,c=vee(s);c===null?a=s:[a,l,u]=c,Cee(t,n,e,a,i,l,u)}i!==null&&r!==null&&xee(e,r,i)}function xee(t,n,e){let r=t.localNames=[];for(let o=0;o<n.length;o+=2){let i=e[n[o+1]];if(i==null)throw new Ne(-301,!1);r.push(n[o],i)}}function vee(t){let n=null,e=!1;for(let s=0;s<t.length;s++){let a=t[s];if(s===0&&qi(a)&&(n=a),a.findHostDirectiveDefs!==null){e=!0;break}}if(!e)return null;let r=null,o=null,i=null;for(let s of t)s.findHostDirectiveDefs!==null&&(r??=[],o??=new Map,i??=new Map,bee(s,r,i,o)),s===n&&(r??=[],r.push(s));return r!==null?(r.push(...n===null?t:t.slice(1)),[r,o,i]):null}function bee(t,n,e,r){let o=n.length;t.findHostDirectiveDefs(t,n,r),e.set(t,[o,n.length-1])}function wee(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function Cee(t,n,e,r,o,i,s){let a=r.length,l=!1;for(let f=0;f<a;f++){let d=r[f];!l&&qi(d)&&(l=!0,wee(t,e,f)),JE(hv(e,n),t,d.type)}Nee(e,t.data.length,a);for(let f=0;f<a;f++){let d=r[f];d.providersResolver&&d.providersResolver(d)}let u=!1,c=!1,p=H2(t,n,a,null);a>0&&(e.directiveToIndex=new Map);for(let f=0;f<a;f++){let d=r[f];if(e.mergedAttrs=Em(e.mergedAttrs,d.hostAttrs),Iee(t,e,n,p,d),_ee(p,d,o),s!==null&&s.has(d)){let[m,g]=s.get(d);e.directiveToIndex.set(d.type,[p,m+e.directiveStart,g+e.directiveStart])}else(i===null||!i.has(d))&&e.directiveToIndex.set(d.type,p);d.contentQueries!==null&&(e.flags|=4),(d.hostBindings!==null||d.hostAttrs!==null||d.hostVars!==0)&&(e.flags|=64);let h=d.type.prototype;!u&&(h.ngOnChanges||h.ngOnInit||h.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),u=!0),!c&&(h.ngOnChanges||h.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),c=!0),p++}See(t,e,i)}function See(t,n,e){for(let r=n.directiveStart;r<n.directiveEnd;r++){let o=t.data[r];if(e===null||!e.has(o))rO(0,n,o,r),rO(1,n,o,r),iO(n,r,!1);else{let i=e.get(o);oO(0,n,i,r),oO(1,n,i,r),iO(n,r,!0)}}}function rO(t,n,e,r){let o=t===0?e.inputs:e.outputs;for(let i in o)if(o.hasOwnProperty(i)){let s;t===0?s=n.inputs??={}:s=n.outputs??={},s[i]??=[],s[i].push(r),dF(n,i)}}function oO(t,n,e,r){let o=t===0?e.inputs:e.outputs;for(let i in o)if(o.hasOwnProperty(i)){let s=o[i],a;t===0?a=n.hostDirectiveInputs??={}:a=n.hostDirectiveOutputs??={},a[s]??=[],a[s].push(r,i),dF(n,s)}}function dF(t,n){n==="class"?t.flags|=8:n==="style"&&(t.flags|=16)}function iO(t,n,e){let{attrs:r,inputs:o,hostDirectiveInputs:i}=t;if(r===null||!e&&o===null||e&&i===null||i_(t)){t.initialInputs??=[],t.initialInputs.push(null);return}let s=null,a=0;for(;a<r.length;){let l=r[a];if(l===0){a+=4;continue}else if(l===5){a+=2;continue}else if(typeof l=="number")break;if(!e&&o.hasOwnProperty(l)){let u=o[l];for(let c of u)if(c===n){s??=[],s.push(l,r[a+1]);break}}else if(e&&i.hasOwnProperty(l)){let u=i[l];for(let c=0;c<u.length;c+=2)if(u[c]===n){s??=[],s.push(u[c+1],r[a+1]);break}}a+=2}t.initialInputs??=[],t.initialInputs.push(s)}function Iee(t,n,e,r,o){t.data[r]=o;let i=o.factory||(o.factory=mc(o.type,!0)),s=new wc(i,qi(o),xt);t.blueprint[r]=s,e[r]=s,Eee(t,n,r,H2(t,e,o.hostVars,Ls),o)}function Eee(t,n,e,r,o){let i=o.hostBindings;if(i){let s=t.hostBindingOpCodes;s===null&&(s=t.hostBindingOpCodes=[]);let a=~n.index;Tee(s)!=a&&s.push(a),s.push(e,r,i)}}function Tee(t){let n=t.length;for(;n>0;){let e=t[--n];if(typeof e=="number"&&e<0)return e}return 0}function _ee(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;qi(n)&&(e[""]=t)}}function Nee(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}function hF(t,n,e,r,o,i,s,a){let l=n.consts,u=cv(l,s),c=x_(n,t,2,r,u);return i&&fF(n,e,c,cv(l,a),o),c.mergedAttrs=Em(c.mergedAttrs,c.attrs),c.attrs!==null&&nO(c,c.attrs,!1),c.mergedAttrs!==null&&nO(c,c.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,c),c}function mF(t,n){l2(t,n),BO(n)&&t.queries.elementEnd(n)}var vv=class extends $v{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let e=mf(n);return new Dm(e,this.ngModule)}};function Dee(t){return Object.keys(t).map(n=>{let[e,r,o]=t[n],i={propName:e,templateName:n,isSignal:(r&Ov.SignalBased)!==0};return o&&(i.transform=o),i})}function kee(t){return Object.keys(t).map(n=>({propName:t[n],templateName:n}))}function Aee(t,n,e){let r=n instanceof zo?n:n?.injector;return r&&t.getStandaloneInjector!==null&&(r=t.getStandaloneInjector(r)||r),r?new mT(e,r):e}function Ree(t){let n=t.get(vf,null);if(n===null)throw new Ne(407,!1);let e=t.get(yee,null),r=t.get(_m,null);return{rendererFactory:n,sanitizer:e,changeDetectionScheduler:r}}function Mee(t,n){let e=(t.selectors[0][0]||"div").toLowerCase();return z2(n,e,e==="svg"?$Z:e==="math"?PZ:null)}var Dm=class extends pF{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=Dee(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=kee(this.componentDef.outputs),this.cachedOutputs}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=aJ(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!e}create(n,e,r,o){qt(22);let i=st(null);try{let s=this.componentDef,a=r?["ng-version","19.2.13"]:lJ(this.componentDef.selectors[0]),l=s_(0,null,null,1,0,null,null,null,null,[a],null),u=Aee(s,o||this.ngModule,n),c=Ree(u),p=c.rendererFactory.createRenderer(null,s),f=r?yJ(p,r,s.encapsulation,u):Mee(s,p),d=a_(null,l,null,512|W2(s),null,null,c,p,u,null,$2(f,u,!0));d[wi]=f,jT(d);let h=null;try{let m=hF(wi,l,d,"#host",()=>[this.componentDef],!0,0);f&&(G2(p,f,m),Om(f,d)),u_(l,d,m),L2(l,m,d),mF(l,m),e!==void 0&&Oee(m,this.ngContentSelectors,e),h=Xi(m.index,d),d[Zr]=h[Zr],p_(l,d,null)}catch(m){throw h!==null&&sT(h),sT(d),m}finally{qt(23),qT()}return new gT(this.componentType,d)}finally{st(i)}}},gT=class extends mee{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,e){super(),this._rootLView=e,this._tNode=jO(e[tt],wi),this.location=_f(this._tNode,e),this.instance=Xi(this._tNode.index,e)[Zr],this.hostView=this.changeDetectorRef=new Nm(e,void 0,!1),this.componentType=n}setInput(n,e){let r=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;let o=this._rootLView,i=c_(r,o[tt],o,n,e);this.previousInputValues.set(n,e);let s=Xi(r.index,o);g_(s,1)}get injector(){return new hc(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function Oee(t,n,e){let r=t.projection=[];for(let o=0;o<n.length;o++){let i=e[o];r.push(i!=null&&i.length?Array.from(i):null)}}var Al=(()=>{class t{static __NG_ELEMENT_ID__=Fee}return t})();function Fee(){let t=Go();return yF(t,Mt())}var $ee=Al,gF=class extends $ee{_lContainer;_hostTNode;_hostLView;constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return _f(this._hostTNode,this._hostLView)}get injector(){return new hc(this._hostTNode,this._hostLView)}get parentInjector(){let n=ZT(this._hostTNode,this._hostLView);if(c2(n)){let e=fv(n,this._hostLView),r=pv(n),o=e[tt].data[r+8];return new hc(o,e)}else return new hc(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let e=sO(this._lContainer);return e!==null&&e[n]||null}get length(){return this._lContainer.length-wo}createEmbeddedView(n,e,r){let o,i;typeof r=="number"?o=r:r!=null&&(o=r.index,i=r.injector);let s=tO(this._lContainer,n.ssrId),a=n.createEmbeddedViewImpl(e||{},i,s);return this.insertImpl(a,o,JM(this._hostTNode,s)),a}createComponent(n,e,r,o,i){let s=n&&!RZ(n),a;if(s)a=e;else{let h=e||{};a=h.index,r=h.injector,o=h.projectableNodes,i=h.environmentInjector||h.ngModuleRef}let l=s?n:new Dm(mf(n)),u=r||this.parentInjector;if(!i&&l.ngModule==null){let m=(s?u:this.parentInjector).get(zo,null);m&&(i=m)}let c=mf(l.componentType??{}),p=tO(this._lContainer,c?.id??null),f=p?.firstChild??null,d=l.create(u,o,f,i);return this.insertImpl(d.hostView,a,JM(this._hostTNode,p)),d}insert(n,e){return this.insertImpl(n,e,!0)}insertImpl(n,e,r){let o=n._lView;if(zZ(o)){let a=this.indexOf(n);if(a!==-1)this.detach(a);else{let l=o[yr],u=new gF(l,l[Si],l[yr]);u.detach(u.indexOf(n))}}let i=this._adjustIndex(e),s=this._lContainer;return see(s,o,i,r),n.attachToViewContainerRef(),kO(FE(s),i,n),n}move(n,e){return this.insert(n,e)}indexOf(n){let e=sO(this._lContainer);return e!==null?e.indexOf(n):-1}remove(n){let e=this._adjustIndex(n,-1),r=dT(this._lContainer,e);r&&(rv(FE(this._lContainer),e),J2(r[tt],r))}detach(n){let e=this._adjustIndex(n,-1),r=dT(this._lContainer,e);return r&&rv(FE(this._lContainer),e)!=null?new Nm(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function sO(t){return t[lv]}function FE(t){return t[lv]||(t[lv]=[])}function yF(t,n){let e,r=n[t.index];return Ps(r)?e=r:(e=uF(r,n,null,t),n[t.index]=e,l_(n,e)),Lee(e,n,t,r),new gF(e,t,n)}function Pee(t,n){let e=t[Pn],r=e.createComment(""),o=Zi(n,t),i=e.parentNode(o);return yv(e,i,r,e.nextSibling(o),!1),r}var Lee=zee,Vee=()=>!1;function Bee(t,n,e){return Vee(t,n,e)}function zee(t,n,e,r){if(t[xc])return;let o;e.type&8?o=Ki(r):o=Pee(n,e),t[xc]=o}var yT=class t{queryList;matches=null;constructor(n){this.queryList=n}clone(){return new t(this.queryList)}setDirty(){this.queryList.setDirty()}},xT=class t{queries;constructor(n=[]){this.queries=n}createEmbeddedView(n){let e=n.queries;if(e!==null){let r=n.contentQueries!==null?n.contentQueries[0]:e.length,o=[];for(let i=0;i<r;i++){let s=e.getByIndex(i),a=this.queries[s.indexInDeclarationView];o.push(a.clone())}return new t(o)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)v_(n,e).matches!==null&&this.queries[e].setDirty()}},vT=class{flags;read;predicate;constructor(n,e,r=null){this.flags=e,this.read=r,typeof n=="string"?this.predicate=Xee(n):this.predicate=n}},bT=class t{queries;constructor(n=[]){this.queries=n}elementStart(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let r=0;r<this.length;r++){let o=e!==null?e.length:0,i=this.getByIndex(r).embeddedTView(n,o);i&&(i.indexInDeclarationView=r,e!==null?e.push(i):e=[i])}return e!==null?new t(e):null}template(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}},wT=class t{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(n,e=-1){this.metadata=n,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new t(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let e=this._declarationNodeIndex,r=n.parent;for(;r!==null&&r.type&8&&r.index!==e;)r=r.parent;return e===(r!==null?r.index:-1)}return this._appliesToNextNode}matchTNode(n,e){let r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){let i=r[o];this.matchTNodeWithReadOption(n,e,Uee(e,i)),this.matchTNodeWithReadOption(n,e,Zx(e,n,i,!1,!1))}else r===Cc?e.type&4&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,Zx(e,n,r,!1,!1))}matchTNodeWithReadOption(n,e,r){if(r!==null){let o=this.metadata.read;if(o!==null)if(o===Qi||o===Al||o===Cc&&e.type&4)this.addMatch(e.index,-2);else{let i=Zx(e,n,o,!1,!1);i!==null&&this.addMatch(e.index,i)}else this.addMatch(e.index,r)}}addMatch(n,e){this.matches===null?this.matches=[n,e]:this.matches.push(n,e)}};function Uee(t,n){let e=t.localNames;if(e!==null){for(let r=0;r<e.length;r+=2)if(e[r]===n)return e[r+1]}return null}function Gee(t,n){return t.type&11?_f(t,n):t.type&4?y_(t,n):null}function Wee(t,n,e,r){return e===-1?Gee(n,t):e===-2?Hee(t,n,r):Tm(t,t[tt],e,n)}function Hee(t,n,e){if(e===Qi)return _f(n,t);if(e===Cc)return y_(n,t);if(e===Al)return yF(n,t)}function xF(t,n,e,r){let o=n[Rs].queries[r];if(o.matches===null){let i=t.data,s=e.matches,a=[];for(let l=0;s!==null&&l<s.length;l+=2){let u=s[l];if(u<0)a.push(null);else{let c=i[u];a.push(Wee(n,c,s[l+1],e.metadata.read))}}o.matches=a}return o.matches}function CT(t,n,e,r){let o=t.queries.getByIndex(e),i=o.matches;if(i!==null){let s=xF(t,n,o,e);for(let a=0;a<i.length;a+=2){let l=i[a];if(l>0)r.push(s[a/2]);else{let u=i[a+1],c=n[-l];for(let p=wo;p<c.length;p++){let f=c[p];f[yc]===f[yr]&&CT(f[tt],f,u,r)}if(c[xf]!==null){let p=c[xf];for(let f=0;f<p.length;f++){let d=p[f];CT(d[tt],d,u,r)}}}}}return r}function jee(t,n){return t[Rs].queries[n].queryList}function qee(t,n,e){let r=new iT((e&4)===4);return WZ(t,n,r,r.destroy),(n[Rs]??=new xT).queries.push(new yT(r))-1}function Kee(t,n,e){let r=xr();return r.firstCreatePass&&(Yee(r,new vT(t,n,e),-1),(n&2)===2&&(r.staticViewQueries=!0)),qee(r,Mt(),n)}function Xee(t){return t.split(",").map(n=>n.trim())}function Yee(t,n,e){t.queries===null&&(t.queries=new bT),t.queries.track(new wT(n,e))}function v_(t,n){return t.queries.getByIndex(n)}function Zee(t,n){let e=t[tt],r=v_(e,n);return r.crossesNgTemplate?CT(e,t,n,[]):xF(e,t,r,n)}var bf=class{},b_=class{};var ST=class extends bf{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new vv(this);constructor(n,e,r,o=!0){super(),this.ngModuleType=n,this._parent=e;let i=MO(n);this._bootstrapComponents=V2(i.bootstrap),this._r3Injector=v2(n,e,[{provide:bf,useValue:this},{provide:$v,useValue:this.componentFactoryResolver},...r],Yr(n),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},IT=class extends b_{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new ST(this.moduleType,n,[])}};var bv=class extends bf{injector;componentFactoryResolver=new vv(this);instance=null;constructor(n){super();let e=new Sm([...n.providers,{provide:bf,useValue:this},{provide:$v,useValue:this.componentFactoryResolver}],n.parent||BT(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function Pv(t,n,e=null){return new bv({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}var Qee=(()=>{class t{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let r=OO(!1,e.type),o=r.length>0?Pv([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Pe({token:t,providedIn:"environment",factory:()=>new t(nt(zo))})}return t})();function Ji(t){return Am(()=>{let n=bF(t),e=pt(me({},n),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===N2.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:n.standalone?o=>o.get(Qee).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Yi.Emulated,styles:t.styles||Vo,_:null,schemas:t.schemas||null,tView:null,id:""});n.standalone&&o_("NgStandalone"),wF(e);let r=t.dependencies;return e.directiveDefs=aO(r,!1),e.pipeDefs=aO(r,!0),e.id=rte(e),e})}function Jee(t){return mf(t)||vZ(t)}function ete(t){return t!==null}function Nc(t){return Am(()=>({type:t.type,bootstrap:t.bootstrap||Vo,declarations:t.declarations||Vo,imports:t.imports||Vo,exports:t.exports||Vo,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function tte(t,n){if(t==null)return gc;let e={};for(let r in t)if(t.hasOwnProperty(r)){let o=t[r],i,s,a,l;Array.isArray(o)?(a=o[0],i=o[1],s=o[2]??i,l=o[3]||null):(i=o,s=o,a=Ov.None,l=null),e[i]=[r,a,l],n[i]=s}return e}function nte(t){if(t==null)return gc;let n={};for(let e in t)t.hasOwnProperty(e)&&(n[t[e]]=e);return n}function xn(t){return Am(()=>{let n=bF(t);return wF(n),n})}function vF(t){return{type:t.type,name:t.name,factory:null,pure:t.pure!==!1,standalone:t.standalone??!0,onDestroy:t.type.prototype.ngOnDestroy||null}}function bF(t){let n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputConfig:t.inputs||gc,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:t.signals===!0,selectors:t.selectors||Vo,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:tte(t.inputs,n),outputs:nte(t.outputs),debugInfo:null}}function wF(t){t.features?.forEach(n=>n(t))}function aO(t,n){if(!t)return null;let e=n?bZ:Jee;return()=>(typeof t=="function"?t():t).map(r=>e(r)).filter(ete)}function rte(t){let n=0,e=typeof t.consts=="function"?"":t.consts,r=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,e,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(let i of r.join("|"))n=Math.imul(31,n)+i.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function ote(t){return Object.getPrototypeOf(t.prototype).constructor}function Co(t){let n=ote(t.type),e=!0,r=[t];for(;n;){let o;if(qi(t))o=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Ne(903,!1);o=n.\u0275dir}if(o){if(e){r.push(o);let s=t;s.inputs=$E(t.inputs),s.declaredInputs=$E(t.declaredInputs),s.outputs=$E(t.outputs);let a=o.hostBindings;a&&ute(t,a);let l=o.viewQuery,u=o.contentQueries;if(l&&ate(t,l),u&&lte(t,u),ite(t,o),XY(t.outputs,o.outputs),qi(o)&&o.data.animation){let c=t.data;c.animation=(c.animation||[]).concat(o.data.animation)}}let i=o.features;if(i)for(let s=0;s<i.length;s++){let a=i[s];a&&a.ngInherit&&a(t),a===Co&&(e=!1)}}n=Object.getPrototypeOf(n)}ste(r)}function ite(t,n){for(let e in n.inputs){if(!n.inputs.hasOwnProperty(e)||t.inputs.hasOwnProperty(e))continue;let r=n.inputs[e];r!==void 0&&(t.inputs[e]=r,t.declaredInputs[e]=n.declaredInputs[e])}}function ste(t){let n=0,e=null;for(let r=t.length-1;r>=0;r--){let o=t[r];o.hostVars=n+=o.hostVars,o.hostAttrs=Em(o.hostAttrs,e=Em(e,o.hostAttrs))}}function $E(t){return t===gc?{}:t===Vo?[]:t}function ate(t,n){let e=t.viewQuery;e?t.viewQuery=(r,o)=>{n(r,o),e(r,o)}:t.viewQuery=n}function lte(t,n){let e=t.contentQueries;e?t.contentQueries=(r,o,i)=>{n(r,o,i),e(r,o,i)}:t.contentQueries=n}function ute(t,n){let e=t.hostBindings;e?t.hostBindings=(r,o)=>{n(r,o),e(r,o)}:t.hostBindings=n}function CF(t){return pte(t)?Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t:!1}function cte(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{let e=t[Symbol.iterator](),r;for(;!(r=e.next()).done;)n(r.value)}}function pte(t){return t!==null&&(typeof t=="function"||typeof t=="object")}function fte(t,n,e){return t[n]=e}function Sc(t,n,e){let r=t[n];return Object.is(r,e)?!1:(t[n]=e,!0)}function SF(t,n,e,r){let o=Sc(t,n,e);return Sc(t,n+1,r)||o}function dte(t,n,e,r,o,i,s,a,l){let u=n.consts,c=x_(n,t,4,s||null,a||null);YO()&&fF(n,e,c,cv(u,l),Y2),c.mergedAttrs=Em(c.mergedAttrs,c.attrs),l2(n,c);let p=c.tView=s_(2,c,r,o,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,u,null);return n.queries!==null&&(n.queries.template(n,c),p.queries=n.queries.embeddedTView(c)),c}function hte(t,n,e,r,o,i,s,a,l,u){let c=e+wi,p=n.firstCreatePass?dte(c,n,t,r,o,i,s,a,l):n.data[c];Mm(p,!1);let f=mte(n,t,p,e);XT()&&h_(n,t,f,p),Om(f,t);let d=uF(f,t,f,p);return t[c]=d,l_(t,d),Bee(d,p,t),zT(p)&&u_(n,t,p),l!=null&&K2(t,p,u),p}function Mr(t,n,e,r,o,i,s,a){let l=Mt(),u=xr(),c=cv(u.consts,i);return hte(l,u,t,n,e,r,o,c,s,a),Mr}var mte=gte;function gte(t,n,e,r){return YT(!0),n[Pn].createComment("")}var IF=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();var EF=new ke("");var yte=(()=>{class t{static \u0275prov=Pe({token:t,providedIn:"root",factory:()=>new ET})}return t})(),ET=class{queuedEffectCount=0;queues=new Map;schedule(n){this.enqueue(n)}remove(n){let e=n.zone,r=this.queues.get(e);r.has(n)&&(r.delete(n),this.queuedEffectCount--)}enqueue(n){let e=n.zone;this.queues.has(e)||this.queues.set(e,new Set);let r=this.queues.get(e);r.has(n)||(this.queuedEffectCount++,r.add(n))}flush(){for(;this.queuedEffectCount>0;)for(let[n,e]of this.queues)n===null?this.flushQueue(e):n.run(()=>this.flushQueue(e))}flushQueue(n){for(let e of n)n.delete(e),this.queuedEffectCount--,e.run()}};function Dc(t){return!!t&&typeof t.then=="function"}function TF(t){return!!t&&typeof t.subscribe=="function"}var xte=new ke("");var _F=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r});appInits=ge(xte,{optional:!0})??[];injector=ge(Ms);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let o of this.appInits){let i=Ci(this.injector,o);if(Dc(i))e.push(i);else if(TF(i)){let s=new Promise((a,l)=>{i.subscribe({complete:a,error:l})});e.push(s)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),e.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),w_=new ke("");function vte(){aE(()=>{throw new Ne(600,!1)})}function bte(t){return t.isBoundToModule}var wte=10;var Ic=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=ge(RQ);afterRenderManager=ge(qQ);zonelessEnabled=ge(QT);rootEffectScheduler=ge(yte);dirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new Sn;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=ge(Tf).hasPendingTasks.pipe(ft(e=>!e));constructor(){ge(Mv,{optional:!0})}whenStable(){let e;return new Promise(r=>{e=this.isStable.subscribe({next:o=>{o&&r()}})}).finally(()=>{e.unsubscribe()})}_injector=ge(zo);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,r){return this.bootstrapImpl(e,r)}bootstrapImpl(e,r,o=Ms.NULL){qt(10);let i=e instanceof pF;if(!this._injector.get(_F).done){let d="";throw new Ne(405,d)}let a;i?a=e:a=this._injector.get($v).resolveComponentFactory(e),this.componentTypes.push(a.componentType);let l=bte(a)?void 0:this._injector.get(bf),u=r||a.selector,c=a.create(o,[],u,l),p=c.location.nativeElement,f=c.injector.get(EF,null);return f?.registerApplication(p),c.onDestroy(()=>{this.detachView(c.hostView),Qx(this.components,c),f?.unregisterApplication(p)}),this._loadComponent(c),qt(11,c),c}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){qt(12),this.tracingSnapshot!==null?this.tracingSnapshot.run(F2.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new Ne(101,!1);let e=st(null);try{this._runningTick=!0,this.synchronize()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,st(e),this.afterTick.next(),qt(13)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(vf,null,{optional:!0}));let e=0;for(;this.dirtyFlags!==0&&e++<wte;)qt(14),this.synchronizeOnce(),qt(15)}synchronizeOnce(){if(this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let e=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r,notifyErrorHandler:o}of this.allViews)Cte(r,o,e,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>Nv(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){let r=e;Qx(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(w_,[]).forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Qx(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Ne(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Qx(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function Cte(t,n,e,r){if(!e&&!Nv(t))return;iF(t,n,e&&!r?0:1)}function Lv(t,n,e,r){let o=Mt(),i=kv();if(Sc(o,i,n)){let s=xr(),a=KT();EJ(a,o,t,n,e,r)}return Lv}function Ste(t,n,e,r){return Sc(t,kv(),e)?n+wm(e)+r:Ls}function Ite(t,n,e,r,o,i){let s=eQ(),a=SF(t,s,e,o);return e2(2),a?n+wm(e)+r+wm(o)+i:Ls}function qx(t,n){return t<<17|n<<2}function Ec(t){return t>>17&32767}function Ete(t){return(t&2)==2}function Tte(t,n){return t&131071|n<<17}function TT(t){return t|2}function wf(t){return(t&131068)>>2}function PE(t,n){return t&-131069|n<<2}function _te(t){return(t&1)===1}function _T(t){return t|1}function Nte(t,n,e,r,o,i){let s=i?n.classBindings:n.styleBindings,a=Ec(s),l=wf(s);t[r]=e;let u=!1,c;if(Array.isArray(e)){let p=e;c=p[1],(c===null||Rm(p,c)>0)&&(u=!0)}else c=e;if(o)if(l!==0){let f=Ec(t[a+1]);t[r+1]=qx(f,a),f!==0&&(t[f+1]=PE(t[f+1],r)),t[a+1]=Tte(t[a+1],r)}else t[r+1]=qx(a,0),a!==0&&(t[a+1]=PE(t[a+1],r)),a=r;else t[r+1]=qx(l,0),a===0?a=r:t[l+1]=PE(t[l+1],r),l=r;u&&(t[r+1]=TT(t[r+1])),lO(t,c,r,!0),lO(t,c,r,!1),Dte(n,c,t,r,i),s=qx(a,l),i?n.classBindings=s:n.styleBindings=s}function Dte(t,n,e,r,o){let i=o?t.residualClasses:t.residualStyles;i!=null&&typeof n=="string"&&Rm(i,n)>=0&&(e[r+1]=_T(e[r+1]))}function lO(t,n,e,r){let o=t[e+1],i=n===null,s=r?Ec(o):wf(o),a=!1;for(;s!==0&&(a===!1||i);){let l=t[s],u=t[s+1];kte(l,n)&&(a=!0,t[s+1]=r?_T(u):TT(u)),s=r?Ec(u):wf(u)}a&&(t[e+1]=r?TT(o):_T(o))}function kte(t,n){return t===null||n==null||(Array.isArray(t)?t[1]:t)===n?!0:Array.isArray(t)&&typeof n=="string"?Rm(t,n)>=0:!1}function vt(t,n,e){let r=Mt(),o=kv();if(Sc(r,o,n)){let i=xr(),s=KT();X2(i,s,r,t,n,r[Pn],e,!1)}return vt}function uO(t,n,e,r,o){c_(n,t,e,o?"class":"style",r)}function C_(t,n,e){return NF(t,n,e,!1),C_}function S_(t,n){return NF(t,n,null,!0),S_}function NF(t,n,e,r){let o=Mt(),i=xr(),s=e2(2);if(i.firstUpdatePass&&Rte(i,t,s,r),n!==Ls&&Sc(o,s,n)){let a=i.data[_c()];Pte(i,a,o,o[Pn],t,o[s+1]=Lte(n,e),r,s)}}function Ate(t,n){return n>=t.expandoStartIndex}function Rte(t,n,e,r){let o=t.data;if(o[e+1]===null){let i=o[_c()],s=Ate(t,e);Vte(i,r)&&n===null&&!s&&(n=!1),n=Mte(o,i,n,r),Nte(o,i,n,e,s,r)}}function Mte(t,n,e,r){let o=iQ(t),i=r?n.residualClasses:n.residualStyles;if(o===null)(r?n.classBindings:n.styleBindings)===0&&(e=LE(null,t,n,e,r),e=km(e,n.attrs,r),i=null);else{let s=n.directiveStylingLast;if(s===-1||t[s]!==o)if(e=LE(o,t,n,e,r),i===null){let l=Ote(t,n,r);l!==void 0&&Array.isArray(l)&&(l=LE(null,t,n,l[1],r),l=km(l,n.attrs,r),Fte(t,n,r,l))}else i=$te(t,n,r)}return i!==void 0&&(r?n.residualClasses=i:n.residualStyles=i),e}function Ote(t,n,e){let r=e?n.classBindings:n.styleBindings;if(wf(r)!==0)return t[Ec(r)]}function Fte(t,n,e,r){let o=e?n.classBindings:n.styleBindings;t[Ec(o)]=r}function $te(t,n,e){let r,o=n.directiveEnd;for(let i=1+n.directiveStylingLast;i<o;i++){let s=t[i].hostAttrs;r=km(r,s,e)}return km(r,n.attrs,e)}function LE(t,n,e,r,o){let i=null,s=e.directiveEnd,a=e.directiveStylingLast;for(a===-1?a=e.directiveStart:a++;a<s&&(i=n[a],r=km(r,i.hostAttrs,o),i!==t);)a++;return t!==null&&(e.directiveStylingLast=a),r}function km(t,n,e){let r=e?1:2,o=-1;if(n!==null)for(let i=0;i<n.length;i++){let s=n[i];typeof s=="number"?o=s:o===r&&(Array.isArray(t)||(t=t===void 0?[]:["",t]),yZ(t,s,e?!0:n[++i]))}return t===void 0?null:t}function Pte(t,n,e,r,o,i,s,a){if(!(n.type&3))return;let l=t.data,u=l[a+1],c=_te(u)?cO(l,n,e,o,wf(u),s):void 0;if(!wv(c)){wv(i)||Ete(u)&&(i=cO(l,null,e,o,a,s));let p=HO(_c(),e);jJ(r,s,p,o,i)}}function cO(t,n,e,r,o,i){let s=n===null,a;for(;o>0;){let l=t[o],u=Array.isArray(l),c=u?l[1]:l,p=c===null,f=e[o+1];f===Ls&&(f=p?Vo:void 0);let d=p?_E(f,r):c===r?f:void 0;if(u&&!wv(d)&&(d=_E(l,r)),wv(d)&&(a=d,s))return a;let h=t[o+1];o=s?Ec(h):wf(h)}if(n!==null){let l=i?n.residualClasses:n.residualStyles;l!=null&&(a=_E(l,r))}return a}function wv(t){return t!==void 0}function Lte(t,n){return t==null||t===""||(typeof n=="string"?t=t+n:typeof t=="object"&&(t=Yr(ZQ(t)))),t}function Vte(t,n){return(t.flags&(n?8:16))!==0}function z(t,n,e,r){let o=Mt(),i=xr(),s=wi+t,a=o[Pn],l=i.firstCreatePass?hF(s,i,o,n,Y2,YO(),e,r):i.data[s],u=Bte(i,o,l,a,n,t);o[s]=u;let c=zT(l);return Mm(l,!0),G2(a,u,l),!Z2(l)&&XT()&&h_(i,o,u,l),(HZ()===0||c)&&Om(u,o),jZ(),c&&(u_(i,o,l),L2(i,l,o)),r!==null&&K2(o,l),z}function U(){let t=Go();QO()?QZ():(t=t.parent,Mm(t,!1));let n=t;XZ(n)&&YZ(),qZ();let e=xr();return e.firstCreatePass&&mF(e,n),n.classesWithoutHost!=null&&pQ(n)&&uO(e,n,Mt(),n.classesWithoutHost,!0),n.stylesWithoutHost!=null&&fQ(n)&&uO(e,n,Mt(),n.stylesWithoutHost,!1),U}function So(t,n,e,r){return z(t,n,e,r),U(),So}var Bte=(t,n,e,r,o,i)=>(YT(!0),z2(r,o,lQ()));function Qr(){return Mt()}var fc=void 0;function zte(t){let n=Math.floor(Math.abs(t)),e=t.toString().replace(/^[^.]*\.?/,"").length;return n===1&&e===0?1:5}var Ute=["en",[["a","p"],["AM","PM"],fc],[["AM","PM"],fc,fc],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],fc,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],fc,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",fc,"{1} 'at' {0}",fc],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",zte],VE={};function Ho(t){let n=Gte(t),e=pO(n);if(e)return e;let r=n.split("-")[0];if(e=pO(r),e)return e;if(r==="en")return Ute;throw new Ne(701,!1)}function pO(t){return t in VE||(VE[t]=ym.ng&&ym.ng.common&&ym.ng.common.locales&&ym.ng.common.locales[t]),VE[t]}var vn=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(vn||{});function Gte(t){return t.toLowerCase().replace(/_/g,"-")}var Cv="en-US";var Wte=Cv;function Hte(t){typeof t=="string"&&(Wte=t.toLowerCase().replace(/_/g,"-"))}function fO(t,n,e){return function r(o){if(o===Function)return e;let i=Sf(t)?Xi(t.index,n):n;g_(i,5);let s=n[Zr],a=dO(n,s,e,o),l=r.__ngNextListenerFn__;for(;l;)a=dO(n,s,l,o)&&a,l=l.__ngNextListenerFn__;return a}}function dO(t,n,e,r){let o=st(null);try{return qt(6,n,e),e(r)!==!1}catch(i){return jte(t,i),!1}finally{qt(7,n,e),st(o)}}function jte(t,n){let e=t[yf],r=e?e.get(Os,null):null;r&&r.handleError(n)}function hO(t,n,e,r,o,i){let s=n[e],a=n[tt],u=a.data[e].outputs[r],c=s[u],p=a.firstCreatePass?WT(a):null,f=GT(n),d=c.subscribe(i),h=f.length;f.push(i,d),p&&p.push(o,t.index,h,-(h+1))}function Je(t,n,e,r){let o=Mt(),i=xr(),s=Go();return DF(i,o,o[Pn],s,t,n,r),Je}function qte(t,n,e,r){let o=t.cleanup;if(o!=null)for(let i=0;i<o.length-1;i+=2){let s=o[i];if(s===e&&o[i+1]===r){let a=n[sv],l=o[i+2];return a.length>l?a[l]:null}typeof s=="string"&&(i+=2)}return null}function DF(t,n,e,r,o,i,s){let a=zT(r),u=t.firstCreatePass?WT(t):null,c=GT(n),p=!0;if(r.type&3||s){let f=Zi(r,n),d=s?s(f):f,h=c.length,m=s?y=>s(Ki(y[r.index])):r.index,g=null;if(!s&&a&&(g=qte(t,n,o,r.index)),g!==null){let y=g.__ngLastListenerFn__||g;y.__ngNextListenerFn__=i,g.__ngLastListenerFn__=i,p=!1}else{i=fO(r,n,i),XQ(n,d,o,i);let y=e.listen(d,o,i);c.push(i,y),u&&u.push(o,m,h,h+1)}}else i=fO(r,n,i);if(p){let f=r.outputs?.[o],d=r.hostDirectiveOutputs?.[o];if(d&&d.length)for(let h=0;h<d.length;h+=2){let m=d[h],g=d[h+1];hO(r,n,m,g,o,i)}if(f&&f.length)for(let h of f)hO(r,n,h,o,o,i)}}function Ot(t=1){return aQ(t)}function $m(t,n,e){Kee(t,n,e)}function Pm(t){let n=Mt(),e=xr(),r=t2();HT(r+1);let o=v_(e,r);if(t.dirty&&BZ(n)===((o.metadata.flags&2)===2)){if(o.matches===null)t.reset([]);else{let i=Zee(n,r);t.reset(i,FQ),t.notifyOnChanges()}return!0}return!1}function Lm(){return jee(Mt(),t2())}function q(t,n=""){let e=Mt(),r=xr(),o=t+wi,i=r.firstCreatePass?x_(r,o,1,n,null):r.data[o],s=Kte(r,e,i,n,t);e[o]=s,XT()&&h_(r,e,s,i),Mm(i,!1)}var Kte=(t,n,e,r,o)=>(YT(!0),uJ(n[Pn],r));function dn(t){return Qn("",t,""),dn}function Qn(t,n,e){let r=Mt(),o=Ste(r,t,n,e);return o!==Ls&&kF(r,_c(),o),Qn}function Vm(t,n,e,r,o){let i=Mt(),s=Ite(i,t,n,e,r,o);return s!==Ls&&kF(i,_c(),s),Vm}function kF(t,n,e){let r=HO(n,t);cJ(t[Pn],r,e)}function Io(t,n,e){T2(n)&&(n=n());let r=Mt(),o=kv();if(Sc(r,o,n)){let i=xr(),s=KT();X2(i,s,r,t,n,r[Pn],e,!1)}return Io}function jo(t,n){let e=T2(t);return e&&t.set(n),e}function Eo(t,n){let e=Mt(),r=xr(),o=Go();return DF(r,e,e[Pn],o,t,n),Eo}function Xte(t,n,e){let r=xr();if(r.firstCreatePass){let o=qi(t);NT(e,r.data,r.blueprint,o,!0),NT(n,r.data,r.blueprint,o,!1)}}function NT(t,n,e,r,o){if(t=Rr(t),Array.isArray(t))for(let i=0;i<t.length;i++)NT(t[i],n,e,r,o);else{let i=xr(),s=Mt(),a=Go(),l=gf(t)?t:Rr(t.provide),u=PO(t),c=a.providerIndexes&1048575,p=a.directiveStart,f=a.providerIndexes>>20;if(gf(t)||!t.multi){let d=new wc(u,o,xt),h=zE(l,n,o?c:c+f,p);h===-1?(JE(hv(a,s),i,l),BE(i,t,n.length),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(d),s.push(d)):(e[h]=d,s[h]=d)}else{let d=zE(l,n,c+f,p),h=zE(l,n,c,c+f),m=d>=0&&e[d],g=h>=0&&e[h];if(o&&!g||!o&&!m){JE(hv(a,s),i,l);let y=Qte(o?Zte:Yte,e.length,o,r,u);!o&&g&&(e[h].providerFactory=y),BE(i,t,n.length,0),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(y),s.push(y)}else{let y=AF(e[o?h:d],u,!o&&r);BE(i,t,d>-1?d:h,y)}!o&&r&&g&&e[h].componentProviders++}}}function BE(t,n,e,r){let o=gf(n),i=EZ(n);if(o||i){let l=(i?Rr(n.useClass):n).prototype.ngOnDestroy;if(l){let u=t.destroyHooks||(t.destroyHooks=[]);if(!o&&n.multi){let c=u.indexOf(e);c===-1?u.push(e,[r,l]):u[c+1].push(r,l)}else u.push(e,l)}}}function AF(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function zE(t,n,e,r){for(let o=e;o<r;o++)if(n[o]===t)return o;return-1}function Yte(t,n,e,r,o){return DT(this.multi,[])}function Zte(t,n,e,r,o){let i=this.multi,s;if(this.providerFactory){let a=this.providerFactory.componentProviders,l=Tm(r,r[tt],this.providerFactory.index,o);s=l.slice(0,a),DT(i,s);for(let u=a;u<l.length;u++)s.push(l[u])}else s=[],DT(i,s);return s}function DT(t,n){for(let e=0;e<t.length;e++){let r=t[e];n.push(r())}return n}function Qte(t,n,e,r,o){let i=new wc(t,e,xt);return i.multi=[],i.index=n,i.componentProviders=0,AF(i,o,r&&!e),i}function es(t,n=[]){return e=>{e.providersResolver=(r,o)=>Xte(r,o?o(t):t,n)}}function Jte(t,n){let e=t[n];return e===Ls?void 0:e}function ene(t,n,e,r,o,i,s){let a=n+e;return SF(t,a,o,i)?fte(t,a+2,s?r.call(s,o,i):r(o,i)):Jte(t,a+2)}function RF(t,n){let e=xr(),r,o=t+wi;e.firstCreatePass?(r=tne(n,e.pipeRegistry),e.data[o]=r,r.onDestroy&&(e.destroyHooks??=[]).push(o,r.onDestroy)):r=e.data[o];let i=r.factory||(r.factory=mc(r.type,!0)),s,a=Xr(xt);try{let l=dv(!1),u=i();return dv(l),VZ(e,Mt(),o,u),u}finally{Xr(a)}}function tne(t,n){if(n)for(let e=n.length-1;e>=0;e--){let r=n[e];if(t===r.name)return r}}function MF(t,n,e,r){let o=t+wi,i=Mt(),s=LZ(i,o);return nne(i,o)?ene(i,JZ(),n,s.transform,e,r,s):s.transform(e,r)}function nne(t,n){return t[tt].data[n].pure}var kT=class{ngModuleFactory;componentFactories;constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}},OF=(()=>{class t{compileModuleSync(e){return new IT(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let r=this.compileModuleSync(e),o=MO(e),i=V2(o.declarations).reduce((s,a)=>{let l=mf(a);return l&&s.push(new Dm(l)),s},[]);return new kT(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var rne=(()=>{class t{zone=ge(Zn);changeDetectionScheduler=ge(_m);applicationRef=ge(Ic);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),one=new ke("",{factory:()=>!1});function FF({ngZoneFactory:t,ignoreChangesOutsideZone:n,scheduleInRootZone:e}){return t??=()=>new Zn(pt(me({},PF()),{scheduleInRootZone:e})),[{provide:Zn,useFactory:t},{provide:Cm,multi:!0,useFactory:()=>{let r=ge(rne,{optional:!0});return()=>r.initialize()}},{provide:Cm,multi:!0,useFactory:()=>{let r=ge(ine);return()=>{r.initialize()}}},n===!0?{provide:w2,useValue:!0}:[],{provide:C2,useValue:e??b2}]}function $F(t){let n=t?.ignoreChangesOutsideZone,e=t?.scheduleInRootZone,r=FF({ngZoneFactory:()=>{let o=PF(t);return o.scheduleInRootZone=e,o.shouldCoalesceEventChangeDetection&&o_("NgZone_CoalesceEvent"),new Zn(o)},ignoreChangesOutsideZone:n,scheduleInRootZone:e});return LT([{provide:one,useValue:!0},{provide:QT,useValue:!1},r])}function PF(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var ine=(()=>{class t{subscription=new Cn;initialized=!1;zone=ge(Zn);pendingTasks=ge(Tf);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Zn.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Zn.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var sne=(()=>{class t{appRef=ge(Ic);taskService=ge(Tf);ngZone=ge(Zn);zonelessEnabled=ge(QT);tracing=ge(Mv,{optional:!0});disableScheduling=ge(w2,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Cn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(gv):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(ge(C2,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof oT||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let r=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2,r=!0;break}case 12:{this.appRef.dirtyFlags|=16,r=!0;break}case 13:{this.appRef.dirtyFlags|=2,r=!0;break}case 11:{r=!0;break}case 9:case 8:case 7:case 10:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;let o=this.useMicrotaskScheduler?HM:S2;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>o(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>o(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(gv+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){throw this.taskService.remove(e),r}finally{this.cleanup()}this.useMicrotaskScheduler=!0,HM(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function ane(){return typeof $localize<"u"&&$localize.locale||Cv}var Vv=new ke("",{providedIn:"root",factory:()=>ge(Vv,Ye.Optional|Ye.SkipSelf)||ane()});var AT=new ke(""),lne=new ke("");function gm(t){return!t.moduleRef}function une(t){let n=gm(t)?t.r3Injector:t.moduleRef.injector,e=n.get(Zn);return e.run(()=>{gm(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();let r=n.get(Os,null),o;if(e.runOutsideAngular(()=>{o=e.onError.subscribe({next:i=>{r.handleError(i)}})}),gm(t)){let i=()=>n.destroy(),s=t.platformInjector.get(AT);s.add(i),n.onDestroy(()=>{o.unsubscribe(),s.delete(i)})}else{let i=()=>t.moduleRef.destroy(),s=t.platformInjector.get(AT);s.add(i),t.moduleRef.onDestroy(()=>{Qx(t.allPlatformModules,t.moduleRef),o.unsubscribe(),s.delete(i)})}return pne(r,e,()=>{let i=n.get(_F);return i.runInitializers(),i.donePromise.then(()=>{let s=n.get(Vv,Cv);if(Hte(s||Cv),!n.get(lne,!0))return gm(t)?n.get(Ic):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(gm(t)){let l=n.get(Ic);return t.rootComponent!==void 0&&l.bootstrap(t.rootComponent),l}else return cne(t.moduleRef,t.allPlatformModules),t.moduleRef})})})}function cne(t,n){let e=t.injector.get(Ic);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>e.bootstrap(r));else if(t.instance.ngDoBootstrap)t.instance.ngDoBootstrap(e);else throw new Ne(-403,!1);n.push(t)}function pne(t,n,e){try{let r=e();return Dc(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}var Jx=null;function fne(t=[],n){return Ms.create({name:n,providers:[{provide:Tv,useValue:"platform"},{provide:AT,useValue:new Set([()=>Jx=null])},...t]})}function dne(t=[]){if(Jx)return Jx;let n=fne(t);return Jx=n,vte(),hne(n),n}function hne(t){let n=t.get(n_,null);Ci(t,()=>{n?.forEach(e=>e())})}var Bm=(()=>{class t{static __NG_ELEMENT_ID__=mne}return t})();function mne(t){return gne(Go(),Mt(),(t&16)===16)}function gne(t,n,e){if(Sf(t)&&!e){let r=Xi(t.index,n);return new Nm(r,r)}else if(t.type&175){let r=n[ji];return new Nm(r,n)}return null}var RT=class{constructor(){}supports(n){return CF(n)}create(n){return new MT(n)}},yne=(t,n)=>n,MT=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(n){this._trackByFn=n||yne}forEachItem(n){let e;for(e=this._itHead;e!==null;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,o=0,i=null;for(;e||r;){let s=!r||e&&e.currentIndex<mO(r,o,i)?e:r,a=mO(s,o,i),l=s.currentIndex;if(s===r)o--,r=r._nextRemoved;else if(e=e._next,s.previousIndex==null)o++;else{i||(i=[]);let u=a-o,c=l-o;if(u!=c){for(let f=0;f<u;f++){let d=f<i.length?i[f]:i[f]=0,h=d+f;c<=h&&h<u&&(i[f]=d+1)}let p=s.previousIndex;i[p]=c-u}}a!==l&&n(s,a,l)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)n(e)}diff(n){if(n==null&&(n=[]),!CF(n))throw new Ne(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._itHead,r=!1,o,i,s;if(Array.isArray(n)){this.length=n.length;for(let a=0;a<this.length;a++)i=n[a],s=this._trackByFn(a,i),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,i,s,a),r=!0):(r&&(e=this._verifyReinsertion(e,i,s,a)),Object.is(e.item,i)||this._addIdentityChange(e,i)),e=e._next}else o=0,cte(n,a=>{s=this._trackByFn(o,a),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,a,s,o),r=!0):(r&&(e=this._verifyReinsertion(e,a,s,o)),Object.is(e.item,a)||this._addIdentityChange(e,a)),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,o){let i;return n===null?i=this._itTail:(i=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,i,o)):(n=this._linkedRecords===null?null:this._linkedRecords.get(r,o),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,i,o)):n=this._addAfter(new OT(e,r),i,o)),n}_verifyReinsertion(n,e,r,o){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return i!==null?n=this._reinsertAfter(i,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;n!==null;){let e=n._next;this._addToRemovals(this._unlink(n)),n=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let o=n._prevRemoved,i=n._nextRemoved;return o===null?this._removalsHead=i:o._nextRemoved=i,i===null?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){let o=e===null?this._itHead:e._next;return n._next=o,n._prev=e,o===null?this._itTail=n:o._prev=n,e===null?this._itHead=n:e._next=n,this._linkedRecords===null&&(this._linkedRecords=new Sv),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let e=n._prev,r=n._next;return e===null?this._itHead=r:e._next=r,r===null?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new Sv),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},OT=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(n,e){this.item=n,this.trackById=e}},FT=class{_head=null;_tail=null;add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;r!==null;r=r._nextDup)if((e===null||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){let e=n._prevDup,r=n._nextDup;return e===null?this._head=r:e._nextDup=r,r===null?this._tail=e:r._prevDup=e,this._head===null}},Sv=class{map=new Map;put(n){let e=n.trackById,r=this.map.get(e);r||(r=new FT,this.map.set(e,r)),r.add(n)}get(n,e){let r=n,o=this.map.get(r);return o?o.get(n,e):null}remove(n){let e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function mO(t,n,e){let r=t.previousIndex;if(r===null)return r;let o=0;return e&&r<e.length&&(o=e[r]),r+n+o}function gO(){return new I_([new RT])}var I_=(()=>{class t{factories;static \u0275prov=Pe({token:t,providedIn:"root",factory:gO});constructor(e){this.factories=e}static create(e,r){if(r!=null){let o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||gO()),deps:[[t,new dZ,new fZ]]}}find(e){let r=this.factories.find(o=>o.supports(e));if(r!=null)return r;throw new Ne(901,!1)}}return t})();function LF(t){qt(8);try{let{rootComponent:n,appProviders:e,platformProviders:r}=t,o=dne(r),i=[FF({}),{provide:_m,useExisting:sne},...e||[]],s=new bv({providers:i,parent:o,debugName:"",runEnvironmentInitializers:!1});return une({r3Injector:s.injector,platformInjector:o,rootComponent:n})}catch(n){return Promise.reject(n)}finally{qt(9)}}function E_(t){return typeof t=="boolean"?t:t!=null&&t!=="false"}function Rl(t){return cE(t)}function Bv(t,n){return sE(t,n?.equal)}var yO=class{[Lo];constructor(n){this[Lo]=n}destroy(){this[Lo].destroy()}};var vr=new ke("");var zF=null;function qo(){return zF}function T_(t){zF??=t}var zm=class{},__=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:()=>ge(UF),providedIn:"platform"})}return t})();var UF=(()=>{class t extends __{_location;_history;_doc=ge(vr);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return qo().getBaseHref(this._doc)}onPopState(e){let r=qo().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){let r=qo().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){this._history.pushState(e,r,o)}replaceState(e,r,o){this._history.replaceState(e,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function GF(t,n){return t?n?t.endsWith("/")?n.startsWith("/")?t+n.slice(1):t+n:n.startsWith("/")?t+n:`${t}/${n}`:t:n}function VF(t){let n=t.search(/#|\?|$/);return t[n-1]==="/"?t.slice(0,n-1)+t.slice(n):t}function Ml(t){return t&&t[0]!=="?"?`?${t}`:t}var zv=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:()=>ge(HF),providedIn:"root"})}return t})(),WF=new ke(""),HF=(()=>{class t extends zv{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,r){super(),this._platformLocation=e,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??ge(vr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return GF(this._baseHref,e)}path(e=!1){let r=this._platformLocation.pathname+Ml(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){let s=this.prepareExternalUrl(o+Ml(i));this._platformLocation.pushState(e,r,s)}replaceState(e,r,o,i){let s=this.prepareExternalUrl(o+Ml(i));this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(r){return new(r||t)(nt(__),nt(WF,8))};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Df=(()=>{class t{_subject=new Sn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let r=this._locationStrategy.getBaseHref();this._basePath=bne(VF(BF(r))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+Ml(r))}normalize(e){return t.stripTrailingSlash(vne(this._basePath,BF(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Ml(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Ml(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r??void 0,complete:o??void 0})}static normalizeQueryParams=Ml;static joinWithSlash=GF;static stripTrailingSlash=VF;static \u0275fac=function(r){return new(r||t)(nt(zv))};static \u0275prov=Pe({token:t,factory:()=>xne(),providedIn:"root"})}return t})();function xne(){return new Df(nt(zv))}function vne(t,n){if(!t||!n.startsWith(t))return n;let e=n.substring(t.length);return e===""||["/",";","?","#"].includes(e[0])?e:n}function BF(t){return t.replace(/\/index.html$/,"")}function bne(t){if(new RegExp("^(https?:)?//").test(t)){let[,e]=t.split(/\/\/[^\/]+/);return e}return t}var br=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}(br||{}),Ft=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}(Ft||{}),Jr=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}(Jr||{}),Bs={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function XF(t){return Ho(t)[vn.LocaleId]}function YF(t,n,e){let r=Ho(t),o=[r[vn.DayPeriodsFormat],r[vn.DayPeriodsStandalone]],i=Ko(o,n);return Ko(i,e)}function ZF(t,n,e){let r=Ho(t),o=[r[vn.DaysFormat],r[vn.DaysStandalone]],i=Ko(o,n);return Ko(i,e)}function QF(t,n,e){let r=Ho(t),o=[r[vn.MonthsFormat],r[vn.MonthsStandalone]],i=Ko(o,n);return Ko(i,e)}function JF(t,n){let r=Ho(t)[vn.Eras];return Ko(r,n)}function Um(t,n){let e=Ho(t);return Ko(e[vn.DateFormat],n)}function Gm(t,n){let e=Ho(t);return Ko(e[vn.TimeFormat],n)}function Wm(t,n){let r=Ho(t)[vn.DateTimeFormat];return Ko(r,n)}function Hm(t,n){let e=Ho(t),r=e[vn.NumberSymbols][n];if(typeof r>"u"){if(n===Bs.CurrencyDecimal)return e[vn.NumberSymbols][Bs.Decimal];if(n===Bs.CurrencyGroup)return e[vn.NumberSymbols][Bs.Group]}return r}function e$(t){if(!t[vn.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[vn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function t$(t){let n=Ho(t);return e$(n),(n[vn.ExtraData][2]||[]).map(r=>typeof r=="string"?N_(r):[N_(r[0]),N_(r[1])])}function n$(t,n,e){let r=Ho(t);e$(r);let o=[r[vn.ExtraData][0],r[vn.ExtraData][1]],i=Ko(o,n)||[];return Ko(i,e)||[]}function Ko(t,n){for(let e=n;e>-1;e--)if(typeof t[e]<"u")return t[e];throw new Error("Locale data API: locale data undefined")}function N_(t){let[n,e]=t.split(":");return{hours:+n,minutes:+e}}var wne=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Uv={},Cne=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function r$(t,n,e,r){let o=Ane(t);n=Vs(e,n)||n;let s=[],a;for(;n;)if(a=Cne.exec(n),a){s=s.concat(a.slice(1));let c=s.pop();if(!c)break;n=c}else{s.push(n);break}let l=o.getTimezoneOffset();r&&(l=i$(r,l),o=kne(o,r));let u="";return s.forEach(c=>{let p=Nne(c);u+=p?p(o,e,l):c==="''"?"'":c.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),u}function qv(t,n,e){let r=new Date(0);return r.setFullYear(t,n,e),r.setHours(0,0,0),r}function Vs(t,n){let e=XF(t);if(Uv[e]??={},Uv[e][n])return Uv[e][n];let r="";switch(n){case"shortDate":r=Um(t,Jr.Short);break;case"mediumDate":r=Um(t,Jr.Medium);break;case"longDate":r=Um(t,Jr.Long);break;case"fullDate":r=Um(t,Jr.Full);break;case"shortTime":r=Gm(t,Jr.Short);break;case"mediumTime":r=Gm(t,Jr.Medium);break;case"longTime":r=Gm(t,Jr.Long);break;case"fullTime":r=Gm(t,Jr.Full);break;case"short":let o=Vs(t,"shortTime"),i=Vs(t,"shortDate");r=Gv(Wm(t,Jr.Short),[o,i]);break;case"medium":let s=Vs(t,"mediumTime"),a=Vs(t,"mediumDate");r=Gv(Wm(t,Jr.Medium),[s,a]);break;case"long":let l=Vs(t,"longTime"),u=Vs(t,"longDate");r=Gv(Wm(t,Jr.Long),[l,u]);break;case"full":let c=Vs(t,"fullTime"),p=Vs(t,"fullDate");r=Gv(Wm(t,Jr.Full),[c,p]);break}return r&&(Uv[e][n]=r),r}function Gv(t,n){return n&&(t=t.replace(/\{([^}]+)}/g,function(e,r){return n!=null&&r in n?n[r]:e})),t}function Ei(t,n,e="-",r,o){let i="";(t<0||o&&t<=0)&&(o?t=-t+1:(t=-t,i=e));let s=String(t);for(;s.length<n;)s="0"+s;return r&&(s=s.slice(s.length-n)),i+s}function Sne(t,n){return Ei(t,3).substring(0,n)}function En(t,n,e=0,r=!1,o=!1){return function(i,s){let a=Ine(t,i);if((e>0||a>-e)&&(a+=e),t===3)a===0&&e===-12&&(a=12);else if(t===6)return Sne(a,n);let l=Hm(s,Bs.MinusSign);return Ei(a,n,l,r,o)}}function Ine(t,n){switch(t){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}function Kt(t,n,e=br.Format,r=!1){return function(o,i){return Ene(o,i,t,n,e,r)}}function Ene(t,n,e,r,o,i){switch(e){case 2:return QF(n,o,r)[t.getMonth()];case 1:return ZF(n,o,r)[t.getDay()];case 0:let s=t.getHours(),a=t.getMinutes();if(i){let u=t$(n),c=n$(n,o,r),p=u.findIndex(f=>{if(Array.isArray(f)){let[d,h]=f,m=s>=d.hours&&a>=d.minutes,g=s<h.hours||s===h.hours&&a<h.minutes;if(d.hours<h.hours){if(m&&g)return!0}else if(m||g)return!0}else if(f.hours===s&&f.minutes===a)return!0;return!1});if(p!==-1)return c[p]}return YF(n,o,r)[s<12?0:1];case 3:return JF(n,r)[t.getFullYear()<=0?0:1];default:let l=e;throw new Error(`unexpected translation type ${l}`)}}function Wv(t){return function(n,e,r){let o=-1*r,i=Hm(e,Bs.MinusSign),s=o>0?Math.floor(o/60):Math.ceil(o/60);switch(t){case 0:return(o>=0?"+":"")+Ei(s,2,i)+Ei(Math.abs(o%60),2,i);case 1:return"GMT"+(o>=0?"+":"")+Ei(s,1,i);case 2:return"GMT"+(o>=0?"+":"")+Ei(s,2,i)+":"+Ei(Math.abs(o%60),2,i);case 3:return r===0?"Z":(o>=0?"+":"")+Ei(s,2,i)+":"+Ei(Math.abs(o%60),2,i);default:throw new Error(`Unknown zone width "${t}"`)}}}var Tne=0,jv=4;function _ne(t){let n=qv(t,Tne,1).getDay();return qv(t,0,1+(n<=jv?jv:jv+7)-n)}function o$(t){let n=t.getDay(),e=n===0?-3:jv-n;return qv(t.getFullYear(),t.getMonth(),t.getDate()+e)}function D_(t,n=!1){return function(e,r){let o;if(n){let i=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,s=e.getDate();o=1+Math.floor((s+i)/7)}else{let i=o$(e),s=_ne(i.getFullYear()),a=i.getTime()-s.getTime();o=1+Math.round(a/6048e5)}return Ei(o,t,Hm(r,Bs.MinusSign))}}function Hv(t,n=!1){return function(e,r){let i=o$(e).getFullYear();return Ei(i,t,Hm(r,Bs.MinusSign),n)}}var k_={};function Nne(t){if(k_[t])return k_[t];let n;switch(t){case"G":case"GG":case"GGG":n=Kt(3,Ft.Abbreviated);break;case"GGGG":n=Kt(3,Ft.Wide);break;case"GGGGG":n=Kt(3,Ft.Narrow);break;case"y":n=En(0,1,0,!1,!0);break;case"yy":n=En(0,2,0,!0,!0);break;case"yyy":n=En(0,3,0,!1,!0);break;case"yyyy":n=En(0,4,0,!1,!0);break;case"Y":n=Hv(1);break;case"YY":n=Hv(2,!0);break;case"YYY":n=Hv(3);break;case"YYYY":n=Hv(4);break;case"M":case"L":n=En(1,1,1);break;case"MM":case"LL":n=En(1,2,1);break;case"MMM":n=Kt(2,Ft.Abbreviated);break;case"MMMM":n=Kt(2,Ft.Wide);break;case"MMMMM":n=Kt(2,Ft.Narrow);break;case"LLL":n=Kt(2,Ft.Abbreviated,br.Standalone);break;case"LLLL":n=Kt(2,Ft.Wide,br.Standalone);break;case"LLLLL":n=Kt(2,Ft.Narrow,br.Standalone);break;case"w":n=D_(1);break;case"ww":n=D_(2);break;case"W":n=D_(1,!0);break;case"d":n=En(2,1);break;case"dd":n=En(2,2);break;case"c":case"cc":n=En(7,1);break;case"ccc":n=Kt(1,Ft.Abbreviated,br.Standalone);break;case"cccc":n=Kt(1,Ft.Wide,br.Standalone);break;case"ccccc":n=Kt(1,Ft.Narrow,br.Standalone);break;case"cccccc":n=Kt(1,Ft.Short,br.Standalone);break;case"E":case"EE":case"EEE":n=Kt(1,Ft.Abbreviated);break;case"EEEE":n=Kt(1,Ft.Wide);break;case"EEEEE":n=Kt(1,Ft.Narrow);break;case"EEEEEE":n=Kt(1,Ft.Short);break;case"a":case"aa":case"aaa":n=Kt(0,Ft.Abbreviated);break;case"aaaa":n=Kt(0,Ft.Wide);break;case"aaaaa":n=Kt(0,Ft.Narrow);break;case"b":case"bb":case"bbb":n=Kt(0,Ft.Abbreviated,br.Standalone,!0);break;case"bbbb":n=Kt(0,Ft.Wide,br.Standalone,!0);break;case"bbbbb":n=Kt(0,Ft.Narrow,br.Standalone,!0);break;case"B":case"BB":case"BBB":n=Kt(0,Ft.Abbreviated,br.Format,!0);break;case"BBBB":n=Kt(0,Ft.Wide,br.Format,!0);break;case"BBBBB":n=Kt(0,Ft.Narrow,br.Format,!0);break;case"h":n=En(3,1,-12);break;case"hh":n=En(3,2,-12);break;case"H":n=En(3,1);break;case"HH":n=En(3,2);break;case"m":n=En(4,1);break;case"mm":n=En(4,2);break;case"s":n=En(5,1);break;case"ss":n=En(5,2);break;case"S":n=En(6,1);break;case"SS":n=En(6,2);break;case"SSS":n=En(6,3);break;case"Z":case"ZZ":case"ZZZ":n=Wv(0);break;case"ZZZZZ":n=Wv(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=Wv(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=Wv(2);break;default:return null}return k_[t]=n,n}function i$(t,n){t=t.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(e)?n:e}function Dne(t,n){return t=new Date(t.getTime()),t.setMinutes(t.getMinutes()+n),t}function kne(t,n,e){let o=t.getTimezoneOffset(),i=i$(n,o);return Dne(t,-1*(i-o))}function Ane(t){if(jF(t))return t;if(typeof t=="number"&&!isNaN(t))return new Date(t);if(typeof t=="string"){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){let[o,i=1,s=1]=t.split("-").map(a=>+a);return qv(o,i-1,s)}let e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let r;if(r=t.match(wne))return Rne(r)}let n=new Date(t);if(!jF(n))throw new Error(`Unable to convert "${t}" into a date`);return n}function Rne(t){let n=new Date(0),e=0,r=0,o=t[8]?n.setUTCFullYear:n.setFullYear,i=t[8]?n.setUTCHours:n.setHours;t[9]&&(e=Number(t[9]+t[10]),r=Number(t[9]+t[11])),o.call(n,Number(t[1]),Number(t[2])-1,Number(t[3]));let s=Number(t[4]||0)-e,a=Number(t[5]||0)-r,l=Number(t[6]||0),u=Math.floor(parseFloat("0."+(t[7]||0))*1e3);return i.call(n,s,a,l,u),n}function jF(t){return t instanceof Date&&!isNaN(t.valueOf())}var Kv=class{$implicit;ngForOf;index;count;constructor(n,e,r,o){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Yv=(()=>{class t{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,r,o){this._viewContainer=e,this._template=r,this._differs=o}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let r=this._viewContainer;e.forEachOperation((o,i,s)=>{if(o.previousIndex==null)r.createEmbeddedView(this._template,new Kv(o.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)r.remove(i===null?void 0:i);else if(i!==null){let a=r.get(i);r.move(a,s),qF(a,o)}});for(let o=0,i=r.length;o<i;o++){let a=r.get(o).context;a.index=o,a.count=i,a.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{let i=r.get(o.currentIndex);qF(i,o)})}static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(xt(Al),xt(Cc),xt(I_))};static \u0275dir=xn({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return t})();function qF(t,n){t.context.$implicit=n.item}var zs=(()=>{class t{_viewContainer;_context=new Xv;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,r){this._viewContainer=e,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){KF(e,!1),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){KF(e,!1),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(xt(Al),xt(Cc))};static \u0275dir=xn({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return t})(),Xv=class{$implicit=null;ngIf=null};function KF(t,n){if(t&&!t.createEmbeddedView)throw new Ne(2020,!1)}function Mne(t,n){return new Ne(2100,!1)}var One="mediumDate",s$=new ke(""),a$=new ke(""),A_=(()=>{class t{locale;defaultTimezone;defaultOptions;constructor(e,r,o){this.locale=e,this.defaultTimezone=r,this.defaultOptions=o}transform(e,r,o,i){if(e==null||e===""||e!==e)return null;try{let s=r??this.defaultOptions?.dateFormat??One,a=o??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return r$(e,s,i||this.locale,a)}catch(s){throw Mne(t,s.message)}}static \u0275fac=function(r){return new(r||t)(xt(Vv,16),xt(s$,24),xt(a$,24))};static \u0275pipe=vF({name:"date",type:t,pure:!0})}return t})();var ts=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=Nc({type:t});static \u0275inj=Tc({})}return t})();function R_(t,n){n=encodeURIComponent(n);for(let e of t.split(";")){let r=e.indexOf("="),[o,i]=r==-1?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===n)return decodeURIComponent(i)}return null}var M_="browser",l$="server";function Zv(t){return t===l$}var jm=class{};var tb=new ke(""),P_=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,r){this._zone=r,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o,i){return this._findPluginFor(r).addEventListener(e,r,o,i)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(i=>i.supports(e)),!r)throw new Ne(5101,!1);return this._eventNameToPlugin.set(e,r),r}static \u0275fac=function(r){return new(r||t)(nt(tb),nt(Zn))};static \u0275prov=Pe({token:t,factory:t.\u0275fac})}return t})(),qm=class{_doc;constructor(n){this._doc=n}manager},Jv="ng-app-id";function u$(t){for(let n of t)n.remove()}function c$(t,n){let e=n.createElement("style");return e.textContent=t,e}function Fne(t,n,e,r){let o=t.head?.querySelectorAll(`style[${Jv}="${n}"],link[${Jv}="${n}"]`);if(o)for(let i of o)i.removeAttribute(Jv),i instanceof HTMLLinkElement?r.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&e.set(i.textContent,{usage:0,elements:[i]})}function F_(t,n){let e=n.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),e}var L_=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(e,r,o,i={}){this.doc=e,this.appId=r,this.nonce=o,this.isServer=Zv(i),Fne(e,r,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,r){for(let o of e)this.addUsage(o,this.inline,c$);r?.forEach(o=>this.addUsage(o,this.external,F_))}removeStyles(e,r){for(let o of e)this.removeUsage(o,this.inline);r?.forEach(o=>this.removeUsage(o,this.external))}addUsage(e,r,o){let i=r.get(e);i?i.usage++:r.set(e,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(e,this.doc)))})}removeUsage(e,r){let o=r.get(e);o&&(o.usage--,o.usage<=0&&(u$(o.elements),r.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])u$(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[r,{elements:o}]of this.inline)o.push(this.addElement(e,c$(r,this.doc)));for(let[r,{elements:o}]of this.external)o.push(this.addElement(e,F_(r,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(Jv,this.appId),e.appendChild(r)}static \u0275fac=function(r){return new(r||t)(nt(vr),nt(t_),nt(r_,8),nt(Fm))};static \u0275prov=Pe({token:t,factory:t.\u0275fac})}return t})(),O_={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},V_=/%COMP%/g;var f$="%COMP%",$ne=`_nghost-${f$}`,Pne=`_ngcontent-${f$}`,Lne=!0,Vne=new ke("",{providedIn:"root",factory:()=>Lne});function Bne(t){return Pne.replace(V_,t)}function zne(t){return $ne.replace(V_,t)}function d$(t,n){return n.map(e=>e.replace(V_,t))}var B_=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,r,o,i,s,a,l,u=null,c=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=u,this.tracingService=c,this.platformIsServer=Zv(a),this.defaultRenderer=new Km(e,s,l,this.platformIsServer,this.tracingService)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Yi.ShadowDom&&(r=pt(me({},r),{encapsulation:Yi.Emulated}));let o=this.getOrCreateRenderer(e,r);return o instanceof eb?o.applyToHost(e):o instanceof Xm&&o.applyStyles(),o}getOrCreateRenderer(e,r){let o=this.rendererByCompId,i=o.get(r.id);if(!i){let s=this.doc,a=this.ngZone,l=this.eventManager,u=this.sharedStylesHost,c=this.removeStylesOnCompDestroy,p=this.platformIsServer,f=this.tracingService;switch(r.encapsulation){case Yi.Emulated:i=new eb(l,u,r,this.appId,c,s,a,p,f);break;case Yi.ShadowDom:return new $_(l,u,e,r,s,a,this.nonce,p,f);default:i=new Xm(l,u,r,c,s,a,p,f);break}o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(r){return new(r||t)(nt(P_),nt(L_),nt(t_),nt(Vne),nt(vr),nt(Fm),nt(Zn),nt(r_),nt(Mv,8))};static \u0275prov=Pe({token:t,factory:t.\u0275fac})}return t})(),Km=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,e,r,o,i){this.eventManager=n,this.doc=e,this.ngZone=r,this.platformIsServer=o,this.tracingService=i}destroy(){}destroyNode=null;createElement(n,e){return e?this.doc.createElementNS(O_[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(p$(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(p$(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){e.remove()}selectRootElement(n,e){let r=typeof n=="string"?this.doc.querySelector(n):n;if(!r)throw new Ne(-5104,!1);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,o){if(o){e=o+":"+e;let i=O_[o];i?n.setAttributeNS(i,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){let o=O_[r];o?n.removeAttributeNS(o,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,o){o&(Fs.DashCase|Fs.Important)?n.style.setProperty(e,r,o&Fs.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&Fs.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n!=null&&(n[e]=r)}setValue(n,e){n.nodeValue=e}listen(n,e,r,o){if(typeof n=="string"&&(n=qo().getGlobalEventTarget(this.doc,n),!n))throw new Ne(5102,!1);let i=this.decoratePreventDefault(r);return this.tracingService?.wrapEventListener&&(i=this.tracingService.wrapEventListener(n,e,i)),this.eventManager.addEventListener(n,e,i,o)}decoratePreventDefault(n){return e=>{if(e==="__ngUnwrap__")return n;(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))===!1&&e.preventDefault()}}};function p$(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var $_=class extends Km{sharedStylesHost;hostEl;shadowRoot;constructor(n,e,r,o,i,s,a,l,u){super(n,i,s,l,u),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let c=o.styles;c=d$(o.id,c);for(let f of c){let d=document.createElement("style");a&&d.setAttribute("nonce",a),d.textContent=f,this.shadowRoot.appendChild(d)}let p=o.getExternalStyles?.();if(p)for(let f of p){let d=F_(f,i);a&&d.setAttribute("nonce",a),this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(null,e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Xm=class extends Km{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,e,r,o,i,s,a,l,u){super(n,i,s,a,l),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o;let c=r.styles;this.styles=u?d$(u,c):c,this.styleUrls=r.getExternalStyles?.(u)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},eb=class extends Xm{contentAttr;hostAttr;constructor(n,e,r,o,i,s,a,l,u){let c=o+"-"+r.id;super(n,e,r,i,s,a,l,u,c),this.contentAttr=Bne(c),this.hostAttr=zne(c)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){let r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}};var nb=class t extends zm{supportsDOMEvents=!0;static makeCurrent(){T_(new t)}onAndCancel(n,e,r,o){return n.addEventListener(e,r,o),()=>{n.removeEventListener(e,r,o)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.remove()}createElement(n,e){return e=e||this.getDefaultDocument(),e.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return e==="window"?window:e==="document"?n:e==="body"?n.body:null}getBaseHref(n){let e=Une();return e==null?null:Gne(e)}resetBaseElement(){Ym=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return R_(document.cookie,n)}},Ym=null;function Une(){return Ym=Ym||document.head.querySelector("base"),Ym?Ym.getAttribute("href"):null}function Gne(t){return new URL(t,document.baseURI).pathname}var Wne=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac})}return t})(),m$=(()=>{class t extends qm{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o,i){return e.addEventListener(r,o,i),()=>this.removeEventListener(e,r,o,i)}removeEventListener(e,r,o,i){return e.removeEventListener(r,o,i)}static \u0275fac=function(r){return new(r||t)(nt(vr))};static \u0275prov=Pe({token:t,factory:t.\u0275fac})}return t})(),h$=["alt","control","meta","shift"],Hne={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},jne={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},g$=(()=>{class t extends qm{constructor(e){super(e)}supports(e){return t.parseEventName(e)!=null}addEventListener(e,r,o,i){let s=t.parseEventName(r),a=t.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>qo().onAndCancel(e,s.domEventName,a,i))}static parseEventName(e){let r=e.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let i=t._normalizeKey(r.pop()),s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),h$.forEach(u=>{let c=r.indexOf(u);c>-1&&(r.splice(c,1),s+=u+".")}),s+=i,r.length!=0||i.length===0)return null;let l={};return l.domEventName=o,l.fullKey=s,l}static matchEventFullKeyCode(e,r){let o=Hne[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),h$.forEach(s=>{if(s!==o){let a=jne[s];a(e)&&(i+=s+".")}}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{t.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(r){return new(r||t)(nt(vr))};static \u0275prov=Pe({token:t,factory:t.\u0275fac})}return t})();function z_(t,n){return LF(me({rootComponent:t},qne(n)))}function qne(t){return{appProviders:[...Qne,...t?.providers??[]],platformProviders:Zne}}function Kne(){nb.makeCurrent()}function Xne(){return new Os}function Yne(){return M2(document),document}var Zne=[{provide:Fm,useValue:M_},{provide:n_,useValue:Kne,multi:!0},{provide:vr,useFactory:Yne}];var Qne=[{provide:Tv,useValue:"root"},{provide:Os,useFactory:Xne},{provide:tb,useClass:m$,multi:!0,deps:[vr]},{provide:tb,useClass:g$,multi:!0,deps:[vr]},B_,L_,P_,{provide:vf,useExisting:B_},{provide:jm,useClass:Wne},[]];var y$=(()=>{class t{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(r){return new(r||t)(nt(vr))};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Ze="primary",lg=Symbol("RouteTitle"),j_=class{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function Ff(t){return new j_(t)}function ere(t,n,e){let r=e.path.split("/");if(r.length>t.length||e.pathMatch==="full"&&(n.hasChildren()||r.length<t.length))return null;let o={};for(let i=0;i<r.length;i++){let s=r[i],a=t[i];if(s[0]===":")o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}function tre(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!ns(t[e],n[e]))return!1;return!0}function ns(t,n){let e=t?q_(t):void 0,r=n?q_(n):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!E$(t[o],n[o]))return!1;return!0}function q_(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function E$(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;let e=[...t].sort(),r=[...n].sort();return e.every((o,i)=>r[i]===o)}else return t===n}function T$(t){return t.length>0?t[t.length-1]:null}function $l(t){return wE(t)?t:Dc(t)?fn(Promise.resolve(t)):Ge(t)}var nre={exact:N$,subset:D$},_$={exact:rre,subset:ore,ignored:()=>!0};function x$(t,n,e){return nre[e.paths](t.root,n.root,e.matrixParams)&&_$[e.queryParams](t.queryParams,n.queryParams)&&!(e.fragment==="exact"&&t.fragment!==n.fragment)}function rre(t,n){return ns(t,n)}function N$(t,n,e){if(!Ac(t.segments,n.segments)||!ib(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(let r in n.children)if(!t.children[r]||!N$(t.children[r],n.children[r],e))return!1;return!0}function ore(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>E$(t[e],n[e]))}function D$(t,n,e){return k$(t,n,n.segments,e)}function k$(t,n,e,r){if(t.segments.length>e.length){let o=t.segments.slice(0,e.length);return!(!Ac(o,e)||n.hasChildren()||!ib(o,e,r))}else if(t.segments.length===e.length){if(!Ac(t.segments,e)||!ib(t.segments,e,r))return!1;for(let o in n.children)if(!t.children[o]||!D$(t.children[o],n.children[o],r))return!1;return!0}else{let o=e.slice(0,t.segments.length),i=e.slice(t.segments.length);return!Ac(t.segments,o)||!ib(t.segments,o,r)||!t.children[Ze]?!1:k$(t.children[Ze],n,i,r)}}function ib(t,n,e){return n.every((r,o)=>_$[e](t[o].parameters,r.parameters))}var Gs=class{root;queryParams;fragment;_queryParamMap;constructor(n=new Nt([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Ff(this.queryParams),this._queryParamMap}toString(){return are.serialize(this)}},Nt=class{segments;children;parent=null;constructor(n,e){this.segments=n,this.children=e,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return sb(this)}},kc=class{path;parameters;_parameterMap;constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap??=Ff(this.parameters),this._parameterMap}toString(){return R$(this)}};function ire(t,n){return Ac(t,n)&&t.every((e,r)=>ns(e.parameters,n[r].parameters))}function Ac(t,n){return t.length!==n.length?!1:t.every((e,r)=>e.path===n[r].path)}function sre(t,n){let e=[];return Object.entries(t.children).forEach(([r,o])=>{r===Ze&&(e=e.concat(n(o,r)))}),Object.entries(t.children).forEach(([r,o])=>{r!==Ze&&(e=e.concat(n(o,r)))}),e}var vb=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:()=>new $f,providedIn:"root"})}return t})(),$f=class{parse(n){let e=new X_(n);return new Gs(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){let e=`/${Zm(n.root,!0)}`,r=cre(n.queryParams),o=typeof n.fragment=="string"?`#${lre(n.fragment)}`:"";return`${e}${r}${o}`}},are=new $f;function sb(t){return t.segments.map(n=>R$(n)).join("/")}function Zm(t,n){if(!t.hasChildren())return sb(t);if(n){let e=t.children[Ze]?Zm(t.children[Ze],!1):"",r=[];return Object.entries(t.children).forEach(([o,i])=>{o!==Ze&&r.push(`${o}:${Zm(i,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}else{let e=sre(t,(r,o)=>o===Ze?[Zm(t.children[Ze],!1)]:[`${o}:${Zm(r,!1)}`]);return Object.keys(t.children).length===1&&t.children[Ze]!=null?`${sb(t)}/${e[0]}`:`${sb(t)}/(${e.join("//")})`}}function A$(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function rb(t){return A$(t).replace(/%3B/gi,";")}function lre(t){return encodeURI(t)}function K_(t){return A$(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ab(t){return decodeURIComponent(t)}function v$(t){return ab(t.replace(/\+/g,"%20"))}function R$(t){return`${K_(t.path)}${ure(t.parameters)}`}function ure(t){return Object.entries(t).map(([n,e])=>`;${K_(n)}=${K_(e)}`).join("")}function cre(t){let n=Object.entries(t).map(([e,r])=>Array.isArray(r)?r.map(o=>`${rb(e)}=${rb(o)}`).join("&"):`${rb(e)}=${rb(r)}`).filter(e=>e);return n.length?`?${n.join("&")}`:""}var pre=/^[^\/()?;#]+/;function U_(t){let n=t.match(pre);return n?n[0]:""}var fre=/^[^\/()?;=#]+/;function dre(t){let n=t.match(fre);return n?n[0]:""}var hre=/^[^=?&#]+/;function mre(t){let n=t.match(hre);return n?n[0]:""}var gre=/^[^&#]+/;function yre(t){let n=t.match(gre);return n?n[0]:""}var X_=class{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Nt([],{}):new Nt([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[Ze]=new Nt(n,e)),r}parseSegment(){let n=U_(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new Ne(4009,!1);return this.capture(n),new kc(ab(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let e=dre(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let o=U_(this.remaining);o&&(r=o,this.capture(r))}n[ab(e)]=ab(r)}parseQueryParam(n){let e=mre(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let s=yre(this.remaining);s&&(r=s,this.capture(r))}let o=v$(e),i=v$(r);if(n.hasOwnProperty(o)){let s=n[o];Array.isArray(s)||(s=[s],n[o]=s),s.push(i)}else n[o]=i}parseParens(n){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=U_(this.remaining),o=this.remaining[r.length];if(o!=="/"&&o!==")"&&o!==";")throw new Ne(4010,!1);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=Ze);let s=this.parseChildren();e[i]=Object.keys(s).length===1?s[Ze]:new Nt([],s),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new Ne(4011,!1)}};function M$(t){return t.segments.length>0?new Nt([],{[Ze]:t}):t}function O$(t){let n={};for(let[r,o]of Object.entries(t.children)){let i=O$(o);if(r===Ze&&i.segments.length===0&&i.hasChildren())for(let[s,a]of Object.entries(i.children))n[s]=a;else(i.segments.length>0||i.hasChildren())&&(n[r]=i)}let e=new Nt(t.segments,n);return xre(e)}function xre(t){if(t.numberOfChildren===1&&t.children[Ze]){let n=t.children[Ze];return new Nt(t.segments.concat(n.segments),n.children)}return t}function Pf(t){return t instanceof Gs}function vre(t,n,e=null,r=null){let o=F$(t);return $$(o,n,e,r)}function F$(t){let n;function e(i){let s={};for(let l of i.children){let u=e(l);s[l.outlet]=u}let a=new Nt(i.url,s);return i===t&&(n=a),a}let r=e(t.root),o=M$(r);return n??o}function $$(t,n,e,r){let o=t;for(;o.parent;)o=o.parent;if(n.length===0)return G_(o,o,o,e,r);let i=bre(n);if(i.toRoot())return G_(o,o,new Nt([],{}),e,r);let s=wre(i,o,t),a=s.processChildren?Jm(s.segmentGroup,s.index,i.commands):L$(s.segmentGroup,s.index,i.commands);return G_(o,s.segmentGroup,a,e,r)}function ub(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function tg(t){return typeof t=="object"&&t!=null&&t.outlets}function G_(t,n,e,r,o){let i={};r&&Object.entries(r).forEach(([l,u])=>{i[l]=Array.isArray(u)?u.map(c=>`${c}`):`${u}`});let s;t===n?s=e:s=P$(t,n,e);let a=M$(O$(s));return new Gs(a,i,o)}function P$(t,n,e){let r={};return Object.entries(t.children).forEach(([o,i])=>{i===n?r[o]=e:r[o]=P$(i,n,e)}),new Nt(t.segments,r)}var cb=class{isAbsolute;numberOfDoubleDots;commands;constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&ub(r[0]))throw new Ne(4003,!1);let o=r.find(tg);if(o&&o!==T$(r))throw new Ne(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function bre(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new cb(!0,0,t);let n=0,e=!1,r=t.reduce((o,i,s)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let a={};return Object.entries(i.outlets).forEach(([l,u])=>{a[l]=typeof u=="string"?u.split("/"):u}),[...o,{outlets:a}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:s===0?(i.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?e=!0:a===".."?n++:a!=""&&o.push(a))}),o):[...o,i]},[]);return new cb(e,n,r)}var Rf=class{segmentGroup;processChildren;index;constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}};function wre(t,n,e){if(t.isAbsolute)return new Rf(n,!0,0);if(!e)return new Rf(n,!1,NaN);if(e.parent===null)return new Rf(e,!0,0);let r=ub(t.commands[0])?0:1,o=e.segments.length-1+r;return Cre(e,o,t.numberOfDoubleDots)}function Cre(t,n,e){let r=t,o=n,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new Ne(4005,!1);o=r.segments.length}return new Rf(r,!1,o-i)}function Sre(t){return tg(t[0])?t[0].outlets:{[Ze]:t}}function L$(t,n,e){if(t??=new Nt([],{}),t.segments.length===0&&t.hasChildren())return Jm(t,n,e);let r=Ire(t,n,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){let i=new Nt(t.segments.slice(0,r.pathIndex),{});return i.children[Ze]=new Nt(t.segments.slice(r.pathIndex),t.children),Jm(i,0,o)}else return r.match&&o.length===0?new Nt(t.segments,{}):r.match&&!t.hasChildren()?Y_(t,n,e):r.match?Jm(t,0,o):Y_(t,n,e)}function Jm(t,n,e){if(e.length===0)return new Nt(t.segments,{});{let r=Sre(e),o={};if(Object.keys(r).some(i=>i!==Ze)&&t.children[Ze]&&t.numberOfChildren===1&&t.children[Ze].segments.length===0){let i=Jm(t.children[Ze],n,e);return new Nt(t.segments,i.children)}return Object.entries(r).forEach(([i,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(o[i]=L$(t.children[i],n,s))}),Object.entries(t.children).forEach(([i,s])=>{r[i]===void 0&&(o[i]=s)}),new Nt(t.segments,o)}}function Ire(t,n,e){let r=0,o=n,i={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(r>=e.length)return i;let s=t.segments[o],a=e[r];if(tg(a))break;let l=`${a}`,u=r<e.length-1?e[r+1]:null;if(o>0&&l===void 0)break;if(l&&u&&typeof u=="object"&&u.outlets===void 0){if(!w$(l,u,s))return i;r+=2}else{if(!w$(l,{},s))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}function Y_(t,n,e){let r=t.segments.slice(0,n),o=0;for(;o<e.length;){let i=e[o];if(tg(i)){let l=Ere(i.outlets);return new Nt(r,l)}if(o===0&&ub(e[0])){let l=t.segments[n];r.push(new kc(l.path,b$(e[0]))),o++;continue}let s=tg(i)?i.outlets[Ze]:`${i}`,a=o<e.length-1?e[o+1]:null;s&&a&&ub(a)?(r.push(new kc(s,b$(a))),o+=2):(r.push(new kc(s,{})),o++)}return new Nt(r,{})}function Ere(t){let n={};return Object.entries(t).forEach(([e,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(n[e]=Y_(new Nt([],{}),0,r))}),n}function b$(t){let n={};return Object.entries(t).forEach(([e,r])=>n[e]=`${r}`),n}function w$(t,n,e){return t==e.path&&ns(n,e.parameters)}var lb="imperative",ar=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(ar||{}),Xo=class{id;url;constructor(n,e){this.id=n,this.url=e}},Lf=class extends Xo{type=ar.NavigationStart;navigationTrigger;restoredState;constructor(n,e,r="imperative",o=null){super(n,e),this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Ol=class extends Xo{urlAfterRedirects;type=ar.NavigationEnd;constructor(n,e,r){super(n,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},_o=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(_o||{}),pb=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(pb||{}),Us=class extends Xo{reason;code;type=ar.NavigationCancel;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Fl=class extends Xo{reason;code;type=ar.NavigationSkipped;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}},ng=class extends Xo{error;target;type=ar.NavigationError;constructor(n,e,r,o){super(n,e),this.error=r,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},fb=class extends Xo{urlAfterRedirects;state;type=ar.RoutesRecognized;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Z_=class extends Xo{urlAfterRedirects;state;type=ar.GuardsCheckStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Q_=class extends Xo{urlAfterRedirects;state;shouldActivate;type=ar.GuardsCheckEnd;constructor(n,e,r,o,i){super(n,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},J_=class extends Xo{urlAfterRedirects;state;type=ar.ResolveStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},eN=class extends Xo{urlAfterRedirects;state;type=ar.ResolveEnd;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},tN=class{route;type=ar.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},nN=class{route;type=ar.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},rN=class{snapshot;type=ar.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},oN=class{snapshot;type=ar.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},iN=class{snapshot;type=ar.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},sN=class{snapshot;type=ar.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var rg=class{},Vf=class{url;navigationBehaviorOptions;constructor(n,e){this.url=n,this.navigationBehaviorOptions=e}};function Tre(t,n){return t.providers&&!t._injector&&(t._injector=Pv(t.providers,n,`Route: ${t.path}`)),t._injector??n}function Ti(t){return t.outlet||Ze}function _re(t,n){let e=t.filter(r=>Ti(r)===n);return e.push(...t.filter(r=>Ti(r)!==n)),e}function ug(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){let e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var aN=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return ug(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new cg(this.rootInjector)}},cg=(()=>{class t{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,r){let o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){let r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new aN(this.rootInjector),this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(r){return new(r||t)(nt(zo))};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),db=class{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){let e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){let e=lN(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){let e=lN(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){let e=uN(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return uN(n,this._root).map(e=>e.value)}};function lN(t,n){if(t===n.value)return n;for(let e of n.children){let r=lN(t,e);if(r)return r}return null}function uN(t,n){if(t===n.value)return[n];for(let e of n.children){let r=uN(t,e);if(r.length)return r.unshift(n),r}return[]}var To=class{value;children;constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}};function Af(t){let n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}var hb=class extends db{snapshot;constructor(n,e){super(n),this.snapshot=e,xN(this,n)}toString(){return this.snapshot.toString()}};function V$(t){let n=Nre(t),e=new ir([new kc("",{})]),r=new ir({}),o=new ir({}),i=new ir({}),s=new ir(""),a=new Rc(e,r,i,s,o,Ze,t,n.root);return a.snapshot=n.root,new hb(new To(a,[]),n)}function Nre(t){let n={},e={},r={},o="",i=new Mf([],n,r,o,e,Ze,t,null,{});return new gb("",new To(i,[]))}var Rc=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,e,r,o,i,s,a,l){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=i,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(ft(u=>u[lg]))??Ge(void 0),this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(ft(n=>Ff(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(ft(n=>Ff(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function mb(t,n,e="emptyOnly"){let r,{routeConfig:o}=t;return n!==null&&(e==="always"||o?.path===""||!n.component&&!n.routeConfig?.loadComponent)?r={params:me(me({},n.params),t.params),data:me(me({},n.data),t.data),resolve:me(me(me(me({},t.data),n.data),o?.data),t._resolvedData)}:r={params:me({},t.params),data:me({},t.data),resolve:me(me({},t.data),t._resolvedData??{})},o&&z$(o)&&(r.resolve[lg]=o.title),r}var Mf=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[lg]}constructor(n,e,r,o,i,s,a,l,u){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Ff(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Ff(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(r=>r.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${e}')`}},gb=class extends db{url;constructor(n,e){super(e),this.url=n,xN(this,e)}toString(){return B$(this._root)}};function xN(t,n){n.value._routerState=t,n.children.forEach(e=>xN(t,e))}function B$(t){let n=t.children.length>0?` { ${t.children.map(B$).join(", ")} } `:"";return`${t.value}${n}`}function W_(t){if(t.snapshot){let n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,ns(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),ns(n.params,e.params)||t.paramsSubject.next(e.params),tre(n.url,e.url)||t.urlSubject.next(e.url),ns(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function cN(t,n){let e=ns(t.params,n.params)&&ire(t.url,n.url),r=!t.parent!=!n.parent;return e&&!r&&(!t.parent||cN(t.parent,n.parent))}function z$(t){return typeof t.title=="string"||t.title===null}var Dre=new ke(""),U$=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Ze;activateEvents=new Jt;deactivateEvents=new Jt;attachEvents=new Jt;detachEvents=new Jt;routerOutletData=E2(void 0);parentContexts=ge(cg);location=ge(Al);changeDetector=ge(Bm);inputBinder=ge(bb,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ne(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ne(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ne(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new Ne(4013,!1);this._activatedRoute=e;let o=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new pN(e,a,o.injector,this.routerOutletData);this.activated=o.createComponent(s,{index:o.length,injector:l,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||t)};static \u0275dir=xn({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Ef]})}return t})(),pN=class{route;childContexts;parent;outletData;constructor(n,e,r,o){this.route=n,this.childContexts=e,this.parent=r,this.outletData=o}get(n,e){return n===Rc?this.route:n===cg?this.childContexts:n===Dre?this.outletData:this.parent.get(n,e)}},bb=new ke("");var G$=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275cmp=Ji({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,o){r&1&&So(0,"router-outlet")},dependencies:[U$],encapsulation:2})}return t})();function vN(t){let n=t.children&&t.children.map(vN),e=n?pt(me({},t),{children:n}):me({},t);return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==Ze&&(e.component=G$),e}function kre(t,n,e){let r=og(t,n._root,e?e._root:void 0);return new hb(r,n)}function og(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){let r=e.value;r._futureSnapshot=n.value;let o=Are(t,n,e);return new To(r,o)}else{if(t.shouldAttach(n.value)){let i=t.retrieve(n.value);if(i!==null){let s=i.route;return s.value._futureSnapshot=n.value,s.children=n.children.map(a=>og(t,a)),s}}let r=Rre(n.value),o=n.children.map(i=>og(t,i));return new To(r,o)}}function Are(t,n,e){return n.children.map(r=>{for(let o of e.children)if(t.shouldReuseRoute(r.value,o.value.snapshot))return og(t,r,o);return og(t,r)})}function Rre(t){return new Rc(new ir(t.url),new ir(t.params),new ir(t.queryParams),new ir(t.fragment),new ir(t.data),t.outlet,t.component,t)}var ig=class{redirectTo;navigationBehaviorOptions;constructor(n,e){this.redirectTo=n,this.navigationBehaviorOptions=e}},W$="ngNavigationCancelingError";function yb(t,n){let{redirectTo:e,navigationBehaviorOptions:r}=Pf(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=H$(!1,_o.Redirect);return o.url=e,o.navigationBehaviorOptions=r,o}function H$(t,n){let e=new Error(`NavigationCancelingError: ${t||""}`);return e[W$]=!0,e.cancellationCode=n,e}function Mre(t){return j$(t)&&Pf(t.url)}function j$(t){return!!t&&t[W$]}var Ore=(t,n,e,r)=>ft(o=>(new fN(n,o.targetRouterState,o.currentRouterState,e,r).activate(t),o)),fN=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,e,r,o,i){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=i}activate(n){let e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),W_(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){let o=Af(e);n.children.forEach(i=>{let s=i.value.outlet;this.deactivateRoutes(i,o[s],r),delete o[s]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(o===i)if(o.component){let s=r.getContext(o.outlet);s&&this.deactivateChildRoutes(n,e,s.children)}else this.deactivateChildRoutes(n,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Af(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);if(r&&r.outlet){let s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:s,route:n,contexts:a})}}deactivateRouteAndOutlet(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Af(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,e,r){let o=Af(e);n.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new sN(i.value.snapshot))}),n.children.length&&this.forwardEvent(new oN(n.value.snapshot))}activateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(W_(o),o===i)if(o.component){let s=r.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,s.children)}else this.activateChildRoutes(n,e,r);else if(o.component){let s=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),W_(a.route.value),this.activateChildRoutes(n,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(n,null,s.children)}else this.activateChildRoutes(n,null,r)}},xb=class{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},Of=class{component;route;constructor(n,e){this.component=n,this.route=e}};function Fre(t,n,e){let r=t._root,o=n?n._root:null;return Qm(r,o,e,[r.value])}function $re(t){let n=t.routeConfig?t.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:t,guards:n}}function zf(t,n){let e=Symbol(),r=n.get(t,e);return r===e?typeof t=="function"&&!CO(t)?t:n.get(t):r}function Qm(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=Af(n);return t.children.forEach(s=>{Pre(s,i[s.value.outlet],e,r.concat([s.value]),o),delete i[s.value.outlet]}),Object.entries(i).forEach(([s,a])=>eg(a,e.getContext(s),o)),o}function Pre(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=t.value,s=n?n.value:null,a=e?e.getContext(t.value.outlet):null;if(s&&i.routeConfig===s.routeConfig){let l=Lre(s,i,i.routeConfig.runGuardsAndResolvers);l?o.canActivateChecks.push(new xb(r)):(i.data=s.data,i._resolvedData=s._resolvedData),i.component?Qm(t,n,a?a.children:null,r,o):Qm(t,n,e,r,o),l&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new Of(a.outlet.component,s))}else s&&eg(n,a,o),o.canActivateChecks.push(new xb(r)),i.component?Qm(t,null,a?a.children:null,r,o):Qm(t,null,e,r,o);return o}function Lre(t,n,e){if(typeof e=="function")return e(t,n);switch(e){case"pathParamsChange":return!Ac(t.url,n.url);case"pathParamsOrQueryParamsChange":return!Ac(t.url,n.url)||!ns(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!cN(t,n)||!ns(t.queryParams,n.queryParams);case"paramsChange":default:return!cN(t,n)}}function eg(t,n,e){let r=Af(t),o=t.value;Object.entries(r).forEach(([i,s])=>{o.component?n?eg(s,n.children.getContext(i),e):eg(s,null,e):eg(s,n,e)}),o.component?n&&n.outlet&&n.outlet.isActivated?e.canDeactivateChecks.push(new Of(n.outlet.component,o)):e.canDeactivateChecks.push(new Of(null,o)):e.canDeactivateChecks.push(new Of(null,o))}function pg(t){return typeof t=="function"}function Vre(t){return typeof t=="boolean"}function Bre(t){return t&&pg(t.canLoad)}function zre(t){return t&&pg(t.canActivate)}function Ure(t){return t&&pg(t.canActivateChild)}function Gre(t){return t&&pg(t.canDeactivate)}function Wre(t){return t&&pg(t.canMatch)}function q$(t){return t instanceof Ds||t?.name==="EmptyError"}var ob=Symbol("INITIAL_VALUE");function Bf(){return xi(t=>Gx(t.map(n=>n.pipe(ks(1),EE(ob)))).pipe(ft(n=>{for(let e of n)if(e!==!0){if(e===ob)return ob;if(e===!1||Hre(e))return e}return!0}),yi(n=>n!==ob),ks(1)))}function Hre(t){return Pf(t)||t instanceof ig}function jre(t,n){return $n(e=>{let{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:s}}=e;return s.length===0&&i.length===0?Ge(pt(me({},e),{guardsResult:!0})):qre(s,r,o,t).pipe($n(a=>a&&Vre(a)?Kre(r,i,t,n):Ge(a)),ft(a=>pt(me({},e),{guardsResult:a})))})}function qre(t,n,e,r){return fn(t).pipe($n(o=>Jre(o.component,o.route,e,n,r)),As(o=>o!==!0,!0))}function Kre(t,n,e,r){return fn(n).pipe(uf(o=>lf(Yre(o.route.parent,r),Xre(o.route,r),Qre(t,o.path,e),Zre(t,o.route,e))),As(o=>o!==!0,!0))}function Xre(t,n){return t!==null&&n&&n(new iN(t)),Ge(!0)}function Yre(t,n){return t!==null&&n&&n(new rN(t)),Ge(!0)}function Zre(t,n,e){let r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||r.length===0)return Ge(!0);let o=r.map(i=>Wx(()=>{let s=ug(n)??e,a=zf(i,s),l=zre(a)?a.canActivate(n,t):Ci(s,()=>a(n,t));return $l(l).pipe(As())}));return Ge(o).pipe(Bf())}function Qre(t,n,e){let r=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(s=>$re(s)).filter(s=>s!==null).map(s=>Wx(()=>{let a=s.guards.map(l=>{let u=ug(s.node)??e,c=zf(l,u),p=Ure(c)?c.canActivateChild(r,t):Ci(u,()=>c(r,t));return $l(p).pipe(As())});return Ge(a).pipe(Bf())}));return Ge(i).pipe(Bf())}function Jre(t,n,e,r,o){let i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!i||i.length===0)return Ge(!0);let s=i.map(a=>{let l=ug(n)??o,u=zf(a,l),c=Gre(u)?u.canDeactivate(t,n,e,r):Ci(l,()=>u(t,n,e,r));return $l(c).pipe(As())});return Ge(s).pipe(Bf())}function eoe(t,n,e,r){let o=n.canLoad;if(o===void 0||o.length===0)return Ge(!0);let i=o.map(s=>{let a=zf(s,t),l=Bre(a)?a.canLoad(n,e):Ci(t,()=>a(n,e));return $l(l)});return Ge(i).pipe(Bf(),K$(r))}function K$(t){return yE(sr(n=>{if(typeof n!="boolean")throw yb(t,n)}),ft(n=>n===!0))}function toe(t,n,e,r){let o=n.canMatch;if(!o||o.length===0)return Ge(!0);let i=o.map(s=>{let a=zf(s,t),l=Wre(a)?a.canMatch(n,e):Ci(t,()=>a(n,e));return $l(l)});return Ge(i).pipe(Bf(),K$(r))}var sg=class{segmentGroup;constructor(n){this.segmentGroup=n||null}},ag=class extends Error{urlTree;constructor(n){super(),this.urlTree=n}};function kf(t){return af(new sg(t))}function noe(t){return af(new Ne(4e3,!1))}function roe(t){return af(H$(!1,_o.GuardRejected))}var dN=class{urlSerializer;urlTree;constructor(n,e){this.urlSerializer=n,this.urlTree=e}lineralizeSegments(n,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),o.numberOfChildren===0)return Ge(r);if(o.numberOfChildren>1||!o.children[Ze])return noe(`${n.redirectTo}`);o=o.children[Ze]}}applyRedirectCommands(n,e,r,o,i){if(typeof e!="string"){let a=e,{queryParams:l,fragment:u,routeConfig:c,url:p,outlet:f,params:d,data:h,title:m}=o,g=Ci(i,()=>a({params:d,data:h,queryParams:l,fragment:u,routeConfig:c,url:p,outlet:f,title:m}));if(g instanceof Gs)throw new ag(g);e=g}let s=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r);if(e[0]==="/")throw new ag(s);return s}applyRedirectCreateUrlTree(n,e,r,o){let i=this.createSegmentGroup(n,e.root,r,o);return new Gs(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){let r={};return Object.entries(n).forEach(([o,i])=>{if(typeof i=="string"&&i[0]===":"){let a=i.substring(1);r[o]=e[a]}else r[o]=i}),r}createSegmentGroup(n,e,r,o){let i=this.createSegments(n,e.segments,r,o),s={};return Object.entries(e.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(n,l,r,o)}),new Nt(i,s)}createSegments(n,e,r,o){return e.map(i=>i.path[0]===":"?this.findPosParam(n,i,o):this.findOrReturn(i,r))}findPosParam(n,e,r){let o=r[e.path.substring(1)];if(!o)throw new Ne(4001,!1);return o}findOrReturn(n,e){let r=0;for(let o of e){if(o.path===n.path)return e.splice(r),o;r++}return n}},hN={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ooe(t,n,e,r,o){let i=X$(t,n,e);return i.matched?(r=Tre(n,r),toe(r,n,e,o).pipe(ft(s=>s===!0?i:me({},hN)))):Ge(i)}function X$(t,n,e){if(n.path==="**")return ioe(e);if(n.path==="")return n.pathMatch==="full"&&(t.hasChildren()||e.length>0)?me({},hN):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let o=(n.matcher||ere)(e,t,n);if(!o)return me({},hN);let i={};Object.entries(o.posParams??{}).forEach(([a,l])=>{i[a]=l.path});let s=o.consumed.length>0?me(me({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function ioe(t){return{matched:!0,parameters:t.length>0?T$(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function C$(t,n,e,r){return e.length>0&&loe(t,e,r)?{segmentGroup:new Nt(n,aoe(r,new Nt(e,t.children))),slicedSegments:[]}:e.length===0&&uoe(t,e,r)?{segmentGroup:new Nt(t.segments,soe(t,e,r,t.children)),slicedSegments:e}:{segmentGroup:new Nt(t.segments,t.children),slicedSegments:e}}function soe(t,n,e,r){let o={};for(let i of e)if(wb(t,n,i)&&!r[Ti(i)]){let s=new Nt([],{});o[Ti(i)]=s}return me(me({},r),o)}function aoe(t,n){let e={};e[Ze]=n;for(let r of t)if(r.path===""&&Ti(r)!==Ze){let o=new Nt([],{});e[Ti(r)]=o}return e}function loe(t,n,e){return e.some(r=>wb(t,n,r)&&Ti(r)!==Ze)}function uoe(t,n,e){return e.some(r=>wb(t,n,r))}function wb(t,n,e){return(t.hasChildren()||n.length>0)&&e.pathMatch==="full"?!1:e.path===""}function coe(t,n,e){return n.length===0&&!t.children[e]}var mN=class{};function poe(t,n,e,r,o,i,s="emptyOnly"){return new gN(t,n,e,r,o,s,i).recognize()}var foe=31,gN=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,e,r,o,i,s,a){this.injector=n,this.configLoader=e,this.rootComponentType=r,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new dN(this.urlSerializer,this.urlTree)}noMatchError(n){return new Ne(4002,`'${n.segmentGroup}'`)}recognize(){let n=C$(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(ft(({children:e,rootSnapshot:r})=>{let o=new To(r,e),i=new gb("",o),s=vre(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(s),{state:i,tree:s}}))}match(n){let e=new Mf([],Object.freeze({}),Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Ze,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,Ze,e).pipe(ft(r=>({children:r,rootSnapshot:e})),Tl(r=>{if(r instanceof ag)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof sg?this.noMatchError(r):r}))}processSegmentGroup(n,e,r,o,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(n,e,r,i):this.processSegment(n,e,r,r.segments,o,!0,i).pipe(ft(s=>s instanceof To?[s]:[]))}processChildren(n,e,r,o){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return fn(i).pipe(uf(s=>{let a=r.children[s],l=_re(e,s);return this.processSegmentGroup(n,l,a,s,o)}),IE((s,a)=>(s.push(...a),s)),_l(null),SE(),$n(s=>{if(s===null)return kf(r);let a=Y$(s);return doe(a),Ge(a)}))}processSegment(n,e,r,o,i,s,a){return fn(e).pipe(uf(l=>this.processSegmentAgainstRoute(l._injector??n,e,l,r,o,i,s,a).pipe(Tl(u=>{if(u instanceof sg)return Ge(null);throw u}))),As(l=>!!l),Tl(l=>{if(q$(l))return coe(r,o,i)?Ge(new mN):kf(r);throw l}))}processSegmentAgainstRoute(n,e,r,o,i,s,a,l){return Ti(r)!==s&&(s===Ze||!wb(o,i,r))?kf(o):r.redirectTo===void 0?this.matchSegmentAgainstRoute(n,o,r,i,s,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(n,o,e,r,i,s,l):kf(o)}expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,s,a){let{matched:l,parameters:u,consumedSegments:c,positionalParamSegments:p,remainingSegments:f}=X$(e,o,i);if(!l)return kf(e);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>foe&&(this.allowRedirects=!1));let d=new Mf(i,u,Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,S$(o),Ti(o),o.component??o._loadedComponent??null,o,I$(o)),h=mb(d,a,this.paramsInheritanceStrategy);d.params=Object.freeze(h.params),d.data=Object.freeze(h.data);let m=this.applyRedirects.applyRedirectCommands(c,o.redirectTo,p,d,n);return this.applyRedirects.lineralizeSegments(o,m).pipe($n(g=>this.processSegment(n,r,e,g.concat(f),s,!1,a)))}matchSegmentAgainstRoute(n,e,r,o,i,s){let a=ooe(e,r,o,n,this.urlSerializer);return r.path==="**"&&(e.children={}),a.pipe(xi(l=>l.matched?(n=r._injector??n,this.getChildConfig(n,r,o).pipe(xi(({routes:u})=>{let c=r._loadedInjector??n,{parameters:p,consumedSegments:f,remainingSegments:d}=l,h=new Mf(f,p,Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,S$(r),Ti(r),r.component??r._loadedComponent??null,r,I$(r)),m=mb(h,s,this.paramsInheritanceStrategy);h.params=Object.freeze(m.params),h.data=Object.freeze(m.data);let{segmentGroup:g,slicedSegments:y}=C$(e,f,d,u);if(y.length===0&&g.hasChildren())return this.processChildren(c,u,g,h).pipe(ft(b=>new To(h,b)));if(u.length===0&&y.length===0)return Ge(new To(h,[]));let x=Ti(r)===i;return this.processSegment(c,u,g,y,x?Ze:i,!0,h).pipe(ft(b=>new To(h,b instanceof To?[b]:[])))}))):kf(e)))}getChildConfig(n,e,r){return e.children?Ge({routes:e.children,injector:n}):e.loadChildren?e._loadedRoutes!==void 0?Ge({routes:e._loadedRoutes,injector:e._loadedInjector}):eoe(n,e,r,this.urlSerializer).pipe($n(o=>o?this.configLoader.loadChildren(n,e).pipe(sr(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):roe(e))):Ge({routes:[],injector:n})}};function doe(t){t.sort((n,e)=>n.value.outlet===Ze?-1:e.value.outlet===Ze?1:n.value.outlet.localeCompare(e.value.outlet))}function hoe(t){let n=t.value.routeConfig;return n&&n.path===""}function Y$(t){let n=[],e=new Set;for(let r of t){if(!hoe(r)){n.push(r);continue}let o=n.find(i=>r.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...r.children),e.add(o)):n.push(r)}for(let r of e){let o=Y$(r.children);n.push(new To(r.value,o))}return n.filter(r=>!e.has(r))}function S$(t){return t.data||{}}function I$(t){return t.resolve||{}}function moe(t,n,e,r,o,i){return $n(s=>poe(t,n,e,r,s.extractedUrl,o,i).pipe(ft(({state:a,tree:l})=>pt(me({},s),{targetSnapshot:a,urlAfterRedirects:l}))))}function goe(t,n){return $n(e=>{let{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return Ge(e);let i=new Set(o.map(l=>l.route)),s=new Set;for(let l of i)if(!s.has(l))for(let u of Z$(l))s.add(u);let a=0;return fn(s).pipe(uf(l=>i.has(l)?yoe(l,r,t,n):(l.data=mb(l,l.parent,t).resolve,Ge(void 0))),sr(()=>a++),cf(1),$n(l=>a===s.size?Ge(e):qr))})}function Z$(t){let n=t.children.map(e=>Z$(e)).flat();return[t,...n]}function yoe(t,n,e,r){let o=t.routeConfig,i=t._resolve;return o?.title!==void 0&&!z$(o)&&(i[lg]=o.title),xoe(i,t,n,r).pipe(ft(s=>(t._resolvedData=s,t.data=mb(t,t.parent,e).resolve,null)))}function xoe(t,n,e,r){let o=q_(t);if(o.length===0)return Ge({});let i={};return fn(o).pipe($n(s=>voe(t[s],n,e,r).pipe(As(),sr(a=>{if(a instanceof ig)throw yb(new $f,a);i[s]=a}))),cf(1),ft(()=>i),Tl(s=>q$(s)?qr:af(s)))}function voe(t,n,e,r){let o=ug(n)??r,i=zf(t,o),s=i.resolve?i.resolve(n,e):Ci(o,()=>i(n,e));return $l(s)}function H_(t){return xi(n=>{let e=t(n);return e?fn(e).pipe(ft(()=>n)):Ge(n)})}var Q$=(()=>{class t{buildTitle(e){let r,o=e.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===Ze);return r}getResolvedTitleForRoute(e){return e.data[lg]}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:()=>ge(boe),providedIn:"root"})}return t})(),boe=(()=>{class t extends Q${title;constructor(e){super(),this.title=e}updateTitle(e){let r=this.buildTitle(e);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||t)(nt(y$))};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Cb=new ke("",{providedIn:"root",factory:()=>({})}),Sb=new ke(""),J$=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=ge(OF);loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Ge(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);let r=$l(e.loadComponent()).pipe(ft(eP),sr(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),mm(()=>{this.componentLoaders.delete(e)})),o=new sf(r,()=>new Sn).pipe(of());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Ge({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let i=woe(r,this.compiler,e,this.onLoadEndListener).pipe(mm(()=>{this.childrenLoaders.delete(r)})),s=new sf(i,()=>new Sn).pipe(of());return this.childrenLoaders.set(r,s),s}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function woe(t,n,e,r){return $l(t.loadChildren()).pipe(ft(eP),$n(o=>o instanceof b_||Array.isArray(o)?Ge(o):fn(n.compileModuleAsync(o))),ft(o=>{r&&r(t);let i,s,a=!1;return Array.isArray(o)?(s=o,a=!0):(i=o.create(e).injector,s=i.get(Sb,[],{optional:!0,self:!0}).flat()),{routes:s.map(vN),injector:i}}))}function Coe(t){return t&&typeof t=="object"&&"default"in t}function eP(t){return Coe(t)?t.default:t}var bN=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:()=>ge(Soe),providedIn:"root"})}return t})(),Soe=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),tP=new ke("");var nP=new ke(""),rP=(()=>{class t{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new Sn;transitionAbortSubject=new Sn;configLoader=ge(J$);environmentInjector=ge(zo);destroyRef=ge(Av);urlSerializer=ge(vb);rootContexts=ge(cg);location=ge(Df);inputBindingEnabled=ge(bb,{optional:!0})!==null;titleStrategy=ge(Q$);options=ge(Cb,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=ge(bN);createViewTransition=ge(tP,{optional:!0});navigationErrorHandler=ge(nP,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Ge(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=o=>this.events.next(new tN(o)),r=o=>this.events.next(new nN(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let r=++this.navigationId;this.transitions?.next(pt(me({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,id:r}))}setupNavigations(e){return this.transitions=new ir(null),this.transitions.pipe(yi(r=>r!==null),xi(r=>{let o=!1,i=!1;return Ge(r).pipe(xi(s=>{if(this.navigationId>r.id)return this.cancelNavigationTransition(r,"",_o.SupersededByNewNavigation),qr;this.currentTransition=r,this.currentNavigation={id:s.id,initialUrl:s.rawUrl,extractedUrl:s.extractedUrl,targetBrowserUrl:typeof s.extras.browserUrl=="string"?this.urlSerializer.parse(s.extras.browserUrl):s.extras.browserUrl,trigger:s.source,extras:s.extras,previousNavigation:this.lastSuccessfulNavigation?pt(me({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let a=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),l=s.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!a&&l!=="reload"){let u="";return this.events.next(new Fl(s.id,this.urlSerializer.serialize(s.rawUrl),u,pb.IgnoredSameUrlNavigation)),s.resolve(!1),qr}if(this.urlHandlingStrategy.shouldProcessUrl(s.rawUrl))return Ge(s).pipe(xi(u=>(this.events.next(new Lf(u.id,this.urlSerializer.serialize(u.extractedUrl),u.source,u.restoredState)),u.id!==this.navigationId?qr:Promise.resolve(u))),moe(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),sr(u=>{r.targetSnapshot=u.targetSnapshot,r.urlAfterRedirects=u.urlAfterRedirects,this.currentNavigation=pt(me({},this.currentNavigation),{finalUrl:u.urlAfterRedirects});let c=new fb(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(c)}));if(a&&this.urlHandlingStrategy.shouldProcessUrl(s.currentRawUrl)){let{id:u,extractedUrl:c,source:p,restoredState:f,extras:d}=s,h=new Lf(u,this.urlSerializer.serialize(c),p,f);this.events.next(h);let m=V$(this.rootComponentType).snapshot;return this.currentTransition=r=pt(me({},s),{targetSnapshot:m,urlAfterRedirects:c,extras:pt(me({},d),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=c,Ge(r)}else{let u="";return this.events.next(new Fl(s.id,this.urlSerializer.serialize(s.extractedUrl),u,pb.IgnoredByUrlHandlingStrategy)),s.resolve(!1),qr}}),sr(s=>{let a=new Z_(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}),ft(s=>(this.currentTransition=r=pt(me({},s),{guards:Fre(s.targetSnapshot,s.currentSnapshot,this.rootContexts)}),r)),jre(this.environmentInjector,s=>this.events.next(s)),sr(s=>{if(r.guardsResult=s.guardsResult,s.guardsResult&&typeof s.guardsResult!="boolean")throw yb(this.urlSerializer,s.guardsResult);let a=new Q_(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot,!!s.guardsResult);this.events.next(a)}),yi(s=>s.guardsResult?!0:(this.cancelNavigationTransition(s,"",_o.GuardRejected),!1)),H_(s=>{if(s.guards.canActivateChecks.length!==0)return Ge(s).pipe(sr(a=>{let l=new J_(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}),xi(a=>{let l=!1;return Ge(a).pipe(goe(this.paramsInheritanceStrategy,this.environmentInjector),sr({next:()=>l=!0,complete:()=>{l||this.cancelNavigationTransition(a,"",_o.NoDataFromResolver)}}))}),sr(a=>{let l=new eN(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}))}),H_(s=>{let a=l=>{let u=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&u.push(this.configLoader.loadComponent(l.routeConfig).pipe(sr(c=>{l.component=c}),ft(()=>{})));for(let c of l.children)u.push(...a(c));return u};return Gx(a(s.targetSnapshot.root)).pipe(_l(null),ks(1))}),H_(()=>this.afterPreactivation()),xi(()=>{let{currentSnapshot:s,targetSnapshot:a}=r,l=this.createViewTransition?.(this.environmentInjector,s.root,a.root);return l?fn(l).pipe(ft(()=>r)):Ge(r)}),ft(s=>{let a=kre(e.routeReuseStrategy,s.targetSnapshot,s.currentRouterState);return this.currentTransition=r=pt(me({},s),{targetRouterState:a}),this.currentNavigation.targetRouterState=a,r}),sr(()=>{this.events.next(new rg)}),Ore(this.rootContexts,e.routeReuseStrategy,s=>this.events.next(s),this.inputBindingEnabled),ks(1),sr({next:s=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ol(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects))),this.titleStrategy?.updateTitle(s.targetRouterState.snapshot),s.resolve(!0)},complete:()=>{o=!0}}),TE(this.transitionAbortSubject.pipe(sr(s=>{throw s}))),mm(()=>{!o&&!i&&this.cancelNavigationTransition(r,"",_o.SupersededByNewNavigation),this.currentTransition?.id===r.id&&(this.currentNavigation=null,this.currentTransition=null)}),Tl(s=>{if(this.destroyed)return r.resolve(!1),qr;if(i=!0,j$(s))this.events.next(new Us(r.id,this.urlSerializer.serialize(r.extractedUrl),s.message,s.cancellationCode)),Mre(s)?this.events.next(new Vf(s.url,s.navigationBehaviorOptions)):r.resolve(!1);else{let a=new ng(r.id,this.urlSerializer.serialize(r.extractedUrl),s,r.targetSnapshot??void 0);try{let l=Ci(this.environmentInjector,()=>this.navigationErrorHandler?.(a));if(l instanceof ig){let{message:u,cancellationCode:c}=yb(this.urlSerializer,l);this.events.next(new Us(r.id,this.urlSerializer.serialize(r.extractedUrl),u,c)),this.events.next(new Vf(l.redirectTo,l.navigationBehaviorOptions))}else throw this.events.next(a),s}catch(l){this.options.resolveNavigationPromiseOnError?r.resolve(!1):r.reject(l)}}return qr}))}))}cancelNavigationTransition(e,r,o){let i=new Us(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Ioe(t){return t!==lb}var Eoe=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:()=>ge(Toe),providedIn:"root"})}return t})(),yN=class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}},Toe=(()=>{class t extends yN{static \u0275fac=(()=>{let e;return function(o){return(e||(e=Wo(t)))(o||t)}})();static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),oP=(()=>{class t{urlSerializer=ge(vb);options=ge(Cb,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=ge(Df);urlHandlingStrategy=ge(bN);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Gs;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:e,initialUrl:r,targetBrowserUrl:o}){let i=e!==void 0?this.urlHandlingStrategy.merge(e,r):r,s=o??i;return s instanceof Gs?this.urlSerializer.serialize(s):s}commitTransition({targetRouterState:e,finalUrl:r,initialUrl:o}){r&&e?(this.currentUrlTree=r,this.rawUrlTree=this.urlHandlingStrategy.merge(r,o),this.routerState=e):this.rawUrlTree=o}routerState=V$(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:e}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e??this.rawUrlTree)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:()=>ge(_oe),providedIn:"root"})}return t})(),_oe=(()=>{class t extends oP{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(r=>{r.type==="popstate"&&setTimeout(()=>{e(r.url,r.state,"popstate")})})}handleRouterEvent(e,r){e instanceof Lf?this.updateStateMemento():e instanceof Fl?this.commitTransition(r):e instanceof fb?this.urlUpdateStrategy==="eager"&&(r.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(r),r)):e instanceof rg?(this.commitTransition(r),this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(r),r)):e instanceof Us&&(e.code===_o.GuardRejected||e.code===_o.NoDataFromResolver)?this.restoreHistory(r):e instanceof ng?this.restoreHistory(r,!0):e instanceof Ol&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,{extras:r,id:o}){let{replaceUrl:i,state:s}=r;if(this.location.isCurrentPathEqualTo(e)||i){let a=this.browserPageId,l=me(me({},s),this.generateNgRouterState(o,a));this.location.replaceState(e,"",l)}else{let a=me(me({},s),this.generateNgRouterState(o,this.browserPageId+1));this.location.go(e,"",a)}}restoreHistory(e,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.getCurrentUrlTree()===e.finalUrl&&i===0&&(this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Wo(t)))(o||t)}})();static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function iP(t,n){t.events.pipe(yi(e=>e instanceof Ol||e instanceof Us||e instanceof ng||e instanceof Fl),ft(e=>e instanceof Ol||e instanceof Fl?0:(e instanceof Us?e.code===_o.Redirect||e.code===_o.SupersededByNewNavigation:!1)?2:1),yi(e=>e!==2),ks(1)).subscribe(()=>{n()})}var Noe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Doe={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},wN=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=ge(IF);stateManager=ge(oP);options=ge(Cb,{optional:!0})||{};pendingTasks=ge(Tf);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=ge(rP);urlSerializer=ge(vb);location=ge(Df);urlHandlingStrategy=ge(bN);_events=new Sn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=ge(Eoe);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=ge(Sb,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!ge(bb,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Cn;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(r,i),r instanceof Us&&r.code!==_o.Redirect&&r.code!==_o.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Ol)this.navigated=!0;else if(r instanceof Vf){let s=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),l=me({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||Ioe(o.source)},s);this.scheduleNavigation(a,lb,null,l,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}Aoe(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),lb,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,r,o)=>{this.navigateToSyncWithBrowser(e,o,r)})}navigateToSyncWithBrowser(e,r,o){let i={replaceUrl:!0},s=o?.navigationId?o:null;if(o){let l=me({},o);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(i.state=l)}let a=this.parseUrl(e);this.scheduleNavigation(a,r,s,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(vN),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){let{relativeTo:o,queryParams:i,fragment:s,queryParamsHandling:a,preserveFragment:l}=r,u=l?this.currentUrlTree.fragment:s,c=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":c=me(me({},this.currentUrlTree.queryParams),i);break;case"preserve":c=this.currentUrlTree.queryParams;break;default:c=i||null}c!==null&&(c=this.removeEmptyProps(c));let p;try{let f=o?o.snapshot:this.routerState.snapshot.root;p=F$(f)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),p=this.currentUrlTree.root}return $$(p,e,c,u??null)}navigateByUrl(e,r={skipLocationChange:!1}){let o=Pf(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,lb,null,r)}navigate(e,r={skipLocationChange:!1}){return koe(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,r){let o;if(r===!0?o=me({},Noe):r===!1?o=me({},Doe):o=r,Pf(e))return x$(this.currentUrlTree,e,o);let i=this.parseUrl(e);return x$(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.entries(e).reduce((r,[o,i])=>(i!=null&&(r[o]=i),r),{})}scheduleNavigation(e,r,o,i,s){if(this.disposed)return Promise.resolve(!1);let a,l,u;s?(a=s.resolve,l=s.reject,u=s.promise):u=new Promise((p,f)=>{a=p,l=f});let c=this.pendingTasks.add();return iP(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(c))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:i,resolve:a,reject:l,promise:u,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),u.catch(p=>Promise.reject(p))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Pe({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function koe(t){for(let n=0;n<t.length;n++)if(t[n]==null)throw new Ne(4008,!1)}function Aoe(t){return!(t instanceof rg)&&!(t instanceof Vf)}var Roe=new ke("");function CN(t,...n){return LT([{provide:Sb,multi:!0,useValue:t},[],{provide:Rc,useFactory:Moe,deps:[wN]},{provide:w_,multi:!0,useFactory:Ooe},n.map(e=>e.\u0275providers)])}function Moe(t){return t.routerState.root}function Ooe(){let t=ge(Ms);return n=>{let e=t.get(Ic);if(n!==e.components[0])return;let r=t.get(wN),o=t.get(Foe);t.get($oe)===1&&r.initialNavigation(),t.get(Poe,null,Ye.Optional)?.setUpPreloading(),t.get(Roe,null,Ye.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var Foe=new ke("",{factory:()=>new Sn}),$oe=new ke("",{providedIn:"root",factory:()=>1});var Poe=new ke("");var sP=[];var aP={providers:[$F({eventCoalescing:!0}),CN(sP)]};var yP=(()=>{class t{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,r){this._renderer=e,this._elementRef=r}setProperty(e,r){this._renderer.setProperty(this._elementRef.nativeElement,e,r)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(r){return new(r||t)(xt(Nf),xt(Qi))};static \u0275dir=xn({type:t})}return t})(),Hf=(()=>{class t extends yP{static \u0275fac=(()=>{let e;return function(o){return(e||(e=Wo(t)))(o||t)}})();static \u0275dir=xn({type:t,features:[Co]})}return t})(),Mc=new ke(""),Voe={provide:Mc,useExisting:Uo(()=>_N),multi:!0},_N=(()=>{class t extends Hf{writeValue(e){this.setProperty("checked",e)}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Wo(t)))(o||t)}})();static \u0275dir=xn({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,o){r&1&&Je("change",function(s){return o.onChange(s.target.checked)})("blur",function(){return o.onTouched()})},standalone:!1,features:[es([Voe]),Co]})}return t})(),Boe={provide:Mc,useExisting:Uo(()=>jf),multi:!0};function zoe(){let t=qo()?qo().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}var Uoe=new ke(""),jf=(()=>{class t extends yP{_compositionMode;_composing=!1;constructor(e,r,o){super(e,r),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!zoe())}writeValue(e){let r=e??"";this.setProperty("value",r)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(r){return new(r||t)(xt(Nf),xt(Qi),xt(Uoe,8))};static \u0275dir=xn({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,o){r&1&&Je("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},standalone:!1,features:[es([Boe]),Co]})}return t})();var NN=new ke(""),Goe=new ke("");function Woe(t){return n=>{if(n.value==null||t==null)return null;let e=parseFloat(n.value);return!isNaN(e)&&e<t?{min:{min:t,actual:n.value}}:null}}function Hoe(t){return n=>{if(n.value==null||t==null)return null;let e=parseFloat(n.value);return!isNaN(e)&&e>t?{max:{max:t,actual:n.value}}:null}}function lP(t){return null}function xP(t){return t!=null}function vP(t){return Dc(t)?fn(t):t}function bP(t){let n={};return t.forEach(e=>{n=e!=null?me(me({},n),e):n}),Object.keys(n).length===0?null:n}function wP(t,n){return n.map(e=>e(t))}function joe(t){return!t.validate}function CP(t){return t.map(n=>joe(n)?n:e=>n.validate(e))}function qoe(t){if(!t)return null;let n=t.filter(xP);return n.length==0?null:function(e){return bP(wP(e,n))}}function SP(t){return t!=null?qoe(CP(t)):null}function Koe(t){if(!t)return null;let n=t.filter(xP);return n.length==0?null:function(e){let r=wP(e,n).map(vP);return CE(r).pipe(ft(bP))}}function IP(t){return t!=null?Koe(CP(t)):null}function uP(t,n){return t===null?[n]:Array.isArray(t)?[...t,n]:[t,n]}function Xoe(t){return t._rawValidators}function Yoe(t){return t._rawAsyncValidators}function SN(t){return t?Array.isArray(t)?t:[t]:[]}function Eb(t,n){return Array.isArray(t)?t.includes(n):t===n}function cP(t,n){let e=SN(n);return SN(t).forEach(o=>{Eb(e,o)||e.push(o)}),e}function pP(t,n){return SN(n).filter(e=>!Eb(t,e))}var Tb=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=SP(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=IP(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return this.control?this.control.hasError(n,e):!1}getError(n,e){return this.control?this.control.getError(n,e):null}},IN=class extends Tb{name;get formDirective(){return null}get path(){return null}},gg=class extends Tb{_parent=null;name=null;valueAccessor=null},EN=class{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Zoe={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},iPe=pt(me({},Zoe),{"[class.ng-submitted]":"isSubmitted"}),Nb=(()=>{class t extends EN{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(xt(gg,2))};static \u0275dir=xn({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,o){r&2&&S_("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[Co]})}return t})();var fg="VALID",Ib="INVALID",Uf="PENDING",dg="DISABLED",Wf=class{},_b=class extends Wf{value;source;constructor(n,e){super(),this.value=n,this.source=e}},hg=class extends Wf{pristine;source;constructor(n,e){super(),this.pristine=n,this.source=e}},mg=class extends Wf{touched;source;constructor(n,e){super(),this.touched=n,this.source=e}},Gf=class extends Wf{status;source;constructor(n,e){super(),this.status=n,this.source=e}};function Qoe(t){return(Db(t)?t.validators:t)||null}function Joe(t){return Array.isArray(t)?SP(t):t||null}function eie(t,n){return(Db(n)?n.asyncValidators:t)||null}function tie(t){return Array.isArray(t)?IP(t):t||null}function Db(t){return t!=null&&!Array.isArray(t)&&typeof t=="object"}var TN=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,e){this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return Rl(this.statusReactive)}set status(n){Rl(()=>this.statusReactive.set(n))}_status=Bv(()=>this.statusReactive());statusReactive=Rv(void 0);get valid(){return this.status===fg}get invalid(){return this.status===Ib}get pending(){return this.status==Uf}get disabled(){return this.status===dg}get enabled(){return this.status!==dg}errors;get pristine(){return Rl(this.pristineReactive)}set pristine(n){Rl(()=>this.pristineReactive.set(n))}_pristine=Bv(()=>this.pristineReactive());pristineReactive=Rv(!0);get dirty(){return!this.pristine}get touched(){return Rl(this.touchedReactive)}set touched(n){Rl(()=>this.touchedReactive.set(n))}_touched=Bv(()=>this.touchedReactive());touchedReactive=Rv(!1);get untouched(){return!this.touched}_events=new Sn;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(cP(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(cP(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(pP(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(pP(n,this._rawAsyncValidators))}hasValidator(n){return Eb(this._rawValidators,n)}hasAsyncValidator(n){return Eb(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){let e=this.touched===!1;this.touched=!0;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched(pt(me({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new mg(!0,r))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(n))}markAsUntouched(n={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:r})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,r),e&&n.emitEvent!==!1&&this._events.next(new mg(!1,r))}markAsDirty(n={}){let e=this.pristine===!0;this.pristine=!1;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty(pt(me({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new hg(!1,r))}markAsPristine(n={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,r),e&&n.emitEvent!==!1&&this._events.next(new hg(!0,r))}markAsPending(n={}){this.status=Uf;let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new Gf(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending(pt(me({},n),{sourceControl:e}))}disable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=dg,this.errors=null,this._forEachChild(o=>{o.disable(pt(me({},n),{onlySelf:!0}))}),this._updateValue();let r=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new _b(this.value,r)),this._events.next(new Gf(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(pt(me({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=fg,this._forEachChild(r=>{r.enable(pt(me({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(pt(me({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n,e){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===fg||this.status===Uf)&&this._runAsyncValidator(r,n.emitEvent)}let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new _b(this.value,e)),this._events.next(new Gf(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(pt(me({},n),{sourceControl:e}))}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?dg:fg}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,e){if(this.asyncValidator){this.status=Uf,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1};let r=vP(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:e,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(n){let e=n;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((r,o)=>r&&r._find(o),this)}getError(n,e){let r=e?this.get(e):this;return r&&r.errors?r.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,e,r){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||r)&&this._events.next(new Gf(this.status,e)),this._parent&&this._parent._updateControlsErrors(n,e,r)}_initObservables(){this.valueChanges=new Jt,this.statusChanges=new Jt}_calculateStatus(){return this._allControlsDisabled()?dg:this.errors?Ib:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Uf)?Uf:this._anyControlsHaveStatus(Ib)?Ib:fg}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,e){let r=!this._anyControlsDirty(),o=this.pristine!==r;this.pristine=r,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,e),o&&this._events.next(new hg(this.pristine,e))}_updateTouched(n={},e){this.touched=this._anyControlsTouched(),this._events.next(new mg(this.touched,e)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,e)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){Db(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let e=this._parent&&this._parent.dirty;return!n&&!!e&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=Joe(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=tie(this._rawAsyncValidators)}};var EP=new ke("",{providedIn:"root",factory:()=>DN}),DN="always";function nie(t,n){return[...n.path,t]}function rie(t,n,e=DN){iie(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||e==="always")&&n.valueAccessor.setDisabledState?.(t.disabled),sie(t,n),lie(t,n),aie(t,n),oie(t,n)}function fP(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function oie(t,n){if(n.valueAccessor.setDisabledState){let e=r=>{n.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}function iie(t,n){let e=Xoe(t);n.validator!==null?t.setValidators(uP(e,n.validator)):typeof e=="function"&&t.setValidators([e]);let r=Yoe(t);n.asyncValidator!==null?t.setAsyncValidators(uP(r,n.asyncValidator)):typeof r=="function"&&t.setAsyncValidators([r]);let o=()=>t.updateValueAndValidity();fP(n._rawValidators,o),fP(n._rawAsyncValidators,o)}function sie(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,t.updateOn==="change"&&TP(t,n)})}function aie(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,t.updateOn==="blur"&&t._pendingChange&&TP(t,n),t.updateOn!=="submit"&&t.markAsTouched()})}function TP(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function lie(t,n){let e=(r,o)=>{n.valueAccessor.writeValue(r),o&&n.viewToModelUpdate(r)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}function uie(t,n){if(!t.hasOwnProperty("model"))return!1;let e=t.model;return e.isFirstChange()?!0:!Object.is(n,e.currentValue)}function cie(t){return Object.getPrototypeOf(t.constructor)===Hf}function pie(t,n){if(!n)return null;Array.isArray(n);let e,r,o;return n.forEach(i=>{i.constructor===jf?e=i:cie(i)?r=i:o=i}),o||r||e||null}function dP(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function hP(t){return typeof t=="object"&&t!==null&&Object.keys(t).length===2&&"value"in t&&"disabled"in t}var fie=class extends TN{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,e,r){super(Qoe(e),eie(r,e)),this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Db(e)&&(e.nonNullable||e.initialValueIsDefault)&&(hP(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){dP(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){dP(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){hP(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var die={provide:gg,useExisting:Uo(()=>yg)},mP=Promise.resolve(),yg=(()=>{class t extends gg{_changeDetectorRef;callSetDisabledState;control=new fie;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Jt;constructor(e,r,o,i,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=pie(this,i)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let r=e.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),uie(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){rie(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){mP.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let r=e.isDisabled.currentValue,o=r!==0&&E_(r);mP.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?nie(e,this._parent):[e]}static \u0275fac=function(r){return new(r||t)(xt(IN,9),xt(NN,10),xt(Goe,10),xt(Mc,10),xt(Bm,8),xt(EP,8))};static \u0275dir=xn({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[es([die]),Co,Ef]})}return t})();var hie={provide:Mc,useExisting:Uo(()=>xg),multi:!0},xg=(()=>{class t extends Hf{writeValue(e){let r=e??"";this.setProperty("value",r)}registerOnChange(e){this.onChange=r=>{e(r==""?null:parseFloat(r))}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Wo(t)))(o||t)}})();static \u0275dir=xn({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,o){r&1&&Je("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[es([hie]),Co]})}return t})();var mie={provide:Mc,useExisting:Uo(()=>kN),multi:!0},kN=(()=>{class t extends Hf{writeValue(e){this.setProperty("value",parseFloat(e))}registerOnChange(e){this.onChange=r=>{e(r==""?null:parseFloat(r))}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Wo(t)))(o||t)}})();static \u0275dir=xn({type:t,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(r,o){r&1&&Je("change",function(s){return o.onChange(s.target.value)})("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[es([mie]),Co]})}return t})();var gie={provide:Mc,useExisting:Uo(()=>kb),multi:!0};function _P(t,n){return t==null?`${n}`:(n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function yie(t){return t.split(":")[0]}var kb=(()=>{class t extends Hf{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r=this._getOptionId(e),o=_P(r,e);this.setProperty("value",o)}registerOnChange(e){this.onChange=r=>{this.value=this._getOptionValue(r),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),e))return r;return null}_getOptionValue(e){let r=yie(e);return this._optionMap.has(r)?this._optionMap.get(r):e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Wo(t)))(o||t)}})();static \u0275dir=xn({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,o){r&1&&Je("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[es([gie]),Co]})}return t})(),NP=(()=>{class t{_element;_renderer;_select;id;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(_P(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(xt(Qi),xt(Nf),xt(kb,9))};static \u0275dir=xn({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})(),xie={provide:Mc,useExisting:Uo(()=>DP),multi:!0};function gP(t,n){return t==null?`${n}`:(typeof n=="string"&&(n=`'${n}'`),n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function vie(t){return t.split(":")[0]}var DP=(()=>{class t extends Hf{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r;if(Array.isArray(e)){let o=e.map(i=>this._getOptionId(i));r=(i,s)=>{i._setSelected(o.indexOf(s.toString())>-1)}}else r=(o,i)=>{o._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(e){this.onChange=r=>{let o=[],i=r.selectedOptions;if(i!==void 0){let s=i;for(let a=0;a<s.length;a++){let l=s[a],u=this._getOptionValue(l.value);o.push(u)}}else{let s=r.options;for(let a=0;a<s.length;a++){let l=s[a];if(l.selected){let u=this._getOptionValue(l.value);o.push(u)}}}this.value=o,e(o)}}_registerOption(e){let r=(this._idCounter++).toString();return this._optionMap.set(r,e),r}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,e))return r;return null}_getOptionValue(e){let r=vie(e);return this._optionMap.has(r)?this._optionMap.get(r)._value:e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Wo(t)))(o||t)}})();static \u0275dir=xn({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,o){r&1&&Je("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[es([xie]),Co]})}return t})(),kP=(()=>{class t{_element;_renderer;_select;id;_value;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue(gP(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(gP(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(xt(Qi),xt(Nf),xt(DP,9))};static \u0275dir=xn({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})();function AP(t){return typeof t=="number"?t:parseFloat(t)}var RP=(()=>{class t{_validator=lP;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){let r=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):lP,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return e!=null}static \u0275fac=function(r){return new(r||t)};static \u0275dir=xn({type:t,features:[Ef]})}return t})(),bie={provide:NN,useExisting:Uo(()=>vg),multi:!0},vg=(()=>{class t extends RP{max;inputName="max";normalizeInput=e=>AP(e);createValidator=e=>Hoe(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=Wo(t)))(o||t)}})();static \u0275dir=xn({type:t,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&Lv("max",o._enabled?o.max:null)},inputs:{max:"max"},standalone:!1,features:[es([bie]),Co]})}return t})(),wie={provide:NN,useExisting:Uo(()=>bg),multi:!0},bg=(()=>{class t extends RP{min;inputName="min";normalizeInput=e=>AP(e);createValidator=e=>Woe(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=Wo(t)))(o||t)}})();static \u0275dir=xn({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&Lv("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[es([wie]),Co]})}return t})();var Cie=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=Nc({type:t});static \u0275inj=Tc({})}return t})();var Ab=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:EP,useValue:e.callSetDisabledState??DN}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Nc({type:t});static \u0275inj=Tc({imports:[Cie]})}return t})();function Sie(t,n){if(t&1){let e=Qr();z(0,"div",4)(1,"div",5)(2,"h1"),q(3,"\u{1F3D3} PONG"),U(),z(4,"p",6),q(5,"The Classic Game Reimagined"),U()(),z(6,"div",7)(7,"button",8),Je("click",function(){He(e);let o=Ot();return je(o.startVsBot())}),q(8," \u{1F916} Player vs Computer "),U(),z(9,"button",9),Je("click",function(){He(e);let o=Ot();return je(o.startVsPlayer())}),q(10," \u{1F465} Player vs Player "),U(),z(11,"button",10),Je("click",function(){He(e);let o=Ot();return je(o.onWatchAILearn())}),q(12," \u{1F9E0} Watch AIs Learn "),U(),z(13,"button",11),Je("click",function(){He(e);let o=Ot();return je(o.openSettings())}),q(14," \u2699\uFE0F Game Settings "),U()(),z(15,"div",12)(16,"h3"),q(17,"\u{1F3AF} How to Play"),U(),z(18,"div",13)(19,"div",14)(20,"span",15),q(21,"W / S"),U(),z(22,"span",16),q(23,"Player 1 - Move Up/Down"),U()(),z(24,"div",14)(25,"span",15),q(26,"\u2191 / \u2193"),U(),z(27,"span",16),q(28,"Player 2 - Move Up/Down"),U()(),z(29,"div",14)(30,"span",15),q(31,"SPACE"),U(),z(32,"span",16),q(33,"Pause/Resume Game"),U()(),z(34,"div",14)(35,"span",15),q(36,"R"),U(),z(37,"span",16),q(38,"Restart Game"),U()()(),z(39,"div",17)(40,"h4"),q(41,"\u{1F9E0} AI Learning Mode"),U(),z(42,"p"),q(43,"Watch two neural networks compete and learn to play Pong in real-time using Deep Q-Learning (DQN). See their strategies evolve as they train!"),U()()()()}}function Iie(t,n){if(t&1){let e=Qr();z(0,"div",20)(1,"label",33),q(2,"Difficulty"),U(),z(3,"select",34),Eo("ngModelChange",function(o){He(e);let i=Ot(2);return jo(i.gameSettings.difficulty,o)||(i.gameSettings.difficulty=o),je(o)}),z(4,"option",35),q(5,"\u{1F60A} Easy"),U(),z(6,"option",36),q(7,"\u{1F610} Medium"),U(),z(8,"option",37),q(9,"\u{1F624} Hard"),U()()()}if(t&2){let e=Ot(2);he(3),Io("ngModel",e.gameSettings.difficulty)}}function Eie(t,n){if(t&1){let e=Qr();z(0,"div",18)(1,"h3"),q(2,"Game Configuration"),U(),z(3,"div",19)(4,"div",20)(5,"label",21),q(6,"Game Mode"),U(),z(7,"select",22),Eo("ngModelChange",function(o){He(e);let i=Ot();return jo(i.gameSettings.gameMode,o)||(i.gameSettings.gameMode=o),je(o)}),z(8,"option",23),q(9,"\u{1F916} VS Computer"),U(),z(10,"option",24),q(11,"\u{1F465} VS Player"),U()()(),Mr(12,Iie,10,1,"div",25),z(13,"div",20)(14,"label",26),q(15),U(),z(16,"input",27),Eo("ngModelChange",function(o){He(e);let i=Ot();return jo(i.gameSettings.ballSpeed,o)||(i.gameSettings.ballSpeed=o),je(o)}),U()(),z(17,"div",20)(18,"label",28),q(19),U(),z(20,"input",29),Eo("ngModelChange",function(o){He(e);let i=Ot();return jo(i.gameSettings.paddleSpeed,o)||(i.gameSettings.paddleSpeed=o),je(o)}),U()(),z(21,"div",20)(22,"label",30),q(23,"Points to Win"),U(),z(24,"select",31),Eo("ngModelChange",function(o){He(e);let i=Ot();return jo(i.gameSettings.winScore,o)||(i.gameSettings.winScore=o),je(o)}),z(25,"option",32),q(26,"3 Points"),U(),z(27,"option",32),q(28,"5 Points"),U(),z(29,"option",32),q(30,"10 Points"),U()()()()()}if(t&2){let e=Ot();he(7),Io("ngModel",e.gameSettings.gameMode),he(5),vt("ngIf",e.gameSettings.gameMode==="vs-bot"),he(3),Qn("Ball Speed: ",e.gameSettings.ballSpeed,""),he(),Io("ngModel",e.gameSettings.ballSpeed),he(3),Qn("Paddle Speed: ",e.gameSettings.paddleSpeed,""),he(),Io("ngModel",e.gameSettings.paddleSpeed),he(4),Io("ngModel",e.gameSettings.winScore),he(),vt("value",3),he(2),vt("value",5),he(2),vt("value",10)}}function Tie(t,n){if(t&1){let e=Qr();z(0,"div",38)(1,"h2",39),q(2,"SETTINGS"),U(),z(3,"div",20)(4,"label",40),q(5,"Difficulty"),U(),z(6,"select",41),Eo("ngModelChange",function(o){He(e);let i=Ot();return jo(i.settings.difficulty,o)||(i.settings.difficulty=o),je(o)}),z(7,"option",35),q(8,"Easy"),U(),z(9,"option",36),q(10,"Medium"),U(),z(11,"option",37),q(12,"Hard"),U()()(),z(13,"div",20)(14,"label",42),q(15,"Win Score"),U(),z(16,"input",43),Eo("ngModelChange",function(o){He(e);let i=Ot();return jo(i.settings.winScore,o)||(i.settings.winScore=o),je(o)}),U()(),z(17,"button",44),Je("click",function(){He(e);let o=Ot();return je(o.backToMain())}),q(18," \u2190 BACK TO MENU "),U()()}if(t&2){let e=Ot();he(6),Io("ngModel",e.settings.difficulty),he(10),Io("ngModel",e.settings.winScore)}}var Rb=class t{startGame=new Jt;watchAILearn=new Jt;currentView="main";gameSettings={gameMode:"vs-bot",difficulty:"medium",ballSpeed:5,paddleSpeed:8,winScore:5};settings={difficulty:"medium",winScore:5};startVsBot(){this.gameSettings.gameMode="vs-bot",this.gameSettings.difficulty=this.settings.difficulty,this.gameSettings.winScore=this.settings.winScore,this.startGame.emit(this.gameSettings)}startVsPlayer(){this.gameSettings.gameMode="vs-player",this.gameSettings.winScore=this.settings.winScore,this.startGame.emit(this.gameSettings)}onWatchAILearn(){this.watchAILearn.emit()}openSettings(){this.currentView="settings"}backToMain(){this.currentView="main"}updateDifficulty(n){this.settings.difficulty=n,this.gameSettings.difficulty=n}onStartGame(){this.startGame.emit(this.gameSettings)}toggleSettings(){this.currentView=this.currentView==="main"?"settings":"main"}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=Ji({type:t,selectors:[["app-game-menu"]],outputs:{startGame:"startGame",watchAILearn:"watchAILearn"},decls:4,vars:3,consts:[[1,"game-menu"],["class","menu-container",4,"ngIf"],["class","settings-panel",4,"ngIf"],["class","settings-container",4,"ngIf"],[1,"menu-container"],[1,"game-title"],[1,"subtitle"],[1,"menu-options"],[1,"menu-btn","primary-btn",3,"click"],[1,"menu-btn","secondary-btn",3,"click"],[1,"menu-btn","ai-btn",3,"click"],[1,"menu-btn","settings-btn",3,"click"],[1,"game-info"],[1,"controls-info"],[1,"control-item"],[1,"key"],[1,"description"],[1,"ai-learn-info"],[1,"settings-panel"],[1,"settings-grid"],[1,"setting-group"],["for","gameMode"],["id","gameMode",3,"ngModelChange","ngModel"],["value","vs-bot"],["value","vs-player"],["class","setting-group",4,"ngIf"],["for","ballSpeed"],["type","range","id","ballSpeed","min","3","max","10",3,"ngModelChange","ngModel"],["for","paddleSpeed"],["type","range","id","paddleSpeed","min","5","max","15",3,"ngModelChange","ngModel"],["for","winScore"],["id","winScore",3,"ngModelChange","ngModel"],[3,"value"],["for","difficulty"],["id","difficulty",3,"ngModelChange","ngModel"],["value","easy"],["value","medium"],["value","hard"],[1,"settings-container"],[1,"settings-title"],["for","difficulty-select"],["id","difficulty-select",1,"setting-input",3,"ngModelChange","ngModel"],["for","win-score-input"],["id","win-score-input","type","number","min","1","max","21",1,"setting-input",3,"ngModelChange","ngModel"],[1,"back-btn",3,"click"]],template:function(e,r){e&1&&(z(0,"div",0),Mr(1,Sie,44,0,"div",1)(2,Eie,31,10,"div",2)(3,Tie,19,2,"div",3),U()),e&2&&(he(),vt("ngIf",r.currentView==="main"),he(),vt("ngIf",r.currentView==="settings"),he(),vt("ngIf",r.currentView==="settings"))},dependencies:[ts,zs,Ab,NP,kP,jf,xg,kN,kb,Nb,bg,vg,yg],styles:[".game-menu[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,#0f0f23,#1a1a3a);font-family:Courier New,monospace;color:#fff;padding:1rem}.menu-container[_ngcontent-%COMP%], .settings-container[_ngcontent-%COMP%]{text-align:center;padding:2rem;background:#0000004d;border-radius:15px;border:2px solid #00ff00;box-shadow:0 0 30px #00ff004d;min-width:400px;max-width:600px;width:100%;margin:auto}.game-title[_ngcontent-%COMP%]{margin-bottom:2rem}.game-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:4rem;font-weight:700;margin-bottom:.5rem;text-shadow:0 0 20px #00ff00;color:#0f0;letter-spacing:.2em}.subtitle[_ngcontent-%COMP%]{color:#aaa;font-size:1.2rem;margin:0}.menu-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;margin-bottom:2rem}.menu-btn[_ngcontent-%COMP%]{background:transparent;border:2px solid #00ff00;color:#0f0;padding:1rem 2rem;font-size:1.2rem;font-family:inherit;cursor:pointer;border-radius:8px;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:1rem;min-height:60px}.menu-btn[_ngcontent-%COMP%]:hover{background:#0f0;color:#0f0f23;box-shadow:0 0 20px #00ff0080;transform:scale(1.05)}.primary-btn[_ngcontent-%COMP%]{border-color:#4caf50;color:#4caf50}.primary-btn[_ngcontent-%COMP%]:hover{background:#4caf50;color:#fff;box-shadow:0 0 20px #4caf5080}.secondary-btn[_ngcontent-%COMP%]{border-color:#2196f3;color:#2196f3}.secondary-btn[_ngcontent-%COMP%]:hover{background:#2196f3;color:#fff;box-shadow:0 0 20px #2196f380}.ai-btn[_ngcontent-%COMP%]{border-color:#ff9800;color:#ff9800}.ai-btn[_ngcontent-%COMP%]:hover{background:#ff9800;color:#fff;box-shadow:0 0 20px #ff980080}.settings-btn[_ngcontent-%COMP%]{border-color:#9c27b0;color:#9c27b0}.settings-btn[_ngcontent-%COMP%]:hover{background:#9c27b0;color:#fff;box-shadow:0 0 20px #9c27b080}.controls-info[_ngcontent-%COMP%]{margin-top:2rem;padding:1rem;background:#0003;border-radius:8px;border:1px solid rgba(0,255,0,.3)}.controls-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;font-size:.9rem}.setting-group[_ngcontent-%COMP%]{margin-bottom:2rem}.setting-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-size:1.3rem;margin-bottom:1rem;color:#0f0;font-weight:700}.difficulty-buttons[_ngcontent-%COMP%], .score-buttons[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:center}.difficulty-btn[_ngcontent-%COMP%], .score-btn[_ngcontent-%COMP%]{background:transparent;border:2px solid #666;color:#666;padding:.8rem 1.5rem;font-size:1rem;font-family:inherit;cursor:pointer;border-radius:6px;transition:all .3s ease;min-width:80px}.difficulty-btn[_ngcontent-%COMP%]:hover, .score-btn[_ngcontent-%COMP%]:hover{border-color:#0f0;color:#0f0}.difficulty-btn.active[_ngcontent-%COMP%], .score-btn.active[_ngcontent-%COMP%]{background:#0f0;color:#0f0f23;border-color:#0f0;box-shadow:0 0 15px #00ff0080}.back-btn[_ngcontent-%COMP%]{background:transparent;border:2px solid #ff6b6b;color:#ff6b6b;padding:1rem 2rem;font-size:1.1rem;font-family:inherit;cursor:pointer;border-radius:8px;transition:all .3s ease;margin-top:2rem}.back-btn[_ngcontent-%COMP%]:hover{background:#ff6b6b;color:#fff;box-shadow:0 0 20px #ff6b6b80}@media (max-width: 600px){.menu-container[_ngcontent-%COMP%], .settings-container[_ngcontent-%COMP%]{min-width:300px;margin:1rem}.title[_ngcontent-%COMP%]{font-size:3rem}.difficulty-buttons[_ngcontent-%COMP%], .score-buttons[_ngcontent-%COMP%]{flex-direction:column;align-items:center}}"]})};var _ie=["gameCanvas"];function Nie(t,n){if(t&1&&(z(0,"span",18),q(1),U()),t&2){let e=Ot();he(),Qn(" (",e.gameState.difficulty.toUpperCase(),") ")}}function Die(t,n){if(t&1){let e=Qr();z(0,"div",19)(1,"div",20)(2,"h2"),q(3),U(),z(4,"div",21)(5,"span"),q(6),U()(),z(7,"div",22)(8,"button",23),Je("click",function(){He(e);let o=Ot();return je(o.restartGame())}),q(9," Play Again "),U(),z(10,"button",24),Je("click",function(){He(e);let o=Ot();return je(o.exitToMenu())}),q(11," Main Menu "),U()()()()}if(t&2){let e=Ot();he(3),Qn("\u{1F389} ",e.gameState.winner," Wins! \u{1F389}"),he(3),Vm("",e.gameState.player1Score," - ",e.gameState.player2Score,"")}}function kie(t,n){t&1&&(z(0,"div",15)(1,"h4"),q(2,"Player 2"),U(),z(3,"p")(4,"kbd"),q(5,"\u2191"),U(),q(6," / "),z(7,"kbd"),q(8,"\u2193"),U(),q(9," to move"),U()())}var Mb=class t{canvasRef;settings;gameEnded=new Jt;ctx;animationId;keysPressed=new Set;canvas={width:800,height:400};ball={x:400,y:200,dx:5,dy:3,radius:8,speed:5};paddle1={x:20,y:175,width:10,height:80,speed:8};paddle2={x:770,y:175,width:10,height:80,speed:8};gameState={player1Score:0,player2Score:0,isGameRunning:!1,isPaused:!1,gameMode:"vs-bot",difficulty:"medium",winner:null};botDifficulty=.8;botReactionDelay=0;ngOnInit(){this.initializeGame(),this.setupEventListeners(),this.startGame()}ngOnDestroy(){this.cleanup()}initializeGame(){let n=this.canvasRef.nativeElement;if(n.width=this.canvas.width,n.height=this.canvas.height,this.ctx=n.getContext("2d"),this.settings)switch(this.gameState.gameMode=this.settings.gameMode,this.gameState.difficulty=this.settings.difficulty,this.ball.speed=this.settings.ballSpeed,this.paddle1.speed=this.settings.paddleSpeed,this.paddle2.speed=this.settings.paddleSpeed,this.settings.difficulty){case"easy":this.botDifficulty=.6;break;case"medium":this.botDifficulty=.8;break;case"hard":this.botDifficulty=.95;break}this.resetBall()}setupEventListeners(){document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this))}onKeyDown(n){this.keysPressed.add(n.key),n.key===" "&&(n.preventDefault(),this.togglePause()),(n.key==="r"||n.key==="R")&&(n.preventDefault(),this.restartGame())}onKeyUp(n){this.keysPressed.delete(n.key)}startGame(){this.gameState.isGameRunning=!0,this.gameLoop()}gameLoop(){this.gameState.isGameRunning&&(this.update(),this.render(),this.animationId=requestAnimationFrame(()=>this.gameLoop()))}update(){this.gameState.isPaused||this.gameState.winner||(this.updatePaddles(),this.updateBall(),this.checkCollisions(),this.checkScore())}updatePaddles(){(this.keysPressed.has("w")||this.keysPressed.has("W"))&&(this.paddle1.y=Math.max(0,this.paddle1.y-this.paddle1.speed)),(this.keysPressed.has("s")||this.keysPressed.has("S"))&&(this.paddle1.y=Math.min(this.canvas.height-this.paddle1.height,this.paddle1.y+this.paddle1.speed)),this.gameState.gameMode==="vs-player"?(this.keysPressed.has("ArrowUp")&&(this.paddle2.y=Math.max(0,this.paddle2.y-this.paddle2.speed)),this.keysPressed.has("ArrowDown")&&(this.paddle2.y=Math.min(this.canvas.height-this.paddle2.height,this.paddle2.y+this.paddle2.speed))):this.updateBot()}updateBot(){let n=this.ball.y,e=this.paddle2.y+this.paddle2.height/2,r=n-e;if(this.botReactionDelay++,this.botReactionDelay<3)return;if(this.botReactionDelay=0,this.ball.dx>0){let i=this.paddle2.speed*this.botDifficulty;Math.abs(r)>10&&(r>0?this.paddle2.y=Math.min(this.canvas.height-this.paddle2.height,this.paddle2.y+i):this.paddle2.y=Math.max(0,this.paddle2.y-i))}this.gameState.player1Score+this.gameState.player2Score>0&&(this.botDifficulty=Math.min(.98,this.botDifficulty+.01))}updateBall(){this.ball.x+=this.ball.dx,this.ball.y+=this.ball.dy,(this.ball.y-this.ball.radius<=0||this.ball.y+this.ball.radius>=this.canvas.height)&&(this.ball.dy=-this.ball.dy)}checkCollisions(){if(this.ballCollidesWithPaddle(this.paddle1)||this.ballCollidesWithPaddle(this.paddle2)){this.ball.dx=-this.ball.dx;let n=this.ball.x<this.canvas.width/2?this.paddle1:this.paddle2,r=(n.y+n.height/2-this.ball.y)/(n.height/2);this.ball.dy=-r*this.ball.speed*.5,this.ball.dx*=1.02,this.ball.dy*=1.02}}ballCollidesWithPaddle(n){return this.ball.x-this.ball.radius<=n.x+n.width&&this.ball.x+this.ball.radius>=n.x&&this.ball.y-this.ball.radius<=n.y+n.height&&this.ball.y+this.ball.radius>=n.y}checkScore(){this.ball.x<0?(this.gameState.player2Score++,this.resetBall()):this.ball.x>this.canvas.width&&(this.gameState.player1Score++,this.resetBall()),this.gameState.player1Score>=this.settings.winScore?(this.gameState.winner=this.gameState.gameMode==="vs-bot"?"Player":"Player 1",this.endGame()):this.gameState.player2Score>=this.settings.winScore&&(this.gameState.winner=this.gameState.gameMode==="vs-bot"?"Bot":"Player 2",this.endGame())}resetBall(){this.ball.x=this.canvas.width/2,this.ball.y=this.canvas.height/2,this.ball.dx=(Math.random()>.5?1:-1)*this.ball.speed,this.ball.dy=(Math.random()-.5)*this.ball.speed}render(){this.ctx.fillStyle="#0f0f23",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setLineDash([10,10]),this.ctx.strokeStyle="#00ff00",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2,0),this.ctx.lineTo(this.canvas.width/2,this.canvas.height),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.fillStyle="#00ff00",this.ctx.fillRect(this.paddle1.x,this.paddle1.y,this.paddle1.width,this.paddle1.height),this.ctx.fillRect(this.paddle2.x,this.paddle2.y,this.paddle2.width,this.paddle2.height),this.ctx.beginPath(),this.ctx.arc(this.ball.x,this.ball.y,this.ball.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.font="48px Courier New",this.ctx.textAlign="center",this.ctx.fillText(this.gameState.player1Score.toString(),this.canvas.width/4,60),this.ctx.fillText(this.gameState.player2Score.toString(),3*this.canvas.width/4,60),this.ctx.font="14px Courier New",this.ctx.fillStyle="#00ff00",this.ctx.textAlign="center",this.gameState.gameMode==="vs-player"?(this.ctx.fillText("Player 1 (W/S)",this.canvas.width/4,this.canvas.height-30),this.ctx.fillText("Player 2 (\u2191/\u2193)",3*this.canvas.width/4,this.canvas.height-30)):(this.ctx.fillText("Player (W/S)",this.canvas.width/4,this.canvas.height-30),this.ctx.fillText("Bot",3*this.canvas.width/4,this.canvas.height-30)),this.gameState.isPaused&&(this.ctx.font="24px Courier New",this.ctx.fillText("PAUSED",this.canvas.width/2,this.canvas.height/2),this.ctx.font="16px Courier New",this.ctx.fillText("Press SPACE to resume",this.canvas.width/2,this.canvas.height/2+30)),this.gameState.winner&&(this.ctx.font="32px Courier New",this.ctx.fillText(`${this.gameState.winner} Wins!`,this.canvas.width/2,this.canvas.height/2),this.ctx.font="16px Courier New",this.ctx.fillText("Press R to restart or ESC to return to menu",this.canvas.width/2,this.canvas.height/2+40))}togglePause(){this.gameState.winner||(this.gameState.isPaused=!this.gameState.isPaused)}restartGame(){switch(this.gameState.player1Score=0,this.gameState.player2Score=0,this.gameState.isPaused=!1,this.gameState.winner=null,this.resetBall(),this.paddle1.y=175,this.paddle2.y=175,this.settings.difficulty){case"easy":this.botDifficulty=.6;break;case"medium":this.botDifficulty=.8;break;case"hard":this.botDifficulty=.95;break}}exitToMenu(){this.gameEnded.emit()}endGame(){}cleanup(){this.animationId&&cancelAnimationFrame(this.animationId),document.removeEventListener("keydown",this.onKeyDown.bind(this)),document.removeEventListener("keyup",this.onKeyUp.bind(this))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=Ji({type:t,selectors:[["app-pong-game"]],viewQuery:function(e,r){if(e&1&&$m(_ie,7),e&2){let o;Pm(o=Lm())&&(r.canvasRef=o.first)}},inputs:{settings:"settings"},outputs:{gameEnded:"gameEnded"},decls:39,vars:6,consts:[["gameCanvas",""],[1,"game-container"],[1,"game-header"],[1,"game-controls"],[1,"control-btn",3,"click","disabled"],[1,"control-btn",3,"click"],[1,"control-btn","exit-btn",3,"click"],[1,"game-info"],[1,"game-mode"],["class","difficulty",4,"ngIf"],[1,"canvas-container"],["tabindex","0",1,"game-canvas"],["class","game-overlay",4,"ngIf"],[1,"game-footer"],[1,"controls-guide"],[1,"player-controls"],["class","player-controls",4,"ngIf"],[1,"game-controls-guide"],[1,"difficulty"],[1,"game-overlay"],[1,"winner-message"],[1,"final-score"],[1,"overlay-controls"],[1,"overlay-btn",3,"click"],[1,"overlay-btn","secondary",3,"click"]],template:function(e,r){if(e&1){let o=Qr();z(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),Je("click",function(){return He(o),je(r.togglePause())}),q(4),U(),z(5,"button",5),Je("click",function(){return He(o),je(r.restartGame())}),q(6," \u{1F504} RESTART "),U(),z(7,"button",6),Je("click",function(){return He(o),je(r.exitToMenu())}),q(8," \u{1F3E0} MENU "),U()(),z(9,"div",7)(10,"span",8),q(11),U(),Mr(12,Nie,2,1,"span",9),U()(),z(13,"div",10),So(14,"canvas",11,0),Mr(16,Die,12,3,"div",12),U(),z(17,"div",13)(18,"div",14)(19,"div",15)(20,"h4"),q(21,"Player 1"),U(),z(22,"p")(23,"kbd"),q(24,"W"),U(),q(25," / "),z(26,"kbd"),q(27,"S"),U(),q(28," to move"),U()(),Mr(29,kie,10,0,"div",16),z(30,"div",17)(31,"p")(32,"kbd"),q(33,"SPACE"),U(),q(34," to pause"),U(),z(35,"p")(36,"kbd"),q(37,"R"),U(),q(38," to restart"),U()()()()()}e&2&&(he(3),vt("disabled",r.gameState.winner),he(),Qn(" ",r.gameState.isPaused?"\u25B6\uFE0F RESUME":"\u23F8\uFE0F PAUSE"," "),he(7),dn(r.gameState.gameMode==="vs-bot"?"VS BOT":"VS PLAYER"),he(),vt("ngIf",r.gameState.gameMode==="vs-bot"),he(4),vt("ngIf",r.gameState.winner),he(13),vt("ngIf",r.gameState.gameMode==="vs-player"))},dependencies:[ts,zs],styles:[".game-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;min-height:100vh;background:linear-gradient(135deg,#0f0f23,#1a1a3a);font-family:Courier New,monospace;color:#fff;padding:1rem}.game-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;max-width:800px;margin-bottom:1rem}.game-controls[_ngcontent-%COMP%]{display:flex;gap:1rem}.control-btn[_ngcontent-%COMP%]{background:transparent;border:2px solid #00ff00;color:#0f0;padding:.5rem 1rem;font-size:.9rem;font-family:inherit;cursor:pointer;border-radius:6px;transition:all .3s ease}.control-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#0f0;color:#0f0f23;box-shadow:0 0 15px #00ff0080}.control-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.exit-btn[_ngcontent-%COMP%]{border-color:#ff6b6b;color:#ff6b6b}.exit-btn[_ngcontent-%COMP%]:hover{background:#ff6b6b;color:#fff;box-shadow:0 0 15px #ff6b6b80}.game-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:700}.game-mode[_ngcontent-%COMP%]{color:#0f0;font-size:1.1rem}.difficulty[_ngcontent-%COMP%]{color:orange;font-size:.9rem}.canvas-container[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;margin-bottom:1rem}.game-canvas[_ngcontent-%COMP%]{border:3px solid #00ff00;border-radius:10px;background:#0f0f23;box-shadow:0 0 30px #00ff004d;cursor:none}.game-canvas[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 40px #00ff0080}.game-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000c;display:flex;justify-content:center;align-items:center;border-radius:10px}.winner-message[_ngcontent-%COMP%]{text-align:center;background:#00ff001a;border:2px solid #00ff00;border-radius:15px;padding:2rem;box-shadow:0 0 30px #00ff004d}.winner-message[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#0f0;margin:0 0 1rem;font-size:2rem;text-shadow:0 0 15px #00ff00}.final-score[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#0f0;margin:1rem 0 2rem;text-shadow:0 0 10px #00ff00}.overlay-controls[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:center}.overlay-btn[_ngcontent-%COMP%]{background:transparent;border:2px solid #00ff00;color:#0f0;padding:1rem 2rem;font-size:1.1rem;font-family:inherit;cursor:pointer;border-radius:8px;transition:all .3s ease;font-weight:700}.overlay-btn[_ngcontent-%COMP%]:hover{background:#0f0;color:#0f0f23;box-shadow:0 0 20px #00ff0080;transform:scale(1.05)}.overlay-btn.secondary[_ngcontent-%COMP%]{border-color:#666;color:#666}.overlay-btn.secondary[_ngcontent-%COMP%]:hover{background:#666;color:#fff;box-shadow:0 0 20px #66666680}.game-footer[_ngcontent-%COMP%]{width:100%;max-width:800px}.controls-guide[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:3rem;background:#0000004d;border-radius:10px;padding:1rem;border:1px solid rgba(0,255,0,.3)}.player-controls[_ngcontent-%COMP%], .game-controls-guide[_ngcontent-%COMP%]{text-align:center}.player-controls[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .game-controls-guide[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#0f0;margin:0 0 .5rem;font-size:1rem}.player-controls[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .game-controls-guide[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.2rem 0;font-size:.9rem;color:#ccc}kbd[_ngcontent-%COMP%]{background:#333;border:1px solid #555;border-radius:3px;padding:.2rem .5rem;font-family:inherit;font-size:.8rem;color:#0f0;margin:0 .1rem}@media (max-width: 900px){.game-canvas[_ngcontent-%COMP%]{width:90vw;height:45vw}.game-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:center}.controls-guide[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;text-align:center}.overlay-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:center}}@media (max-width: 600px){.game-controls[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center}.control-btn[_ngcontent-%COMP%]{padding:.5rem;font-size:.8rem}.winner-message[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem}.final-score[_ngcontent-%COMP%]{font-size:2rem}}"]})};var Oc=class{constructor(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)}set(n,e){this.dataIdsCount++,this.data.set(n,e)}has(n){return this.data.has(n)}delete(n){return this.dataIdsCount--,this.data.delete(n)}numDataIds(){return this.dataIdsCount}},Ws=class{refCount(n){return eo("refCount")}incRef(n){return eo("incRef")}timerAvailable(){return!0}time(n){return eo("time")}read(n){return eo("read")}readSync(n){return eo("readSync")}readToGPU(n,e){return eo("readToGPU")}numDataIds(){return eo("numDataIds")}disposeData(n,e){return eo("disposeData")}write(n,e,r){return eo("write")}move(n,e,r,o,i){return eo("move")}createTensorFromGPUData(n,e,r){return eo("createTensorFromGPUData")}memory(){return eo("memory")}floatPrecision(){return eo("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return eo("dispose")}};function eo(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function OP(t){let n=t.length,e=0;for(;n>0;)e=Math.random()*n|0,n--,Ob(t,n,e)}function Aie(t,n){if(t.length!==n.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${n.length}`);let e=t.length,r=0;for(;e>0;)r=Math.random()*e|0,e--,Ob(t,e,r),Ob(n,e,r)}function qf(t,n,e){return Math.max(t,Math.min(n,e))}function Rie(t){return t%2===0?t:t+1}function Ob(t,n,e){let r=t[n];t[n]=t[e],t[e]=r}function Mie(t){let n=0;for(let e=0;e<t.length;e++)n+=t[e];return n}function Oie(t,n){let e=Math.random();return n*e+(1-e)*t}function Fie(t,n){let e=0;for(let r=0;r<t.length;r++){let o=Number(t[r])-Number(n[r]);e+=o*o}return e}function _(t,n){if(!t)throw new Error(typeof n=="string"?n:n())}function Fb(t,n,e=""){_(Pl(t,n),()=>e+` Shapes ${t} and ${n} must match`)}function wg(t){_(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function ot(t){if(t.length===0)return 1;let n=t[0];for(let e=1;e<t.length;e++)n*=t[e];return n}function $ie(t){return t.length===0}function Pie(t,n){if(t===n)return!0;if(t==null||n==null||t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==null&&n[e]!==null&&t[e]!==n[e])return!1;return!0}function Pl(t,n){if(t===n)return!0;if(t==null||n==null||t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function Hs(t){return t%1===0}function Lie(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{let n=Math.exp(2*t);return(n-1)/(n+1)}}function Vie(t){let n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function Bie(t){let n=new Uint32Array(t);for(let e=0;e<t;++e)n[e]=e;return OP(n),n}function $c(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function zie(t,n=o=>0,e,r){return new Promise((o,i)=>{let s=0,a=()=>{if(t()){o();return}s++;let l=n(s);if(e!=null&&s>=e){i();return}r!=null?r(a,l):setTimeout(a,l)};a()})}function Uie(t,n){let e=1,r=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)e*=t[i];else if(t[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(r===-1){if(n>0&&n!==e)throw Error(`Size(${n}) must match the product of shape ${t}`);return t}if(e===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(n%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${n} / ${e}`);let o=t.slice();return o[r]=n/e,o}function hn(t,n){let e=n.length;return t=t==null?n.map((r,o)=>o):[].concat(t),_(t.every(r=>r>=-e&&r<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${t}`),_(t.every(r=>Hs(r)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(r=>r<0?e+r:r)}function RN(t,n){let e=[],r=[],o=n!=null&&Array.isArray(n)&&n.length===0,i=n==null||o?null:hn(n,t).sort(),s=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[s]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[s]==null||i[s]>a)&&t[a]===1&&(e.push(t[a]),r.push(a)),i[s]<=a&&s++}t[a]!==1&&(e.push(t[a]),r.push(a))}return{newShape:e,keptDims:r}}function Gie(t,n){return $b(t,n)}function $b(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else if(t==="string")e=new Array(n);else throw new Error(`Unknown data type ${t}`);return e}function MN(t,n){for(let e=0;e<t.length;e++){let r=t[e];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${n} being uploaded contains ${r}.`)}}function ON(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function Wie(t,n){return!(n==="complex64"||n==="float32"&&t!=="complex64"||n==="int32"&&t!=="float32"&&t!=="complex64"||n==="bool"&&t==="bool")}function Kf(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function FN(t){if(t==null)return 0;let n=0;return t.forEach(e=>n+=e.length),n}function Xf(t){return typeof t=="string"||t instanceof String}function FP(t){return typeof t=="boolean"}function $P(t){return typeof t=="number"}function Ll(t){return Array.isArray(t)?Ll(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":$P(t)?"float32":Xf(t)?"string":FP(t)?"bool":"float32"}function Yf(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Zf(t,n){for(let e=n;e<t;++e)if(t%e===0)return e;return t}function rs(t){let n=t.length;if(n<2)return[];let e=new Array(n-1);e[n-2]=t[n-1];for(let r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function PP(t,n,e,r=!1){let o=new Array;if(n.length===1){let i=n[0]*(r?2:1);for(let s=0;s<i;s++)o[s]=e[t+s]}else{let i=n[0],s=n.slice(1),a=s.reduce((l,u)=>l*u)*(r?2:1);for(let l=0;l<i;l++)o[l]=PP(t+l*a,s,e,r)}return o}function Fc(t,n,e=!1){if(t.length===0)return n[0];let r=t.reduce((o,i)=>o*i)*(e?2:1);if(r===0)return[];if(r!==n.length)throw new Error(`[${t}] does not match the input size ${n.length}${e?" for a complex tensor":""}.`);return PP(0,t,n,e)}function Hie(t,n){if(Array.isArray(t))return t;if(n==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(n==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(n==="bool"||n==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${n}`)}function Cg(t,n){let e=Qf(t,n);for(let r=0;r<e.length;r++)e[r]=1;return e}function Qf(t,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${n}`)}function jie(t,n){let e=t.reduce((r,o)=>r*o,1);if(n==null||n==="float32")return Fc(t,new Float32Array(e));if(n==="int32")return Fc(t,new Int32Array(e));if(n==="bool")return Fc(t,new Uint8Array(e));throw new Error(`Unknown data type ${n}`)}function Ln(t){t.forEach(n=>{_(Number.isInteger(n)&&n>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function qie(t,n,e){if(n===0)return 0;if(n===1)return t[0];let r=t[t.length-1];for(let o=0;o<t.length-1;++o)r+=e[o]*t[o];return r}function Kie(t,n,e){if(n===0)return[];if(n===1)return[t];let r=new Array(n);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(t/e[o]),t-=r[o]*e[o];return r[r.length-1]=t,r}function Pc(t){return t&&t.then&&typeof t.then=="function"}var LP="tfjsflags",Sg=class{constructor(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Yie,this.populateURLFlags()}setPlatform(n,e){this.platform!=null&&(P().getBool("IS_TEST")||P().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${n}.`)),this.platformName=n,this.platform=e}registerFlag(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},this.urlFlags[n]!=null){let o=this.urlFlags[n];P().getBool("IS_TEST")||P().getBool("PROD")||console.warn(`Setting feature override from URL ${n}: ${o}.`),this.set(n,o)}}getAsync(n){return B(this,null,function*(){return n in this.flags?this.flags[n]:(this.flags[n]=yield this.evaluateFlag(n),this.flags[n])})}get(n){if(n in this.flags)return this.flags[n];let e=this.evaluateFlag(n);if(Pc(e))throw new Error(`Flag ${n} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[n]=e,this.flags[n]}getNumber(n){return this.get(n)}getBool(n){return this.get(n)}getString(n){return this.get(n)}getFlags(){return this.flags}get features(){return this.flags}set(n,e){if(this.flagRegistry[n]==null)throw new Error(`Cannot set flag ${n} as it has not been registered.`);this.flags[n]=e,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(e)}evaluateFlag(n){if(this.flagRegistry[n]==null)throw new Error(`Cannot evaluate flag '${n}': no evaluation function found.`);return this.flagRegistry[n].evaluationFn()}setFlags(n){this.flags=Object.assign({},n)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let n=this.getQueryParams(this.global.location.search);LP in n&&n[LP].split(",").forEach(r=>{let[o,i]=r.split(":");this.urlFlags[o]=Qie(o,i)})}};function Yie(t){let n={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...r)=>(Zie(n,r[0],r[1]),r.join("="))),n}function Zie(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}function Qie(t,n){let e=n.toLowerCase();return e==="true"||e==="false"?e==="true":`${+e}`===e?+e:n}function P(){return $N}var $N=null;function VP(t){$N=t}var PN;function LN(){if(PN==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");PN=t}return PN}function Jie(){let t=LN();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function Ig(t,n){let e=Jie();if(e.has(t))return e.get(t);{let r=n();return e.set(t,r),e.get(t)}}var Vl="Abs",js="Acos",qs="Acosh",_i="Add",Jf="AddN",ed="All",td="Any",Bl="ArgMax",zl="ArgMin",Ks="Asin",Xs="Asinh",Ys="Atan",Zs="Atanh",Qs="Atan2",Ul="AvgPool",nd="AvgPoolGrad",Gl="AvgPool3D",rd="AvgPool3DGrad",Wl="BatchMatMul",Hl="BatchToSpaceND",od="Bincount",Eg="BitwiseAnd",BP="BroadcastTo",Pb="BroadcastArgs",os="Cast",Js="Ceil",ea="ClipByValue",id="Complex",jl="ComplexAbs",ql="Concat",Kl="Conv2D",sd="Conv2DBackpropFilter",Xl="Conv2DBackpropInput",Yl="Conv3D",ad="Conv3DBackpropFilterV2",ld="Conv3DBackpropInputV2",ta="Cos",na="Cosh",ud="Cumprod",Zl="Cumsum",cd="CropAndResize",pd="DenseBincount",fd="DepthToSpace",Ql="DepthwiseConv2dNative",dd="DepthwiseConv2dNativeBackpropFilter",hd="DepthwiseConv2dNativeBackpropInput",Lb="Diag",Jl="Dilation2D",Tg="Dilation2DBackpropInput",_g="Dilation2DBackpropFilter",zP="Draw",ra="RealDiv",md="Einsum",oa="Elu",gd="EluGrad",ia="Erf",Lc="Equal",sa="Exp",eu="ExpandDims",aa="Expm1",yd="FFT",xd="Fill",vd="FlipLeftRight",la="Floor",ua="FloorDiv",tu="FusedBatchNorm",nu="GatherV2",Vb="GatherNd",Vc="Greater",ca="GreaterEqual",is="Identity",bd="IFFT",wd="Imag",pa="IsFinite",fa="IsInf",da="IsNan",ru="LeakyRelu",Bc="Less",zc="LessEqual",Bb="LinSpace",ha="Log",ma="Log1p",Uc="LogicalAnd",Gc="LogicalNot",Wc="LogicalOr";var UP="LogSoftmax";var ou="LRN",Cd="LRNGrad";var iu="Max",ga="Maximum",su="MaxPool",Sd="MaxPoolGrad",au="MaxPool3D",Id="MaxPool3DGrad",zb="MaxPoolWithArgmax",lu="Mean",uu="Min",ya="Minimum",cu="MirrorPad",xa="Mod",Ub="Multinomial",va="Multiply",pu="Neg",Hc="NotEqual",Ed="NonMaxSuppressionV3",Td="NonMaxSuppressionV4",_d="NonMaxSuppressionV5",fu="OnesLike",du="OneHot",hu="Pack",mu="PadV2";var ba="Pow",gu="Prelu",yu="Prod",Gb="RaggedGather",Wb="RaggedRange",Hb="RaggedTensorToTensor",Nd="Range",Dd="Real",wa="Reciprocal",Ca="Relu",xu="Reshape",vu="ResizeNearestNeighbor",kd="ResizeNearestNeighborGrad",bu="ResizeBilinear",Ad="ResizeBilinearGrad",Sa="Relu6",wu="Reverse",Ia="Round",Ea="Rsqrt",jb="ScatterNd",qb="TensorScatterUpdate",Kb="SearchSorted",Cu="Select",Ta="Selu",Su="Slice",_a="Sin",Na="Sinh",Da="Sign",ka="Sigmoid",Aa="Softplus",Ra="Sqrt",Iu="Sum",Eu="SpaceToBatchND",Tu="SplitV",_u="Softmax",Xb="SparseFillEmptyRows",Yb="SparseReshape",Zb="SparseSegmentMean",Qb="SparseSegmentSum",Jb="SparseToDense",Ma="SquaredDifference",Rd="Square",Ng="StaticRegexReplace",Md="StridedSlice",e0="StringNGrams",t0="StringSplit",n0="StringToHashBucketFast",Oa="Sub",Fa="Tan",$a="Tanh",ss="Tile",Od="TopK",Fd="Transform",as="Transpose",$d="Unique",Nu="Unpack",Du="UnsortedSegmentSum";var ku="ZerosLike",Pa="Step",GP="FromPixels",Pd="RotateWithOffset",jc="_FusedMatMul",qc="FusedConv2D",Kc="FusedDepthwiseConv2D";function ls(...t){P().getBool("IS_TEST")||P().getBool("PROD")||console.warn(...t)}function ese(...t){P().getBool("IS_TEST")||P().getBool("PROD")||console.log(...t)}var r0=Ig("kernelRegistry",()=>new Map),VN=Ig("gradRegistry",()=>new Map);function BN(t,n){let e=jP(t,n);return r0.get(e)}function zN(t){return VN.get(t)}function UN(t){let n=r0.entries(),e=[];for(;;){let{done:r,value:o}=n.next();if(r)break;let[i,s]=o,[a]=i.split("_");a===t&&e.push(s)}return e}function o0(t){let{kernelName:n,backendName:e}=t,r=jP(n,e);r0.has(r)&&ls(`The kernel '${n}' for backend '${e}' is already registered`),r0.set(r,t)}function HP(t){let{kernelName:n}=t;VN.has(n)&&P().getBool("DEBUG")&&ls(`Overriding the gradient for '${n}'`),VN.set(n,t)}function jP(t,n){return`${n}_${t}`}var v={};Po(v,{arraysEqual:()=>Pl,arraysEqualWithNull:()=>Pie,assert:()=>_,assertNonNegativeIntegerDimensions:()=>Ln,assertNonNull:()=>wg,assertShapesMatch:()=>Fb,bytesFromStringArray:()=>FN,bytesPerElement:()=>Kf,checkConversionForErrors:()=>MN,clamp:()=>qf,computeStrides:()=>rs,convertBackendValuesAndArrayBuffer:()=>Hie,createScalarValue:()=>ase,createShuffledIndices:()=>Bie,decodeString:()=>Ud,distSquared:()=>Fie,encodeString:()=>zd,fetch:()=>use,fingerPrint64:()=>sse,flatten:()=>Ru,getArrayFromDType:()=>$b,getTypedArrayFromDType:()=>Gie,hasEncodingLoss:()=>Wie,hexToLong:()=>Dg,indexToLoc:()=>Kie,inferDtype:()=>Ll,inferFromImplicitShape:()=>Uie,isBoolean:()=>FP,isFunction:()=>Yf,isInt:()=>Hs,isNumber:()=>$P,isPromise:()=>Pc,isScalarShape:()=>$ie,isString:()=>Xf,isTypedArray:()=>lr,isValidDtype:()=>ON,locToIndex:()=>qie,makeOnesTypedArray:()=>Cg,makeZerosNestedTypedArray:()=>jie,makeZerosTypedArray:()=>Qf,nearestDivisor:()=>Zf,nearestLargerEven:()=>Rie,now:()=>Jc,parseAxisParam:()=>hn,randUniform:()=>Oie,repeatedTry:()=>zie,rightPad:()=>$c,shuffle:()=>OP,shuffleCombo:()=>Aie,sizeFromShape:()=>ot,sizeToSquarishShape:()=>Vie,squeezeShape:()=>RN,sum:()=>Mie,swap:()=>Ob,tanh:()=>Lie,toNestedArray:()=>Fc,toTypedArray:()=>Bd});function i0(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var jN=am(rL());var Qc=jN.default||jN;function Dg(t){return Qc.fromString(t,!0,16)}var iL=Dg("c3a5c85c97cb3127"),Zc=Dg("b492b66fbe98f273"),wr=Dg("9ae16a3b2f90404f");function HN(t){return t.xor(t.shru(47))}function sL(t,n,e){let r=t.slice(n,n+e);return Qc.fromBytes(Array.from(r),!0,!0)}function Ut(t,n){return sL(t,n,8)}function oL(t,n){return sL(t,n,4)}function Vn(t,n){return n===0?t:t.shru(n).or(t.shl(64-n))}function Au(t,n,e=Dg("9ddfea08eb382d69")){let r=t.xor(n).mul(e);r=r.xor(r.shru(47));let o=n.xor(r).mul(e);return o=o.xor(o.shru(47)),o=o.mul(e),o}function nse(t,n,e,r,o,i){o=o.add(t),i=Vn(i.add(o).add(r),21);let s=o;return o=o.add(n),o=o.add(e),i=i.add(Vn(o,44)),[o.add(r),i.add(s)]}function a0(t,n,e,r){return nse(Ut(t,n),Ut(t,n+8),Ut(t,n+16),Ut(t,n+24),e,r)}function rse(t,n=t.length){if(n>=8){let e=wr.add(n*2),r=Ut(t,0).add(wr),o=Ut(t,n-8),i=Vn(o,37).mul(e).add(r),s=Vn(r,25).add(o).mul(e);return Au(i,s,e)}if(n>=4){let e=wr.add(n*2),r=oL(t,0);return Au(r.shl(3).add(n),oL(t,n-4),e)}if(n>0){let e=t[0],r=t[n>>1],o=t[n-1],i=e+(r<<8),s=n+(o<<2);return HN(wr.mul(i).xor(iL.mul(s))).mul(wr)}return wr}function ose(t,n=t.length){let e=wr.add(n*2),r=Ut(t,0).mul(Zc),o=Ut(t,8),i=Ut(t,n-8).mul(e),s=Ut(t,n-16).mul(wr);return Au(Vn(r.add(o),43).add(Vn(i,30)).add(s),r.add(Vn(o.add(wr),18)).add(i),e)}function ise(t,n=t.length){let e=wr.add(n*2),r=Ut(t,0).mul(wr),o=Ut(t,8),i=Ut(t,n-8).mul(e),s=Ut(t,n-16).mul(wr),a=Vn(r.add(o),43).add(Vn(i,30)).add(s),l=Au(a,r.add(Vn(o.add(wr),18)).add(i),e),u=Ut(t,16).mul(e),c=Ut(t,24),p=a.add(Ut(t,n-32)).mul(e),f=l.add(Ut(t,n-24)).mul(e);return Au(Vn(u.add(c),43).add(Vn(p,30)).add(f),u.add(Vn(c.add(r),18)).add(p),e)}function sse(t,n=t.length){let e=Qc.fromNumber(81,!0);if(n<=32)return n<=16?rse(t,n):ose(t,n);if(n<=64)return ise(t,n);let r=e,o=e.mul(Zc).add(113),i=HN(o.mul(wr).add(113)).mul(wr),s=[Qc.UZERO,Qc.UZERO],a=[Qc.UZERO,Qc.UZERO];r=r.mul(wr).add(Ut(t,0));let l=0,u=(n-1>>6)*64,c=u+(n-1&63)-63;do r=Vn(r.add(o).add(s[0]).add(Ut(t,l+8)),37).mul(Zc),o=Vn(o.add(s[1]).add(Ut(t,l+48)),42).mul(Zc),r=r.xor(a[1]),o=o.add(s[0]).add(Ut(t,l+40)),i=Vn(i.add(a[0]),33).mul(Zc),s=a0(t,l,s[1].mul(Zc),r.add(a[0])),a=a0(t,l+32,i.add(a[1]),o.add(Ut(t,l+16))),[i,r]=[r,i],l+=64;while(l!==u);let p=Zc.add(i.and(255).shl(1));return l=c,a[0]=a[0].add(n-1&63),s[0]=s[0].add(a[0]),a[0]=a[0].add(s[0]),r=Vn(r.add(o).add(s[0]).add(Ut(t,l+8)),37).mul(p),o=Vn(o.add(s[1]).add(Ut(t,l+48)),42).mul(p),r=r.xor(a[1].mul(9)),o=o.add(s[0].mul(9).add(Ut(t,l+40))),i=Vn(i.add(a[0]),33).mul(p),s=a0(t,l,s[1].mul(p),r.add(a[0])),a=a0(t,l+32,i.add(a[1]),o.add(Ut(t,l+16))),[i,r]=[r,i],Au(Au(s[0],a[0],p).add(HN(o).mul(iL)).add(i),Au(s[1],a[1],p).add(r),p)}function ase(t,n){return n==="string"?zd(t):Bd([t],n)}function lse(t,n){return t instanceof Float32Array&&n==="float32"||t instanceof Int32Array&&n==="int32"||t instanceof Uint8Array&&n==="bool"}function Bd(t,n){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ru(t)),P().getBool("DEBUG")&&MN(t,n),lse(t,n))return t;if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool"){let e=new Uint8Array(t.length);for(let r=0;r<e.length;++r)Math.round(t[r])!==0&&(e[r]=1);return e}else throw new Error(`Unknown data type ${n}`)}function Jc(){return P().platform.now()}function use(t,n){return P().platform.fetch(t,n)}function zd(t,n="utf-8"){return n=n||"utf-8",P().platform.encode(t,n)}function Ud(t,n="utf-8"){return n=n||"utf-8",P().platform.decode(t,n)}function lr(t){return P().platform.isTypedArray!=null?P().platform.isTypedArray(t):i0(t)}function Ru(t,n=[],e=!1){if(n==null&&(n=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||Pc(t)||t==null||lr(t)&&e)n.push(t);else if(Array.isArray(t)||lr(t))for(let r=0;r<t.length;++r)Ru(t[r],n,e);else{let r=-1;for(let o of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(o)&&(r=Math.max(r,Number(o)));for(let o=0;o<=r;o++)Ru(t[o],n,e)}return n}var l0=class{constructor(n,e){this.backendTimer=n,this.logger=e,e==null&&(this.logger=new qN)}profileKernel(n,e,r){let o,i=()=>{o=r()},s,a=Jc();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(let u of o)u.dataSync();s=Promise.resolve({kernelMs:Jc()-a})}if(P().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<o.length;u++){let c=o[u];c.data().then(p=>{cse(p,c.dtype,n)})}return{kernelName:n,outputs:o,inputs:e,timeMs:s.then(u=>u.kernelMs),extraInfo:s.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(n){let{kernelName:e,outputs:r,timeMs:o,inputs:i,extraInfo:s}=n;r.forEach(a=>{Promise.all([a.data(),o,s]).then(l=>{this.logger.logKernelProfile(e,a,l[0],l[1],i,l[2])})})}};function cse(t,n,e){if(n!=="float32")return!1;for(let r=0;r<t.length;r++){let o=t[r];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${e}'`),!0}return!1}var qN=class{logKernelProfile(n,e,r,o,i,s){let a=typeof o=="number"?$c(`${o}ms`,9):o.error,l=$c(n,25),u=e.rank,c=e.size,p=$c(e.shape.toString(),14),f="";for(let d in i){let h=i[d];if(h!=null){let m=h.shape||e.shape,g=m.length;f+=`${d}: ${g}D ${g>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${p}	%c${c}	%c${f}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function aL(t,n,e){let r={},o={};for(let l=0;l<n.length;l++)r[n[l].id]=!0;for(let l=0;l<t.length;l++){let u=t[l],c=u.inputs;for(let p in c){let f=c[p],d=!1;for(let h=0;h<n.length;h++)if(r[f.id]){u.outputs.forEach(m=>r[m.id]=!0),d=!0,o[u.id]=!0;break}if(d)break}}let i={};i[e.id]=!0;let s={};for(let l=t.length-1;l>=0;l--){let u=t[l],c=u.inputs;for(let p=0;p<u.outputs.length;p++)if(i[u.outputs[p].id]){for(let f in c)i[c[f].id]=!0,s[u.id]=!0;break}}let a=[];for(let l=0;l<t.length;l++){let u=t[l];if(o[u.id]&&s[u.id]){let c={};for(let f in u.inputs){let d=u.inputs[f];r[d.id]&&(c[f]=d)}let p=Object.assign({},u);p.inputs=c,p.outputs=u.outputs,a.push(p)}}return a}function lL(t,n,e,r){for(let o=n.length-1;o>=0;o--){let i=n[o],s=[];if(i.outputs.forEach(l=>{let u=t[l.id];u!=null?s.push(u):s.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let a=i.gradient(s);for(let l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);let u=e(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);let c=i.inputs[l];if(!Pl(u.shape,c.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${c.shape}'`);if(t[c.id]==null)t[c.id]=u;else{let p=t[c.id];t[c.id]=r(p,u),p.dispose()}}}}var uL=20,kg=3,KN=7;function cL(t,n,e,r){let o=rs(n),i=pse(t,n,e,o),s=n.length,a=u0(t,n,e,o,i),l=["Tensor"];return r&&(l.push(`  dtype: ${e}`),l.push(`  rank: ${s}`),l.push(`  shape: [${n}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function pse(t,n,e,r){let o=ot(n),i=r[r.length-1],s=new Array(i).fill(0),a=n.length,l=e==="complex64"?Rg(t):t;if(a>1)for(let u=0;u<o/i;u++){let c=u*i;for(let p=0;p<i;p++)s[p]=Math.max(s[p],Ag(l[c+p],0,e).length)}return s}function Ag(t,n,e){let r;return Array.isArray(t)?r=`${parseFloat(t[0].toFixed(KN))} + ${parseFloat(t[1].toFixed(KN))}j`:Xf(t)?r=`'${t}'`:e==="bool"?r=pL(t):r=parseFloat(t.toFixed(KN)).toString(),$c(r,n)}function pL(t){return t===0?"false":"true"}function u0(t,n,e,r,o,i=!0){let s=e==="complex64"?2:1,a=n[0],l=n.length;if(l===0){if(e==="complex64"){let m=Rg(t);return[Ag(m[0],0,e)]}return e==="bool"?[pL(t[0])]:[t[0].toString()]}if(l===1){if(a>uL){let g=kg*s,y=Array.from(t.slice(0,g)),x=Array.from(t.slice((a-kg)*s,a*s));return e==="complex64"&&(y=Rg(y),x=Rg(x)),["["+y.map((b,w)=>Ag(b,o[w],e)).join(", ")+", ..., "+x.map((b,w)=>Ag(b,o[a-kg+w],e)).join(", ")+"]"]}return["["+(e==="complex64"?Rg(t):Array.from(t)).map((g,y)=>Ag(g,o[y],e)).join(", ")+"]"]}let u=n.slice(1),c=r.slice(1),p=r[0]*s,f=[];if(a>uL){for(let m=0;m<kg;m++){let g=m*p,y=g+p;f.push(...u0(t.slice(g,y),u,e,c,o,!1))}f.push("...");for(let m=a-kg;m<a;m++){let g=m*p,y=g+p;f.push(...u0(t.slice(g,y),u,e,c,o,m===a-1))}}else for(let m=0;m<a;m++){let g=m*p,y=g+p;f.push(...u0(t.slice(g,y),u,e,c,o,m===a-1))}let d=l===2?",":"";f[0]="["+(a>0?f[0]+d:"");for(let m=1;m<f.length-1;m++)f[m]=" "+f[m]+d;let h=`,
`;for(let m=2;m<l;m++)h+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(i?"":h),f}function Rg(t){let n=[];for(let e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var mt=class{constructor(n,e,r){if(this.dtype=e,this.shape=n.slice(),this.size=ot(n),r!=null){let o=r.length;_(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||$b(e,this.size),this.strides=rs(n)}set(n,...e){e.length===0&&(e=[0]),_(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);let r=this.locToIndex(e);this.values[r]=n}get(...n){n.length===0&&(n=[0]);let e=0;for(let o of n){if(o<0||o>=this.shape[e]){let i=`Requested out of range element at ${n}.   Buffer shape=${this.shape}`;throw new Error(i)}e++}let r=n[n.length-1];for(let o=0;o<n.length-1;++o)r+=this.strides[o]*n[o];return this.values[r]}locToIndex(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];let e=n[n.length-1];for(let r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e}indexToLoc(n){if(this.rank===0)return[];if(this.rank===1)return[n];let e=new Array(this.shape.length);for(let r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e}get rank(){return this.shape.length}toTensor(){return Di().makeTensor(this.values,this.shape,this.dtype)}},Di=null,Gd=null,fse=null;function fL(t){Di=t}function dL(t){Gd=t}function hL(t){fse=t}var lt=class{constructor(n,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=ot(n),this.strides=rs(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}buffer(){return B(this,null,function*(){let n=yield this.data();return Gd.buffer(this.shape,this.dtype,n)})}bufferSync(){return Gd.buffer(this.shape,this.dtype,this.dataSync())}array(){return B(this,null,function*(){let n=yield this.data();return Fc(this.shape,n,this.dtype==="complex64")})}arraySync(){return Fc(this.shape,this.dataSync(),this.dtype==="complex64")}data(){return B(this,null,function*(){this.throwIfDisposed();let n=Di().read(this.dataId);if(this.dtype==="string"){let e=yield n;try{return e.map(r=>Ud(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return n})}dataToGPU(n){return this.throwIfDisposed(),Di().readToGPU(this.dataId,n)}dataSync(){this.throwIfDisposed();let n=Di().readSync(this.dataId);if(this.dtype==="string")try{return n.map(e=>Ud(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n}bytes(){return B(this,null,function*(){this.throwIfDisposed();let n=yield Di().read(this.dataId);return this.dtype==="string"?n:new Uint8Array(n.buffer)})}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Di().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(n=!1){return Gd.print(this,n)}clone(){return this.throwIfDisposed(),Gd.clone(this)}toString(n=!1){let e=this.dataSync();return cL(e,this.shape,this.dtype,n)}cast(n){return this.throwIfDisposed(),Gd.cast(this,n)}variable(n=!0,e,r){return this.throwIfDisposed(),Di().makeVariable(this,n,e,r)}};Object.defineProperty(lt,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function A(){return Ig("Tensor",()=>lt)}A();var La=class extends lt{constructor(n,e,r,o){super(n.shape,n.dtype,n.dataId,o),this.trainable=e,this.name=r}assign(n){if(n.dtype!==this.dtype)throw new Error(`dtype of the new value (${n.dtype}) and previous value (${this.dtype}) must match`);if(!Pl(n.shape,this.shape))throw new Error(`shape of the new value (${n.shape}) and previous value (${this.shape}) must match`);Di().disposeTensor(this),this.dataId=n.dataId,Di().incRef(this,null)}dispose(){Di().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(La,Symbol.hasInstance,{value:t=>t instanceof lt&&t.assign!=null&&t.assign instanceof Function});var mL=function(t){return t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64",t}(mL||{}),gL=function(t){return t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64",t}(gL||{}),yL=function(t){return t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64",t}(yL||{}),xL=function(t){return t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64",t}(xL||{}),dse={float32:yL,int32:mL,bool:gL,complex64:xL};function un(t,n){if(t==="string"||n==="string"){if(t==="string"&&n==="string")return"string";throw new Error(`Can not upcast ${t} with ${n}`)}return dse[t][n]}function ep(t){return un(t,"int32")}function c0(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function p0(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}function Ve(t,n){if(t.dtype===n.dtype)return[t,n];let e=un(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function f0(t){let n=[];return vL(t,n,new Set),n}function vL(t,n,e){if(t==null)return;if(t instanceof lt){n.push(t);return}if(!hse(t))return;let r=t;for(let o in r){let i=r[o];e.has(i)||(e.add(i),vL(i,n,e))}}function hse(t){return Array.isArray(t)||typeof t=="object"}function XN(t){return t.kernelName!=null}var d0=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(n=>n.name)))}}}dispose(){for(let n in this.registeredVariables)this.registeredVariables[n].dispose()}},gse=(()=>{class t{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new d0}ready(){return B(this,null,function*(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r];if(yield this.initializeBackend(o).success){yield this.setBackend(o);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")})}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:r}=this.initializeBackendsAndReturnBest();if(r)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:r}=this.initializeBackend(e);if(r)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,r,o=1){return e in this.registryFactory?(ls(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:r,priority:o},!0)}setBackend(e){return B(this,null,function*(){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:r,asyncInit:o}=this.initializeBackend(e);if(!(o?yield r:r))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new l0(this.backendInstance),!0})}setupRegisteredKernels(){UN(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){UN(e).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[e])})}initializeBackend(e){let r=this.registryFactory[e];if(r==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let o=r.factory();if(o&&!(o instanceof Ws)&&typeof o.then=="function"){let i=++this.pendingBackendInitId,s=o.then(a=>i<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,ls(`Initialization of backend ${e} failed`),ls(a.stack||a.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(o){return ls(`Initialization of backend ${e} failed`),ls(o.stack||o.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,r)=>this.registryFactory[r].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r],{success:i,asyncInit:s}=this.initializeBackend(o);if(s||i)return{name:o,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,r){let o=this.state.tensorInfo.get(r),i=o.backend,s=this.readSync(r),a=i.refCount(r);i.disposeData(r,!0),o.backend=e,e.move(r,s,o.shape,o.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,r){let o=null;if(r==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");r=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof r!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}let i;return this.scopedRun(()=>this.startScope(o),()=>this.endScope(i),()=>(i=r(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,r,o){e();try{let i=o();return r(),i}catch(i){throw r(),i}}nextTensorId(){return t.nextTensorId++}nextVariableId(){return t.nextVariableId++}clone(e){let r=E.runKernel(is,{x:e}),o={x:e},i=a=>({x:()=>{let l="float32",u={x:a},c={dtype:l};return E.runKernel(os,u,c)}}),s=[];return this.addTapeNode(this.state.activeScope.name,o,[r],i,s,{}),r}runKernel(e,r,o){if(this.backendName==null&&this.backend,!(BN(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:r,attrs:o})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,r,o){let i=this.backend.numDataIds(),s=0;o.forEach(u=>{s+=u.dtype==="complex64"?3:1});let a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=i-r-s-a;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${e}'`)}runKernelFunc(e){let r,o=[],i=this.isTapeOn(),s=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let u,c=XN(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(XN(e)){let{kernelName:m,inputs:g,attrs:y}=e;this.backendName==null&&this.backend;let x=BN(m,this.backendName);_(x!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),l=()=>{let b=this.backend.numDataIds();u=x.kernelFunc({inputs:g,attrs:y,backend:this.backend});let w=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,b,w);let C=w.map(N=>N.rank!=null?N:this.makeTensorFromTensorInfo(N));if(i){let N=this.getTensorsForGradient(m,g,C);o=this.saveTensorsForBackwardMode(N)}return C}}else{let{forwardFunc:m}=e,g=y=>{i&&(o=y.map(x=>this.keep(this.clone(x))))};l=()=>{let y=this.backend.numDataIds();u=this.tidy(()=>m(this.backend,g));let x=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,y,x),x}}let{inputs:p,attrs:f}=e,d=XN(e)?null:e.backwardsFunc,h;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?r=l():(h=this.profiler.profileKernel(c,p,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(h),r=h.outputs)}),i&&this.addTapeNode(c,p,r,d,o,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(p).map(m=>p[m]!=null?p[m].shape:null),outputShapes:r.map(m=>m.shape),kernelTimeMs:h.timeMs,extraInfo:h.extraInfo}),Array.isArray(u)?r:r[0]}saveTensorsForBackwardMode(e){return e.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(e,r,o){let i=zN(e);if(i!=null){let s=i.inputsToSave||[],a=i.outputsToSave||[],l;i.saveAllInputs?(_(Array.isArray(r),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(r).map(c=>r[c])):l=s.map(c=>r[c]);let u=o.filter((c,p)=>a[p]);return l.concat(u)}return[]}makeTensor(e,r,o,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");o=o||"float32",i=i||this.backend;let s=e;o==="string"&&Xf(e[0])&&(s=e.map(u=>zd(u)));let a=i.write(s,r,o),l=new lt(r,o,a,this.nextTensorId());if(this.trackTensor(l,i),o==="string"){let u=this.state.tensorInfo.get(a),c=FN(s);this.state.numBytes+=c-u.bytes,u.bytes=c}return l}makeTensorFromDataId(e,r,o,i){o=o||"float32";let s={dataId:e,shape:r,dtype:o};return this.makeTensorFromTensorInfo(s,i)}makeTensorFromTensorInfo(e,r){let{dataId:o,shape:i,dtype:s}=e,a=new lt(i,s,o,this.nextTensorId());return this.trackTensor(a,r),a}makeVariable(e,r=!0,o,i){o=o||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));let s=new La(e,r,o,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,r){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let o=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(o=e.size*Kf(e.dtype)),this.state.numBytes+=o,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:r||this.backend,dtype:e.dtype,shape:e.shape,bytes:o})),e instanceof La||this.track(e)}incRef(e,r){this.trackTensor(e,r),this.backend.incRef(e.dataId)}removeDataId(e,r){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===r&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let r=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=r.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let o=e.size*Kf(e.dtype);this.state.numBytes-=o}r.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,r.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let r=this.state.registeredVariables[e];this.disposeVariable(r)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}profile(e){return B(this,null,function*(){this.state.profiling=!0;let r=this.state.numBytes,o=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=yield e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-r,this.state.activeProfile.newTensors=this.state.numTensors-o;for(let i of this.state.activeProfile.kernels)i.kernelTimeMs=yield i.kernelTimeMs,i.extraInfo=yield i.extraInfo;return this.state.activeProfile})}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,r,o,i,s,a){let l={id:this.state.nextTapeNodeId++,kernelName:e,inputs:r,outputs:o,saved:s},u=zN(e);u!=null&&(i=u.gradFunc),i!=null&&(l.gradient=c=>(c=c.map((p,f)=>{if(p==null){let d=o[f],h=Qf(d.size,d.dtype);return this.makeTensor(h,d.shape,d.dtype)}return p}),i(c.length>1?c:c[0],s,a))),this.state.activeTape.push(l)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let r={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(r.name=e),this.state.scopeStack.push(r),this.state.activeScope=r}endScope(e){let r=f0(e),o=new Set(r.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let a=this.state.activeScope.track[s];!a.kept&&!o.has(a.id)&&a.dispose()}let i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(e,r,o,i=!1){if(_(r.length>0,()=>"gradients() received an empty list of xs."),o!=null&&o.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${o.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));_(s instanceof lt,()=>"The result y returned by f() must be a tensor.");let a=aL(this.state.activeTape,r,s);if(!i&&a.length===0&&r.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let l={};l[s.id]=o??yse(s.shape),lL(l,a,c=>this.tidy(c),xse);let u=r.map(c=>l[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(let p of c.saved)p.dispose()}),this.state.activeTape=null),{value:s,grads:u}})}customGrad(e){return _(Yf(e),()=>"The f passed in customGrad(f) must be a function."),(...r)=>{_(r.every(l=>l instanceof lt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let o,i={};r.forEach((l,u)=>{i[u]=l});let s=(l,u)=>(o=e(...r,u),_(o.value instanceof lt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),_(Yf(o.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),o.value),a=(l,u)=>{let c=o.gradFunc(l,u),p=Array.isArray(c)?c:[c];_(p.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),_(p.every(d=>d instanceof lt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let f={};return p.forEach((d,h)=>{f[h]=()=>d}),f};return this.runKernelFunc({forwardFunc:s,backwardsFunc:a,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,r){return this.state.tensorInfo.get(e).backend.readToGPU(e,r)}time(e){return B(this,null,function*(){let r=Jc(),o=yield this.backend.time(e);return o.wallMs=Jc()-r,o})}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new d0;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}return t.nextTensorId=0,t.nextVariableId=0,t})();function yse(t){let n=Cg(ot(t),"float32");return E.makeTensor(n,t,"float32")}function YN(){let t=LN();if(t._tfengine==null){let n=new Sg(t);t._tfengine=new gse(n)}return VP(t._tfengine.ENV),fL(()=>t._tfengine),t._tfengine}var E=YN();function xse(t,n){let e={a:t,b:n};return E.runKernel(_i,e)}var Mu={};Po(Mu,{isBrowser:()=>QN,isMobile:()=>wse,mockIsMobile:()=>bse});function vse(){return typeof navigator<"u"&&navigator!=null}var ZN;function bse(t){ZN=t}function wse(t){if(ZN!==void 0)return ZN;if(t||vse()){if(t||(t=navigator),t.product==="ReactNative")return!0;let n=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!n){let e=t;return e.userAgentData&&e.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}return!1}function QN(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Or=P();Or.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Or.registerFlag("IS_BROWSER",()=>QN());Or.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Or.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Or.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Or.registerFlag("PROD",()=>!1);Or.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Or.getBool("DEBUG"));Or.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Or.registerFlag("IS_TEST",()=>!1);Or.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Or.getBool("DEBUG"));Or.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Or.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Or.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function tp(t,n){let e=t;if(lr(t))return n==="string"?[]:[t.length];if(c0(t)){let o=t.channels||"RGBA";return[t.height,t.width*o.length]}else if(p0(t))return[t.buffer.size/(n==null?4:Kf(n))];if(!Array.isArray(t))return[];let r=[];for(;Array.isArray(e)||lr(e)&&n!=="string";)r.push(e.length),e=e[0];return Array.isArray(t)&&P().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&wL(t,r,[]),r}function wL(t,n,e){if(e=e||[],!Array.isArray(t)&&!lr(t)){_(n.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${n[0]} elements`);return}_(n.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${t.length} elements`),_(t.length===n[0],()=>`Element arr[${e.join("][")}] should have ${n[0]} elements, but has ${t.length} elements`);let r=n.slice(1);for(let o=0;o<t.length;++o)wL(t[o],r,e.concat(o))}function bL(t,n,e,r){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==n||t==="numeric"&&n==="string")throw new Error(`Argument '${e}' passed to '${r}' must be ${t} tensor, but got ${n} tensor`)}}function I(t,n,e,r="numeric"){if(t instanceof A())return bL(r,t.dtype,n,e),t;let o=Ll(t);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),bL(r,o,n,e),t==null||!lr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){let l=t==null?"null":t.constructor.name;throw new Error(`Argument '${n}' passed to '${e}' must be a Tensor or TensorLike, but got '${l}'`)}let i=tp(t,o);!lr(t)&&!Array.isArray(t)&&(t=[t]);let a=o!=="string"?Bd(t,o):Ru(t,[],!0);return E.makeTensor(a,i,o)}function h0(t,n,e,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${n} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,s)=>I(i,`${n}[${s}]`,e,r))}var Cse="__op";function T(t){let n=Object.keys(t);if(n.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${n.length} keys.`);let e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+Cse;let o=(...i)=>{E.startScope(e);try{let s=r(...i);return Pc(s)&&console.error("Cannot return a Promise inside of tidy."),E.endScope(s),s}catch(s){throw E.endScope(null),s}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}function Sse(t,n){let e=I(t,"real","complex"),r=I(n,"imag","complex");Fb(e.shape,r.shape,`real and imag shapes, ${e.shape} and ${r.shape}, must match in call to tf.complex().`);let o={real:e,imag:r};return E.runKernel(id,o)}var No=T({complex_:Sse});function Ou(t,n,e,r){if(r==null)r=Ll(t);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(p0(t)||c0(t)){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return E.backend.createTensorFromGPUData(t,n||e,r)}if(!lr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){Ln(n);let o=ot(n),i=ot(e);_(o===i,()=>`Based on the provided shape, [${n}], the tensor should have ${o} values but has ${i}`);for(let s=0;s<e.length;++s){let a=e[s],l=s===e.length-1?a!==ot(n.slice(s)):!0;_(e[s]===n[s]||!l,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${n}). `)}}return!lr(t)&&!Array.isArray(t)&&(t=[t]),n=n||e,t=r!=="string"?Bd(t,r):Ru(t,[],!0),E.makeTensor(t,n,r)}function Fr(t,n,e){let r=tp(t,e);return Ou(t,n,r,e)}var Va={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var Jn=class t{static join(n){return new t(n).slice()}constructor(n){if(this.shards=[],this.previousShardIndex=0,n==null||(n instanceof Array||(n=[n]),n=n.map(r=>lr(r)?r.buffer:r),n.length===0))return;this.bufferUniformSize=n[0].byteLength;let e=0;for(let r=0;r<n.length;r++){let o=n[r];r!==n.length-1&&o.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let i=e+o.byteLength;this.shards.push({buffer:o,start:e,end:i}),e=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(n=0,e=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(n=isNaN(Number(n))?0:n,e=isNaN(Number(e))?0:e,n=Math.max(0,n),e=Math.min(this.byteLength,e),e<=n)return new ArrayBuffer(0);let r=this.findShardForByte(n);if(r===-1)throw new Error(`Could not find start shard for byte ${n}`);let o=e-n,i=new ArrayBuffer(o),s=new Uint8Array(i),a=0;for(let l=r;l<this.shards.length;l++){let u=this.shards[l],p=n+a-u.start,f=a,h=Math.min(e,u.end)-u.start,m=new Uint8Array(u.buffer,p,h-p);if(s.set(m,f),a+=m.length,e<u.end)break}return i}findShardForByte(n){if(this.shards.length===0||n<0||n>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(n/this.bufferUniformSize),this.previousShardIndex;function e(o){return n<o.start?-1:n>=o.end?1:0}if(e(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let r=Ise(this.shards,e);return r===-1?-1:(this.previousShardIndex=r,this.previousShardIndex)}};function Ise(t,n){let e=0,r=t.length;for(;e<=r;){let o=Math.floor((r-e)/2)+e,i=n(t[o]);if(i===0)return o;i<0?r=o:e=o+1}return-1}function Ese(t){P().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}hL(Ese);function Jo(){return E}function Mg(){return E.memory()}function L(t,n){return E.tidy(t,n)}function De(t){f0(t).forEach(e=>e.dispose())}function Tn(t){return E.keep(t)}function CL(){return E.ready()}function SL(){return E.backendName}function m0(t,n,e=1){return E.registerBackend(t,n,e)}function g0(){return E.backend}var Fu=4;function TL(t,n){return B(this,null,function*(){let e=[],r=[],o=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);for(let s=0;s<o.length;++s){let a=o[s],l=Array.isArray(t)?t[s].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);let u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){let c=new Promise(p=>B(null,null,function*(){let f=yield l.bytes(),d=f.reduce((g,y)=>g+y.length,0)+Fu*f.length,h=new Uint8Array(d),m=0;for(let g=0;g<f.length;g++){let y=f[g],x=new Uint8Array(new Uint32Array([y.length]).buffer);h.set(x,m),m+=Fu,h.set(y,m),m+=y.length}p(h)}));r.push(c)}else r.push(l.data());n!=null&&(u.group=n),e.push(u)}let i=yield Promise.all(r);return{data:Nse(i),specs:e}})}function y0(t,n){let e=new Jn(t),r={},o=0;for(let i of n){let s=Tse(i,(a,l)=>e.slice(o+a,o+l));r[i.name]=_L(i,e.slice(o,o+s)),o+=s}return r}function Tse(t,n){let e=ot(t.shape),r;if("quantization"in t){let o=t.quantization;r=Va[o.dtype]}else if(t.dtype==="string"){let o=0;for(let i=0;i<e;i++)o+=Fu+new Uint32Array(n(o,o+Fu))[0];return o}else r=Va[t.dtype];return e*r}function _se(t,n){return B(this,null,function*(){let e=ot(t.shape),r;if("quantization"in t){let o=t.quantization;r=Va[o.dtype]}else if(t.dtype==="string"){let o=0;for(let i=0;i<e;i++)o+=Fu+new Uint32Array(yield n(o,o+Fu))[0];return o}else r=Va[t.dtype];return e*r})}function _L(t,n){let e=t.name,r=t.dtype,o=t.shape,i=ot(o),s,a=0;if("quantization"in t){let l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(r!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${r}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let u=Va[l.dtype],c=l.dtype==="uint8"?new Uint8Array(n):new Uint16Array(n);if(r==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){s=new Float32Array(c.length);for(let p=0;p<c.length;p++){let f=c[p];s[p]=f*l.scale+l.min}}else if(l.dtype==="float16")s=Rse()(c);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(r==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);s=new Int32Array(c.length);for(let p=0;p<c.length;p++){let f=c[p];s[p]=Math.round(f*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${e}': ${r}`);a+=i*u}else if(r==="string"){let l=ot(t.shape);s=[];for(let u=0;u<l;u++){let c=new Uint32Array(n.slice(a,a+Fu))[0];a+=Fu;let p=new Uint8Array(n.slice(a,a+c));s.push(p),a+=c}}else{let l=Va[r];if(r==="float32")s=new Float32Array(n);else if(r==="int32")s=new Int32Array(n);else if(r==="bool")s=new Uint8Array(n);else if(r==="complex64"){s=new Float32Array(n);let u=new Float32Array(s.length/2),c=new Float32Array(s.length/2);for(let h=0;h<u.length;h++)u[h]=s[h*2],c[h]=s[h*2+1];let p=Fr(u,o,"float32"),f=Fr(c,o,"float32"),d=No(p,f);return p.dispose(),f.dispose(),d}else throw new Error(`Unsupported dtype in weight '${e}': ${r}`);a+=i*l}return Fr(s,o,r)}function IL(t,n,e){return B(this,null,function*(){let r=new Uint8Array(n);for(;r.byteLength<e;){let{done:o,value:i}=yield t.read();if(o&&i==null){let a=e-r.byteLength;throw new Error(`Reader is done but ${a} bytes are still expected`)}let s=new Uint8Array(r.length+i.byteLength);s.set(r,0),s.set(new Uint8Array(i),r.length),r=s}return r.buffer})}function JN(t,n){return B(this,null,function*(){let e={},r=t.getReader(),o=new ArrayBuffer(0);for(let i of n){let s=yield _se(i,(u,c)=>B(null,null,function*(){return o=yield IL(r,o,c),o.slice(u,c)}));o=yield IL(r,o,s);let a=o.slice(0,s);o=o.slice(s);let l=_L(i,a);if(e[i.name]=l,SL()==="webgpu"){let u=g0();"uploadToGPU"in u&&ot(l.shape)>=P().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&u.uploadToGPU(l.dataId)}}return e})}function Nse(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let n=0,e=[];t.forEach(i=>{if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});let r=new Uint8Array(n),o=0;return e.forEach(i=>{r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var eD=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function EL(t){return eD?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function NL(t){if(eD)return Buffer.from(t).toString("base64");let n=new Uint8Array(t),e="";for(let r=0,o=n.length;r<o;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function DL(t){if(eD){let r=Buffer.from(t,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let n=atob(t),e=new Uint8Array(n.length);for(let r=0;r<n.length;++r)e.set([n.charCodeAt(r)],r);return e.buffer}function kL(t){return Jn.join(t)}function tD(t){let n="/";for(t=t.trim();t.endsWith(n);)t=t.slice(0,t.length-1);let e=t.split(n);return e[e.length-1]}function x0(t,n){let e={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n};return t.signature!=null&&(e.signature=t.signature),t.userDefinedMetadata!=null&&(e.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(e.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(e.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(e.trainingConfig=t.trainingConfig),e}function nD(t,n,e){let r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(r.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!n)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!e)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=n,r.weightData=e}return t.signature!=null&&(r.signature=t.signature),t.userDefinedMetadata!=null&&(r.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(r.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(r.initializerSignature=t.initializerSignature),r}function Wd(t,n){return B(this,null,function*(){let e,r;return t.weightsManifest!=null&&([e,r]=yield n(t.weightsManifest)),nD(t,e,r)})}function us(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:EL(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:EL(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new Jn(t.weightData).byteLength}}function Og(t){let n=[];for(let e of t)n.push(...e.weights);return n}function Dse(){let t=e=>{let r=e<<13,o=0;for(;(r&8388608)===0;)o-=8388608,r<<=1;return r&=-8388609,o+=947912704,r|o},n=new Uint32Array(2048);n[0]=0;for(let e=1;e<1024;e++)n[e]=t(e);for(let e=1024;e<2048;e++)n[e]=939524096+(e-1024<<13);return n}function kse(){let t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let n=1;n<31;n++)t[n]=n<<23;for(let n=33;n<63;n++)t[n]=2147483648+(n-32<<23);return t}function Ase(){let t=new Uint32Array(64);for(let n=0;n<64;n++)t[n]=1024;return t[0]=t[32]=0,t}function Rse(){let t=Dse(),n=kse(),e=Ase();return r=>{let o=new ArrayBuffer(4*r.length),i=new Uint32Array(o);for(let s=0;s<r.length;s++){let a=r[s],l=t[e[a>>10]+(a&1023)]+n[a>>10];i[s]=l}return new Float32Array(o)}}var _n=class t{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerSaveRouter(n){t.getInstance().saveRouters.push(n)}static registerLoadRouter(n){t.getInstance().loadRouters.push(n)}static getSaveHandlers(n){return t.getHandlers(n,"save")}static getLoadHandlers(n,e){return t.getHandlers(n,"load",e)}static getHandlers(n,e,r){let o=[];return(e==="load"?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(s=>{let a=s(n,r);a!==null&&o.push(a)}),o}},AL=t=>_n.registerSaveRouter(t),RL=t=>_n.registerLoadRouter(t),ML=t=>_n.getSaveHandlers(t),OL=(t,n)=>_n.getLoadHandlers(t,n);var rD="tensorflowjs",oD=1,np="models_store",$u="model_info_store";function FL(){if(!P().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let t=typeof window>"u"?self:window,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function iD(t){let n=t.result;n.createObjectStore(np,{keyPath:"modelPath"}),n.createObjectStore($u,{keyPath:"modelPath"})}var rp=(()=>{class t{constructor(e){if(this.indexedDB=FL(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}save(e){return B(this,null,function*(){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)})}load(){return B(this,null,function*(){return this.databaseAction(this.modelPath)})}databaseAction(e,r){return new Promise((o,i)=>{let s=this.indexedDB.open(rD,oD);s.onupgradeneeded=()=>iD(s),s.onsuccess=()=>{let a=s.result;if(r==null){let l=a.transaction(np,"readonly"),c=l.objectStore(np).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return a.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));o(c.result.modelArtifacts)},c.onerror=p=>(a.close(),i(c.error)),l.oncomplete=()=>a.close()}else{r.weightData=Jn.join(r.weightData);let l=us(r),u=a.transaction($u,"readwrite"),c=u.objectStore($u),p;try{p=c.put({modelPath:this.modelPath,modelArtifactsInfo:l})}catch(d){return i(d)}let f;p.onsuccess=()=>{f=a.transaction(np,"readwrite");let d=f.objectStore(np),h;try{h=d.put({modelPath:this.modelPath,modelArtifacts:r,modelArtifactsInfo:l})}catch(m){return i(m)}h.onsuccess=()=>o({modelArtifactsInfo:l}),h.onerror=m=>{c=u.objectStore($u);let g=c.delete(this.modelPath);g.onsuccess=()=>(a.close(),i(h.error)),g.onerror=y=>(a.close(),i(h.error))}},p.onerror=d=>(a.close(),i(p.error)),u.oncomplete=()=>{f==null?a.close():f.oncomplete=()=>a.close()}}},s.onerror=a=>i(s.error)})}}return t.URL_SCHEME="indexeddb://",t})();var $L=t=>P().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(rp.URL_SCHEME)?Mse(t.slice(rp.URL_SCHEME.length)):null;_n.registerSaveRouter($L);_n.registerLoadRouter($L);function Mse(t){return new rp(t)}function Ose(t){return t.startsWith(rp.URL_SCHEME)?t.slice(rp.URL_SCHEME.length):t}var v0=class{constructor(){this.indexedDB=FL()}listModels(){return B(this,null,function*(){return new Promise((n,e)=>{let r=this.indexedDB.open(rD,oD);r.onupgradeneeded=()=>iD(r),r.onsuccess=()=>{let o=r.result,i=o.transaction($u,"readonly"),a=i.objectStore($u).getAll();a.onsuccess=()=>{let l={};for(let u of a.result)l[u.modelPath]=u.modelArtifactsInfo;n(l)},a.onerror=l=>(o.close(),e(a.error)),i.oncomplete=()=>o.close()},r.onerror=o=>e(r.error)})})}removeModel(n){return B(this,null,function*(){return n=Ose(n),new Promise((e,r)=>{let o=this.indexedDB.open(rD,oD);o.onupgradeneeded=()=>iD(o),o.onsuccess=()=>{let i=o.result,s=i.transaction($u,"readwrite"),a=s.objectStore($u),l=a.get(n),u;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${n}' in IndexedDB.`));{let c=a.delete(n),p=()=>{u=i.transaction(np,"readwrite");let d=u.objectStore(np).delete(n);d.onsuccess=()=>e(l.result.modelArtifactsInfo),d.onerror=h=>r(l.error)};c.onsuccess=p,c.onerror=f=>(p(),i.close(),r(l.error))}},l.onerror=c=>(i.close(),r(l.error)),s.oncomplete=()=>{u==null?i.close():u.oncomplete=()=>i.close()}},o.onerror=i=>r(o.error)})})}};var Ba="/",Hd="tensorflowjs_models",PL="info",Fse="model_topology",$se="weight_specs",Pse="weight_data",Lse="model_metadata";function LL(t){return{info:[Hd,t,PL].join(Ba),topology:[Hd,t,Fse].join(Ba),weightSpecs:[Hd,t,$se].join(Ba),weightData:[Hd,t,Pse].join(Ba),modelMetadata:[Hd,t,Lse].join(Ba)}}function VL(t){for(let n of Object.values(t))window.localStorage.removeItem(n)}function Vse(t){let n=t.split(Ba);if(n.length<3)throw new Error(`Invalid key format: ${t}`);return n.slice(1,n.length-1).join(Ba)}function Bse(t){return t.startsWith(op.URL_SCHEME)?t.slice(op.URL_SCHEME.length):t}var op=(()=>{class t{constructor(e){if(!P().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=LL(this.modelPath)}save(e){return B(this,null,function*(){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let r=JSON.stringify(e.modelTopology),o=JSON.stringify(e.weightSpecs),i=us(e),s=Jn.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,r),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,NL(s));let a={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(a)),{modelArtifactsInfo:i}}catch{throw VL(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}})}load(){return B(this,null,function*(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let r={},o=JSON.parse(this.LS.getItem(this.keys.topology));if(o==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);r.modelTopology=o;let i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);r.weightSpecs=i;let s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){let l=JSON.parse(s);r.format=l.format,r.generatedBy=l.generatedBy,r.convertedBy=l.convertedBy,l.signature!=null&&(r.signature=l.signature),l.userDefinedMetadata!=null&&(r.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(r.modelInitializer=l.modelInitializer),l.initializerSignature!=null&&(r.initializerSignature=l.initializerSignature),l.trainingConfig!=null&&(r.trainingConfig=l.trainingConfig)}let a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return r.weightData=DL(a),r})}}return t.URL_SCHEME="localstorage://",t})();var BL=t=>P().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(op.URL_SCHEME)?zse(t.slice(op.URL_SCHEME.length)):null;_n.registerSaveRouter(BL);_n.registerLoadRouter(BL);function zse(t){return new op(t)}var b0=class{constructor(){_(P().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),_(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}listModels(){return B(this,null,function*(){let n={},e=Hd+Ba,r=Ba+PL;for(let o=0;o<this.LS.length;++o){let i=this.LS.key(o);if(i.startsWith(e)&&i.endsWith(r)){let s=Vse(i);n[s]=JSON.parse(this.LS.getItem(i))}}return n})}removeModel(n){return B(this,null,function*(){n=Bse(n);let e=LL(n);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${n}'`);let r=JSON.parse(this.LS.getItem(e.info));return VL(e),r})}};var jd="://",ki=class t{constructor(){this.managers={}}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerManager(n,e){_(n!=null,()=>"scheme must not be undefined or null."),n.endsWith(jd)&&(n=n.slice(0,n.indexOf(jd))),_(n.length>0,()=>"scheme must not be an empty string.");let r=t.getInstance();_(r.managers[n]==null,()=>`A model store manager is already registered for scheme '${n}'.`),r.managers[n]=e}static getManager(n){let e=t.getInstance().managers[n];if(e==null)throw new Error(`Cannot find model manager for scheme '${n}'`);return e}static getSchemes(){return Object.keys(t.getInstance().managers)}};function w0(t){if(t.indexOf(jd)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${ki.getSchemes().join(",")}`);return{scheme:t.split(jd)[0],path:t.split(jd)[1]}}function zL(t,n,e=!1){return B(this,null,function*(){_(t!==n,()=>`Old path and new path are the same: '${t}'`);let r=_n.getLoadHandlers(t);_(r.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),_(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`);let o=r[0],i=_n.getSaveHandlers(n);_(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${n}.`),_(i.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${n}.`);let s=i[0],a=w0(t).scheme,l=w0(t).path,u=a===w0(t).scheme,c=yield o.load();e&&u&&(yield ki.getManager(a).removeModel(l));let p=yield s.save(c);return e&&!u&&(yield ki.getManager(a).removeModel(l)),p.modelArtifactsInfo})}function UL(){return B(this,null,function*(){let t=ki.getSchemes(),n={};for(let e of t){let r=yield ki.getManager(e).listModels();for(let o in r){let i=e+jd+o;n[i]=r[o]}}return n})}function GL(t){return B(this,null,function*(){let n=w0(t);return ki.getManager(n.scheme).removeModel(n.path)})}function WL(t,n){return B(this,null,function*(){return zL(t,n,!1)})}function HL(t,n){return B(this,null,function*(){return zL(t,n,!0)})}var sD=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(n,e){return fetch(n,e)}now(){return performance.now()}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)}decode(n,e){return new TextDecoder(e).decode(n)}setTimeoutCustom(n,e){if(typeof window>"u"||!P().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(n,e);return}this.functionRefs.push(n),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},e),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",r=>{if(r.source===window&&r.data.name===this.messageName){r.stopPropagation();let o=this.functionRefs[r.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(n){return i0(n)}};if(P().get("IS_BROWSER")){P().setPlatform("browser",new sD);try{ki.registerManager(op.URL_SCHEME,new b0)}catch{}try{ki.registerManager(rp.URL_SCHEME,new v0)}catch{}}var Gse={importFetch:()=>qL()},aD;var lD=class{constructor(){this.util=KL(),this.textEncoder=new this.util.TextEncoder}fetch(n,e){return P().global.fetch!=null?P().global.fetch(n,e):(aD==null&&(aD=Gse.importFetch()),aD(n,e))}now(){let n=process.hrtime();return n[0]*1e3+n[1]/1e6}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(n)}decode(n,e){return n.length===0?"":new this.util.TextDecoder(e).decode(n)}isTypedArray(n){return this.util.types.isFloat32Array(n)||this.util.types.isInt32Array(n)||this.util.types.isUint8Array(n)||this.util.types.isUint8ClampedArray(n)}};P().get("IS_NODE")&&!P().get("IS_BROWSER")&&P().setPlatform("node",new lD);function ve(t,n="float32",e){return n=n||"float32",Ln(t),new mt(t,n,e)}function Wse(t,n){let e=I(t,"x","cast");if(!ON(n))throw new Error(`Failed to cast to unknown dtype ${n}`);if(n==="string"&&e.dtype!=="string"||n!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:e},o={dtype:n};return E.runKernel(os,r,o)}var J=T({cast_:Wse});function Hse(t){let e={x:I(t,"x","clone","string_or_numeric")};return E.runKernel(is,e)}var ro=T({clone_:Hse});function XL(t,n=!1){console.log(t.toString(n))}YN();var jse={buffer:ve,cast:J,clone:ro,print:XL};dL(jse);function qse(t,n){let e=I(t,"a","add"),r=I(n,"b","add");[e,r]=Ve(e,r);let o={a:e,b:r};return E.runKernel(_i,o)}var Z=T({add_:qse});function Kse(t,n){let e=I(t,"a","floorDiv"),r=I(n,"b","floorDiv");[e,r]=Ve(e,r);let o={a:e,b:r};return E.runKernel(ua,o)}var C0=T({floorDiv_:Kse});function Xse(t,n){let e=I(t,"a","div"),r=I(n,"b","div");if([e,r]=Ve(e,r),e.dtype==="int32"&&r.dtype==="int32")return C0(e,r);let o={a:e,b:r},i={};return E.runKernel(ra,o,i)}var se=T({div_:Xse});function Yse(t,n){let e=I(t,"a","mul"),r=I(n,"b","mul");[e,r]=Ve(e,r);let o={a:e,b:r};return E.runKernel(va,o)}var R=T({mul_:Yse});function Zse(t){let n=I(t,"x","abs");if(n.dtype==="complex64"){let e={x:n};return E.runKernel(jl,e)}else{let e={x:n};return E.runKernel(Vl,e)}}var cn=T({abs_:Zse});function Qse(t){let e={x:I(t,"x","acos")};return E.runKernel(js,e)}var uD=T({acos_:Qse});function Jse(t){let e={x:I(t,"x","acosh")};return E.runKernel(qs,e)}var cD=T({acosh_:Jse});function eae(t,n=null,e=!1){let o={x:I(t,"x","all","bool")},i={axis:n,keepDims:e};return E.runKernel(ed,o,i)}var Fg=T({all_:eae});function tae(t,n=null,e=!1){let o={x:I(t,"x","any","bool")},i={axis:n,keepDims:e};return E.runKernel(td,o,i)}var Kd=T({any_:tae});function nae(t,n=0){let r={x:I(t,"x","argMax")},o={axis:n};return E.runKernel(Bl,r,o)}var za=T({argMax_:nae});function rae(t,n=0){let r={x:I(t,"x","argMin")},o={axis:n};return E.runKernel(zl,r,o)}var YL=T({argMin_:rae});function oae(t){let e={x:I(t,"x","asin")};return E.runKernel(Ks,e)}var pD=T({asin_:oae});function iae(t){let e={x:I(t,"x","asinh")};return E.runKernel(Xs,e)}var fD=T({asinh_:iae});function sae(t){let e={x:I(t,"x","atan")};return E.runKernel(Ys,e)}var dD=T({atan_:sae});function aae(t,n){let e=I(t,"a","atan2"),r=I(n,"b","atan2");[e,r]=Ve(e,r);let o={a:e,b:r};return E.runKernel(Qs,o)}var ZL=T({atan2_:aae});function lae(t){let e={x:I(t,"x","atanh")};return E.runKernel(Zs,e)}var hD=T({atanh_:lae});function uae(t,n,e,r,o="NHWC",i){let s=t[3],a=[...n,s],l=JL(o);return sp(t,a,e,i,r,null,null,l)}function gD(t,n,e,r,o,i,s="channelsLast"){let[a,l]=$g(n),u;if(s==="channelsLast")u=[a,l,t[3],t[3]];else if(s==="channelsFirst")u=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return sp(t,u,e,r,o,i,!1,s)}function cae(t,n,e,r,o,i,s="NDHWC"){let[a,l,u]=mD(n),c,p;if(s==="NDHWC")p="channelsLast",c=[a,l,u,t[4],t[4]];else if(s==="NCDHW")p="channelsFirst",c=[a,l,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return QL(t,c,e,r,o,!1,p,i)}function sp(t,n,e,r,o,i,s=!1,a="channelsLast"){let[l,u,c,p]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,c,p]=t;else if(a==="channelsFirst")[l,p,u,c]=t;else throw new Error(`Unknown dataFormat ${a}`);let[f,d,,h]=n,[m,g]=$g(e),[y,x]=$g(r),b=Xd(f,y),w=Xd(d,x),{padInfo:C,outHeight:N,outWidth:D}=dae(o,u,c,m,g,b,w,i,a),k=s?h*p:h,O;return a==="channelsFirst"?O=[l,k,N,D]:a==="channelsLast"&&(O=[l,N,D,k]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:p,outHeight:N,outWidth:D,outChannels:k,padInfo:C,strideHeight:m,strideWidth:g,filterHeight:f,filterWidth:d,effectiveFilterHeight:b,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:x,inShape:t,outShape:O,filterShape:n}}function QL(t,n,e,r,o,i=!1,s="channelsLast",a){let[l,u,c,p,f]=[-1,-1,-1,-1,-1];if(s==="channelsLast")[l,u,c,p,f]=t;else if(s==="channelsFirst")[l,f,u,c,p]=t;else throw new Error(`Unknown dataFormat ${s}`);let[d,h,m,,g]=n,[y,x,b]=mD(e),[w,C,N]=mD(r),D=Xd(d,w),k=Xd(h,C),O=Xd(m,N),{padInfo:$,outDepth:V,outHeight:G,outWidth:W}=hae(o,u,c,p,y,x,b,D,k,O,a),H=i?g*f:g,j;return s==="channelsFirst"?j=[l,H,V,G,W]:s==="channelsLast"&&(j=[l,V,G,W,H]),{batchSize:l,dataFormat:s,inDepth:u,inHeight:c,inWidth:p,inChannels:f,outDepth:V,outHeight:G,outWidth:W,outChannels:H,padInfo:$,strideDepth:y,strideHeight:x,strideWidth:b,filterDepth:d,filterHeight:h,filterWidth:m,effectiveFilterDepth:D,effectiveFilterHeight:k,effectiveFilterWidth:O,dilationDepth:w,dilationHeight:C,dilationWidth:N,inShape:t,outShape:j,filterShape:n}}function pae(t,n,e,r,o){r==null&&(r=yD(t,n,e));let i=t[0],s=t[1],a=Pg((i-n+2*r)/e+1,o),l=Pg((s-n+2*r)/e+1,o);return[a,l]}function fae(t,n,e,r,o,i){o==null&&(o=yD(t,n[0],r[0]));let s=[0,0,0,e];for(let a=0;a<3;a++)t[a]+2*o>=n[a]&&(s[a]=Pg((t[a]-n[a]+2*o)/r[a]+1,i));return s}function yD(t,n,e,r=1){let o=Xd(n,r);return Math.floor((t[0]*(e-1)-e+o)/2)}function $g(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function mD(t){return typeof t=="number"?[t,t,t]:t}function Xd(t,n){return n<=1?t:t+(t-1)*(n-1)}function dae(t,n,e,r,o,i,s,a,l){let u,c,p;if(typeof t=="number"){u={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};let d=pae([n,e],i,r,t,a);c=d[0],p=d[1]}else if(t==="same"){c=Math.ceil(n/r),p=Math.ceil(e/o);let f=Math.max(0,(c-1)*r+i-n),d=Math.max(0,(p-1)*o+s-e),h=Math.floor(f/2),m=f-h,g=Math.floor(d/2),y=d-g;u={top:h,bottom:m,left:g,right:y,type:"SAME"}}else if(t==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((n-i+1)/r),p=Math.ceil((e-s+1)/o);else if(typeof t=="object"){let f=l==="channelsLast"?t[1][0]:t[2][0],d=l==="channelsLast"?t[1][1]:t[2][1],h=l==="channelsLast"?t[2][0]:t[3][0],m=l==="channelsLast"?t[2][1]:t[3][1];u={top:f,bottom:d,left:h,right:m,type:f===0&&d===0&&h===0&&m===0?"VALID":"EXPLICIT"},c=Pg((n-i+f+d)/r+1,a),p=Pg((e-s+h+m)/o+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outHeight:c,outWidth:p}}function hae(t,n,e,r,o,i,s,a,l,u,c){let p,f,d,h;if(t==="valid"&&(t=0),typeof t=="number"){p={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};let g=fae([n,e,r,1],[a,l,u],1,[o,i,s],t,c);f=g[0],d=g[1],h=g[2]}else if(t==="same"){f=Math.ceil(n/o),d=Math.ceil(e/i),h=Math.ceil(r/s);let m=(f-1)*o+a-n,g=(d-1)*i+l-e,y=(h-1)*s+u-r,x=Math.floor(m/2),b=m-x,w=Math.floor(g/2),C=g-w,N=Math.floor(y/2),D=y-N;p={top:w,bottom:C,left:N,right:D,front:x,back:b,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:p,outDepth:f,outHeight:d,outWidth:h}}function Pg(t,n){if(!n)return Math.trunc(t);switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${n}`)}}function Do(t){let[n,e,r]=$g(t);return n===1&&e===1&&r===1}function Bn(t,n){return Do(t)||Do(n)}function cs(t){return $g(t).every(n=>n>0)}function JL(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function It(t,n,e){if(e!=null){if(typeof n=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${e} but got pad ${n}.`);if(typeof n=="number")_(Hs(n),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${e} but got pad ${n}.`);else if(typeof n=="object")n.forEach(r=>{r.forEach(o=>{_(Hs(o),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${e} but got pad ${o}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${n}`)}}function mae(t,n){let r={x:I(t,"x","reshape","string_or_numeric")},o={shape:n};return E.runKernel(xu,r,o)}var M=T({reshape_:mae});function gae(t,n,e,r,o){let i=I(t,"x","avgPool","float32"),s=1;_(Bn(e,s),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=M(i,[1,i.shape[0],i.shape[1],i.shape[2]])),_(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),It("avgPool",r,o);let u={x:a},c={filterSize:n,strides:e,pad:r,dimRoundingMode:o},p=E.runKernel(Ul,u,c);return p=J(p,i.dtype),l?M(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var ap=T({avgPool_:gae});function yae(t,n,e,r,o,i="NDHWC"){let s=I(t,"x","avgPool3d","float32"),a=s,l=!1;s.rank===4&&(l=!0,a=M(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),_(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),_(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),_(typeof e=="number"&&e>0||Array.isArray(e)&&e[0]>0&&e[1]>0&&e[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${e}'`),It("avgPool3d",r,o);let u={x:a},c={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},p=E.runKernel(Gl,u,c);return p=J(p,a.dtype),l?M(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var xD=T({avgPool3d_:yae});function xae(t,n=0){_(t.length>=1,()=>"Pass at least one tensor to concat");let e=h0(t,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),e.length===1)return ro(e[0]);let r=e,o={axis:n};return E.runKernel(ql,r,o)}var Dt=T({concat_:xae});function vae(t,n,e=!1,r=!1){let o=I(t,"a","matMul"),i=I(n,"b","matMul");[o,i]=Ve(o,i);let s={a:o,b:i},a={transposeA:e,transposeB:r};return E.runKernel(Wl,s,a)}var it=T({matMul_:vae});function bae(t){let e={x:I(t,"x","sigmoid","float32")};return E.runKernel(ka,e)}var ei=T({sigmoid_:bae});function wae(t,n,e){let r=I(t,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let o={x:r},i={begin:n,size:e};return E.runKernel(Su,o,i)}var qe=T({slice_:wae});function Cae(t){let e={x:I(t,"x","tanh","float32")};return E.runKernel($a,e)}var lp=T({tanh_:Cae});function Sae(t,n,e){let r=I(t,"x","batchToSpaceND"),o=n.reduce((a,l)=>a*l);_(r.rank>=1+n.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${n.length}`),_(e.length===n.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${n.length}`),_(r.shape[0]%o===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${n.join(" * ")} === ${o}`);let i={x:r},s={blockShape:n,crops:e};return E.runKernel(Hl,i,s)}var Yd=T({batchToSpaceND_:Sae});function eV(t){let n;return t.rank===0||t.rank===1?n=M(t,[1,1,1,t.size]):t.rank===2?n=M(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?n=M(t,[1,t.shape[0],t.shape[1],t.shape[2]]):n=t,n}function Iae(t,n,e,r,o,i){i==null&&(i=.001);let s=I(t,"x","batchNorm"),a=I(n,"mean","batchNorm"),l=I(e,"variance","batchNorm"),u;o!=null&&(u=I(o,"scale","batchNorm"));let c;r!=null&&(c=I(r,"offset","batchNorm")),_(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),_(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),_(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let f={x:eV(s),scale:u,offset:c,mean:a,variance:l},d={varianceEpsilon:i},h=E.runKernel(tu,f,d);return M(h,s.shape)}var Pu=T({batchNorm_:Iae});function Eae(t,n,e,r,o,i){let s=I(t,"x","batchNorm"),a=I(n,"mean","batchNorm"),l=I(e,"variance","batchNorm"),u;o!=null&&(u=I(o,"scale","batchNorm"));let c;return r!=null&&(c=I(r,"offset","batchNorm")),_(s.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`),_(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),_(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&_(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&_(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),Pu(s,a,l,c,u,i)}var vD=T({batchNorm2d_:Eae});function Tae(t,n,e,r,o,i){let s=I(t,"x","batchNorm"),a=I(n,"mean","batchNorm"),l=I(e,"variance","batchNorm"),u;o!=null&&(u=I(o,"scale","batchNorm"));let c;return r!=null&&(c=I(r,"offset","batchNorm")),_(s.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`),_(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),_(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&_(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&_(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),Pu(s,a,l,c,u,i)}var bD=T({batchNorm3d_:Tae});function _ae(t,n,e,r,o,i){let s=I(t,"x","batchNorm"),a=I(n,"mean","batchNorm"),l=I(e,"variance","batchNorm"),u;o!=null&&(u=I(o,"scale","batchNorm"));let c;return r!=null&&(c=I(r,"offset","batchNorm")),_(s.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`),_(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),_(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&_(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&_(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),Pu(s,a,l,c,u,i)}var wD=T({batchNorm4d_:_ae});function Nae(t,n,e){let r=I(t,"x","bincount"),o=I(n,"weights","bincount");_(r.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${r.dtype}`),_(e>=0,()=>`size must be non-negative, but got ${e}.`),_(o.size===r.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${r.shape}, weights shape: ${o.shape}.`);let i={x:r,weights:o},s={size:e};return E.runKernel(od,i,s)}var tV=T({bincount_:Nae});function Dae(t,n){let e=I(t,"broadcastTo","x"),r=e.shape;if(Ln(n),n.length<e.rank)throw new Error(`broadcastTo(): shape.length=${n.length} < input.rank=${e.rank}.`);if(n.length>e.rank){let u=e.shape.slice();for(;u.length<n.length;)u.unshift(1);e=M(e,u)}let o=e.shape,i=Array.from(n);for(let u=n.length-1;u>=0;u--)if(o[u]===n[u])i[u]=1;else if(e.shape[u]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${n}].`);if(i.map((u,c)=>u>1?c:-1).filter(u=>u>=0).length===0)return ro(e);let a={x:e},l={reps:i};return E.runKernel(ss,a,l)}var Ua=T({broadcastTo_:Dae});function kae(t){let e={x:I(t,"x","ceil","float32")};return E.runKernel(Js,e)}var CD=T({ceil_:kae});function Ga(t,n,e){Ln(t),e=e||Ll(n);let r={shape:t,value:n,dtype:e};return E.runKernel(xd,{},r)}function Aae(t,n,e){let r=I(t,"x","clipByValue");if(_(n<=e,()=>`Error in clip: min (${n}) must be less than or equal to max (${e}).`),n===e)return Ga(r.shape,n,r.dtype);let o={x:r},i={clipValueMin:n,clipValueMax:e};return E.runKernel(ea,o,i)}var zn=T({clipByValue_:Aae});function Rae(t){return Dt(t,0)}var SD=T({concat1d_:Rae});function Mae(t,n){return Dt(t,n)}var ID=T({concat2d_:Mae});function Oae(t,n){return Dt(t,n)}var ED=T({concat3d_:Oae});function Fae(t,n){return Dt(t,n)}var TD=T({concat4d_:Fae});function $ae(t,n,e,r,o="NHWC",i=[1,1],s){let a=I(t,"x","conv2d","float32"),l=I(n,"filter","conv2d","float32"),u=a,c=!1;a.rank===3&&(c=!0,u=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),_(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),_(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),It("conv2d",r,s);let p=o==="NHWC"?u.shape[3]:u.shape[1];_(p===l.shape[2],()=>`Error in conv2d: depth of input (${p}) must match input depth for filter ${l.shape[2]}.`),_(Bn(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),_(cs(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),_(cs(e),()=>"Error in conv2D: Strides should be larger than 0.");let f={x:u,filter:l},d={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},h=E.runKernel(Kl,f,d);return c?M(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var oo=T({conv2d_:$ae});function Pae(t,n,e,r,o="NWC",i=1,s){let a=I(t,"x","conv1d"),l=I(n,"filter","conv1d"),u=a,c=!1;a.rank===2&&(c=!0,u=M(a,[1,a.shape[0],a.shape[1]])),_(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),_(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),It("conv1d",r,s),_(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),_(Bn(e,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${i}'`),_(cs(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),_(cs(e),()=>"Error in conv1D: Stride should be larger than 0."),_(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let p=M(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=M(u,[u.shape[0],1,u.shape[1],u.shape[2]]),g=oo(f,p,[1,e],r,"NHWC",[1,i],s);return c?M(g,[g.shape[2],g.shape[3]]):M(g,[g.shape[0],g.shape[2],g.shape[3]])}var Lg=T({conv1d_:Pae});function Lae(t,n,e,r,o,i="NHWC",s){_(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let a=t,l=n,u=!1;n.rank===3&&(u=!0,l=M(n,[1,n.shape[0],n.shape[1],n.shape[2]]),a=[1,t[0],t[1],t[2]]),_(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),_(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),_(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);let c=i==="NHWC"?a[3]:a[1],p=i==="NHWC"?l.shape[3]:l.shape[1];_(c===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${e.shape[2]}.`),_(p===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${p}) must match output depth for filter ${e.shape[3]}.`),It("conv2dDerInput",o,s);let f={dy:l,filter:e},d={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,inputShape:a},h=E.runKernel(Xl,f,d);return u?M(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var Zd=T({conv2DBackpropInput_:Lae});function Vae(t,n,e,r,o,i){let s=I(t,"x","conv2dTranspose"),a=I(n,"filter","conv2dTranspose");return Zd(e,s,a,r,o,"NHWC",i)}var Vg=T({conv2dTranspose_:Vae});function Bae(t,n,e,r,o="NDHWC",i=[1,1,1]){let s=I(t,"x","conv3d"),a=I(n,"filter","conv3d"),l=s,u=!1;s.rank===4&&(u=!0,l=M(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),_(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),_(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),_(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),_(Bn(e,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),_(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`),_(cs(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),_(cs(e),()=>"Error in conv3D: Strides should be larger than 0.");let c={x:l,filter:a},p={strides:e,pad:r,dataFormat:o,dilations:i},f=E.runKernel(Yl,c,p);return u?M(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var _D=T({conv3d_:Bae});function zae(t,n,e,r,o){_(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let i=t,s=n,a=!1;n.rank===4&&(a=!0,s=M(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);let l=i[4],u=s.shape[4];_(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),_(s.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`),_(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),_(l===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${e.shape[3]}.`),_(u===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${e.shape[4]}.`);let c={dy:s,filter:e},p={pad:o,strides:r,inputShape:i},f=E.runKernel(ld,c,p);return a?M(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var S0=T({conv3DBackpropInput_:zae});function Uae(t,n,e,r,o){let i=I(t,"x","conv3dTranspose"),s=I(n,"filter","conv3dTranspose");return S0(e,i,s,r,o)}var ND=T({conv3dTranspose_:Uae});function Gae(t){let e={x:I(t,"x","cos","float32")};return E.runKernel(ta,e)}var up=T({cos_:Gae});function Wae(t){let e={x:I(t,"x","cosh","float32")};return E.runKernel(na,e)}var Bg=T({cosh_:Wae});function Hae(t,n=0,e=!1,r=!1){let i={x:I(t,"x","cumprod")},s={axis:n,exclusive:e,reverse:r};return E.runKernel(ud,i,s)}var zg=T({cumprod_:Hae});function jae(t,n=0,e=!1,r=!1){let i={x:I(t,"x","cumsum")},s={axis:n,exclusive:e,reverse:r};return E.runKernel(Zl,i,s)}var I0=T({cumsum_:jae});function qae(t,n,e,r=!1){let o=I(t,"x","denseBincount"),i=I(n,"weights","denseBincount");_(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),_(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),_(e>=0,()=>`size must be non-negative, but got ${e}.`),_(i.size===o.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${i.shape}.`);let s={x:o,weights:i},a={size:e,binaryOutput:r};return E.runKernel(pd,s,a)}var E0=T({denseBincount_:qae});function Kae(t,n,e="NHWC"){let r=I(t,"x","depthToSpace","float32"),o=e==="NHWC"?r.shape[1]:r.shape[2],i=e==="NHWC"?r.shape[2]:r.shape[3],s=e==="NHWC"?r.shape[3]:r.shape[1];_(n>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${n}`),_(o*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${n}  for depthToSpace with input shape
    ${r.shape}`),_(i*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${n} for depthToSpace with input shape
        ${r.shape}`),_(s%(n*n)===0,()=>`Dimension size must be evenly divisible by ${n*n} but is ${s} for depthToSpace with input shape ${r.shape}`);let a={x:r},l={blockSize:n,dataFormat:e};return E.runKernel(fd,a,l)}var nV=T({depthToSpace_:Kae});function Xae(t,n,e,r,o="NHWC",i=[1,1],s){let a=I(t,"x","depthwiseConv2d","float32"),l=I(n,"filter","depthwiseConv2d","float32"),u=a,c=!1;a.rank===3&&(c=!0,u=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),_(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),_(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);let p=o==="NHWC"?u.shape[3]:u.shape[1];_(p===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${p}) must match the inChannels dimension in filter ${l.shape[2]}.`),It("depthwiseConv2d",r,s);let f={x:u,filter:l},d={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},h=E.runKernel(Ql,f,d);return c?M(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var Wa=T({depthwiseConv2d_:Xae});function Yae(t,n,e,r,o=[1,1],i="NHWC"){let s=I(t,"x","dilation2d"),a=I(n,"filter","dilation2d");_(s.rank===3||s.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`),_(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),_(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=s,u=!1;s.rank===3&&(l=M(s,[1,s.shape[0],s.shape[1],s.shape[2]]),u=!0),_(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);let c={x:l,filter:a},p={strides:e,pad:r,dilations:o},f=E.runKernel(Jl,c,p);return u?M(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var rV=T({dilation2d_:Yae});var io={};Po(io,{assertAndGetBroadcastShape:()=>Re,getBroadcastDims:()=>oV,getReductionAxes:()=>bt});function oV(t,n){let e=t.length,r=[];for(let o=0;o<e;o++){let i=e-1-o,s=t[i]||1;(n[n.length-1-o]||1)>1&&s===1&&r.unshift(i)}return r}function bt(t,n){let e=[];for(let r=0;r<n.length;r++){let o=t[t.length-r-1],i=n.length-r-1,s=n[i];(o==null||o===1&&s>1)&&e.unshift(i)}return e}function Re(t,n){let e=Math.max(t.length,n.length),r=new Array(e);for(let o=0;o<e;o++){let i=t[t.length-o-1];i==null&&(i=1);let s=n[n.length-o-1];if(s==null&&(s=1),i===1)r[e-o-1]=s;else if(s===1)r[e-o-1]=i;else if(i!==s){let a=`Operands could not be broadcast together with shapes ${t} and ${n}.`;throw Error(a)}else r[e-o-1]=i}return r}function Zae(t,n){let e=I(t,"a","equal","string_or_numeric"),r=I(n,"b","equal","string_or_numeric");[e,r]=Ve(e,r),Re(e.shape,r.shape);let o={a:e,b:r};return E.runKernel(Lc,o)}var Cr=T({equal_:Zae});function Qae(t,n,e){let r=I(n,"a","where"),o=I(e,"b","where"),i=I(t,"condition","where","bool"),s=Re(Re(i.shape,r.shape),o.shape),a=Ua(i,s),l=Ua(r,s),u=Ua(o,s),c={condition:a,t:l,e:u};return E.runKernel(Cu,c)}var kt=T({where_:Qae});function Jae(t){let e={x:I(t,"x","zerosLike")};return E.runKernel(ku,e)}var be=T({zerosLike_:Jae});function ele(t,n){let e=I(t,"a","div"),r=I(n,"b","div");[e,r]=Ve(e,r);let o=se(e,r),i=be(o),s=Cr(r,i);return kt(s,i,o)}var iV=T({divNoNan_:ele});function tle(t,n){let e=I(t,"t1","dot"),r=I(n,"t2","dot");_((e.rank===1||e.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${r.rank}.`);let o=e.rank===1?e.size:e.shape[1],i=r.rank===1?r.size:r.shape[0];if(_(o===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${i}.`),e.rank===1&&r.rank===1){let s=M(e,[1,-1]),a=M(r,[-1,1]),l=it(s,a);return M(l,[])}else if(e.rank===1&&r.rank===2){let s=M(e,[1,-1]),a=M(r,[r.shape[0],r.shape[1]]),l=it(s,a);return M(l,[l.size])}else if(e.rank===2&&r.rank===1){let s=M(r,[-1,1]),a=it(e,s);return M(a,[a.size])}else{let s=M(r,[r.shape[0],r.shape[1]]);return it(e,s)}}var sV=T({dot_:tle});function nle(t,...n){let e=n.map((o,i)=>I(o,`tensors${i}`,"einsum")),r={equation:t};return E.runKernel(md,e,r)}var Qd=T({einsum_:nle});function rle(t){let e={x:I(t,"x","elu","float32")};return E.runKernel(oa,e)}var Ha=T({elu_:rle});function ole(t){let n=I(t,"x","erf");_(n.dtype==="int32"||n.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),n.dtype==="int32"&&(n=J(n,"float32"));let e={x:n};return E.runKernel(ia,e)}var Ug=T({erf_:ole});function DD(t,n){for(let e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function aV(t,n,e){let r=t.length+n.length,o=[],i=0,s=0;for(let a=0;a<r;a++)e.indexOf(a)===-1?o.push(t[i++]):o.push(n[s++]);return o}function kD(t,n){let e=[],r=t.length;for(let i=0;i<r;i++)n.indexOf(i)===-1&&e.push(t[i]);let o=n.map(i=>t[i]);return[e,o]}function ps(t,n){let e=n.map(r=>1);return aV(t,e,n)}function ile(t,n,e){_(DD(n,e),()=>`${t} supports only inner-most axes for now. Got axes ${n} and rank-${e} input.`)}function AD(t,n){if(DD(t,n))return null;let e=[];for(let r=0;r<n;++r)t.indexOf(r)===-1&&e.push(r);return t.forEach(r=>e.push(r)),e}function Gg(t){return t.map((n,e)=>[e,n]).sort((n,e)=>n[1]-e[1]).map(n=>n[0])}function sle(t,n){let e=[];for(let r=n-t;r<n;++r)e.push(r);return e}function ale(t,n=null,e=!1){let o={x:I(t,"x","max")},i={reductionIndices:n,keepDims:e};return E.runKernel(iu,o,i)}var Un=T({max_:ale});function lle(t,n=null,e=!1){let o={x:I(t,"x","min")},i={axis:n,keepDims:e};return E.runKernel(uu,o,i)}var Lu=T({min_:lle});function ule(t,n){let e=I(t,"base","pow"),r=I(n,"exp","pow");[e,r]=Ve(e,r);let o={a:e,b:r};return E.runKernel(ba,o)}var $r=T({pow_:ule});function Se(t,n){if((lr(t)&&n!=="string"||Array.isArray(t))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&lr(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ou(t,[],[],n)}function cle(t){let e={x:I(t,"x","sqrt","float32")};return E.runKernel(Ra,e)}var wt=T({sqrt_:cle});function ple(t){let n=I(t,"x","square"),e={};return E.runKernel("Square",{x:n},e)}var Le=T({square_:ple});function fle(t,n=null,e=!1){let r=I(t,"x","sum");r.dtype==="bool"&&(r=J(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return E.runKernel(Iu,o,i)}var ue=T({sum_:fle});function dle(t,n="euclidean",e=null,r=!1){t=I(t,"x","norm");let o=lV(t,n,e),i=o.shape;if(r){let s=hn(e,t.shape);i=ps(o.shape,s)}return M(o,i)}function lV(t,n,e=null){if(t.rank===0)return cn(t);if(t.rank!==1&&e===null)return lV(M(t,[-1]),n,e);if(t.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(n===1)return ue(cn(t),e);if(n===1/0)return Un(cn(t),e);if(n===-1/0)return Lu(cn(t),e);if(n==="euclidean"||n===2)return wt(ue($r(cn(t),Se(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}if(Array.isArray(e)&&e.length===2){if(n===1)return Un(ue(cn(t),e[0]),e[1]-1);if(n===1/0)return Un(ue(cn(t),e[1]),e[0]);if(n===-1/0)return Lu(ue(cn(t),e[1]),e[0]);if(n==="fro"||n==="euclidean")return wt(ue(Le(t),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}var Vu=T({norm_:dle});function hle(t,n=null,e=!1){return Vu(t,"euclidean",n,e)}var uV=T({euclideanNorm_:hle});function mle(t){let e={x:I(t,"x","exp")};return E.runKernel(sa,e)}var Nn=T({exp_:mle});function gle(t,n=0){let e=I(t,"x","expandDims","string_or_numeric");_(n<=e.rank,()=>"Axis must be <= rank of the tensor");let r={input:e},o={dim:n};return E.runKernel(eu,r,o)}var sn=T({expandDims_:gle});function yle(t){let e={x:I(t,"x","expm1")};return E.runKernel(aa,e)}var MD=T({expm1_:yle});function xle(t,n){let e=I(t,"x","tile","string_or_numeric");_(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${n}.`);let r={x:e},o={reps:n};return E.runKernel(ss,r,o)}var er=T({tile_:xle});function vle(t,n,e,r="float32"){n==null&&(n=t);let o=ve([t,n],r),i=t<=n?t:n;for(let a=0;a<i;++a)o.set(1,a,a);let s=M(o.toTensor(),[t,n]);if(e==null)return s;if(e.length===1)return er(sn(s,0),[e[0],1,1]);if(e.length===2)return er(sn(sn(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return er(sn(sn(sn(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}var Jd=T({eye_:vle});function ble(t){let e={x:I(t,"x","floor","float32")};return E.runKernel(la,e)}var ja=T({floor_:ble});function wle(t,n,e=0,r=0){let o=I(t,"x","gather"),i=I(n,"indices","gather","int32"),s={x:o,indices:i},a={axis:e,batchDims:r};return E.runKernel(nu,s,a)}var cp=T({gather_:wle});function Cle(t,n){let e=I(t,"a","greater","string_or_numeric"),r=I(n,"b","greater","string_or_numeric");[e,r]=Ve(e,r),Re(e.shape,r.shape);let o={a:e,b:r};return E.runKernel(Vc,o)}var Zt=T({greater_:Cle});function Sle(t,n){let e=I(t,"a","greaterEqual","string_or_numeric"),r=I(n,"b","greaterEqual","string_or_numeric");[e,r]=Ve(e,r),Re(e.shape,r.shape);let o={a:e,b:r};return E.runKernel(ca,o)}var Pr=T({greaterEqual_:Sle});function Ile(t){let e={input:I(t,"input","imag")};return E.runKernel(wd,e)}var eh=T({imag_:Ile});function Ele(t){let e={x:I(t,"x","isFinite")};return E.runKernel(pa,e)}var OD=T({isFinite_:Ele});function Tle(t){let e={x:I(t,"x","isInf")};return E.runKernel(fa,e)}var FD=T({isInf_:Tle});function _le(t){let e={x:I(t,"x","isNaN")};return E.runKernel(da,e)}var $D=T({isNaN_:_le});function Nle(t,n=.2){let r={x:I(t,"x","leakyRelu")},o={alpha:n};return E.runKernel(ru,r,o)}var pp=T({leakyRelu_:Nle});function Dle(t,n){let e=I(t,"a","less","string_or_numeric"),r=I(n,"b","less","string_or_numeric");[e,r]=Ve(e,r),Re(e.shape,r.shape);let o={a:e,b:r};return E.runKernel(Bc,o)}var fp=T({less_:Dle});function kle(t,n){let e=I(t,"a","lessEqual","string_or_numeric"),r=I(n,"b","lessEqual","string_or_numeric");[e,r]=Ve(e,r),Re(e.shape,r.shape);let o={a:e,b:r};return E.runKernel(zc,o)}var ti=T({lessEqual_:kle});function Ale(t,n=5,e=1,r=1,o=.5){let i=I(t,"x","localResponseNormalization");_(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),_(Hs(n),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${n}.`);let s=i,a=!1;i.rank===3&&(a=!0,s=M(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let l={x:s},u={depthRadius:n,bias:e,alpha:r,beta:o},c=E.runKernel(ou,l,u);return a?M(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var cV=T({localResponseNormalization_:Ale});function Rle(t){let e={x:I(t,"x","log","float32")};return E.runKernel(ha,e)}var Sr=T({log_:Rle});function Mle(t){let e={x:I(t,"x","log1p")};return E.runKernel(ma,e)}var Wg=T({log1p_:Mle});function PD(t,n){_(Yf(t),()=>"The f passed in variableGrads(f) must be a function"),_(n==null||Array.isArray(n)&&n.every(u=>u instanceof La),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let e=n!=null;if(!e){n=[];for(let u in E.registeredVariables)n.push(E.registeredVariables[u])}let r=e?n.filter(u=>!u.trainable):null,o=n.length;n=n.filter(u=>u.trainable),_(n.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let i=!0,{value:s,grads:a}=E.gradients(t,n,null,i);_(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),_(s.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);let l={};return n.forEach((u,c)=>{a[c]!=null&&(l[u.name]=a[c])}),r?.forEach(u=>l[u.name]=null),{value:s,grads:l}}function Ao(t){return E.customGrad(t)}function Ole(t){let e={x:I(t,"x","neg")};return E.runKernel(pu,e)}var Qe=T({neg_:Ole});function Fle(t){let e={x:I(t,"x","softplus")};return E.runKernel(Aa,e)}var fs=T({softplus_:Fle});function $le(t){let n=I(t,"x","logSigmoid");return Ao(r=>({value:Qe(fs(Qe(r))),gradFunc:s=>R(s,ei(Qe(r)))}))(n)}var LD=T({logSigmoid_:$le});function Ple(t,n){let e=I(t,"a","sub"),r=I(n,"b","sub");[e,r]=Ve(e,r);let o={a:e,b:r};return E.runKernel(Oa,o)}var pe=T({sub_:Ple});function Lle(t,n=-1){let e=I(t,"logits","logSoftmax");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${n}`);return Ao((o,i)=>{let a=Un(o,n,!0),l=pe(o,a),u=pe(J(l,"float32"),Sr(ue(Nn(l),n,!0)));return i([u]),{value:u,gradFunc:(p,f)=>{let[d]=f,h=!0,m=Nn(d);return pe(p,R(ue(p,n,h),m))}}})(e)}var Hg=T({logSoftmax_:Lle});function Vle(t,n=null,e=!1){let r=I(t,"x","logSumExp"),o=hn(n,r.shape),i=Un(r,o,!0),s=pe(r,i),a=Nn(s),l=ue(a,o),u=Sr(l),c=Z(M(i,u.shape),u);if(e){let p=ps(c.shape,o);return M(c,p)}return c}var jg=T({logSumExp_:Vle});function Ble(t,n){let e=I(t,"a","logicalAnd","bool"),r=I(n,"b","logicalAnd","bool");Re(e.shape,r.shape);let o={a:e,b:r};return E.runKernel(Uc,o)}var ur=T({logicalAnd_:Ble});function zle(t){let e={x:I(t,"x","logicalNot","bool")};return E.runKernel(Gc,e)}var th=T({logicalNot_:zle});function Ule(t,n){let e=I(t,"a","logicalOr","bool"),r=I(n,"b","logicalOr","bool");Re(e.shape,r.shape);let o={a:e,b:r};return E.runKernel(Wc,o)}var T0=T({logicalOr_:Ule});function Gle(t,n){let e=I(t,"a","logicalXor","bool"),r=I(n,"b","logicalXor","bool");return Re(e.shape,r.shape),ur(T0(t,n),th(ur(t,n)))}var pV=T({logicalXor_:Gle});function Wle(t,n,e,r,o){let i=I(t,"x","maxPool"),s=1,a=i,l=!1;i.rank===3&&(l=!0,a=M(i,[1,i.shape[0],i.shape[1],i.shape[2]])),_(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),_(Bn(e,s),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`),It("maxPool",r,o);let u={x:a},c={filterSize:n,strides:e,pad:r,dimRoundingMode:o},p=E.runKernel(su,u,c);return l?M(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var dp=T({maxPool_:Wle});function Hle(t,n=[1,1,1],e,r,o,i="NDHWC"){let s=I(t,"x","maxPool3d"),a=s,l=!1;s.rank===4&&(l=!0,a=M(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),_(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),_(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),It("maxPool3d",r,o);let u={x:a},c={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},p=E.runKernel(au,u,c);return l?M(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var VD=T({maxPool3d_:Hle});function jle(t,n){let e=I(t,"a","maximum"),r=I(n,"b","maximum");[e,r]=Ve(e,r),e.dtype==="bool"&&(e=J(e,"int32"),r=J(r,"int32")),Re(e.shape,r.shape);let o={a:e,b:r};return E.runKernel(ga,o)}var so=T({maximum_:jle});function qle(t,n=null,e=!1){let o={x:I(t,"x","mean")},i={axis:n,keepDims:e};return E.runKernel(lu,o,i)}var $t=T({mean_:qle});function At(t,n="float32"){if(Ln(t),n==="complex64"){let r=At(t,"float32"),o=At(t,"float32");return No(r,o)}let e=Qf(ot(t),n);return E.makeTensor(e,t,n)}function Ir(t,n="float32"){if(Ln(t),n==="complex64"){let r=Ir(t,"float32"),o=At(t,"float32");return No(r,o)}let e=Cg(ot(t),n);return E.makeTensor(e,t,n)}function Kle(t,n){let e=I(t,"a","minimum"),r=I(n,"b","minimum");[e,r]=Ve(e,r),e.dtype==="bool"&&(e=J(e,"int32"),r=J(r,"int32")),Re(e.shape,r.shape);let o={a:e,b:r};return E.runKernel(ya,o)}var ds=T({minimum_:Kle});function Xle(t,n,e){_(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);let r=I(t,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");_(n.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${n.length}.`);let o=e==="reflect"?1:0;for(let a=0;a<r.rank;a++)_(n[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),_(n[a][0]>=0&&n[a][0]<=r.shape[a]-o&&n[a][1]>=0&&n[a][1]<=r.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-o} or less than 0 for input of shape ${r.shape}`);let i={paddings:n,mode:e},s={x:r};return E.runKernel(cu,s,i)}var fV=T({mirrorPad_:Xle});function Yle(t,n){let e=I(t,"a","mod"),r=I(n,"b","mod");[e,r]=Ve(e,r);let o={a:e,b:r};return E.runKernel(xa,o)}var dV=T({mod_:Yle});function Zle(t,n=null,e=!1){t=I(t,"x","moments");let r=hn(n,t.shape),o=$t(t,r,e),i=o.shape;e||(i=ps(o.shape,r));let s=Le(pe(J(t,"float32"),M(o,i))),a=$t(s,r,e);return{mean:o,variance:a}}var nh=T({moments_:Zle});function Qle(t,n){let e=I(t,"a","notEqual","string_or_numeric"),r=I(n,"b","notEqual","string_or_numeric");[e,r]=Ve(e,r),Re(e.shape,r.shape);let o={a:e,b:r};return E.runKernel(Hc,o)}var Bu=T({notEqual_:Qle});function Jle(t,n,e=1,r=0,o="int32"){if(n<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${n}`);let s={indices:I(t,"indices","oneHot","int32")},a={dtype:o,depth:n,onValue:e,offValue:r};return E.runKernel(du,s,a)}var rh=T({oneHot_:Jle});function eue(t){let e={x:I(t,"x","onesLike")};return E.runKernel(fu,e)}var Dn=T({onesLike_:eue});function tue(t,n,e=0){let r=I(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:n,constantValue:e},i={x:r};return E.runKernel(mu,i,o)}var hp=T({pad_:tue});function nue(t,n,e){let r=I(t,"x","spaceToBatchND");_(r.rank>=1+n.length,()=>`input rank ${r.rank} should be > than [blockShape] ${n.length}`),_(e.length===n.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${n.length}`),_(r.shape.reduce((s,a,l)=>l>0&&l<=n.length?s&&(a+e[l-1][0]+e[l-1][1])%n[l-1]===0:s,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${n.toString()}`);let o={x:r},i={blockShape:n,paddings:e};return E.runKernel(Eu,o,i)}var oh=T({spaceToBatchND_:nue});function rue(t,n,e,r,o,i,s){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");let a=I(t,"x","maxPool"),l=a,u=!1;a.rank===3&&(u=!0,l=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),_(Bn(i,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${o}'`);let c=gD(l.shape,n,i,o,r),p=[c.dilationHeight,c.dilationWidth],f;r==="same"?f=iue([c.filterHeight,c.filterWidth],p):f=[[0,0],[0,0]];let d=p[0]===1&&p[1]===1,[h,m]=oue([c.inHeight,c.inWidth],p,f),g=d?r:"valid",y=d?l:oh(l,p,h),b=(e==="avg"?()=>ap(y,n,i,g,s):()=>dp(y,n,i,g,s))(),w=d?b:Yd(b,p,m);return u?M(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function oue(t,n,e){let r=e.map(c=>c[0]),o=e.map(c=>c[1]),i=t.concat(r,o),s=n.map((c,p)=>(c-i[p]%c)%c),a=o.map((c,p)=>c+s[p]),l=n.map((c,p)=>[r[p],a[p]]),u=n.map((c,p)=>[0,s[p]]);return[l,u]}function iue(t,n){let r=t.map((s,a)=>s+(s-1)*(n[a]-1)).map(s=>s-1),o=r.map(s=>Math.floor(s/2)),i=r.map((s,a)=>s-o[a]);return r.map((s,a)=>[o[a],i[a]])}var hV=T({pool_:rue});function sue(t,n){let e=I(t,"x","prelu"),r=I(n,"alpha","prelu"),o={x:e,alpha:r};return E.runKernel(gu,o)}var mp=T({prelu_:sue});function aue(t,n=null,e=!1){let r=I(t,"x","prod");r.dtype==="bool"&&(r=J(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return E.runKernel(yu,o,i)}var mV=T({prod_:aue});var jD=am(qg());var ih=class{constructor(n,e,r,o,i){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let s=i||Math.random();this.random=jD.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let n,e,r=!1;for(;!r;){let o,i,s;do o=2*this.random()-1,i=2*this.random()-1,s=o*o+i*i;while(s>=1||s===0);let a=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*o*a,e=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(n))&&(r=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(n)}convertValue(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)}isValidTruncated(n){return n<=this.upper&&n>=this.lower}};var N0=class{constructor(n=0,e=1,r,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=n,this.range=e-n,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${n} - ${e} <= 1 and dtype is not float`);this.random=jD.alea(o)}convertValue(n){return this.canReturnFloat()?n:Math.round(n)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function hue(t,n=0,e=1,r,o){if(Ln(t),r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let i=new ih(n,e,r,!1,o),s=ve(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var D0=T({randomNormal_:hue});function mue(t,n=0,e=1,r="float32",o){Ln(t);let i=ve(t,r),s=new N0(n,e,null,o);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var Ai=T({randomUniform_:mue});function qa(t,n,e=1,r="float32"){if(e===0)throw new Error("Cannot have a step of zero");let o={start:t,stop:n,step:e,dtype:r};return E.runKernel(Nd,{},o)}function gue(t){let e={input:I(t,"input","real")};return E.runKernel(Dd,e)}var yp=T({real_:gue});function yue(t){let e={x:I(t,"x","reciprocal")};return E.runKernel(wa,e)}var qD=T({reciprocal_:yue});function xue(t){let e={x:I(t,"x","relu")};return E.runKernel(Ca,e)}var ao=T({relu_:xue});function vue(t){let e={x:I(t,"x","relu6")};return E.runKernel(Sa,e)}var k0=T({relu6_:vue});function bue(t,n){let r={x:I(t,"x","reverse")},o={dims:n};return E.runKernel(wu,r,o)}var Ro=T({reverse_:bue});function wue(t){let e={x:I(t,"x","round")};return E.runKernel(Ia,e)}var Kg=T({round_:wue});function Cue(t){let e={x:I(t,"x","rsqrt","float32")};return E.runKernel(Ea,e)}var Xg=T({rsqrt_:Cue});function Sue(t){let e={x:I(t,"x","selu")};return E.runKernel(Ta,e)}var Yg=T({selu_:Sue});function Iue(t,n,e,r,o,i=[1,1],s="NHWC"){let a=I(t,"x","separableConv2d"),l=I(n,"depthwiseFilter","separableConv2d"),u=I(e,"pointwiseFilter","separableConv2d"),c=a,p=!1;if(a.rank===3&&(p=!0,c=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");_(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),_(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),_(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),_(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),_(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);let f=l.shape[2],d=l.shape[3];_(u.shape[2]===f*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*d}, but got ${u.shape[2]}.`);let h=Wa(c,l,r,o,s,i),g=oo(h,u,1,"valid",s);return p?M(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var Zg=T({separableConv2d_:Iue});function Eue(t){let e={x:I(t,"x","sign")};return E.runKernel(Da,e)}var KD=T({sign_:Eue});function Tue(t){let e={x:I(t,"x","sin","float32")};return E.runKernel(_a,e)}var Qg=T({sin_:Tue});function _ue(t){let e={x:I(t,"x","sinh")};return E.runKernel(Na,e)}var Jg=T({sinh_:_ue});function Nue(t,n,e){let r=I(t,"x","slice1d");return _(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),qe(r,[n],[e])}var ey=T({slice1d_:Nue});function Due(t,n,e){let r=I(t,"x","slice2d");return _(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),qe(r,n,e)}var A0=T({slice2d_:Due});function kue(t,n,e){let r=I(t,"x","slice3d");return _(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),qe(r,n,e)}var ty=T({slice3d_:kue});function Aue(t,n,e){let r=I(t,"x","slice4d");return _(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),qe(r,n,e)}var sh=T({slice4d_:Aue});function Rue(t,n=-1){let e=I(t,"logits","softmax","float32");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${n}`);let r={logits:e},o={dim:n};return E.runKernel(_u,r,o)}var xp=T({softmax_:Rue});function Mue(t){_(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);let n={input:t};return E.runKernel(yd,n)}var ny=T({fft_:Mue});function Oue(t){_(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);let n={input:t};return E.runKernel(bd,n)}var ah=T({ifft_:Oue});function Fue(t){let n=t.shape[t.shape.length-1],e=t.size/n,r;if(n<=2){let o=M(t,[e,n]);r=ah(o)}else{let o=[e,2*(n-1)],i=M(yp(t),[e,n]),s=M(eh(t),[e,n]),a=Ro(qe(i,[0,1],[e,n-2]),1),l=R(Ro(qe(s,[0,1],[e,n-2]),1),Se(-1)),u=Dt([i,a],1),c=Dt([s,l],1),p=M(No(u,c),[o[0],o[1]]);r=ah(p)}if(r=yp(r),t.rank===3&&t.shape[0]!==0){let o=r,i=t.shape[0];r=M(r,[i,r.shape[0]/i,r.shape[1]]),o.dispose()}return r}var XD=T({irfft_:Fue});function $ue(t,n,e=0){let o={x:I(t,"x","split")},i={numOrSizeSplits:n,axis:e};return E.runKernel(Tu,o,i)}var bn=T({split_:$ue});function Pue(t,n){_(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let e=t.shape[t.shape.length-1],r=t.size/e,o;if(n!=null&&n<e){let h=t.shape.map(g=>0),m=t.shape.map(g=>g);m[t.shape.length-1]=n,o=qe(t,h,m),e=n}else if(n!=null&&n>e){let h=t.shape.map(m=>m);h[t.shape.length-1]=n-e,o=Dt([t,At(h)],t.shape.length-1),e=n}else o=t;let i=be(o),s=M(No(o,i),[r,e]),a=ny(s),l=Math.floor(e/2)+1,u=yp(a),c=eh(a),p=bn(u,[l,e-l],u.shape.length-1),f=bn(c,[l,e-l],c.shape.length-1),d=o.shape.slice();return d[o.shape.length-1]=l,M(No(p[0],f[0]),d)}var YD=T({rfft_:Pue});function Lue(t,n){let e=I(t,"a","squaredDifference"),r=I(n,"b","squaredDifference");[e,r]=Ve(e,r),Re(e.shape,r.shape);let o={a:e,b:r},i={};return E.runKernel(Ma,o,i)}var RV=T({squaredDifference_:Lue});function Vue(t,n){let e=I(t,"x","squeeze","string_or_numeric");return M(e,RN(e.shape,n).newShape)}var Ri=T({squeeze_:Vue});function Bue(t,n=0){let e=h0(t,"tensors","stack","string_or_numeric");_(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&_(n<=e[0].rank,()=>"Axis must be <= rank of the tensor");let r=e,o={axis:n};return E.runKernel(hu,r,o)}var mn=T({stack_:Bue});function zue(t,n=0){let r={x:I(t,"x","step")},o={alpha:n};return E.runKernel(Pa,r,o)}var Mi=T({step_:zue});function Uue(t,n,e,r,o=0,i=0,s=0,a=0,l=0){let c={x:I(t,"x","stridedSlice","string_or_numeric")},p={begin:n,end:e,strides:r,beginMask:o,endMask:i,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};return E.runKernel(Md,c,p)}var ZD=T({stridedSlice_:Uue});function Gue(t){let e={x:I(t,"x","tan","float32")};return E.runKernel(Fa,e)}var QD=T({tan_:Gue});function an(t,n){wg(t);let e=tp(t,n);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ou(t,null,e,n)}function Lr(t,n,e){if(wg(t),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=tp(t,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ou(t,n,r,e)}function MV(t,n,e){let r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${n.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${o}.`;if(e.rank<o)throw new Error(i+` update.rank < ${o}. `);if(t.length<r+(e.rank-o))throw new Error(i+` Output shape length < ${r+(e.rank-o)}`);if(e.rank!==o+t.length-r)throw new Error(i+` update.rank != ${o+t.length-r}`);for(let s=0;s<o;++s)if(e.shape[s]!==n.shape[s])throw new Error(i+` updates.shape[${s}] (${e.shape[s]}) != indices.shape[${s}] (${n.shape[s]}).`);for(let s=0;s<e.rank-o;++s)if(e.shape[s+o]!==t[s+r])throw new Error(i+` updates.shape[${s+o}] (${e.shape[s+o]}) != shape[${s+o}] (${t[s+o]})`)}function Wue(t,n,e){if(n.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${n.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(n.size===0)throw new Error(`Indices specified for empty output. indices shape: ${n.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}MV(e,n,t)}function Hue(t,n,e){let r=n.shape.length,o=r>1?n.shape[r-1]:1,i=e.length,s=1;for(let p=o;p<i;++p)s*=e[p];let a=o<1?1:o,l=ot(n.shape)/a,u=[...rs(e.slice(0,o)),1],c=ot(e);return{sliceRank:o,numUpdates:l,sliceSize:s,strides:u,outputSize:c}}function jue(t,n=1,e=!0){let r=I(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=r.shape[r.shape.length-1];if(n<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${n}`);if(n>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${n}`);let i={x:r},s={k:n,sorted:e},[a,l]=E.runKernel(Od,i,s);return{values:a,indices:l}}var OV=T({topk_:jue});function que(t,n=0,e=1,r,o){if(Ln(t),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let i=new ih(n,e,r,!0,o),s=ve(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var ry=T({truncatedNormal_:que});function Kue(t,n=0){let e=I(t,"x","unique","string_or_numeric");_(e.rank>0,()=>"The input tensor must be at least 1D");let r={x:e},o={axis:n},[i,s]=E.runKernel($d,r,o);return{values:i,indices:s}}var FV=T({unique_:Kue});function Xue(t,n,e){let r=I(t,"x","unsortedSegmentSum"),o=I(n,"segmentIds","unsortedSegmentSum","int32");_(Hs(e),()=>"numSegments must be of dtype int");let i={x:r,segmentIds:o},s={numSegments:e};return E.runKernel(Du,i,s)}var R0=T({unsortedSegmentSum_:Xue});function Yue(t,n=0){let e=I(t,"x","unstack","string_or_numeric");_(n>=-e.shape.length&&n<e.shape.length,()=>`Axis = ${n} is not in [-${e.shape.length}, ${e.shape.length})`);let r={value:e},o={axis:n};return E.runKernel(Nu,r,o)}var cr=T({unstack_:Yue});function JD(t,n=!0,e,r){return E.makeVariable(t,n,e,r)}function $V(t,n){let e=[];for(let i=0;i<n.length;i++)n[i]&&e.push(i);let r=ve(t,"int32"),o=ve([e.length,t.length],"int32");for(let i=0;i<e.length;i++){let s=r.indexToLoc(e[i]),a=i*t.length;o.values.set(s,a)}return o.toTensor()}function Zue(t,n,e){let r=I(t,"x","transpose");if(n==null&&(n=r.shape.map((s,a)=>a).reverse()),_(r.rank===n.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${n}.`),n.forEach(s=>{_(s>=0&&s<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${n}`)}),r.rank<=1)return r.clone();let o={x:r},i={perm:n};return r.dtype==="complex64"?L(()=>{let s=yp(r),a=eh(r);return s=E.runKernel(as,{x:s},i),a=E.runKernel(as,{x:a},i),e&&(a=Qe(a)),No(s,a)}):E.runKernel(as,o,i)}var $e=T({transpose_:Zue});function PV(t,n){if(n==null)return t.shape.slice();if(Pl(t.shape,n))return n;if(t.shape.length===n.length){let e=[];for(let r=0;r<t.shape.length;r++)n[r]==null&&t.shape[r]!=null?e.push(t.shape[r]):e.push(n[r]);return e}return n}function Que(t,n,e,r){let o=I(t,"x","dropout");if(_(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),_(n>=0&&n<1,()=>`rate must be a float in the range [0, 1), but got ${n}.`),n===0)return t instanceof lt?o.clone():o;let i=PV(o,e),s=1-n,a=se(ja(Z(Ai(i,0,1,"float32",r),s)),s);return R(o,a)}var LV=T({dropout_:Que});var Sp={};Po(Sp,{conv2d:()=>VV,depthwiseConv2d:()=>BV,matMul:()=>zV});function Jue(t,n,e,r,o,i="NHWC",s){let a=t;t.rank===3&&(a=M(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=M(n,[1,n.shape[0],n.shape[1],n.shape[2]])),_(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),_(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),_(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);let u=i==="NHWC"?a.shape[3]:a.shape[1],c=i==="NHWC"?l.shape[3]:l.shape[1];_(u===e[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${e[2]}.`),_(c===e[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${e[3]}).`),It("conv2dDerFilter",o,s);let p={x:a,dy:l},f={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,filterShape:e};return E.runKernel(sd,p,f)}var lh=T({conv2DBackpropFilter_:Jue});function vp(t,n,e){if(e==null||e==="linear")return t;if(e==="relu")return R(t,Mi(n));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function bp(t,n){let e=n,r=bt(t.shape,n.shape);return r.length>0&&(e=ue(e,r)),M(e,t.shape)}function wp(t,n,e,r){if(n==="linear")return t;if(n==="relu")return ao(t);if(n==="elu")return Ha(t);if(n==="relu6")return k0(t);if(n==="prelu")return mp(t,e);if(n==="leakyrelu")return pp(t,r);if(n==="sigmoid")return ei(t);throw new Error(`Unknown fused activation ${n}.`)}var Cp=(t,n)=>!(t>0)||n==="linear";function ece({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",Cp(E.state.gradientDepth,l)===!1){_(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let N=oo(t,n,e,r,o,i,s);return a!=null&&(N=Z(N,a)),wp(N,l,u,c)}let p=I(t,"x","conv2d","float32"),f=I(n,"filter","conv2d","float32"),d=p,h=!1;p.rank===3&&(h=!0,d=M(p,[1,p.shape[0],p.shape[1],p.shape[2]])),_(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),_(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),It("fused conv2d",r,s);let m=o==="NHWC"?d.shape[3]:d.shape[1];_(f.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${f.shape[2]}.`),_(Bn(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);let g=sp(d.shape,f.shape,e,i,r,s),y;a!=null&&(y=I(a,"bias","fused conv2d"),[y]=Ve(y,p),o==="NHWC"?Re(g.outShape,y.shape):(_(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),_(y.shape.length===0||y.shape[0]===g.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let x;if(u!=null){let N=u.shape;if(_(N.length<=1||N.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${N.length}.`),N.length===1)_(N[0]===1||N[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the number of output channels (${g.outChannels}).`);else if(N.length===3)try{Re(N,g.outShape)}catch{let k=`Error in fused conv2d: PReLU activation weights (${N}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(k)}x=I(u,"prelu weights","fused conv2d")}let b=(N,D)=>{_(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);let[k,O,$,V]=D,G=vp(N,$,l);_(Do(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);let W=Zd(O.shape,G,k,e,r),H=lh(O,G,k.shape,e,r),j=[W,H];if(V!=null){let Y=bp(V,G);j.push(Y)}return j},w={x:d,filter:f,bias:y,preluActivationWeights:x},C={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:c};return a==null?Ao((D,k,O)=>{let $=E.runKernel(qc,w,C);return O([k,D,$]),h&&($=M($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:b}})(d,f):Ao((D,k,O,$)=>{let V=E.runKernel(qc,w,C);return $([k,D,V,O]),h&&(V=M(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:b}})(d,f,y)}var VV=T({fusedConv2d_:ece});function tce(t,n,e,r,o,i=[1,1],s){let a=t;t.rank===3&&(a=M(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=M(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u={x:a,dy:l},c={strides:r,pad:o,dimRoundingMode:s,dilations:i,filterShape:e};return E.runKernel(dd,u,c)}var M0=T({depthwiseConv2dNativeBackpropFilter_:tce});function nce(t,n,e,r,o,i=[1,1],s){let a=n,l=!1;n.rank===3&&(l=!0,a=M(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u={dy:a,filter:e},c={strides:r,pad:o,dimRoundingMode:s,dilations:i,inputShape:t},p=E.runKernel(hd,u,c);return l?M(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var O0=T({depthwiseConv2dNativeBackpropInput_:nce});function rce({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(Cp(E.state.gradientDepth,l)===!1){let C=Wa(t,n,e,r,o,i,s);return a!=null&&(C=Z(C,a)),wp(C,l,u,c)}let p=I(t,"x","depthwiseConv2d","float32"),f=I(n,"filter","depthwiseConv2d","float32"),d=p,h=!1;p.rank===3&&(h=!0,d=M(p,[1,p.shape[0],p.shape[1],p.shape[2]])),_(d.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),_(f.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${f.rank}.`),_(d.shape[3]===f.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${f.shape[2]}.`),i==null&&(i=[1,1]),_(Bn(e,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),It("fused depthwiseConv2d",r,s);let m=sp(d.shape,f.shape,e,i,r,s,!0),g;a!=null&&(g=I(a,"bias","fused conv2d"),[g]=Ve(g,p),Re(m.outShape,g.shape));let y;u!=null&&(y=I(u,"prelu weights","fused depthwiseConv2d"));let x=(C,N)=>{_(Do(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);let[D,k,O,$]=N,V=vp(C,O,l),G=O0(k.shape,V,D,e,r,i,s),W=M0(k,V,D.shape,e,r,i,s);if($!=null){let H=bp(g,V);return[G,W,H]}return[G,W]},b={x:d,filter:f,bias:g,preluActivationWeights:y},w={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:c};return a==null?Ao((N,D,k)=>{let O=E.runKernel(Kc,b,w);return k([D,N,O]),h&&(O=M(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:x}})(d,f):Ao((N,D,k,O)=>{let $=E.runKernel(Kc,b,w);return O([D,N,$,k]),h&&($=M($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:x}})(d,f,g)}var BV=T({fusedDepthwiseConv2d_:rce});function oce({a:t,b:n,transposeA:e=!1,transposeB:r=!1,bias:o,activation:i="linear",preluActivationWeights:s,leakyreluAlpha:a=.2}){if(Cp(E.state.gradientDepth,i)===!1){let V=it(t,n,e,r);return o!=null&&(V=Z(V,o)),wp(V,i,s,a)}let l=I(t,"a","fused matMul"),u=I(n,"b","fused matMul");[l,u]=Ve(l,u);let c=e?l.shape[l.rank-2]:l.shape[l.rank-1],p=r?u.shape[u.rank-1]:u.shape[u.rank-2],f=e?l.shape[l.rank-1]:l.shape[l.rank-2],d=r?u.shape[u.rank-2]:u.shape[u.rank-1],h=l.shape.slice(0,-2),m=u.shape.slice(0,-2),g=ot(h),y=ot(m);_(c===p,()=>`Error in fused matMul: inner shapes (${c}) and (${p}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${e} and transposeB=${r} must match.`);let b=Re(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([f,d]),w=e?M(l,[g,c,f]):M(l,[g,f,c]),C=r?M(u,[y,d,p]):M(u,[y,p,d]),N;o!=null&&(N=I(o,"bias","fused matMul"),[N]=Ve(N,l),Re(b,N.shape));let D;s!=null&&(D=I(s,"prelu weights","fused matMul"));let k=(V,G)=>{let[W,H,j,Y]=G,ee=vp(M(V,j.shape),j,i),X,te;if(!e&&!r?(X=it(ee,H,!1,!0),te=it(W,ee,!0,!1)):!e&&r?(X=it(ee,H,!1,!1),te=it(ee,W,!0,!1)):e&&!r?(X=it(H,ee,!1,!0),te=it(W,ee,!1,!1)):(X=it(H,ee,!0,!0),te=it(ee,W,!0,!0)),o!=null){let re=bp(Y,ee);return[X,te,re]}else return[X,te]},O={a:w,b:C,bias:N,preluActivationWeights:D},$={transposeA:e,transposeB:r,activation:i,leakyreluAlpha:a};return o==null?Ao((G,W,H)=>{let j=E.runKernel(jc,O,$);return H([G,W,j]),{value:M(j,b),gradFunc:k}})(w,C):Ao((G,W,H,j)=>{let Y=E.runKernel(jc,O,$);return j([G,W,Y,H]),{value:M(Y,b),gradFunc:k}})(w,C,N)}var zV=T({fusedMatMul_:oce});function ice(t,n,e,r,o="bilinear",i=0){let s=I(t,"image","cropAndResize"),a=I(n,"boxes","cropAndResize","float32"),l=I(e,"boxInd","cropAndResize","int32"),u=a.shape[0];_(s.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${s.rank}.`),_(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),_(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),_(r.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${r.length}.`),_(r[0]>=1&&r[1]>=1,()=>`cropSize must be atleast [1,1], but was ${r}`),_(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);let c={image:s,boxes:a,boxInd:l},p={method:o,extrapolationValue:i,cropSize:r};return E.runKernel(cd,c,p)}var UV=T({cropAndResize_:ice});function sce(t){let n=I(t,"image","flipLeftRight","float32");_(n.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${n.rank}.`);let e={image:n};return E.runKernel(vd,e,{})}var GV=T({flipLeftRight_:sce});function ace(t){let n=I(t,"image","grayscaleToRGB"),e=n.rank-1,r=n.shape[e];_(n.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${n.rank}.`),_(r===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${r}.`);let o=new Array(n.rank);return o.fill(1,0,e),o[e]=3,er(n,o)}var WV=T({grayscaleToRGB_:ace});function lce(t){let n=I(t,"image","RGBToGrayscale"),e=n.rank-1,r=n.shape[e];_(n.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${n.rank}.`),_(r===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${r}.`);let o=n.dtype,i=J(n,"float32"),s=an([.2989,.587,.114]),a;switch(n.rank){case 2:a=Qd("ij,j->i",i,s);break;case 3:a=Qd("ijk,k->ij",i,s);break;case 4:a=Qd("ijkl,l->ijk",i,s);break;case 5:a=Qd("ijklm,m->ijkl",i,s);break;case 6:a=Qd("ijklmn,n->ijklm",i,s);break;default:throw new Error("Not a valid tensor rank.")}return a=sn(a,-1),J(a,o)}var HV=T({rgbToGrayscale_:lce});function uce(t,n,e=0,r=.5){let o=I(t,"image","rotateWithOffset","float32");_(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);let i={image:o},s={radians:n,fillValue:e,center:r};return E.runKernel(Pd,i,s)}var jV=T({rotateWithOffset_:uce});function ni(t,n,e,r,o,i){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),i==null&&(i=0);let s=t.shape[0];return e=Math.min(e,s),_(0<=r&&r<=1,()=>`iouThreshold must be in [0, 1], but was '${r}'`),_(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),_(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),_(n.rank===1,()=>"scores must be a 1D tensor"),_(n.shape[0]===s,()=>`scores has incompatible shape with boxes. Expected ${s}, but was ${n.shape[0]}`),_(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}function cce(t,n,e,r=.5,o=Number.NEGATIVE_INFINITY){let i=I(t,"boxes","nonMaxSuppression","float32"),s=I(n,"scores","nonMaxSuppression","float32"),a=ni(i,s,e,r,o);e=a.maxOutputSize,r=a.iouThreshold,o=a.scoreThreshold;let l={maxOutputSize:e,iouThreshold:r,scoreThreshold:o};return E.runKernel(Ed,{boxes:i,scores:s},l)}var qV=T({nonMaxSuppression_:cce});function KV(t,n,e){let r=pce(t,n,e),o=r<0?-(r+1):r;t.splice(o,0,n)}function pce(t,n,e){return dce(t,n,e||fce)}function fce(t,n){return t>n?1:t<n?-1:0}function dce(t,n,e){let r=0,o=t.length,i=0,s=!1;for(;r<o;){i=r+(o-r>>>1);let a=e(n,t[i]);a>0?r=i+1:(o=i,s=!a)}return s?r:-r-1}function F0(t,n,e,r,o){return e1(t,n,e,r,o,0)}function $0(t,n,e,r,o,i){return e1(t,n,e,r,o,0,!1,i,!0)}function P0(t,n,e,r,o,i){return e1(t,n,e,r,o,i,!0)}function e1(t,n,e,r,o,i,s=!1,a=!1,l=!1){let u=[];for(let g=0;g<n.length;g++)n[g]>o&&u.push({score:n[g],boxIndex:g,suppressBeginIndex:0});u.sort(XV);let c=i>0?-.5/i:0,p=[],f=[];for(;p.length<e&&u.length>0;){let g=u.pop(),{score:y,boxIndex:x,suppressBeginIndex:b}=g;if(y<o)break;let w=!1;for(let C=p.length-1;C>=b;--C){let N=hce(t,x,p[C]);if(N>=r){w=!0;break}if(g.score=g.score*mce(r,c,N),g.score<=o)break}g.suppressBeginIndex=p.length,w||(g.score===y?(p.push(x),f.push(g.score)):g.score>o&&KV(u,g,XV))}let d=p.length,h=e-d;a&&h>0&&(p.push(...new Array(h).fill(0)),f.push(...new Array(h).fill(0)));let m={selectedIndices:p};return s&&(m.selectedScores=f),l&&(m.validOutputs=d),m}function hce(t,n,e){let r=t.subarray(n*4,n*4+4),o=t.subarray(e*4,e*4+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),u=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),p=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),d=(a-i)*(l-s),h=(p-u)*(f-c);if(d<=0||h<=0)return 0;let m=Math.max(i,u),g=Math.max(s,c),y=Math.min(a,p),x=Math.min(l,f),b=Math.max(y-m,0)*Math.max(x-g,0);return b/(d+h-b)}function mce(t,n,e){let r=Math.exp(n*e*e);return e<=t?r:0}function XV(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function gce(i,s,a){return B(this,arguments,function*(t,n,e,r=.5,o=Number.NEGATIVE_INFINITY){let l=I(t,"boxes","nonMaxSuppressionAsync"),u=I(n,"scores","nonMaxSuppressionAsync"),c=ni(l,u,e,r,o);e=c.maxOutputSize,r=c.iouThreshold,o=c.scoreThreshold;let p=yield Promise.all([l.data(),u.data()]),f=p[0],d=p[1],{selectedIndices:h}=F0(f,d,e,r,o);return l!==t&&l.dispose(),u!==n&&u.dispose(),an(h,"int32")})}var YV=gce;function yce(t,n,e,r=.5,o=Number.NEGATIVE_INFINITY,i=0){let s=I(t,"boxes","nonMaxSuppression"),a=I(n,"scores","nonMaxSuppression"),l=ni(s,a,e,r,o,i);e=l.maxOutputSize,r=l.iouThreshold,o=l.scoreThreshold,i=l.softNmsSigma;let u={boxes:s,scores:a},c={maxOutputSize:e,iouThreshold:r,scoreThreshold:o,softNmsSigma:i},p=E.runKernel(_d,u,c);return{selectedIndices:p[0],selectedScores:p[1]}}var ZV=T({nonMaxSuppressionWithScore_:yce});function xce(s,a,l){return B(this,arguments,function*(t,n,e,r=.5,o=Number.NEGATIVE_INFINITY,i=0){let u=I(t,"boxes","nonMaxSuppressionAsync"),c=I(n,"scores","nonMaxSuppressionAsync"),p=ni(u,c,e,r,o,i);e=p.maxOutputSize,r=p.iouThreshold,o=p.scoreThreshold,i=p.softNmsSigma;let f=yield Promise.all([u.data(),c.data()]),d=f[0],h=f[1],{selectedIndices:m,selectedScores:g}=P0(d,h,e,r,o,i);return u!==t&&u.dispose(),c!==n&&c.dispose(),{selectedIndices:an(m,"int32"),selectedScores:an(g)}})}var QV=xce;function vce(t,n,e,r=.5,o=Number.NEGATIVE_INFINITY,i=!1){let s=I(t,"boxes","nonMaxSuppression"),a=I(n,"scores","nonMaxSuppression"),l=ni(s,a,e,r,o,null),u=l.maxOutputSize,c=l.iouThreshold,p=l.scoreThreshold,f={boxes:s,scores:a},d={maxOutputSize:u,iouThreshold:c,scoreThreshold:p,padToMaxOutputSize:i},h=E.runKernel(Td,f,d);return{selectedIndices:h[0],validOutputs:h[1]}}var JV=T({nonMaxSuppressionPadded_:vce});function bce(s,a,l){return B(this,arguments,function*(t,n,e,r=.5,o=Number.NEGATIVE_INFINITY,i=!1){let u=I(t,"boxes","nonMaxSuppressionAsync"),c=I(n,"scores","nonMaxSuppressionAsync"),p=ni(u,c,e,r,o,null),f=p.maxOutputSize,d=p.iouThreshold,h=p.scoreThreshold,[m,g]=yield Promise.all([u.data(),c.data()]),{selectedIndices:y,validOutputs:x}=$0(m,g,f,d,h,i);return u!==t&&u.dispose(),c!==n&&c.dispose(),{selectedIndices:an(y,"int32"),validOutputs:Se(x,"int32")}})}var eB=bce;function wce(t,n,e=!1,r=!1){let o=I(t,"images","resizeBilinear");_(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),_(n.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${n}.`),_(r===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=M(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},u=E.runKernel(bu,a,l);return s?M(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var L0=T({resizeBilinear_:wce});function Cce(t,n,e=!1,r=!1){let o=I(t,"images","resizeNearestNeighbor");_(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),_(n.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${n}.`),_(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),_(r===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=M(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},u=E.runKernel(vu,a,l);return s?M(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var V0=T({resizeNearestNeighbor_:Cce});function Sce(t,n="binary",e=!1,r=.5){let o=I(t,"image","threshold"),i=.2989,s=.587,a=.114,l=o.shape[0]*o.shape[1],u=R(an([r]),255),c,p,f,d;if(_(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),_(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),_(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),_(n==="otsu"||n==="binary",()=>`Method must be binary or otsu, but was ${n}`),o.shape[2]===3){[c,p,f]=bn(o,[1,1,1],-1);let g=R(c,i),y=R(p,s),x=R(f,a);d=Z(Z(g,y),x)}else d=t;if(n==="otsu"){let g=tV(J(Kg(d),"int32"),Fr([]),256);u=Ice(g,l)}let h=e?ti(d,u):Zt(d,u);return J(R(h,255),"int32")}function Ice(t,n){let e=an([-1]),r=an([0]),o=an([0]),i,s,a,l,u,c;for(let p=0;p<t.size-1;p++){i=qe(t,0,p+1),s=qe(t,p+1),u=se(ue(i),n),c=se(ue(s),n);let f=ue(R(i,qa(0,i.size)));a=se(f,ue(i));let d=Ga(s.shape,i.size),h=Z(qa(0,s.size),d),m=R(s,h);l=se(ue(m),ue(s));let g=pe(a,l),y=pe(a,l),x=R(u,c);o=R(R(x,g),y);let b=Zt(o,r);r=kt(b,o,r),e=kt(b,an([p]),e)}return e}var tB=T({threshold_:Sce});function Ece(t,n,e="nearest",r="constant",o=0,i){let s=I(t,"image","transform","float32"),a=I(n,"transforms","transform","float32");_(s.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${s.rank}.`),_(a.rank===2&&(a.shape[0]===s.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),_(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);let l={image:s,transforms:a},u={interpolation:e,fillMode:r,fillValue:o,outputShape:i};return E.runKernel(Fd,l,u)}var nB=T({transform_:Ece});function Tce(t,n,e){let r=I(t,"a","bandPart");_(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let o=r.shape,[i,s]=r.shape.slice(-2),a,l;typeof n=="number"?(_(n%1===0,()=>`bandPart(): numLower must be an integer, got ${n}.`),_(n<=i,()=>`bandPart(): numLower (${n}) must not be greater than the number of rows (${i}).`),a=I(n<0?i:n,"numLower","bandPart")):(_(n.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=kt(fp(n,0),i,ds(n,i))),typeof e=="number"?(_(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`),_(e<=s,()=>`bandPart(): numUpper (${e}) must not be greater than the number of columns (${s}).`),l=I(e<0?s:e,"numUpper","bandPart")):(_(e.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=kt(fp(e,0),s,ds(e,s)));let u=M(qa(0,i,1,"int32"),[-1,1]),c=qa(0,s,1,"int32"),p=pe(u,c),f=ur(ti(p,a),Pr(p,Qe(l))),d=At([i,s],r.dtype);return M(mn(cr(M(r,[-1,i,s])).map(h=>kt(f,h,d))),o)}var rB=T({bandPart_:Tce});function _ce(t){let n;if(Array.isArray(t)){n=!1,_(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=t[0].shape[0];for(let i=1;i<t.length;++i)_(t[i].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${o})`)}else n=!0,t=bn(t,t.shape[0],0).map(o=>Ri(o,[0]));_(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);let e=[],r=t;for(let o=0;o<t.length;++o)e.push(E.tidy(()=>{let i=r[o];if(o>0)for(let s=0;s<o;++s){let a=R(ue(R(e[s],i)),e[s]);i=pe(i,a)}return se(i,Vu(i,"euclidean"))}));return n?mn(e,0):e}var oB=T({gramSchmidt_:_ce});function Nce(t,n=!1){if(_(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return iB(t,n);{let e=t.shape.slice(0,t.shape.length-2).reduce((l,u)=>l*u),r=cr(M(t,[e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];r.forEach(l=>{let[u,c]=iB(l,n);o.push(u),i.push(c)});let s=M(mn(o,0),t.shape),a=M(mn(i,0),t.shape);return[s,a]}}function iB(t,n=!1){return E.tidy(()=>{_(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);let e=t.shape[0],r=t.shape[1],o=Jd(e),i=ro(t),s=Lr([[1]],[1,1]),a=ro(s),l=e>=r?r:e;for(let u=0;u<l;++u){let c=i,p=a,f=o;[a,i,o]=E.tidy(()=>{let d=qe(i,[u,u],[e-u,1]),h=Vu(d),m=qe(i,[u,u],[1,1]),g=kt(Zt(m,0),Lr([[-1]]),Lr([[1]])),y=pe(m,R(g,h)),x=se(d,y);x.shape[0]===1?a=ro(s):a=Dt([s,qe(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);let b=Qe(se(it(g,y),h)),w=qe(i,[u,0],[e-u,r]),C=R(b,a),N=$e(a);if(u===0)i=pe(w,it(C,it(N,w)));else{let O=pe(w,it(C,it(N,w)));i=Dt([qe(i,[0,0],[u,r]),O],0)}let D=$e(C),k=qe(o,[0,u],[e,o.shape[1]-u]);if(u===0)o=pe(k,it(it(k,a),D));else{let O=pe(k,it(it(k,a),D));o=Dt([qe(o,[0,0],[e,u]),O],1)}return[a,i,o]}),De([c,p,f])}return!n&&e>r&&(o=qe(o,[0,0],[e,r]),i=qe(i,[0,0],[r,r])),[o,i]})}var sB=T({qr_:Nce});var lo={flipLeftRight:GV,grayscaleToRGB:WV,resizeNearestNeighbor:V0,resizeBilinear:L0,rgbToGrayscale:HV,rotateWithOffset:jV,cropAndResize:UV,nonMaxSuppression:qV,nonMaxSuppressionAsync:YV,nonMaxSuppressionWithScore:ZV,nonMaxSuppressionWithScoreAsync:QV,nonMaxSuppressionPadded:JV,nonMaxSuppressionPaddedAsync:eB,threshold:tB,transform:nB},aB={bandPart:rB,gramSchmidt:oB,qr:sB};var K={};Po(K,{Serializable:()=>oy,SerializationMap:()=>B0,getRegisteredName:()=>kce,registerClass:()=>n1});var Dce=new Map,t1=new Map,oy=class{getClassName(){return this.constructor.className}static fromConfig(n,e){return new n(e)}},B0=class t{constructor(){this.classNameMap={}}static getMap(){return t.instance==null&&(t.instance=new t),t.instance}static register(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]}};function n1(t,n,e){_(t.className!=null,()=>"Class being registered does not have the static className property defined."),_(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),_(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof n>"u"&&(n="Custom"),typeof e>"u"&&(e=t.className);let r=e,o=n+">"+r;return B0.register(t),Dce.set(o,t),t1.set(t,o),t}function kce(t){return t1.has(t)?t1.get(t):t.className}var tr=class extends oy{minimize(n,e=!1,r){let{value:o,grads:i}=this.computeGradients(n,r);if(r!=null){let s=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(s)}else this.applyGradients(i);return De(i),e?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(n,e){return PD(n,e)}dispose(){this.iterations_!=null&&De(this.iterations_)}saveIterations(){return B(this,null,function*(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Se(this.iterations_,"int32")}})}getWeights(){return B(this,null,function*(){throw new Error("getWeights() is not implemented for this optimizer yet.")})}setWeights(n){return B(this,null,function*(){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)})}extractIterations(n){return B(this,null,function*(){return this.iterations_=(yield n[0].tensor.data())[0],n.slice(1)})}};Object.defineProperty(tr,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});var uh=class extends tr{static get className(){return"Adadelta"}constructor(n,e,r=null){super(),this.learningRate=n,this.rho=e,this.epsilon=r,this.accumulatedGrads=[],this.accumulatedUpdates=[],r==null&&(this.epsilon=E.backend.epsilon())}applyGradients(n){(Array.isArray(n)?n.map(r=>r.name):Object.keys(n)).forEach((r,o)=>{let i=E.registeredVariables[r],s=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${r}/accum_grad`,variable:L(()=>be(i).variable(s))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${r}/accum_var`,variable:L(()=>be(i).variable(s))});let a=Array.isArray(n)?n[o].tensor:n[r];if(a==null)return;let l=this.accumulatedGrads[o].variable,u=this.accumulatedUpdates[o].variable;L(()=>{let c=Z(R(l,this.rho),R(Le(a),1-this.rho)),p=R(se(wt(Z(u,this.epsilon)),wt(Z(l,this.epsilon))),a),f=Z(R(u,this.rho),R(Le(p),1-this.rho));l.assign(c),u.assign(f);let d=Z(R(p,-this.learningRate),i);i.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(De(this.accumulatedGrads.map(n=>n.variable)),De(this.accumulatedUpdates.map(n=>n.variable)))}getWeights(){return B(this,null,function*(){let n=[...this.accumulatedGrads,...this.accumulatedUpdates];return[yield this.saveIterations()].concat(n.map(e=>({name:e.originalName,tensor:e.variable})))})}setWeights(n){return B(this,null,function*(){n=yield this.extractIterations(n);let e=n.length/2,r=!1;this.accumulatedGrads=n.slice(0,e).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedUpdates=n.slice(e,e*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))})}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(n,e){return new n(e.learningRate,e.rho,e.epsilon)}};var ch=class extends tr{static get className(){return"Adagrad"}constructor(n,e=.1){super(),this.learningRate=n,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(n){(Array.isArray(n)?n.map(r=>r.name):Object.keys(n)).forEach((r,o)=>{let i=E.registeredVariables[r];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${r}/accumulator`,variable:L(()=>Ga(i.shape,this.initialAccumulatorValue).variable(!1))});let s=Array.isArray(n)?n[o].tensor:n[r];if(s==null)return;let a=this.accumulatedGrads[o].variable;L(()=>{let l=Z(a,Le(s));a.assign(l);let u=Z(R(se(s,wt(Z(l,E.backend.epsilon()))),-this.learningRate),i);i.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&De(this.accumulatedGrads.map(n=>n.variable))}getWeights(){return B(this,null,function*(){return[yield this.saveIterations()].concat(this.accumulatedGrads.map(n=>({name:n.originalName,tensor:n.variable})))})}setWeights(n){return B(this,null,function*(){n=yield this.extractIterations(n);let e=!1;this.accumulatedGrads=n.map(r=>({originalName:r.name,variable:r.tensor.variable(e)}))})}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(n,e){return new n(e.learningRate,e.initialAccumulatorValue)}};var ph=class extends tr{static get className(){return"Adam"}constructor(n,e,r,o=null){super(),this.learningRate=n,this.beta1=e,this.beta2=r,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],L(()=>{this.accBeta1=Se(e).variable(),this.accBeta2=Se(r).variable()}),o==null&&(this.epsilon=E.backend.epsilon())}applyGradients(n){let e=Array.isArray(n)?n.map(r=>r.name):Object.keys(n);L(()=>{let r=pe(1,this.accBeta1),o=pe(1,this.accBeta2);e.forEach((i,s)=>{let a=E.registeredVariables[i],l=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${i}/m`,variable:L(()=>be(a).variable(l))}),this.accumulatedSecondMoment[s]==null&&(this.accumulatedSecondMoment[s]={originalName:`${i}/v`,variable:L(()=>be(a).variable(l))});let u=Array.isArray(n)?n[s].tensor:n[i];if(u==null)return;let c=this.accumulatedFirstMoment[s].variable,p=this.accumulatedSecondMoment[s].variable,f=Z(R(c,this.beta1),R(u,1-this.beta1)),d=Z(R(p,this.beta2),R(Le(u),1-this.beta2)),h=se(f,r),m=se(d,o);c.assign(f),p.assign(d);let g=Z(R(se(h,Z(wt(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(R(this.accBeta1,this.beta1)),this.accBeta2.assign(R(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&De(this.accumulatedFirstMoment.map(n=>n.variable)),this.accumulatedSecondMoment!=null&&De(this.accumulatedSecondMoment.map(n=>n.variable))}getWeights(){return B(this,null,function*(){let n=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[yield this.saveIterations()].concat(n.map(e=>({name:e.originalName,tensor:e.variable})))})}setWeights(n){return B(this,null,function*(){n=yield this.extractIterations(n),L(()=>{this.accBeta1.assign($r(this.beta1,this.iterations_+1)),this.accBeta2.assign($r(this.beta2,this.iterations_+1))});let e=n.length/2,r=!1;this.accumulatedFirstMoment=n.slice(0,e).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedSecondMoment=n.slice(e,e*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))})}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(n,e){return new n(e.learningRate,e.beta1,e.beta2,e.epsilon)}};var fh=class extends tr{static get className(){return"Adamax"}constructor(n,e,r,o=null,i=0){super(),this.learningRate=n,this.beta1=e,this.beta2=r,this.epsilon=o,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],L(()=>{this.iteration=Se(0).variable(),this.accBeta1=Se(e).variable()}),o==null&&(this.epsilon=E.backend.epsilon())}applyGradients(n){let e=Array.isArray(n)?n.map(r=>r.name):Object.keys(n);L(()=>{let r=pe(1,this.accBeta1),o=se(-this.learningRate,Z(R(this.iteration,this.decay),1));e.forEach((i,s)=>{let a=E.registeredVariables[i],l=!1;this.accumulatedFirstMoment[s]==null&&(this.accumulatedFirstMoment[s]={originalName:`${i}/m`,variable:be(a).variable(l)}),this.accumulatedWeightedInfNorm[s]==null&&(this.accumulatedWeightedInfNorm[s]={originalName:`${i}/v`,variable:be(a).variable(l)});let u=Array.isArray(n)?n[s].tensor:n[i];if(u==null)return;let c=this.accumulatedFirstMoment[s].variable,p=this.accumulatedWeightedInfNorm[s].variable,f=Z(R(c,this.beta1),R(u,1-this.beta1)),d=R(p,this.beta2),h=cn(u),m=so(d,h);c.assign(f),p.assign(m);let g=Z(R(se(o,r),se(f,Z(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(Z(this.iteration,1)),this.accBeta1.assign(R(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&De(this.accumulatedFirstMoment.map(n=>n.variable)),this.accumulatedWeightedInfNorm!=null&&De(this.accumulatedWeightedInfNorm.map(n=>n.variable))}getWeights(){return B(this,null,function*(){throw new Error("getWeights() is not implemented for Adamax yet.")})}setWeights(n){return B(this,null,function*(){throw new Error("setWeights() is not implemented for Adamax yet.")})}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(n,e){return new n(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)}};var zu=class extends tr{static get className(){return"SGD"}constructor(n){super(),this.learningRate=n,this.setLearningRate(n)}applyGradients(n){(Array.isArray(n)?n.map(r=>r.name):Object.keys(n)).forEach((r,o)=>{let i=Array.isArray(n)?n[o].tensor:n[r];if(i==null)return;let s=E.registeredVariables[r];L(()=>{let a=Z(R(this.c,i),s);s.assign(a)})}),this.incrementIterations()}setLearningRate(n){this.learningRate=n,this.c!=null&&this.c.dispose(),this.c=Tn(Se(-n))}dispose(){this.c.dispose()}getWeights(){return B(this,null,function*(){return[yield this.saveIterations()]})}setWeights(n){return B(this,null,function*(){if(n=yield this.extractIterations(n),n.length!==0)throw new Error("SGD optimizer does not have settable weights.")})}getConfig(){return{learningRate:this.learningRate}}static fromConfig(n,e){return new n(e.learningRate)}};var dh=class extends zu{static get className(){return"Momentum"}constructor(n,e,r=!1){super(n),this.learningRate=n,this.momentum=e,this.useNesterov=r,this.accumulations=[],this.m=Se(this.momentum)}applyGradients(n){(Array.isArray(n)?n.map(r=>r.name):Object.keys(n)).forEach((r,o)=>{let i=E.registeredVariables[r];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${r}/momentum`,variable:L(()=>be(i).variable(!1))});let s=this.accumulations[o].variable,a=Array.isArray(n)?n[o].tensor:n[r];a!=null&&L(()=>{let l,u=Z(R(this.m,s),a);this.useNesterov?l=Z(R(this.c,Z(a,R(u,this.m))),i):l=Z(R(this.c,u),i),s.assign(u),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&De(this.accumulations.map(n=>n.variable))}setMomentum(n){this.momentum=n}getWeights(){return B(this,null,function*(){return[yield this.saveIterations()].concat(this.accumulations.map(n=>({name:n.originalName,tensor:n.variable})))})}setWeights(n){return B(this,null,function*(){n=yield this.extractIterations(n);let e=!1;this.accumulations=n.map(r=>({originalName:r.name,variable:r.tensor.variable(e)}))})}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(n,e){return new n(e.learningRate,e.momentum,e.useNesterov)}};var hh=class extends tr{static get className(){return"RMSProp"}constructor(n,e=.9,r=0,o=null,i=!1){if(super(),this.learningRate=n,this.decay=e,this.momentum=r,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,o==null&&(this.epsilon=E.backend.epsilon()),n==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(n){(Array.isArray(n)?n.map(r=>r.name):Object.keys(n)).forEach((r,o)=>{let i=E.registeredVariables[r],s=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${r}/rms`,variable:L(()=>be(i).variable(s))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${r}/momentum`,variable:L(()=>be(i).variable(s))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${r}/mg`,variable:L(()=>be(i).variable(s))});let a=Array.isArray(n)?n[o].tensor:n[r];if(a==null)return;let l=this.accumulatedMeanSquares[o].variable,u=this.accumulatedMoments[o].variable;L(()=>{let c=Z(R(l,this.decay),R(Le(a),1-this.decay));if(this.centered){let p=this.accumulatedMeanGrads[o].variable,f=Z(R(p,this.decay),R(a,1-this.decay)),d=se(R(a,this.learningRate),wt(pe(c,Z(Le(f),this.epsilon)))),h=Z(R(u,this.momentum),d);l.assign(c),p.assign(f),u.assign(h);let m=pe(i,h);i.assign(m)}else{let p=Z(R(l,this.decay),R(Le(a),1-this.decay)),f=Z(R(u,this.momentum),se(R(a,this.learningRate),wt(Z(p,this.epsilon))));l.assign(p),u.assign(f);let d=pe(i,f);i.assign(d)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&De(this.accumulatedMeanSquares.map(n=>n.variable)),this.accumulatedMeanGrads!=null&&this.centered&&De(this.accumulatedMeanGrads.map(n=>n.variable)),this.accumulatedMoments!=null&&De(this.accumulatedMoments.map(n=>n.variable))}getWeights(){return B(this,null,function*(){let n=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&n.push(...this.accumulatedMeanGrads),[yield this.saveIterations()].concat(n.map(e=>({name:e.originalName,tensor:e.variable})))})}setWeights(n){return B(this,null,function*(){n=yield this.extractIterations(n);let e=this.centered?n.length/3:n.length/2,r=!1;this.accumulatedMeanSquares=n.slice(0,e).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.accumulatedMoments=n.slice(e,e*2).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})),this.centered&&(this.accumulatedMeanGrads=n.slice(e*2,e*3).map(o=>({originalName:o.name,variable:o.tensor.variable(r)})))})}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(n,e){return new n(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)}};var Ace=[uh,ch,ph,fh,dh,hh,zu];function lB(){for(let t of Ace)n1(t)}var Ka={};Po(Ka,{CompositeArrayBuffer:()=>Jn,browserFiles:()=>cB,browserHTTPRequest:()=>mB,concatenateArrayBuffers:()=>kL,copyModel:()=>WL,decodeWeights:()=>y0,decodeWeightsStream:()=>JN,encodeWeights:()=>TL,fromMemory:()=>gB,fromMemorySync:()=>u1,getLoadHandlers:()=>OL,getModelArtifactsForJSON:()=>Wd,getModelArtifactsForJSONSync:()=>nD,getModelArtifactsInfoForJSON:()=>us,getSaveHandlers:()=>ML,getWeightSpecs:()=>Og,http:()=>U0,isHTTPScheme:()=>z0,listModels:()=>UL,loadWeights:()=>fB,moveModel:()=>HL,registerLoadRouter:()=>RL,registerSaveRouter:()=>AL,removeModel:()=>GL,weightsLoaderFactory:()=>a1,withSaveHandler:()=>yB,withSaveHandlerSync:()=>xB});var Rce="model",Mce=".json",Oce=".weights.bin";function uB(t){return new Promise(n=>setTimeout(n)).then(t)}var r1=(()=>{class t{constructor(e){if(!P().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Rce),this.modelJsonFileName=e+Mce,this.weightDataFileName=e+Oce}save(e){return B(this,null,function*(){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let r=Jn.join(e.weightData),o=window.URL.createObjectURL(new Blob([r],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let i=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],s=x0(e,i),a=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),l=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(l.download=this.modelJsonFileName,l.href=a,yield uB(()=>l.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=o,yield uB(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:us(e)}}})}}return t.URL_SCHEME="downloads://",t})();var o1=class{constructor(n){if(n==null||n.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${n}`);this.jsonFile=n[0],this.weightsFiles=n.slice(1)}load(){return B(this,null,function*(){return new Promise((n,e)=>{let r=new FileReader;r.onload=o=>{let i=JSON.parse(o.target.result),s=i.modelTopology;if(s==null){e(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(i.weightsManifest==null){e(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){n({modelTopology:s});return}let l=Wd(i,u=>this.loadWeights(u));n(l)},r.onerror=o=>e(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),r.readAsText(this.jsonFile)})})}loadWeights(n){let e=[],r=[];for(let s of n)e.push(...s.weights),r.push(...s.paths);let o=this.checkManifestAndWeightFiles(n),i=r.map(s=>this.loadWeightsFile(s,o[s]));return Promise.all(i).then(s=>[e,s])}loadWeightsFile(n,e){return new Promise((r,o)=>{let i=new FileReader;i.onload=s=>{let a=s.target.result;r(a)},i.onerror=s=>o(`Failed to weights data from file of path '${n}'.`),i.readAsArrayBuffer(e)})}checkManifestAndWeightFiles(n){let e=[],r=this.weightsFiles.map(i=>tD(i.name)),o={};for(let i of n)i.paths.forEach(s=>{let a=tD(s);if(e.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(e.push(a),r.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);o[s]=this.weightsFiles[r.indexOf(a)]});if(e.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${e.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return o}},Fce=t=>P().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(r1.URL_SCHEME)?$ce(t.slice(r1.URL_SCHEME.length)):null;_n.registerSaveRouter(Fce);function $ce(t="model"){return new r1(t)}function cB(t){return new o1(t)}function i1(t,n,e,r){s(t),e=e??0,r=r??1,a(e,r);let o=0,i=l=>(l.then(u=>{let c=e+ ++o/t.length*(r-e);return n(c),u}),l);function s(l){_(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){_(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),_(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),_(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(t.map(i))}function s1(t,n){return B(this,null,function*(){n==null&&(n={});let e=n.fetchFunc==null?P().platform.fetch:n.fetchFunc,r=t.map(p=>e(p,n.requestInit,{isBinary:!0})),a=(n.onProgress==null?yield Promise.all(r):yield i1(r,n.onProgress,0,.5)).map(p=>p.arrayBuffer());return n.onProgress==null?yield Promise.all(a):yield i1(a,n.onProgress,.5,1)})}function pB(t,n){var e;let r=n.fetchFunc==null?P().platform.fetch:n.fetchFunc,o=0,i;return(e=n.onProgress)===null||e===void 0||e.call(n,0),new ReadableStream({pull:s=>B(null,null,function*(){for(var a;o<t.length;){i||(i=(yield r(t[o],n.requestInit,{isBinary:!0})).body.getReader());let{done:l,value:u}=yield i.read();if(l){o++,i=void 0,(a=n.onProgress)===null||a===void 0||a.call(n,o/t.length);continue}s.enqueue(u);return}s.close()})})}function fB(t,n="",e,r){return B(this,null,function*(){return a1(s=>s1(s,{requestInit:r}))(t,n,e)})}function a1(t){return(n,e="",r)=>B(null,null,function*(){let o=n.map(()=>!1),i={},s=r!=null?r.map(()=>!1):[],a=[];if(n.forEach((d,h)=>{let m=0;d.weights.forEach(g=>{let y="quantization"in g?g.quantization.dtype:g.dtype,x=Va[y]*ot(g.shape),b=()=>{o[h]=!0,i[h]==null&&(i[h]=[]),i[h].push({manifestEntry:g,groupOffset:m,sizeBytes:x})};r!=null?r.forEach((w,C)=>{w===g.name&&(b(),s[C]=!0)}):b(),a.push(g.name),m+=x})}),!s.every(d=>d)){let d=r.filter((h,m)=>!s[m]);throw new Error(`Could not find weights in manifest with names: ${d.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let l=o.reduce((d,h,m)=>(h&&d.push(m),d),[]),u=[];l.forEach(d=>{n[d].paths.forEach(h=>{let m=e+(e.endsWith("/")?"":"/")+h;u.push(m)})});let c=yield t(u),p={},f=0;return l.forEach(d=>{let h=n[d].paths.length,m=new Jn(c.slice(f,f+h));i[d].forEach(y=>{let x=m.slice(y.groupOffset,y.groupOffset+y.sizeBytes),b=y0(x,[y.manifestEntry]);for(let w in b)p[w]=b[w]}),f+=h}),p})}var Pce="application/octet-stream",Lce="application/json",dB=(()=>{class t{constructor(e,r){if(this.DEFAULT_METHOD="POST",r==null&&(r={}),this.weightPathPrefix=r.weightPathPrefix,this.weightUrlConverter=r.weightUrlConverter,r.fetchFunc!=null?(_(typeof r.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=r.fetchFunc):this.fetch=P().platform.fetch,_(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&_(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,r.requestInit!=null&&r.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=r.requestInit||{},this.loadOptions=r}save(e){return B(this,null,function*(){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let r=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);r.body=new FormData;let o=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i=x0(e,o);if(r.body.append("model.json",new Blob([JSON.stringify(i)],{type:Lce}),"model.json"),e.weightData!=null){let a=Jn.join(e.weightData);r.body.append("model.weights.bin",new Blob([a],{type:Pce}),"model.weights.bin")}let s=yield this.fetch(this.path,r);if(s.ok)return{modelArtifactsInfo:us(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)})}loadModelJSON(){return B(this,null,function*(){let e=yield this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let r;try{r=yield e.json()}catch{let a=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?a+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":a+=" Please make sure the server is serving valid JSON for this request.",new Error(a)}let o=r.modelTopology,i=r.weightsManifest;if(o==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return r})}load(){return B(this,null,function*(){if(this.loadOptions.streamWeights)return this.loadStream();let e=yield this.loadModelJSON();return Wd(e,r=>this.loadWeights(r))})}loadStream(){return B(this,null,function*(){let e=yield this.loadModelJSON(),r=yield this.getWeightUrls(e.weightsManifest),o=Og(e.weightsManifest),i=()=>pB(r,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:o,getWeightStream:i})})}getWeightUrls(e){return B(this,null,function*(){let r=Array.isArray(this.path)?this.path[1]:this.path,[o,i]=Vce(r),s=this.weightPathPrefix||o,a=[],l=[];for(let u of e)for(let c of u.paths)this.weightUrlConverter!=null?l.push(this.weightUrlConverter(c)):a.push(s+c+i);return this.weightUrlConverter&&a.push(...yield Promise.all(l)),a})}loadWeights(e){return B(this,null,function*(){let r=yield this.getWeightUrls(e),o=Og(e),i=yield s1(r,this.loadOptions);return[o,i]})}}return t.URL_SCHEME_REGEX=/^https?:\/\//,t})();function Vce(t){let n=t.lastIndexOf("/"),e=t.lastIndexOf("?"),r=t.substring(0,n),o=e>n?t.substring(e):"";return[r+"/",o]}function z0(t){return t.match(dB.URL_SCHEME_REGEX)!=null}var hB=(t,n)=>{if(typeof fetch>"u"&&(n==null||n.fetchFunc==null))return null;{let e=!0;if(Array.isArray(t)?e=t.every(r=>z0(r)):e=z0(t),e)return U0(t,n)}return null};_n.registerSaveRouter(hB);_n.registerLoadRouter(hB);function U0(t,n){return new dB(t,n)}function mB(t,n){return U0(t,n)}var iy=class{constructor(n){this.modelArtifacts=n}load(){return this.modelArtifacts}},G0=class{constructor(n){this.saveHandler=n}save(n){return this.saveHandler(n)}},l1=class{constructor(n){n.load&&(this.load=()=>Promise.resolve(n.load())),n.save&&(this.save=e=>Promise.resolve(n.save(e)))}};function gB(t,n,e,r){let o=arguments;return new l1(u1(...o))}function u1(t,n,e,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new iy(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new iy({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new iy({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))}function yB(t){return new G0(t)}function xB(t){return new G0(t)}function Bce(t,n){let e=t.shape.length,r=n.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(n.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.shape[r-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${n.shape[r-1]} vs. ${e}`);if(ot(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);let o=n.shape,i=o[o.length-1],s=1;for(let p=0;p<o.length-1;++p)s*=o[p];let a=t.shape,l=o.slice();l.pop();let u=1;for(let p=i;p<e;++p)u*=a[p],l.push(a[p]);let c=[...rs(t.shape).map(p=>p/u),1].slice(0,i);return[l,s,u,c]}var kn={};Po(kn,{assertParamsValid:()=>Uce,computeFlatOffset:()=>qce,computeOutShape:()=>Wce,getNormalizedAxes:()=>Hce,isSliceContinous:()=>jce,maskToAxes:()=>Gce,parseSliceParams:()=>p1,sliceInfo:()=>Kce,startForAxis:()=>TB,startIndicesWithElidedDims:()=>SB,stopForAxis:()=>_B,stopIndicesWithElidedDims:()=>IB,stridesForAxis:()=>EB,stridesWithElidedDims:()=>bB});var c1=-2,zce=-1;function Uce(t,n,e){let r=t.shape.length;_(r===n.length,()=>`Error in slice${r}D: Length of begin ${n} must match the rank of the array (${r}).`),_(r===e.length,()=>`Error in slice${r}D: Length of size ${e} must match the rank of the array (${r}).`);for(let o=0;o<r;++o)_(n[o]+e[o]<=t.shape[o],()=>`Error in slice${r}D: begin[${o}] + size[${o}] (${n[o]+e[o]}) would overflow input.shape[${o}] (${t.shape[o]})`)}function Gce(t){let n=[],e=0;for(;t>0;)t&1&&n.push(e),t/=2,e++;return n}function Wce(t,n,e){let r=[];for(let o=0;o<t.length;o++)r[o]=Math.ceil((n[o]-t[o])/e[o]);return r}function bB(t,n,e,r){let o=[...t];for(let i=o.length;i<r.length;i++)o.push(1);for(let i=0;i<e;i++)i===0?o[n]=1:(o.splice(n,0,1),o.pop());return o}function wB(t,n,e){return e<=t?e:e-(n-1)}function CB(t,n){let e=[];for(let r=0;r<t;r++)e.push(n+r);return e}function Hce(t,n,e,r,o,i,s,a,l){let u=t.length,c=new Array(u),p=new Array(u),f=new Array(u);if(n.length&&e>0){let d=n[0],h=e+1;c=SB(s,d,h,r,t),p=IB(a,d,h,o,t),f=bB(i,d,h,t)}else for(let d=0;d<u;d++)c[d]=TB(s,r,i,t,d,l),p[d]=_B(a,o,i,t,d,l),f[d]=EB(i,d,l);return{begin:c,end:p,strides:f}}function SB(t,n,e,r,o){let i=[...o],s=CB(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=0;else{let l=wB(n,e,a),u=r[l];t&1<<l&&(u=0),i[a]=u}return i}function IB(t,n,e,r,o){let i=[...o],s=CB(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{let l=wB(n,e,a),u=r[l];t&1<<l&&(u=Number.MAX_SAFE_INTEGER),i[a]=u}for(let a=0;a<i.length;a++){let l=o[a];i[a]<0&&(i[a]+=l),i[a]=qf(0,i[a],o[a])}return i}function EB(t,n,e){let r=t[n];return(e&1<<n||r==null)&&(r=1),r}function TB(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MIN_SAFE_INTEGER:s=Number.MAX_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),s=qf(0,s,l-1),s}function _B(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MAX_SAFE_INTEGER:s=Number.MIN_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),a>0?s=qf(0,s,l):s=qf(-1,s,l-1),s}function jce(t,n,e){let r=e.length;for(let o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(let o=r+1;o<e.length;o++)if(n[o]>0||e[o]!==t[o])return!1;return!0}function qce(t,n){let e=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}function p1(t,n,e){let r,o=t.shape.length;typeof n=="number"?r=[n,...new Array(o-1).fill(0)]:n.length<o?r=n.concat(new Array(o-n.length).fill(0)):r=n.slice(),r.forEach(s=>{_(s!==-1,()=>"slice() does not support negative begin indexing.")});let i;return e==null?i=new Array(o).fill(-1):typeof e=="number"?i=[e,...new Array(o-1).fill(-1)]:e.length<o?i=e.concat(new Array(o-e.length).fill(-1)):i=e,i=i.map((s,a)=>s>=0?s:(_(s===-1,()=>`Negative size values should be exactly -1 but got ${s} for the slice() size at index ${a}.`),t.shape[a]-r[a])),[r,i]}function Kce(t,n,e,r,o,i,s,a,l){let u;if(r==null?(u=new Array(n.length),u.fill(1)):u=r,s!=null&&(s&s-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1,p={dims:u.length,numAddAxisAfterEllipsis:0,begin:n.slice(),end:e.slice(),strides:u.slice(),beginMask:o,endMask:i,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};for(let b=0;b<p.dims;b++)c&&(1<<b&a)!==0&&p.numAddAxisAfterEllipsis++,1<<b&s&&(c=!0);c||(p.ellipsisMask|=1<<p.dims,p.dims++);let f={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Xce(p,f);let d=!0,h=!0,m=!0,g=[],y=[];for(let b=0;b<t.length;++b){if(f.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);let w=!!(f.shrinkAxisMask&1<<b),C=t[b];if(C===-1){g.push(w?1:-1);continue}let N=[f.beginMask&1<<b,f.endMask&1<<b],D=[f.strides[b]>0?0:-1,f.strides[b]>0?C:C-1];if(w&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&f.strides[b]===1;let k=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(w){let G=f.begin[b]<0?C+f.begin[b]:f.begin[b];if(f.begin[b]=G,f.end[b]=f.begin[b]+1,G<0||G>=C)throw Error(`slice index ${f.begin[b]} of dimension ${b} out of bounds.`)}else f.begin[b]=vB(f.begin[b],0,f.strides[b],C,N,D),f.end[b]=vB(f.end[b],1,f.strides[b],C,N,D);let V=f.strides[b]===1&&f.begin[b]===0&&f.end[b]===C;d=d&&V,h=h&&(b===0&&f.strides[b]===1||V)}else d=d&&f.strides[b]===1&&k,h=h&&(b===0&&f.strides[b]===1||k);let O,$=!1;if(f.beginValid&&f.endValid?(O=f.end[b]-f.begin[b],$=!0):w?(O=1,$=!0):k&&C>=0&&(f.strides[b]<0?O=-C:O=C,$=!0),$){let V;O===0||O<0!=f.strides[b]<0?V=0:V=Math.trunc(O/f.strides[b])+(O%f.strides[b]!==0?1:0),g.push(V)}else g.push(-1)}for(let b=0;b<f.finalShapeGatherIndices.length;++b){let w=f.finalShapeGatherIndices[b];w>=0?y.push(g[w]):w===c1&&y.push(1)}return{finalShapeSparse:y.filter((b,w)=>f.finalShapeGatherIndices[w]!==c1),finalShape:y,isIdentity:d,sliceDim0:h,isSimpleSlice:m,begin:f.begin,end:f.end,strides:f.strides}}function Xce(t,n){n.beginMask=0,n.endMask=0,n.shrinkAxisMask=0;let e=0;n.beginValid=t.begin!=null,n.endValid=t.end!=null,n.begin=new Array(n.dims),n.end=new Array(n.dims),n.strides=new Array(n.dims),n.finalShapeGatherIndices=[],n.finalShapeGatherIndicesSparse=[],n.inputShapeGatherIndicesSparse=new Array(n.dims);for(let r=0;r<t.dims;r++)if(1<<r&t.ellipsisMask){let o=Math.min(n.dims-(t.dims-r)+1+t.numAddAxisAfterEllipsis,n.dims);for(;e<o;e++)n.begin[e]=0,n.end[e]=0,n.strides[e]=1,n.beginMask|=1<<e,n.endMask|=1<<e,n.finalShapeGatherIndices.push(e),n.finalShapeGatherIndicesSparse.push(-1),n.inputShapeGatherIndicesSparse[e]=r}else if(1<<r&t.newAxisMask)n.finalShapeGatherIndices.push(c1),n.finalShapeGatherIndicesSparse.push(-1);else{if(e===n.begin.length)throw Error(`Index out of range using input dim ${e}; input has only ${n.dims} dims, ${n.begin.length}.`);t.begin!=null&&(n.begin[e]=t.begin[r]),t.end!=null&&(n.end[e]=t.end[r]),n.strides[e]=t.strides[r],t.beginMask&1<<r&&(n.beginMask|=1<<e),t.endMask&1<<r&&(n.endMask|=1<<e),t.shrinkAxisMask&1<<r?(n.finalShapeGatherIndices.push(zce),n.finalShapeGatherIndicesSparse.push(-1),n.shrinkAxisMask|=1<<e):(n.finalShapeGatherIndices.push(e),n.finalShapeGatherIndicesSparse.push(r)),n.inputShapeGatherIndicesSparse[e]=r,e++}}function vB(t,n,e,r,o,i){if(o[n])return e>0?i[n]:i[n+1&1];{let s=t<0?r+t:t;return s<i[0]?i[0]:s>i[1]?i[1]:s}}var W0=class{static sgd(n){return new zu(n)}static momentum(n,e,r=!1){return new dh(n,e,r)}static rmsprop(n,e=.9,r=0,o=null,i=!1){return new hh(n,e,r,o,i)}static adam(n=.001,e=.9,r=.999,o=null){return new ph(n,e,r,o)}static adadelta(n=.001,e=.95,r=null){return new uh(n,e,r)}static adamax(n=.002,e=.9,r=.999,o=null,i=0){return new fh(n,e,r,o,i)}static adagrad(n,e=.1){return new ch(n,e)}};var hs=W0;var Yce=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function sy(){return new Promise(t=>Yce(()=>t()))}var S={};Po(S,{ERF_A1:()=>ppe,ERF_A2:()=>fpe,ERF_A3:()=>dpe,ERF_A4:()=>hpe,ERF_A5:()=>mpe,ERF_P:()=>cpe,PARALLELIZE_THRESHOLD:()=>H0,RowPartitionType:()=>Xa,SELU_SCALE:()=>d1,SELU_SCALEALPHA:()=>f1,applyActivation:()=>wp,assertAndGetBroadcastShape:()=>Re,assertAxesAreInnerMostDims:()=>ile,assertParamsConsistent:()=>Zce,assignToTypedArray:()=>wpe,axesAreInnerMostDims:()=>DD,calculateShapes:()=>Hue,checkEinsumDimSizes:()=>_pe,checkPadOnDimRoundingMode:()=>It,combineLocations:()=>aV,combineRaggedTensorToTensorShapes:()=>Jce,complexWithEvenIndex:()=>xpe,complexWithOddIndex:()=>vpe,computeConv2DInfo:()=>sp,computeConv3DInfo:()=>QL,computeDefaultPad:()=>yD,computeDilation2DInfo:()=>uae,computeOptimalWindowSize:()=>rpe,computeOutAndReduceShapes:()=>kD,computeOutShape:()=>Qce,computePool2DInfo:()=>gD,computePool3DInfo:()=>cae,convertConv2DDataFormat:()=>JL,decodeEinsumEquation:()=>Epe,eitherStridesOrDilationsAreOne:()=>Bn,expandShapeToKeepDim:()=>ps,exponent:()=>Spe,exponents:()=>Cpe,fromStringArrayToUint8:()=>Kpe,fromUint8ToStringArray:()=>qpe,getAxesPermutation:()=>AD,getBroadcastDims:()=>oV,getComplexWithIndex:()=>bpe,getEinsumComputePath:()=>Npe,getEinsumPermutation:()=>Tpe,getFusedBiasGradient:()=>bp,getFusedDyActivation:()=>vp,getImageCenter:()=>ope,getInnerMostAxes:()=>sle,getPermuted:()=>spe,getRaggedRank:()=>tpe,getReductionAxes:()=>bt,getReshaped:()=>ipe,getReshapedPermuted:()=>ape,getRowPartitionTypesHelper:()=>epe,getSliceBeginCoords:()=>lpe,getSliceSize:()=>upe,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>Rpe,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>Mpe,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>Ope,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>Ppe,getSparseReshapeInputOutputMismatchErrorMessage:()=>Vpe,getSparseReshapeInputOutputMultipleErrorMessage:()=>Lpe,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>Fpe,getSparseReshapeNegativeOutputDimErrorMessage:()=>$pe,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>Gpe,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>Bpe,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>zpe,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>Upe,getUndoAxesPermutation:()=>Gg,isIdentityPermutation:()=>Dpe,log:()=>ese,mergeRealAndImagArrays:()=>gpe,prepareAndValidate:()=>Bce,prepareSplitSize:()=>Ape,segment_util:()=>m1,shouldFuse:()=>Cp,slice_util:()=>kn,splitRealAndImagArrays:()=>ype,stridesOrDilationsArePositive:()=>cs,tupleValuesAreOne:()=>Do,upcastType:()=>un,validateDefaultValueShape:()=>npe,validateInput:()=>Wue,validateUpdateShape:()=>MV,warn:()=>ls});function Zce(t,n){let e=t[0].length;t.forEach((o,i)=>{_(o.length===e,()=>`Error in concat${e}D: rank of tensors[${i}] must be the same as the rank of the rest (${e})`)}),_(n>=0&&n<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);let r=t[0];t.forEach((o,i)=>{for(let s=0;s<e;s++)_(s===n||o[s]===r[s],()=>`Error in concat${e}D: Shape of tensors[${i}] (${o}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function Qce(t,n){let e=t[0].slice();for(let r=1;r<t.length;r++)e[n]+=t[r][n];return e}var Xa=function(t){return t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS",t}(Xa||{});function Jce(t,n,e){let r=new Array;if(e==null&&n==null)return r;if(n==null)for(;r.length<t+e.length;)r.push(-1);else r=n.slice();if(e==null)return r;if(t+e.length!==r.length)throw new Error(`rt input.shape and shape=${n} are incompatible: rt input.rank = ${t+e.length}, but shape.rank = ${r.length}`);for(let o=1;o<e.length;++o){let i=e[o],s=r[r.length-e.length+o],a=r[s];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${n} are incompatible: rt input.shape[${o+t}] = ${i} but shape[${o+t}] = ${a}`)}else r[s]=i}return r}function epe(t){let n={FIRST_DIM_SIZE:Xa.FIRST_DIM_SIZE,VALUE_ROWIDS:Xa.VALUE_ROWIDS,ROW_LENGTHS:Xa.ROW_LENGTHS,ROW_SPLITS:Xa.ROW_SPLITS,ROW_LIMITS:Xa.ROW_LIMITS,ROW_STARTS:Xa.ROW_STARTS},e=[];for(let r of t)if(r in n)e.push(n[r]);else break;return e}function tpe(t){return t.length===0?0:t[0]===Xa.FIRST_DIM_SIZE?t.length-1:t.length}function npe(t,n){if(t==null||n==null)return;let e=t.length,r=n.length;if(e>=r)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${n}, are incompatible: defaultValue.rank = ${e} must be less than ragged tensor input flatValues.rank = ${r})`);for(let o=0;o<Math.min(e,r-1);++o){let i=t[o],s=n[o+1];if(i>=0&&s>=0&&i!==1&&i!==s)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${n} are incompatible: defaultValue.shape[${o-t.length}] = ${i} but ragged tensor input.flatValues.shape[${o-t.length}] = ${s}`)}}var H0=30;function rpe(t){return t<=H0?t:Zf(t,Math.floor(Math.sqrt(t)))}function ope(t,n,e){let r=e*(typeof t=="number"?t:t[0]),o=n*(typeof t=="number"?t:t[1]);return[r,o]}function ipe(t,n,e,r=!0){let o=[];if(r)o=o.concat(n.slice(0)),o.push(t[0]/e),o=o.concat(t.slice(1));else{o=o.concat(t[0]);let i=n.length;for(let s=0;s<i;++s)o=o.concat([t[s+1]/n[s],n[s]]);o=o.concat(t.slice(i+1))}return o}function spe(t,n,e=!0){let r=[];if(e){r.push(n);for(let o=n+1;o<t;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{let o=[],i=[];for(let s=1;s<t;++s)s>=n*2+1||s%2===1?i.push(s):o.push(s);r.push(...o),r.push(0),r.push(...i)}return r}function ape(t,n,e,r=!0){let o=[];r?o.push(t[0]/e):o.push(t[0]*e);for(let i=1;i<t.length;++i)i<=n.length?r?o.push(n[i-1]*t[i]):o.push(t[i]/n[i-1]):o.push(t[i]);return o}function lpe(t,n){let e=[0];for(let r=0;r<n;++r)e.push(t[r][0]);return e}function upe(t,n,e){let r=t.slice(0,1);for(let o=0;o<e;++o)r.push(t[o+1]-n[o][0]-n[o][1]);return r}var f1=1.7580993408473768,d1=1.0507009873554805;var cpe=.3275911,ppe=.254829592,fpe=-.284496736,dpe=1.421413741,hpe=-1.453152027,mpe=1.061405429;function gpe(t,n){if(t.length!==n.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${n.length}.`);let e=new Float32Array(t.length*2);for(let r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function ype(t){let n=new Float32Array(t.length/2),e=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)n[r/2]=t[r],e[r/2]=t[r+1];return{real:n,imag:e}}function xpe(t){let n=Math.ceil(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=0;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function vpe(t){let n=Math.floor(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=2;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function bpe(t,n){let e=t[n*2],r=t[n*2+1];return{real:e,imag:r}}function wpe(t,n,e,r){t[r*2]=n,t[r*2+1]=e}function Cpe(t,n){let e=new Float32Array(t/2),r=new Float32Array(t/2);for(let o=0;o<Math.ceil(t/2);o++){let i=(n?2:-2)*Math.PI*(o/t);e[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:e,imag:r}}function Spe(t,n,e){let r=(e?2:-2)*Math.PI*(t/n),o=Math.cos(r),i=Math.sin(r);return{real:o,imag:i}}var h1="->",Ipe=/->/g,NB=",",DB="...";function Epe(t,n){t=t.replace(/\s/g,"");let e=(t.length-t.replace(Ipe,"").length)/h1.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${h1}").`);let[r,o]=t.split(h1);_(r.indexOf(DB)===-1,()=>`The ellipsis notation ("${DB}") is not supported yet.`);let i=r.split(NB),s=i.length;if(n!==s)throw new Error(`Expected ${s} input tensors, received ${n}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let f=0;f<o.length;++f){let d=o[f];if(!i.some(h=>h.indexOf(d)!==-1))throw new Error(`Output subscripts contain the label ${d} not present in the input subscripts.`);a.indexOf(d)===-1&&a.push(d)}for(let f=0;f<r.length;++f){let d=r[f];a.indexOf(d)===-1&&d!==NB&&a.push(d)}let l=new Array(i.length);for(let f=0;f<s;++f){if(new Set(i[f].split("")).size!==i[f].length)throw new Error(`Found duplicate axes in input component ${i[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let d=0;d<i[f].length;++d)l[f].push(a.indexOf(i[f][d]))}let u=a.length,c=o.length,p=[];for(let f=c;f<u;++f)p.push(f);return{allDims:a,summedDims:p,idDims:l}}function Tpe(t,n){let e=new Array(t);e.fill(-1);for(let o=0;o<n.length;++o)e[n[o]]=o;let r=[];for(let o=0;o<t;++o)e[o]===-1&&r.push(o);return e=e.filter(o=>o!==-1),{permutationIndices:e,expandDims:r}}function _pe(t,n,e){let r=new Array(t);for(let o=0;o<e.length;++o){let i=e[o].shape;for(let s=0;s<n[o].length;++s)r[n[o][s]]===void 0?r[n[o][s]]=i[s]:_(r[n[o][s]]===i[s],()=>`Expected dimension ${r[n[o][s]]} at axis ${s} of input shaped ${JSON.stringify(i)}, but got dimension ${i[s]}`)}}function Npe(t,n){let e=t,r=[],o=0;t.length===0&&e.push(-1),o=t.length+1;for(let s=0;s<o;++s)r.push([]);let i=[];for(let s=0;s<e.length;++s){let a=e[s],l=kpe(n,a);for(let u of l)i.indexOf(u)===-1&&(r[s].push(u),i.push(u))}return{path:e,steps:r}}function Dpe(t){return t.every((n,e)=>n===e)}function kpe(t,n){let e=[];for(let r=0;r<t.length;++r)(t[r].length===0||t[r].indexOf(n)!==-1||n===-1)&&e.push(r);return e}function Ape(t,n,e=0){let r=[];if(typeof n=="number")_(t.shape[e]%n===0,()=>"Number of splits must evenly divide the axis."),r=new Array(n).fill(t.shape[e]/n);else{let o=n.reduce((s,a)=>(a===-1&&(s+=1),s),0);_(o<=1,()=>"There should be only one negative value in split array.");let i=n.indexOf(-1);if(i!==-1){let s=n.reduce((a,l)=>l>0?a+l:a);n[i]=t.shape[e]-s}_(t.shape[e]===n.reduce((s,a)=>s+a),()=>"The sum of sizes must match the size of the axis dimension."),r=n}return r}function Rpe(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function Mpe(t,n){return`indices(${t}, 0) is invalid: ${n} < 0`}function Ope(t,n,e){return`indices(${t}, 0) is invalid: ${n} >= ${e}`}function Fpe(t,n){return`only one output dimension may be -1, not both ${t} and ${n}`}function $pe(t,n){return`size ${t} must be non-negative, not ${n}`}function Ppe(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Lpe(t,n){let e=ot(t),r=ot(n);return`Input to reshape is a SparseTensor with ${e}
  dense values, but the requested shape requires a multiple of ${r}. inputShape=${t} outputShape= ${n}`}function Vpe(t,n){let e=ot(t),r=ot(n);return`Input to reshape is a tensor with ${e} dense values, but the requested shape has ${r}. inputShape=${t} outputShape=${n}`}function Bpe(){return"segment ids must be >= 0"}function zpe(){return"segment ids are not increasing"}function Upe(t,n){return`Segment id ${t} out of range [0, ${n}), possibly because segmentIds input is not sorted.`}function Gpe(t,n,e){return`Bad: indices[${t}] == ${n} out of range [0, ${e})`}var m1={};Po(m1,{collectGatherOpShapeInfo:()=>jpe,computeOutShape:()=>Hpe,segOpComputeOptimalWindowSize:()=>Wpe});function Wpe(t,n){let e=!1,r;for(t<=H0?(r=t,e=!0):r=Zf(t,Math.floor(Math.sqrt(t)));!e;)r>n||r===t?e=!0:r=Zf(t,r+1);return r}function Hpe(t,n,e){let r=[],o=t.length;for(let i=0;i<o;i++)i!==n?r.push(t[i]):r.push(e);return r}function jpe(t,n,e,r){let o=n.shape.length,i=t.shape.length;if(r!==0&&(r<-o||r>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${r}`);if(r<0&&(r+=o),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(e<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${e}).`);for(let p=0;p<r;++p)if(t.shape[p]!==n.shape[p])throw new Error(`x.shape[${p}]: ${t.shape[p]} should be equal to indices.shape[${p}]: ${n.shape[p]}.`);let s=t.shape[e],a=[],l=1,u=1,c=1;for(let p=0;p<r;++p)a.push(t.shape[p]),l*=t.shape[p];for(let p=r;p<e;p++)a.push(t.shape[p]),u*=t.shape[p];for(let p=r;p<o;p++)a.push(n.shape[p]);for(let p=e+1;p<i;p++)a.push(t.shape[p]),c*=t.shape[p];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:s,outputShape:a}}function qpe(t){try{return t.map(n=>Ud(n))}catch(n){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${n}`)}}function Kpe(t){return t.map(n=>zd(n))}var nr={};Po(nr,{nonMaxSuppressionV3Impl:()=>F0,nonMaxSuppressionV4Impl:()=>$0,nonMaxSuppressionV5Impl:()=>P0,whereImpl:()=>$V});lB();var j0={kernelName:Vl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(t,Mi(J(e,"float32"),-1))}}};var kB={kernelName:js,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Le(J(e,"float32")),o=wt(pe(Se(1),r));return Qe(se(t,o))}}}};var AB={kernelName:qs,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=wt(pe(Le(J(e,"float32")),1));return se(t,r)}}}};var RB={kernelName:_i,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Re(e.shape,r.shape);return{a:()=>{let a=t,l=bt(e.shape,o);return l.length>0&&(a=ue(a,l)),M(a,e.shape)},b:()=>{let a=t,l=bt(r.shape,o);return l.length>0&&(a=ue(a,l)),M(a,r.shape)}}}};var MB={kernelName:Jf,saveAllInputs:!0,gradFunc:(t,n)=>{let e={};return n.forEach((r,o)=>{e[o]=()=>t.clone()}),e}};var OB={kernelName:Bl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>be(e)}}};var FB={kernelName:zl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>be(e)}}};var $B={kernelName:Ks,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>se(t,wt(pe(Se(1),Le(J(e,"float32")))))}}};var PB={kernelName:Xs,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=wt(Z(Se(1),Le(J(e,"float32"))));return se(t,r)}}}};var LB={kernelName:Qs,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Re(e.shape,r.shape);return{a:()=>{let a=Z(Le(e),Le(r)),l=R(t,se(r,a)),u=bt(e.shape,o);return u.length>0&&(l=ue(l,u)),M(l,e.shape)},b:()=>{let a=Z(Le(e),Le(r)),l=Qe(R(t,se(e,a))),u=bt(r.shape,o);return u.length>0&&(l=ue(l,u)),M(l,r.shape)}}}};var VB={kernelName:Ys,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>se(t,Z(Le(J(e,"float32")),1))}}};var BB={kernelName:Zs,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>se(t,pe(Se(1),Le(J(e,"float32"))))}}};function Xpe(t,n,e,r,o,i){let s=I(t,"dy","avgPool3dGrad"),a=I(n,"input","avgPool3dGrad"),l=s,u=a,c=!1;a.rank===4&&(c=!0,l=M(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),u=M(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),_(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),_(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),It("avgPool3dGrad",o,i);let p={dy:l,input:u},f={filterSize:e,strides:r,pad:o,dimRoundingMode:i},d=E.runKernel(rd,p,f);return c?M(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var zB=T({avgPool3dGrad_:Xpe});var UB={kernelName:Gl,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s,dimRoundingMode:a}=e;return{x:()=>zB(t,r,o,i,s,a)}}};function Ype(t,n,e,r,o){let i=I(t,"dy","avgPoolGrad"),s=I(n,"input","avgPoolGrad");_(s.rank===i.rank,()=>`Rank of input (${s.rank}) does not match rank of dy (${i.rank})`);let a=s,l=i,u=!1;s.rank===3&&(u=!0,a=M(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=M(i,[1,i.shape[0],i.shape[1],i.shape[2]])),_(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),_(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let c={dy:l,input:a},p={filterSize:e,strides:r,pad:o},f=E.runKernel(nd,c,p);return u?M(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var GB=T({avgPoolGrad_:Ype});var WB={kernelName:Ul,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s}=e;return{x:()=>GB(t,r,o,i,s)}}};var HB={kernelName:Wl,inputsToSave:["a","b"],gradFunc:(t,n,e)=>{let[r,o]=n,{transposeA:i,transposeB:s}=e;return!i&&!s?{a:()=>it(t,o,!1,!0),b:()=>it(r,t,!0,!1)}:!i&&s?{a:()=>it(t,o,!1,!1),b:()=>it(t,r,!0,!1)}:i&&!s?{a:()=>it(o,t,!1,!0),b:()=>it(r,t,!1,!1)}:{a:()=>it(o,t,!0,!0),b:()=>it(t,r,!0,!0)}}};var jB={kernelName:Hl,gradFunc:(t,n,e)=>{let{blockShape:r,crops:o}=e;return{x:()=>oh(t,r,o)}}};var qB={kernelName:BP,gradFunc:(t,n,e)=>{let r=e,o=r.inputShape,i=r.shape,s=Array.from(i);for(let l=o.length-1;l>=0;l--)if(o[l]===i[l])s[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${i}].`);let a=[];for(let l=0;l<s.length;l++)s[l]>1&&a.push(l);return{x:()=>ue(t,a,!0)}}};var KB={kernelName:os,gradFunc:t=>({x:()=>t.clone()})};var XB={kernelName:Js,gradFunc:t=>({x:()=>be(t)})};var YB={kernelName:ea,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{clipValueMin:o,clipValueMax:i}=e;return{x:()=>kt(ur(Pr(r,o),ti(r,i)),t,be(t))}}};var ZB={kernelName:jl,inputsToSave:["x"],gradFunc:j0.gradFunc};var QB={kernelName:ql,saveAllInputs:!0,gradFunc:(t,n,e)=>{let r=n.map(l=>l.shape),{axis:o}=e,i=hn(o,n[0].shape)[0],s=r.map(l=>l[i]);return bn(t,s,i).map(l=>()=>l)}};var JB={kernelName:Kl,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{dilations:i,strides:s,pad:a,dataFormat:l}=e;return _(Do(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>Zd(r.shape,t,o,s,a,l),filter:()=>lh(r,t,o.shape,s,a,l)}}};var ez={kernelName:Xl,inputsToSave:["dy","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{strides:i,pad:s,dataFormat:a,dimRoundingMode:l}=e;return{dy:()=>oo(t,o,i,s,a,1,l),filter:()=>lh(t,r,o.shape,i,s,a,l)}}};function Zpe(t,n,e,r,o){let i=t;t.rank===4&&(i=M(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let s=n;s.rank===4&&(s=M(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]])),_(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),_(s.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${s.shape}.`),_(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),_(i.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${e[3]}.`),_(s.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${s.shape[4]}) must match output depth for filter (${e[4]}).`);let a={x:i,dy:s},l={strides:r,pad:o,filterShape:e};return E.runKernel(ad,a,l)}var tz=T({conv3DBackpropFilter_:Zpe});var nz={kernelName:Yl,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i}=e;_(Do(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[s,a]=n;return{x:()=>S0(s.shape,t,a,o,i),filter:()=>tz(s,t,a.shape,o,i)}}};var rz={kernelName:ta,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(Qe(Qg(J(e,"float32"))),t)}}};var oz={kernelName:na,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(Jg(J(e,"float32")),t)}}};var iz={kernelName:Zl,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o,exclusive:i,reverse:s}=e;return{x:()=>{let a=AD([o],r.rank),l=I0(t,o,i,!s);return a!=null&&(l=$e(l,a)),l}}}};var sz={kernelName:Ql,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i,dimRoundingMode:s}=e,a=r??[1,1];_(Do(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[l,u]=n;return _(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),_(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),_(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),_(Bn(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),It("depthwiseConv2d",i,s),{x:()=>O0(l.shape,t,u,o,i,a,s),filter:()=>M0(l,t,u.shape,o,i,a,s)}}};var az={kernelName:Jl,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,i={x:r,filter:o,dy:t},s={x:r,filter:o,dy:t};return{x:()=>E.runKernel(Tg,i,e),filter:()=>E.runKernel(_g,s,e)}}};var lz={kernelName:oa,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n,r={dy:t,y:e};return{x:()=>E.runKernel(gd,r)}}};var uz={kernelName:ia,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=R(Nn(Qe(Le(e))),2/Math.sqrt(Math.PI));return{x:()=>R(t,r)}}};var cz={kernelName:sa,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(t,e)}}};var pz={kernelName:eu,inputsToSave:["input"],gradFunc:(t,n)=>{let[e]=n;return{input:()=>M(t,e.shape)}}};var fz={kernelName:aa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(t,Nn(e))}}};var dz={kernelName:la,gradFunc:t=>({x:()=>be(t)})};var hz={kernelName:ua,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Re(e.shape,r.shape);return{a:()=>{let a=se(t,J(r,"float32")),l=bt(e.shape,o);return l.length>0?M(ue(a,l),e.shape):a},b:()=>{let a=R(t,J(e,"float32")),l=bt(r.shape,o);l.length>0&&(a=M(ue(a,l),r.shape));let u=Le(r);return Qe(se(a,J(u,"float32")))}}}};var mz={kernelName:tu,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,n,e)=>{let{varianceEpsilon:r}=e,[o,i,s,a]=n,l=a??Se(1),u=bt(i.shape,o.shape),c=[];if(i.rank===1){for(let w=0;w<o.shape.length-1;++w)c.push(o.shape[w]);c.push(1)}let p=pe(o,i),f=R(t,l),d=Xg(Z(s,Se(r))),h=R(R(R(d,d),d),Se(-.5));return{x:()=>i.rank===1?M(R(R(t,er(M(d,[1,1,1,i.shape[0]]),c)),l),o.shape):M(R(R(t,d),l),o.shape),mean:()=>{let w=R(R(d,Se(-1)),f);return i.rank===1&&(w=ue(w,u)),M(w,i.shape)},variance:()=>{let w=R(R(h,p),f);return i.rank===1&&(w=ue(w,u)),M(w,i.shape)},scale:()=>{let w=R(p,d),C=R(t,w);return i.rank===1&&(C=ue(C,u)),M(C,i.shape)},offset:()=>{let w=t;return i.rank===1&&(w=ue(w,u)),M(w,i.shape)}}}};var xz={kernelName:nu,inputsToSave:["x","indices"],gradFunc:(t,n,e)=>{let[r,o]=n,{axis:i,batchDims:s}=e,a=hn(i,r.shape)[0],l=(u,c,p)=>()=>{let f=u.shape,d=c.size,h=f.slice(0,a),m=h.length,g=f.slice(i,f.length).slice(1),y=g.length,x=gz(0,m),b=gz(m+1,m+1+y),w=yz([h,[d],g]),C=M(p,w),N=M(c,[d]),D=yz([[m],x,b]),k=$e(C,D),O=R0(k,N,u.shape[a]),$=Gg(D);return O=$e(O,$),O};if(s===1){let u=r.shape[0],c=r.split(u,0);return{x:()=>mn(c.map((d,h)=>l(d,o.slice(h,1),t.slice(h,1))())).reshape(r.shape),indices:()=>o}}else return{x:l(r,o,t),indices:()=>o}}};function gz(t,n){let e=[];for(let r=t;r<n;++r)e.push(r);return e}function yz(t){let n=[];for(let e=0;e<t.length;++e)for(let r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var vz={kernelName:ca,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>be(e),b:()=>be(r)}}};var bz={kernelName:is,gradFunc:t=>({x:()=>J(t,"float32")})};var wz={kernelName:pa,gradFunc:t=>({x:()=>be(t)})};var Cz={kernelName:fa,gradFunc:t=>({x:()=>be(t)})};var Sz={kernelName:da,gradFunc:t=>({x:()=>be(t)})};var Iz={kernelName:ru,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{alpha:o}=e,i=Zt(r,0);return{x:()=>kt(i,t,R(t,o))}}};var Ez={kernelName:ma,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>se(t,Z(e,1))}}};var Tz={kernelName:ha,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>se(t,J(e,"float32"))}}};var _z={kernelName:UP,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e;return{logits:()=>{let s=Nn(r);return pe(t,R(ue(t,o,!0),s))}}}};function Qpe(t,n,e,r=5,o=1,i=1,s=.5){let a={x:t,y:n,dy:e},l={depthRadius:r,bias:o,alpha:i,beta:s};return E.runKernel(Cd,a,l)}var Nz=T({localResponseNormalizationBackprop_:Qpe});var Dz={kernelName:ou,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{depthRadius:i,bias:s,alpha:a,beta:l}=e;return{x:()=>Nz(r,o,t,i,s,a,l)}}};function q0(t,n,e,r){return n.rank<e.rank&&(n=M(n,ps(n.shape,r))),t.rank<e.rank&&(t=M(t,ps(t.shape,r))),{x:()=>R(t,J(Cr(e,n),t.dtype))}}var g1={kernelName:iu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{reductionIndices:o}=r,i=n[0],s=n[1],a=hn(o,i.shape),l=q0(t,s,i,a);return{x:()=>l.x()}}};var kz={kernelName:ga,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>R(t,J(Pr(e,r),"float32")),b:()=>R(t,J(fp(e,r),"float32"))}}};function Jpe(t,n,e,r,o,i,s){let a=I(t,"dy","maxPool3dGrad"),l=I(n,"input","maxPool3dGrad"),u=I(e,"output","maxPool3dGrad"),c=a,p=l,f=u,d=!1;l.rank===4&&(d=!0,c=M(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),p=M(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=M(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),_(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),_(p.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${p.rank}.`),_(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),It("maxPool3dGrad",i,s);let h={dy:c,input:p,output:f},m={filterSize:r,strides:o,pad:i,dimRoundingMode:s},g=E.runKernel(Id,h,m);return d?M(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var Az=T({maxPool3dGrad_:Jpe});var Rz={kernelName:au,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=e;return{x:()=>Az(t,r,o,i,s,a,l)}}};function efe(t,n,e,r,o,i,s){let a=I(t,"dy","maxPoolGrad"),l=I(n,"input","maxPoolGrad"),u=I(e,"output","maxPoolGrad");_(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),_(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),_(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),It("maxPoolGrad",i,s);let c={dy:a,input:l,output:u},p={filterSize:r,strides:o,pad:i,dimRoundingMode:s};return E.runKernel(Sd,c,p)}var Mz=T({maxPoolGrad_:efe});var Oz={kernelName:su,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a}=e;return{x:()=>Mz(t,r,o,i,s,a)}}};var Fz={kernelName:lu,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e,i=hn(o,r.shape),a=kD(r.shape,i)[1],l=ot(a);return{x:()=>{let c=r.shape.slice();i.forEach(d=>{c[d]=1});let p=M(t,c);return se(R(p,Ir(r.shape,"float32")),l)}}}};var $z={kernelName:uu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{axis:o}=r,[i,s]=n,a=hn(o,i.shape),l=q0(t,s,i,a);return{x:()=>l.x()}}};var Pz={kernelName:ya,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>R(t,J(ti(e,r),"float32")),b:()=>R(t,J(Zt(e,r),"float32"))}}};var Lz={kernelName:cu,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>qe(t,i,r.shape)}}};var Vz={kernelName:xa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Re(e.shape,r.shape);return{a:()=>{let a=bt(e.shape,o);return a.length>0?M(ue(t,a),e.shape):t},b:()=>{let a=R(t,Qe(ja(se(e,r)))),l=bt(r.shape,o);return l.length>0?M(ue(a,l),r.shape):a}}}};var Bz={kernelName:va,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Re(e.shape,r.shape);return{a:()=>{let a=R(t,J(r,"float32")),l=bt(e.shape,o);return l.length>0?M(ue(a,l),e.shape):a},b:()=>{let a=R(t,J(e,"float32")),l=bt(r.shape,o);return l.length>0?M(ue(a,l),r.shape):a}}}};var zz={kernelName:pu,gradFunc:t=>({x:()=>Qe(t)})};var Uz={kernelName:du,inputsToSave:["indices"],gradFunc:(t,n)=>{let e=n[0];return{indices:()=>At(e.shape,"float32")}}};var Gz={kernelName:fu,gradFunc:t=>({x:()=>be(t)})};var Wz={kernelName:hu,saveAllInputs:!0,gradFunc:(t,n,e)=>{let{axis:r}=e;return cr(t,r).map(i=>()=>i)}};var y1={kernelName:mu,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>qe(t,i,r.shape)}}};var Hz={kernelName:ba,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,n)=>{let[e,r,o]=n,i=e,s=r,a=Re(i.shape,s.shape);return{a:()=>{let c=J(s,"float32"),p=R(t,R(c,$r(i,pe(c,Se(1))))),f=bt(i.shape,a);return f.length>0&&(p=ue(p,f)),M(p,i.shape)},b:()=>{let c=Zt(i,0),p=kt(c,Sr(i),be(i)),f=R(t,R(o,p)),d=bt(s.shape,a);return d.length>0&&(f=ue(f,d)),M(f,s.shape)}}}};var jz={kernelName:gu,inputsToSave:["x","alpha"],gradFunc:(t,n)=>{let[e,r]=n,o=Zt(e,0);return{x:()=>kt(o,t,R(t,r)),alpha:()=>{let i=kt(o,be(t),R(t,e)),s=bt(r.shape,t.shape);return s.length>0&&(i=ue(i,s)),M(i,r.shape)}}}};function tfe(t,n,e){let r=t.shape.slice();r[e]=1;let o=M(n,r),i=zg(t,e,!0,!1),s=zg(t,e,!0,!0),a=R(i,s);return R(o,a)}function nfe(t,n,e){let r=t.shape.length,o=r-e.length,i=S.getAxesPermutation(e,r),s=t;i!=null&&(s=$e(t,i));let a=s.shape.slice(),u=a.splice(r-e.length,e.length).reduce((f,d)=>f*d,1);a.push(u);let c=s.reshape(a),p=tfe(c,n,o);if(p=p.reshape(s.shape),i!=null){let f=S.getUndoAxesPermutation(i);p=$e(p,f)}return p}var qz={kernelName:yu,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e,i=[];return o==null?i=r.shape.map((s,a)=>a):typeof o=="number"?i=[o]:i=o,{x:()=>nfe(r,t,i)}}};var Kz={kernelName:ra,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Re(e.shape,r.shape);return{a:()=>{let a=se(t,J(r,"float32")),l=bt(e.shape,o);return l.length>0?M(ue(a,l),e.shape):a},b:()=>{let a=R(t,J(e,"float32")),l=bt(r.shape,o);l.length>0&&(a=M(ue(a,l),r.shape));let u=Le(r);return Qe(se(a,J(u,"float32")))}}}};var Xz={kernelName:wa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>se(t,Qe(Le(e)))}}};var Yz={kernelName:Sa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=R(ti(e,6),Mi(e));return{x:()=>R(t,J(r,"float32"))}}};var Zz={kernelName:Ca,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(t,J(Mi(e),"float32"))}}};var Qz={kernelName:xu,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>M(t,e.shape)}}};var Jz={kernelName:bu,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>E.runKernel(Ad,o,e)}}};var e3={kernelName:vu,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>E.runKernel(kd,o,e)}}};var t3={kernelName:wu,gradFunc:(t,n,e)=>{let{dims:r}=e,o=hn(r,t.shape);return{x:()=>Ro(t,o)}}};var n3={kernelName:Ia,gradFunc:t=>({x:()=>be(t)})};var r3={kernelName:Ea,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Qe(se(t,R($r(e,1.5),2)))}}};var o3={kernelName:Cu,inputsToSave:["condition"],gradFunc:(t,n)=>{let[e]=n;return{condition:()=>J(be(e),"float32"),t:()=>R(t,J(e,t.dtype)),e:()=>R(t,J(th(e),t.dtype))}}};var i3={kernelName:Ta,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Zt(e,Se(0)),o=Se(f1),i=Se(d1),s=R(t,i),a=R(R(t,o),Nn(J(e,"float32")));return kt(r,s,a)}}}};var s3={kernelName:ka,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(t,R(e,pe(Se(1),e)))}}};var a3={kernelName:Da,gradFunc:t=>({x:()=>be(t)})};var l3={kernelName:_a,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(up(J(e,"float32")),t)}}};var u3={kernelName:Na,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(Bg(J(e,"float32")),t)}}};var c3={kernelName:Su,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{begin:o,size:i}=e,s=r.shape,[a,l]=p1(r,o,i),u=[];for(let c=0;c<t.rank;c++)u.push([a[c],s[c]-a[c]-l[c]]);return{x:()=>hp(t,u)}}};var p3={kernelName:_u,outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{dim:o}=e,i=!0,s=R(t,r);return{logits:()=>pe(s,R(ue(s,[o],i),r))}}};var f3={kernelName:Aa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(t,ei(e))}}};var x1={kernelName:Eu,gradFunc:(t,n,e)=>{let{blockShape:r,paddings:o}=e;return{x:()=>Yd(t,r,o)}}};var v1={kernelName:Tu,gradFunc:(t,n,e)=>{let{axis:r}=e;return{x:()=>Dt(t,r)}}};var d3={kernelName:Ra,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>se(t,R(wt(J(e,"float32")),2))}}};var h3={kernelName:Rd,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(t,R(J(e,"float32"),2))}}};var m3={kernelName:Ma,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Se(2);return{a:()=>R(t,R(o,pe(e,r))),b:()=>R(t,R(o,pe(r,e)))}}};var g3={kernelName:Pa,gradFunc:t=>({x:()=>be(t)})};var y3={kernelName:Oa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Re(e.shape,r.shape);return{a:()=>{let a=t,l=bt(e.shape,o);return l.length>0&&(a=ue(a,l)),M(a,e.shape)},b:()=>{let a=t,l=bt(r.shape,o);return l.length>0&&(a=ue(a,l)),M(Qe(a),r.shape)}}}};var x3={kernelName:Iu,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,o=r.shape.slice(),{axis:i}=e;hn(i,r.shape).forEach(u=>{o[u]=1});let a=M(t,o),l=R(a,Ir(r.shape,"float32"));return{x:()=>l}}};var v3={kernelName:Fa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>se(t,Le(up(e)))}}};var b3={kernelName:$a,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>R(pe(Se(1),Le(e)),t)}}};var w3={kernelName:ss,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{reps:o}=e;return{x:()=>{let s=be(r);if(r.rank===1)for(let a=0;a<o[0];++a)s=Z(s,qe(t,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)s=Z(s,qe(t,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let u=0;u<o[2];++u)s=Z(s,qe(t,[a*r.shape[0],l*r.shape[1],u*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let u=0;u<o[2];++u)for(let c=0;c<o[3];++c)s=Z(s,qe(t,[a*r.shape[0],l*r.shape[1],u*r.shape[2],c*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return s}}}};var C3={kernelName:as,gradFunc:(t,n,e)=>{let r=e,{perm:o}=r,i=Gg(o);return{x:()=>$e(t,i)}}};var S3={kernelName:Nu,gradFunc:(t,n,e)=>{let r=e,{axis:o}=r;return{value:()=>mn(t,o)}}};var I3={kernelName:Du,inputsToSave:["segmentIds"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>rfe(t,e)}}};function rfe(t,n){let e=so(n,be(n)),r=cp(t,e),o=Pr(n,Se(0,"int32")),i=r.rank-o.rank;for(let a=0;a<i;++a)o=sn(o,a+1);o=ur(o,Ir(r.shape,"bool"));let s=be(r);return kt(o,r,s)}var E3={kernelName:ku,gradFunc:t=>({x:()=>be(t)})};var ofe=[j0,kB,AB,RB,MB,OB,FB,$B,PB,LB,VB,BB,UB,WB,HB,jB,qB,KB,XB,YB,ZB,QB,ez,JB,nz,rz,oz,iz,sz,az,Kz,lz,uz,cz,pz,fz,hz,dz,mz,xz,vz,bz,wz,Cz,Sz,Iz,Ez,Tz,_z,Dz,g1,g1,kz,Rz,Oz,Fz,$z,Pz,Lz,Vz,Bz,zz,Uz,Gz,Wz,y1,y1,Hz,jz,qz,Xz,Yz,Zz,Qz,Jz,e3,t3,n3,r3,o3,i3,s3,a3,l3,u3,c3,p3,f3,x1,x1,v1,v1,d3,m3,h3,g3,y3,x3,v3,b3,w3,C3,S3,I3,E3];for(let t of ofe)HP(t);A().prototype.abs=function(){return this.throwIfDisposed(),cn(this)};A().prototype.acos=function(){return this.throwIfDisposed(),uD(this)};A().prototype.acosh=function(){return this.throwIfDisposed(),cD(this)};A().prototype.add=function(t){return this.throwIfDisposed(),Z(this,t)};A().prototype.all=function(t,n){return this.throwIfDisposed(),Fg(this,t,n)};A().prototype.any=function(t,n){return this.throwIfDisposed(),Kd(this,t,n)};A().prototype.argMax=function(t){return this.throwIfDisposed(),za(this,t)};A().prototype.argMin=function(t){return this.throwIfDisposed(),YL(this,t)};A().prototype.asScalar=function(){return this.throwIfDisposed(),_(this.size===1,()=>"The array must have only 1 element."),M(this,[])};A().prototype.asType=function(t){return this.throwIfDisposed(),J(this,t)};A().prototype.as1D=function(){return this.throwIfDisposed(),M(this,[this.size])};A().prototype.as2D=function(t,n){return this.throwIfDisposed(),M(this,[t,n])};A().prototype.as3D=function(t,n,e){return this.throwIfDisposed(),M(this,[t,n,e])};A().prototype.as4D=function(t,n,e,r){return this.throwIfDisposed(),M(this,[t,n,e,r])};A().prototype.as5D=function(t,n,e,r,o){return this.throwIfDisposed(),M(this,[t,n,e,r,o])};A().prototype.asin=function(){return this.throwIfDisposed(),pD(this)};A().prototype.asinh=function(){return this.throwIfDisposed(),fD(this)};A().prototype.atan=function(){return this.throwIfDisposed(),dD(this)};A().prototype.atan2=function(t){return this.throwIfDisposed(),ZL(this,t)};A().prototype.atanh=function(){return this.throwIfDisposed(),hD(this)};A().prototype.avgPool=function(t,n,e,r){return this.throwIfDisposed(),ap(this,t,n,e,r)};A().prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),Yd(this,t,n)};A().prototype.batchNorm=function(t,n,e,r,o){return this.throwIfDisposed(),Pu(this,t,n,e,r,o)};A().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Ua(this,t)};A().prototype.cast=function(t){return this.throwIfDisposed(),J(this,t)};A().prototype.ceil=function(){return this.throwIfDisposed(),CD(this)};A().prototype.clipByValue=function(t,n){return this.throwIfDisposed(),zn(this,t,n)};A().prototype.concat=function(t,n){return this.throwIfDisposed(),t instanceof lt&&(t=[t]),Dt([this,...t],n)};A().prototype.conv1d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Lg(this,t,n,e,r,o,i)};A().prototype.conv2dTranspose=function(t,n,e,r,o){return this.throwIfDisposed(),Vg(this,t,n,e,r,o)};A().prototype.conv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),oo(this,t,n,e,r,o,i)};A().prototype.cos=function(){return this.throwIfDisposed(),up(this)};A().prototype.cosh=function(){return this.throwIfDisposed(),Bg(this)};A().prototype.cumprod=function(t,n,e){return this.throwIfDisposed(),zg(this,t,n,e)};A().prototype.cumsum=function(t,n,e){return this.throwIfDisposed(),I0(this,t,n,e)};A().prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),nV(this,t,n)};A().prototype.depthwiseConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Wa(this,t,n,e,r,o,i)};A().prototype.dilation2d=function(t,n,e,r,o){return this.throwIfDisposed(),rV(this,t,n,e,r,o)};A().prototype.divNoNan=function(t){return this.throwIfDisposed(),iV(this,t)};A().prototype.div=function(t){return this.throwIfDisposed(),se(this,t)};A().prototype.dot=function(t){return this.throwIfDisposed(),sV(this,t)};A().prototype.elu=function(){return this.throwIfDisposed(),Ha(this)};A().prototype.equal=function(t){return this.throwIfDisposed(),Cr(this,t)};A().prototype.erf=function(){return this.throwIfDisposed(),Ug(this)};A().prototype.euclideanNorm=function(t,n){return this.throwIfDisposed(),uV(this,t,n)};A().prototype.exp=function(){return this.throwIfDisposed(),Nn(this)};A().prototype.expandDims=function(t){return this.throwIfDisposed(),sn(this,t)};A().prototype.expm1=function(){return this.throwIfDisposed(),MD(this)};A().prototype.fft=function(){return this.throwIfDisposed(),ny(this)};A().prototype.flatten=function(){return this.throwIfDisposed(),M(this,[this.size])};A().prototype.floor=function(){return this.throwIfDisposed(),ja(this)};A().prototype.floorDiv=function(t){return this.throwIfDisposed(),C0(this,t)};A().prototype.gather=function(t,n,e){return this.throwIfDisposed(),cp(this,t,n,e)};A().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Pr(this,t)};A().prototype.greater=function(t){return this.throwIfDisposed(),Zt(this,t)};A().prototype.ifft=function(){return this.throwIfDisposed(),ah(this)};A().prototype.irfft=function(){return this.throwIfDisposed(),XD(this)};A().prototype.isFinite=function(){return this.throwIfDisposed(),OD(this)};A().prototype.isInf=function(){return this.throwIfDisposed(),FD(this)};A().prototype.isNaN=function(){return this.throwIfDisposed(),$D(this)};A().prototype.leakyRelu=function(t){return this.throwIfDisposed(),pp(this,t)};A().prototype.lessEqual=function(t){return this.throwIfDisposed(),ti(this,t)};A().prototype.less=function(t){return this.throwIfDisposed(),fp(this,t)};A().prototype.localResponseNormalization=function(t,n,e,r){return this.throwIfDisposed(),cV(this,t,n,e,r)};A().prototype.logSigmoid=function(){return this.throwIfDisposed(),LD(this)};A().prototype.logSoftmax=function(t){return this.throwIfDisposed(),Hg(this,t)};A().prototype.logSumExp=function(t,n){return this.throwIfDisposed(),jg(this,t,n)};A().prototype.log=function(){return this.throwIfDisposed(),Sr(this)};A().prototype.log1p=function(){return this.throwIfDisposed(),Wg(this)};A().prototype.logicalAnd=function(t){return this.throwIfDisposed(),ur(this,t)};A().prototype.logicalNot=function(){return this.throwIfDisposed(),th(this)};A().prototype.logicalOr=function(t){return this.throwIfDisposed(),T0(this,t)};A().prototype.logicalXor=function(t){return this.throwIfDisposed(),pV(this,t)};A().prototype.matMul=function(t,n,e){return this.throwIfDisposed(),it(this,t,n,e)};A().prototype.maxPool=function(t,n,e,r){return this.throwIfDisposed(),dp(this,t,n,e,r)};A().prototype.max=function(t,n){return this.throwIfDisposed(),Un(this,t,n)};A().prototype.maximum=function(t){return this.throwIfDisposed(),so(this,t)};A().prototype.mean=function(t,n){return this.throwIfDisposed(),$t(this,t,n)};A().prototype.min=function(t,n){return this.throwIfDisposed(),Lu(this,t,n)};A().prototype.minimum=function(t){return this.throwIfDisposed(),ds(this,t)};A().prototype.mirrorPad=function(t,n){return this.throwIfDisposed(),fV(this,t,n)};A().prototype.mod=function(t){return this.throwIfDisposed(),dV(this,t)};A().prototype.mul=function(t){return this.throwIfDisposed(),R(this,t)};A().prototype.neg=function(){return this.throwIfDisposed(),Qe(this)};A().prototype.norm=function(t,n,e){return this.throwIfDisposed(),Vu(this,t,n,e)};A().prototype.notEqual=function(t){return this.throwIfDisposed(),Bu(this,t)};A().prototype.oneHot=function(t,n=1,e=0){return this.throwIfDisposed(),rh(this,t,n,e)};A().prototype.onesLike=function(){return this.throwIfDisposed(),Dn(this)};A().prototype.pad=function(t,n){return this.throwIfDisposed(),hp(this,t,n)};A().prototype.pool=function(t,n,e,r,o,i){return this.throwIfDisposed(),hV(this,t,n,e,r,o,i)};A().prototype.pow=function(t){return this.throwIfDisposed(),$r(this,t)};A().prototype.prelu=function(t){return this.throwIfDisposed(),mp(this,t)};A().prototype.prod=function(t,n){return this.throwIfDisposed(),mV(this,t,n)};A().prototype.reciprocal=function(){return this.throwIfDisposed(),qD(this)};A().prototype.relu=function(){return this.throwIfDisposed(),ao(this)};A().prototype.relu6=function(){return this.throwIfDisposed(),k0(this)};A().prototype.reshapeAs=function(t){return this.throwIfDisposed(),M(this,t.shape)};A().prototype.reshape=function(t){return this.throwIfDisposed(),M(this,t)};A().prototype.resizeBilinear=function(t,n,e){return this.throwIfDisposed(),L0(this,t,n,e)};A().prototype.resizeNearestNeighbor=function(t,n,e){return this.throwIfDisposed(),V0(this,t,n,e)};A().prototype.reverse=function(t){return this.throwIfDisposed(),Ro(this,t)};A().prototype.rfft=function(){return this.throwIfDisposed(),YD(this)};A().prototype.round=function(){return this.throwIfDisposed(),Kg(this)};A().prototype.rsqrt=function(){return this.throwIfDisposed(),Xg(this)};A().prototype.selu=function(){return this.throwIfDisposed(),Yg(this)};A().prototype.separableConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Zg(this,t,n,e,r,o,i)};A().prototype.sigmoid=function(){return this.throwIfDisposed(),ei(this)};A().prototype.sign=function(){return this.throwIfDisposed(),KD(this)};A().prototype.sin=function(){return this.throwIfDisposed(),Qg(this)};A().prototype.sinh=function(){return this.throwIfDisposed(),Jg(this)};A().prototype.slice=function(t,n){return this.throwIfDisposed(),qe(this,t,n)};A().prototype.softmax=function(t){return this.throwIfDisposed(),xp(this,t)};A().prototype.softplus=function(){return this.throwIfDisposed(),fs(this)};A().prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),oh(this,t,n)};A().prototype.split=function(t,n){return this.throwIfDisposed(),bn(this,t,n)};A().prototype.sqrt=function(){return this.throwIfDisposed(),wt(this)};A().prototype.square=function(){return this.throwIfDisposed(),Le(this)};A().prototype.squaredDifference=function(t){return this.throwIfDisposed(),RV(this,t)};A().prototype.squeeze=function(t){return this.throwIfDisposed(),Ri(this,t)};A().prototype.stack=function(t,n){this.throwIfDisposed();let e=t instanceof lt?[this,t]:[this,...t];return mn(e,n)};A().prototype.step=function(t){return this.throwIfDisposed(),Mi(this,t)};A().prototype.stridedSlice=function(t,n,e,r,o,i,s,a){return this.throwIfDisposed(),ZD(this,t,n,e,r,o,i,s,a)};A().prototype.sub=function(t){return this.throwIfDisposed(),pe(this,t)};A().prototype.sum=function(t,n){return this.throwIfDisposed(),ue(this,t,n)};A().prototype.tan=function(){return this.throwIfDisposed(),QD(this)};A().prototype.tanh=function(){return this.throwIfDisposed(),lp(this)};A().prototype.tile=function(t){return this.throwIfDisposed(),er(this,t)};A().prototype.toBool=function(){return this.throwIfDisposed(),J(this,"bool")};A().prototype.toFloat=function(){return this.throwIfDisposed(),J(this,"float32")};A().prototype.toInt=function(){return this.throwIfDisposed(),J(this,"int32")};A().prototype.topk=function(t,n){return this.throwIfDisposed(),OV(this,t,n)};A().prototype.transpose=function(t){return this.throwIfDisposed(),$e(this,t)};A().prototype.unique=function(t){return this.throwIfDisposed(),FV(this,t)};A().prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),R0(this,t,n)};A().prototype.unstack=function(t){return this.throwIfDisposed(),cr(this,t)};A().prototype.where=function(t,n){return this.throwIfDisposed(),kt(t,this,n)};A().prototype.zerosLike=function(){return this.throwIfDisposed(),be(this)};var Mo=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},Er=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},F=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},Ee=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},K0=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}};var ay=class{constructor(n){this.maxEntries=n||100,this.cache=new Map}get(n){let e;return this.cache.has(n)&&(e=this.cache.get(n),this.cache.delete(n),this.cache.set(n,e)),e}put(n,e){if(this.cache.has(n))this.cache.delete(n);else if(this.cache.size>=this.maxEntries){let r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(n,e)}getMaxEntries(){return this.maxEntries}setMaxEntries(n){if(n<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${n}.`);if(this.maxEntries>n)for(let e=0;e<this.maxEntries-n;e++){let r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=n}};function oi(t,n){if(Array.isArray(t)){let e=[];for(let r=0;r<n;r++)e=e.concat(t);return e}else{let e=new Array(n);return e.fill(t),e}}function Oo(t,n){if(!t)throw new K0(n)}function w1(t,n){let e=0;for(let r of t)r===n&&e++;return e}function An(t){return t.length===1?t[0]:t}function ut(t){return Array.isArray(t)?t:[t]}function ii(t){let e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Ya(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(n,e)=>e.toUpperCase())}var ri={};function mh(t){if(t==null)return null;let n={};return n.className=t.getClassName(),n.config=t.getConfig(),n}function b1(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(n=>b1(n));else{let n=Object.keys(t);for(let e of n){let r=t[e];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?t[e]=r.value:b1(r))}}}function ms(t,n={},e={},r="object",o=!1){if(typeof t=="string"){let i=t,s;if(i in e)s=e[i];else if(i in ri)s=ri[i];else if(s=n[i],s==null)throw new F(`Unknown ${r}: ${t}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}else{let i=t;if(i.className==null||i.config==null)throw new F(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);let s=i.className,a,l;if(s in e?[a,l]=e[s]:s in ri?[a,l]=ri.className:s in n&&([a,l]=n[s]),a==null)throw new F(`Unknown ${r}: ${s}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){let u={};for(let d of Object.keys(ri))u[d]=ri[d];for(let d of Object.keys(e))u[d]=e[d];let c=i.config;c.customObjects=u;let p=Object.assign({},ri);for(let d of Object.keys(e))ri[d]=e[d];b1(i.config);let f=l(a,i.config,e,o);return ri=Object.assign({},p),f}else{let u=Object.assign({},ri);for(let p of Object.keys(e))ri[p]=e[p];let c=new a(i.config);return ri=Object.assign({},u),c}}}function ife(t,n){return t<n?-1:t>n?1:0}function ly(t,n){return-1*ife(t,n)}function si(t){if(t==null)return t;let n=[];for(let e of t)n.indexOf(e)===-1&&n.push(e);return n}function T3(t){if(t==null)throw new F(`Invalid value in obj: ${JSON.stringify(t)}`);for(let n in t)if(t.hasOwnProperty(n))return!1;return!0}function gs(t,n,e){if(e!=null&&t.indexOf(e)<0)throw new F(`${e} is not a valid ${n}.  Valid values are ${t} or null/undefined.`)}function X0(t,n,e=0,r=1/0){return Oo(e>=0),Oo(r>=e),Array.isArray(t)&&t.length>=e&&t.length<=r&&t.every(o=>typeof o===n)}function tn(t,n){Array.isArray(t)?(v.assert(t.length>0,()=>`${n} is unexpectedly an empty array.`),t.forEach((e,r)=>tn(e,`element ${r+1} of ${n}`))):v.assert(Number.isInteger(t)&&t>0,()=>`Expected ${n} to be a positive integer, but got ${_3(t)}.`)}function _3(t){return t===null?"null":Array.isArray(t)?"["+t.map(n=>_3(n)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function N3(t,n,e){let r=e!=null?e():v.now(),o;return(...s)=>{let a=e!=null?e():v.now();return a-r<n||(r=a,o=t(...s)),o}}function Y0(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}var sfe=0;function Q0(){return sfe++}var Z0={};function Uu(t=""){return t in Z0||(Z0[t]=0),Z0[t]+=1,t+Z0[t].toString()}var D3=["channelsFirst","channelsLast"],k3=["nearest","bilinear"],A3=["valid","same","causal"],R3=["max","avg"],M3=["sum","mul","concat","ave"];var gh=new Map;function Pt(t){gs(D3,"DataFormat",t)}function F3(t){gs(k3,"InterpolationFormat",t)}function Tr(t){gs(A3,"PaddingMode",t)}function C1(t){gs(R3,"PoolMode",t)}var uy=[],O3="/";function Fi(t,n){uy.push(t);try{let e=n();return uy.pop(),e}catch(e){throw uy.pop(),e}}function afe(){return uy.length===0?"":uy.join(O3)+O3}function J0(t){if(!$3(t))throw new Error("Not a valid tensor name: '"+t+"'");return afe()+t}function ew(t){if(!$3(t))throw new Error("Not a valid tensor name: '"+t+"'");gh.has(t)||gh.set(t,0);let n=gh.get(t);if(gh.set(t,gh.get(t)+1),n>0){let e=`${t}_${n}`;return gh.set(e,1),e}else return t}var lfe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function $3(t){return!!t.match(lfe)}function P3(t){return t===parseInt(t.toString(),10)}function ai(t,n,e){n==null&&(n=0),e==null&&(e=t.length);let r=1;for(let o=n;o<e;++o)r*=t[o];return r}function Ip(t){if(t.length===0)return Number.NaN;let n=Number.POSITIVE_INFINITY;for(let e=0;e<t.length;e++){let r=t[e];r<n&&(n=r)}return n}function $i(t){if(t.length===0)return Number.NaN;let n=Number.NEGATIVE_INFINITY;for(let e=0;e<t.length;e++){let r=t[e];r>n&&(n=r)}return n}function _r(t,n){if(n<t)throw new F(`end (${n}) < begin (${t}) is forbidden.`);let e=[];for(let r=t;r<n;++r)e.push(r);return e}var S1;function pn(){return S1==null&&(S1=g0().epsilon()),S1}function Nr(){return"channelsLast"}function pr(t,n){return J(t,n)}function Qa(t,n=-1){let e=t.shape.slice();return n<0&&(n=e.length+n+1),e.splice(n,0,1),M(t,e)}function L3(t,n){return L(()=>{if(t.shape.length!==2)throw new F(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);let e=Qa(t,1);return nw(e,[1,n,1])})}function V3(t){let n=[ai(t.shape)];return M(t,n)}function B3(t){if(t.rank<=1)throw new F(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);let n=[t.shape[0],ai(t.shape,1)];return M(t,n)}function Za(t,n,e){return L(()=>{switch(t.rank){case 1:return ey(t,n,e);case 2:return A0(t,[n,0],[e,t.shape[1]]);case 3:return ty(t,[n,0,0],[e,t.shape[1],t.shape[2]]);case 4:return sh(t,[n,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3]]);case 5:return qe(t,[n,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return qe(t,[n,0,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new F(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function I1(t,n,e){return L(()=>{switch(t.rank){case 1:return ey(t,n,e);case 2:return A0(t,[0,n],[t.shape[0],e]);case 3:return ty(t,[0,0,n],[t.shape[0],t.shape[1],e]);case 4:return sh(t,[0,0,0,n],[t.shape[0],t.shape[1],t.shape[2],e]);default:throw new F(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function cy(t,n,e,r){return L(()=>{switch(t.rank){case 1:return ey(t,n,e);case 2:switch(r){case 1:return Za(t,n,e);case 2:return I1(t,n,e);default:throw new F(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Za(t,n,e);case 2:return ty(t,[0,n,0],[t.shape[0],e,t.shape[2]]);case 3:return I1(t,n,e);default:throw new F(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Za(t,n,e);case 2:return sh(t,[0,n,0,0],[t.shape[0],e,t.shape[2],t.shape[3]]);case 3:return sh(t,[0,0,n,0],[t.shape[0],t.shape[1],e,t.shape[3]]);case 4:return I1(t,n,e);default:throw new F(`The axis is not within the rank of the tensor ${r}`)}default:throw new F(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function yh(t,n=-1){let e;return n<0&&(e=t[0].rank,e!==0?n=e:n=0),n===t[0].rank&&(n=-1),Dt(t,n)}function T1(t,n){switch(t.rank){case 1:return SD([t,n]);case 2:return ID([t,n],0);case 3:return ED([t,n],0);case 4:return TD([t,n],0);default:throw new F(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function nw(t,n){if(Array.isArray(n)||(n=[n]),t.rank!==n.length)throw new F(`The length of input n (${n.length}) does not match the number of dimensions in input x (${t.rank})`);return er(t,n)}function xh(t,n=0,e=1,r,o){return D0(t,n,e,r,o)}function li(t,n,e,r){if(t.rank<2||n.rank<2)throw new Ee(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${n.shape}`);if(n.rank>=3){let o=t.shape.slice(-1)[0],i=n.shape.slice(-2)[0];if(o!==i)throw new Ee(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${n.shape}`)}if(t.rank===2&&n.rank===2)return Sp.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?E1(t.rank,r,Nr()):null,activation:e});{let o=t.shape.slice(),i=o.pop();t=M(t,[-1,i]);let s=n.shape.slice(),a=s.pop(),l=s.pop(),u=[...s,a],c=Array.from({length:n.rank},(h,m)=>m===0?n.rank-2:m<=n.rank-2?m-1:m);n=M($e(n,c),[l,-1]);let p=[...o,...u];return M(Sp.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?E1(t.rank,r,Nr()):null,activation:e}),p)}}function rw(t,n,e){return L(()=>(Array.isArray(n)?n=an(n,"int32"):n=J(n,"int32"),cp(t,n,e)))}function Ep(t){return R(t,t)}function E1(t,n,e){let r=n.shape;if(n.rank!==1&&n.rank!==t)throw new F(`Unexpected bias dimensions: ${n.rank}; expected it to be 1 or ${t}`);if(t===5){if(e==="channelsFirst")return r.length===1?M(n,[1,r[0],1,1,1]):M(n,[1,r[3],r[0],r[1],r[2]]);if(e==="channelsLast")return r.length===1?M(n,[1,1,1,1,r[0]]):M(n,[1].concat(r))}else if(t===4){if(e==="channelsFirst")return r.length===1?M(n,[1,r[0],1,1]):M(n,[1,r[2],r[0],r[1]]);if(e==="channelsLast")return r.length===1?M(n,[1,1,1,r[0]]):M(n,[1].concat(r))}else if(t===3){if(e==="channelsFirst")return r.length===1?M(n,[1,r[0],1]):M(n,[1,r[1],r[0]]);if(e==="channelsLast")return r.length===1?M(n,[1,1,r[0]]):M(n,[1].concat(r))}else if(t<3)return n;throw new F(`Unsupported input rank by biasAdd: ${n.rank}`)}function Dr(t,n,e){return L(()=>(e==null&&(e=Nr()),Pt(e),Z(t,E1(t.rank,n,e))))}function z3(t,n=1){if(n!==1)throw new Ee(`Support for alpha values other than 1 (${n}) is not implemented yet.`);return Ha(t)}function U3(t){return L(()=>se(t,Z(cn(t),1)))}function ow(t,n,e,r){return L(()=>LV(t,n,e,r))}function G3(t){return L(()=>{let n=Z(.5,R(.2,t));return zn(n,0,1)})}function Gu(t,n,e=!1){return e?t():n()}var W3=["fanIn","fanOut","fanAvg"],H3=["normal","uniform","truncatedNormal"];function ufe(t){gs(W3,"FanMode",t)}function cfe(t){gs(H3,"Distribution",t)}var kr=class extends K.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},K3=(()=>{class t extends kr{apply(e,r){return At(e,r)}}return t.className="Zeros",t})();K.registerClass(K3);var iw=(()=>{class t extends kr{apply(e,r){return Ir(e,r)}}return t.className="Ones",t})();K.registerClass(iw);var X3=(()=>{class t extends kr{constructor(e){if(super(),typeof e!="object")throw new F(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new F(`config must have value set but got ${e}`);this.value=e.value}apply(e,r){return L(()=>R(Se(this.value),Ir(e,r)))}getConfig(){return{value:this.value}}}return t.className="Constant",t})();K.registerClass(X3);var Y3=(()=>{class t extends kr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,r){return Ai(e,this.minval,this.maxval,r,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}return t.className="RandomUniform",t})();K.registerClass(Y3);var Z3=(()=>{class t extends kr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ee(`randomNormal does not support dType ${r}.`);return xh(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="RandomNormal",t})();K.registerClass(Z3);var Q3=(()=>{class t extends kr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ee(`truncatedNormal does not support dType ${r}.`);return ry(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="TruncatedNormal",t})();K.registerClass(Q3);var J3=(()=>{class t extends kr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,r){return L(()=>{if(e.length!==2||e[0]!==e[1])throw new F("Identity matrix initializer can only be used for 2D square matrices.");return R(this.gain,Jd(e[0]))})}getConfig(){return{gain:this.gain}}}return t.className="Identity",t})();K.registerClass(J3);function pfe(t,n="channelsLast"){let e,r;if(Pt(n),t.length===2)e=t[0],r=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(n==="channelsFirst"){let o=ai(t,2);e=t[1]*o,r=t[0]*o}else if(n==="channelsLast"){let o=ai(t,0,t.length-2);e=t[t.length-2]*o,r=t[t.length-1]*o}}else{let o=ai(t);e=Math.sqrt(o),r=Math.sqrt(o)}return[e,r]}var uo=(()=>{class t extends kr{constructor(e){if(super(),e.scale<0)throw new F(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,ufe(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,cfe(this.distribution),this.seed=e.seed}apply(e,r){let o=pfe(e),i=o[0],s=o[1],a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,i):this.mode==="fanOut"?a/=Math.max(1,s):a/=Math.max(1,(i+s)/2),this.distribution==="normal"){let l=Math.sqrt(a);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ee(`${this.getClassName()} does not support dType ${r}.`);return ry(e,0,l,r,this.seed)}else{let l=Math.sqrt(3*a);return Ai(e,-l,l,r,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}return t.className="VarianceScaling",t})();K.registerClass(uo);var _1=(()=>{class t extends uo{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return uo.className}}return t.className="GlorotUniform",t})();K.registerClass(_1);var N1=(()=>{class t extends uo{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return uo.className}}return t.className="GlorotNormal",t})();K.registerClass(N1);var D1=(()=>{class t extends uo{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return uo.className}}return t.className="HeNormal",t})();K.registerClass(D1);var k1=(()=>{class t extends uo{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return uo.className}}return t.className="HeUniform",t})();K.registerClass(k1);var A1=(()=>{class t extends uo{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return uo.className}}return t.className="LeCunNormal",t})();K.registerClass(A1);var R1=(()=>{class t extends uo{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return uo.className}}return t.className="LeCunUniform",t})();K.registerClass(R1);var eU=(()=>{class t extends kr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,r){return L(()=>{if(e.length<2)throw new Ee("Shape must be at least 2D.");if(r!=="int32"&&r!=="float32"&&r!==void 0)throw new TypeError(`Unsupported data type ${r}.`);r=r;let o=v.sizeFromShape(e.slice(0,-1)),i=e[e.length-1],s=o*i;s>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${s}) elements: Slowness may result.`);let a=[Math.max(i,o),Math.min(i,o)],l=xh(a,0,1,r,this.seed),u=aB.qr(l,!1),c=u[0],f=u[1].flatten().stridedSlice([0],[Math.min(i,o)*Math.min(i,o)],[Math.min(i,o)+1]);return c=R(c,f.sign()),o<i&&(c=c.transpose()),R(Se(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}return t.className="Orthogonal",t})();K.registerClass(eU);var j3={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function q3(t,n={}){return ms(t,K.SerializationMap.getMap().classNameMap,n,"initializer")}function Et(t){return mh(t)}function yt(t){if(typeof t=="string"){let n=t in j3?j3[t]:t;if(n==="GlorotNormal")return new N1;if(n==="GlorotUniform")return new _1;if(n==="HeNormal")return new D1;if(n==="HeUniform")return new k1;if(n==="LeCunNormal")return new A1;if(n==="LeCunUniform")return new R1;{let e={};return e.className=n,e.config={},q3(e)}}else return t instanceof kr?t:q3(t)}function sw(t){return Array.isArray(t)&&Array.isArray(t[0])}function vh(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function we(t){let n;if(Array.isArray(t)){if(t.length!==1)throw new F(`Expected Tensor length to be 1; got ${t.length}`);n=t[0]}else n=t;return n}function Fe(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new F(`Expected exactly 1 Shape; got ${t.length}`)}else return t}function bh(t){let n=0;for(let e of t)e.shape.length===0?n+=1:n+=e.shape.reduce((r,o)=>r*o);return n}var nU="Variable",py=class{constructor(n,e="float32",r=nU,o=!0,i=null){this.dtype=e??"float32",this.shape=n.shape,this.id=Q0(),r=r??nU,this.originalName=J0(r),this.name=ew(this.originalName),this.trainable_=o,this.constraint=i,this.val=JD(n,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(n){return this.assertNotDisposed(),dfe(this.val,n),this.val.id!==n.id&&(this.val.assign(n),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(n){this.trainable_=n,this.val.trainable=n}};function dfe(t,n){if(t.shape.toString()!==n.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(n.shape))}function fy(t){return t.map(n=>n.read())}function wh(t){t.forEach(n=>{n[0].write(n[1])})}var Ct=class{constructor(n){this.dtype=n.dtype,this.shape=n.shape,n.shape!=null?this.ndim=n.shape.length:this.ndim=n.ndim,this.maxNDim=n.maxNDim,this.minNDim=n.minNDim,this.axes=n.axes||{}}},fr=class{constructor(n,e,r,o,i,s,a){this.dtype=n,this.shape=e,this.sourceLayer=r,this.inputs=o,this.callArgs=i,this.outputTensorIndex=a,this.id=Q0(),s!=null&&(this.originalName=J0(s),this.name=ew(this.originalName)),this.rank=e.length}},hfe=0,Ja=class{constructor(n,e){this.callArgs=e,this.id=hfe++,this.outboundLayer=n.outboundLayer,this.inboundLayers=n.inboundLayers,this.nodeIndices=n.nodeIndices,this.tensorIndices=n.tensorIndices,this.inputTensors=n.inputTensors,this.outputTensors=n.outputTensors,this.inputMasks=n.inputMasks,this.outputMasks=n.outputMasks,this.inputShapes=n.inputShapes,this.outputShapes=n.outputShapes;for(let r of n.inboundLayers)r?.outboundNodes.push(this);n.outboundLayer.inboundNodes.push(this)}getConfig(){let n=[];for(let e of this.inboundLayers)e!=null?n.push(e.name):n.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},mfe=0,Ie=class extends K.Serializable{constructor(n={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=mfe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=n.name;if(!e){let r=this.getClassName();e=ii(r)+"_"+Uu(r)}if(this.name=e,this.trainable_=n.trainable==null?!0:n.trainable,n.inputShape!=null||n.batchInputShape!=null){let r;if(n.batchInputShape!=null)r=n.batchInputShape;else if(n.inputShape!=null){let i=null;n.batchSize!=null&&(i=n.batchSize),r=[i].concat(n.inputShape)}this.batchInputShape=r;let o=n.dtype;o==null&&(o=n.inputDType),o==null&&(o="float32"),this.dtype=o}n.weights!=null?this.initialWeights=n.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(n,e){return n.name+"_ib-"+e.toString()}getNodeAtIndex(n,e){if(this.inboundNodes.length===0)throw new Er(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=n)throw new F(`Asked to get ${e} at node ${n}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[n]}getInputAt(n){return An(this.getNodeAtIndex(n,"input").inputTensors)}getOutputAt(n){return An(this.getNodeAtIndex(n,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Mo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Mo(`Layer ${this.name} is not connected, no input to return.`);return An(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Mo(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Mo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return An(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(n=>n())}get updates(){return this._updates}get built(){return this._built}set built(n){this._built=n}get trainable(){return this.trainable_}set trainable(n){this._trainableWeights.forEach(e=>e.trainable=n),this.trainable_=n}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(n=>n.trainable):[]}set trainableWeights(n){this._trainableWeights=n}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(n=>!n.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(n){this._nonTrainableWeights=n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(n){let e=ut(n);if(this.inputSpec==null||this.inputSpec.length===0)return;let r=ut(this.inputSpec);if(e.length!==r.length)throw new F(`Layer ${this.name} expects ${r.length} inputs, but it received ${e.length} input tensors. Input received: ${n}`);for(let o=0;o<e.length;o++){let i=e[o],s=r[o];if(s==null)continue;let a=i.rank;if(s.ndim!=null&&a!==s.ndim)throw new F(`Input ${o} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${a}`);if(s.maxNDim!=null&&a>s.maxNDim)throw new F(`Input ${o} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${a}`);if(s.minNDim!=null&&a<s.minNDim)throw new F(`Input ${o} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${a}.`);if(s.dtype!=null&&i.dtype!==s.dtype)throw new F(`Input ${o} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${i.dtype}.`);if(s.axes){let l=i.shape;for(let u in s.axes){let c=Number(u),p=s.axes[u],f=c>=0?l[c]:l[l.length+c];if(p!=null&&[p,null].indexOf(f)===-1)throw new F(`Input ${o} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${p} but got shape ${l}.`)}}if(s.shape!=null)for(let l=0;l<s.shape.length;++l){let u=s.shape[l],c=i.shape[l];if(u!=null&&c!=null&&u!==c)throw new F(`Input ${o} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${i.shape}.`)}}}call(n,e){return n}invokeCallHook(n,e){this._callHook!=null&&this._callHook(n,e)}setCallHook(n){this._callHook=n}clearCallHook(){this._callHook=null}apply(n,e){e=e||{},this.assertNotDisposed();let r=ut(n),o=xfe(n),i=vfe(n);if(o===i)throw new F("Arguments to apply() must be all SymbolicTensors or all Tensors");return Fi(this.name,()=>{if(!this.built){this.assertInputCompatibility(n);let s=[];for(let a of ut(n))s.push(a.shape);this.build(An(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(n),i){let s=this.call(n,e);this.supportsMasking&&this.setMaskMetadata(n,s);let a=ut(s),l=[];for(let u of a)r.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(s=An(l),this.activityRegularizer!=null)throw new Ee("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{let s=gfe(n),a=this.computeOutputShape(s),l,u=yfe(n);if(this.warnOnIncompatibleInputShape(Array.isArray(n)?s[0]:s),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((c,p)=>new fr(u,c,this,ut(n),e,this.name,p)):l=new fr(u,a,this,ut(n),e,this.name),this.addInboundNode(n,l,null,null,s,a,e),this._refCount++,this.activityRegularizer!=null)throw new Ee("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(n){if(this.batchInputShape!=null)if(n.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(n)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((r,o)=>{r!=null&&n[o]!=null&&n[o]!==r&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(n)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Mo(`The layer ${this.name} has never been called and thus has no defined output shape.`);let n=[];for(let e of this.inboundNodes){let r=JSON.stringify(e.outputShapes);n.indexOf(r)===-1&&n.push(r)}if(n.length===1){let e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new Mo(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Er(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return bh(this.weights)}build(n){this.built=!0}getWeights(n=!1){return fy(n?this.trainableWeights:this.weights)}setWeights(n){L(()=>{let e=this.weights;if(e.length!==n.length)throw new F(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${n.length}, but the layer was expecting ${e.length} weights. Provided weights: ${n}...`);if(e.length===0)return;let r=[],o=fy(e);for(let i=0;i<o.length;++i){let s=o[i],a=e[i],l=n[i];if(!v.arraysEqual(s.shape,l.shape))throw new F(`Layer weight shape ${s.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}wh(r)})}addWeight(n,e,r,o,i,s,a,l){if(this._addedWeightNames.indexOf(n)!==-1)throw new F(`Duplicate weight name ${n} for layer ${this.name}`);this._addedWeightNames.push(n),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(o=l!=null?l():yt("zeros"));let u=o.apply(e,r),c=new py(u,r,n,s,a);return u.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),s==null&&(s=!0),s?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(n){this.fastWeightInitDuringBuild=n}addLoss(n){n==null||Array.isArray(n)&&n.length===0||(n=ut(n),this._losses!==void 0&&this._losses!==null&&this.losses.push(...n))}computeOutputShape(n){return n}computeMask(n,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}setMaskMetadata(n,e,r){if(!this.supportsMasking)return;let o=this.computeMask(n,r),i=ut(e),s=ut(o);if(i.length!==s.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=s[a]}addInboundNode(n,e,r,o,i,s,a=null){let l=ut(n);e=ut(e),r=ut(r),o=ut(o),i=vh(i),s=vh(s);let u=[],c=[],p=[];for(let f of l)u.push(f.sourceLayer),c.push(f.nodeIndex),p.push(f.tensorIndex);new Ja({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:p,inputTensors:l,outputTensors:e,inputMasks:r,outputMasks:o,inputShapes:i,outputShapes:s},a);for(let f=0;f<e.length;f++)e[f].sourceLayer=this,e[f].nodeIndex=this.inboundNodes.length-1,e[f].tensorIndex=f}getConfig(){let n={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(n.batchInputShape=this.batchInputShape),this.dtype!=null&&(n.dtype=this.dtype),n}disposeWeights(){return this.weights.forEach(n=>n.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let n=0;return--this._refCount===0&&(n=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:n}}};function gfe(t){t=ut(t);let n=[];for(let e of t)n.push(e.shape);return An(n)}function yfe(t){return"float32"}function M1(t,n,e){if((n==null||e!=null&&e>0)&&(n=t.sourceLayer,e=t.nodeIndex),n.inboundNodes.length===0)return[t];{let r=n.inboundNodes[e];if(r.inboundLayers.length===0)return r.inputTensors;{let o=[];for(let i=0;i<r.inboundLayers.length;i++){let s=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],u=M1(s,a,l);for(let c of u)o.indexOf(c)===-1&&o.push(c)}return o}}}function xfe(t){let n=!0;for(let e of ut(t))if(!(e instanceof fr)){n=!1;break}return n}function vfe(t){let n=!0;for(let e of ut(t))if(e instanceof fr){n=!1;break}return n}var Wu=(()=>{class t extends Ie{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Uu("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new F("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let r=e.batchInputShape;if(r==null){if(e.inputShape==null)throw new F("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new F("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let o=e.dtype||"float32";this.batchInputShape=r,this.dtype=o,this.inputSpec=[{shape:r}];let i=new fr(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new Ja({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]})}apply(e,r){throw new F(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}return t.className="InputLayer",t})();K.registerClass(Wu);function aw(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new F("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let n=t.batchShape;t.shape!=null&&n==null&&(n=[null].concat(t.shape));let e=t.dtype;return e==null&&(e="float32"),new Wu({batchInputShape:n,name:t.name,dtype:e,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}function bfe(t,n){if(t.dtype==null||t.dtype===n.dtype)return n;try{return J(n,t.dtype)}catch{throw new F(`The dtype of the feed (${n.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}var ys=class t{constructor(n){if(this.id2Value={},this.id2Mask={},this.name2Id={},n instanceof t)for(let e in n.id2Value)this.id2Value[e]=n.id2Value[e],e in n.id2Mask&&(this.id2Mask[e]=n.id2Mask[e]);else{if(n==null)return;for(let e of n)this.add(e.key,e.value)}}add(n,e,r){if(this.id2Value[n.id]==null)this.id2Value[n.id]=bfe(n,e),this.name2Id[n.name]=n.id,r!=null&&(this.id2Mask[n.id]=r);else throw new F(`Duplicate key: name=${n.name}, id=${n.id}`);return this}addFeed(n){this.add(n.key,n.value)}hasKey(n){return this.id2Value[n.id]!=null}names(){return Object.keys(this.name2Id)}getValue(n){if(n instanceof fr){if(this.id2Value[n.id]==null)throw new F(`Nonexistent key: ${n.name}`);return this.id2Value[n.id]}else{let e=this.name2Id[n];if(e==null)throw new F(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Value[e]}}getMask(n){if(n instanceof fr){if(this.id2Value[n.id]==null)throw new F(`Nonexistent key: ${n.name}`);return this.id2Mask[n.id]}else{let e=this.name2Id[n];if(e==null)throw new F(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&De(this.id2Mask)}},lw=new ay,uw=new ay;function oU(t){lw?.setMaxEntries(t),uw?.setMaxEntries(t)}function Tp(t,n,e,r){let o=e==null?!1:e.training,i=Array.isArray(t),s=i?t:[t],a=s.map(h=>h.name),l=[],u=n.names();for(let h of a)u.indexOf(h)!==-1?l.push(n.getValue(h)):l.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);let c=a.join(",")+"|"+n.names().sort().join(","),p=lw.get(c),f;if(p==null){let h=wfe(s,n);p=h.sorted,f=h.recipientCounts,lw.put(c,p),uw.put(c,f)}f={},o||Object.assign(f,uw.get(c));let d=new ys(n);for(let h=0;h<p.length;++h){if(r!=null){let O=Mg().numTensors;O>r.maxNumTensors&&(r.maxNumTensors=O),O<r.minNumTensors&&(r.minNumTensors=O)}let m=p[h],g=m.sourceLayer;if(g instanceof Wu)continue;let y=[],x=[],b=[],w=!1;for(let O of m.inputs){let $=d.getValue(O),V=d.getMask(O);y.push($),x.push(V),V!=null&&(w=!0),o||(f[O.name]--,f[O.name]===0&&!n.hasKey(O)&&a.indexOf(O.name)===-1&&!$.isDisposed&&O.sourceLayer.stateful!==!0&&b.push($))}w&&(e=e||{},e.mask=x[0]);let C=ut(g.apply(y,e)),N=null;g.supportsMasking&&(N=g.computeMask(y,x));let D=Sfe(m),k=Array.isArray(D)?D:[D];for(let O=0;O<k.length;++O){d.hasKey(k[O])||d.add(k[O],C[O],Array.isArray(N)?N[0]:N);let $=a.indexOf(k[O].name);$!==-1&&(l[$]=C[O])}o||De(b)}return d.disposeMasks(),i?l:l[0]}function wfe(t,n){v.assert(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let e=[],r={};if(t.length===1){let o=rU(t[0],n);e=o.sorted,r=o.recipientMap}else{let o=new Set;for(let i of t){let{sorted:s,recipientMap:a}=rU(i,n);for(let l of s)o.has(l.name)||(e.push(l),o.add(l.name));for(let l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(u=>r[l].add(u))}}return{sorted:e,recipientCounts:Cfe(r)}}function Cfe(t){let n={};for(let e in t)n[e]=t[e].size;return n}function rU(t,n){let e=new Set,r=[],o={};for(let a of n.names())e.add(a);let i=[],s=[];for(i.push(t);i.length>0;){let a=i[i.length-1];if(e.has(a.name)){i.pop();continue}let l=s[s.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),e.add(a.name),l&&s.pop();else{s.push(i.length-1);for(let u of a.inputs)o[u.name]==null&&(o[u.name]=new Set),o[u.name].add(a.name),!e.has(u.name)&&i.push(u)}}return{sorted:r,recipientMap:o}}function Sfe(t){let n;if(t.sourceLayer.inboundNodes.length===1)n=t.sourceLayer.output;else{let e=null;for(let r=0;r<t.sourceLayer.inboundNodes.length;++r)for(let o of t.sourceLayer.inboundNodes[r].outputTensors)if(o.id===t.id){e=r;break}n=t.sourceLayer.getOutputAt(e)}return n}var Ife=P();Ife.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,oU);function O1(t,n){return L(()=>wt(ue(R(t,t),n,!0)))}var _p=class extends K.Serializable{getConfig(){return{}}},aU=(()=>{class t extends _p{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return L(()=>{let r=O1(e,this.axis),o=zn(r,0,this.maxValue);return R(e,se(o,Z(pn(),r)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}return t.className="MaxNorm",t})();K.registerClass(aU);var lU=(()=>{class t extends _p{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return L(()=>se(e,Z(pn(),O1(e,this.axis))))}getConfig(){return{axis:this.axis}}}return t.className="UnitNorm",t})();K.registerClass(lU);var uU=(()=>{class t extends _p{apply(e){return ao(e)}}return t.className="NonNeg",t})();K.registerClass(uU);var cU=(()=>{class t extends _p{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return L(()=>{let r=O1(e,this.axis),o=Z(R(this.rate,zn(r,this.minValue,this.maxValue)),R(1-this.rate,r));return R(e,se(o,Z(pn(),r)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}return t.className="MinMaxNorm",t})();K.registerClass(cU);var iU={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Gt(t){return mh(t)}function sU(t,n={}){return ms(t,K.SerializationMap.getMap().classNameMap,n,"constraint")}function Wt(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in iU?iU[t]:t,config:{}};return sU(e)}else return t instanceof _p?t:sU(t)}var il={};Po(il,{Layer:()=>Ie,RNN:()=>xs,RNNCell:()=>nl,activation:()=>she,add:()=>mhe,alphaDropout:()=>Qhe,average:()=>ghe,averagePooling1d:()=>Qk,averagePooling2d:()=>Jk,averagePooling3d:()=>eA,avgPool1d:()=>Ehe,avgPool2d:()=>_he,avgPool3d:()=>Dhe,avgPooling1d:()=>The,avgPooling2d:()=>Nhe,avgPooling3d:()=>khe,batchNormalization:()=>Che,bidirectional:()=>Whe,categoryEncoding:()=>rme,centerCrop:()=>tme,concatenate:()=>yhe,conv1d:()=>Zde,conv2d:()=>Qde,conv2dTranspose:()=>Jde,conv3d:()=>ehe,conv3dTranspose:()=>the,convLstm2d:()=>Bhe,convLstm2dCell:()=>zhe,cropping2D:()=>rhe,dense:()=>ahe,depthwiseConv2d:()=>ihe,dot:()=>whe,dropout:()=>lhe,elu:()=>Hde,embedding:()=>hhe,flatten:()=>che,gaussianDropout:()=>Zhe,gaussianNoise:()=>Yhe,globalAveragePooling1d:()=>Ahe,globalAveragePooling2d:()=>Rhe,globalMaxPool1d:()=>jhe,globalMaxPool2d:()=>qhe,globalMaxPooling1d:()=>LU,globalMaxPooling2d:()=>VU,gru:()=>Ohe,gruCell:()=>Fhe,input:()=>W1,inputLayer:()=>Wde,layerNormalization:()=>She,leakyReLU:()=>qde,lstm:()=>$he,lstmCell:()=>Phe,masking:()=>Jhe,maxPool1d:()=>Khe,maxPool2d:()=>Xhe,maxPooling1d:()=>BU,maxPooling2d:()=>zU,maxPooling3d:()=>Mhe,maximum:()=>xhe,minimum:()=>vhe,multiply:()=>bhe,permute:()=>dhe,prelu:()=>Kde,randomWidth:()=>ome,reLU:()=>jde,repeatVector:()=>phe,rescaling:()=>eme,reshape:()=>fhe,resizing:()=>nme,rnn:()=>Uhe,separableConv2d:()=>nhe,simpleRNN:()=>Lhe,simpleRNNCell:()=>Vhe,softmax:()=>Xde,spatialDropout1d:()=>uhe,stackedRNNCells:()=>Ghe,thresholdedReLU:()=>Yde,timeDistributed:()=>Hhe,upSampling2d:()=>ohe,zeroPadding2d:()=>Ihe});function el(t){return B(this,null,function*(){if(t==null)return;let n=[],e=[],r=[];for(let o in t){let i=t[o];if(typeof i!="number"){let s=i;n.push(s.data()),e.push(o),r.push(s)}}if(n.length>0){let o=yield Promise.all(n);for(let i=0;i<o.length;++i)t[e[i]]=o[i][0];De(r)}})}function cw(t){if(t!=null)for(let n in t){let e=t[n];typeof e!="number"&&e.dispose()}}var _fe=125,Hu=class{constructor(){this.validationData=null}setParams(n){this.params=n}onEpochBegin(n,e){return B(this,null,function*(){})}onEpochEnd(n,e){return B(this,null,function*(){})}onBatchBegin(n,e){return B(this,null,function*(){})}onBatchEnd(n,e){return B(this,null,function*(){})}onTrainBegin(n){return B(this,null,function*(){})}onTrainEnd(n){return B(this,null,function*(){})}setModel(n){}},pw=class{constructor(n,e=10){n==null&&(n=[]),this.callbacks=n,this.queueLength=e}append(n){this.callbacks.push(n)}setParams(n){for(let e of this.callbacks)e.setParams(n)}setModel(n){for(let e of this.callbacks)e.setModel(n)}onEpochBegin(n,e){return B(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onEpochBegin(n,e)})}onEpochEnd(n,e){return B(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onEpochEnd(n,e)})}onBatchBegin(n,e){return B(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onBatchBegin(n,e)})}onBatchEnd(n,e){return B(this,null,function*(){e==null&&(e={});for(let r of this.callbacks)yield r.onBatchEnd(n,e)})}onTrainBegin(n){return B(this,null,function*(){n==null&&(n={});for(let e of this.callbacks)yield e.onTrainBegin(n)})}onTrainEnd(n){return B(this,null,function*(){n==null&&(n={});for(let e of this.callbacks)yield e.onTrainEnd(n)})}},F1=class extends Hu{constructor(){super()}onEpochBegin(n){return B(this,null,function*(){this.seen=0,this.totals={}})}onBatchEnd(n,e){return B(this,null,function*(){e==null&&(e={});let r=e.size==null?0:e.size;this.seen+=r;for(let o in e){let i=e[o];if(typeof i=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+i*r;else{let s;o in this.totals?s=this.totals[o]:this.totals[o]=0;let a=L(()=>Z(this.totals[o],R(i,r)));this.totals[o]=a,s?.dispose()}}})}onEpochEnd(n,e){return B(this,null,function*(){if(e!=null)for(let r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?e[r]=this.totals[r]/this.seen:L(()=>{let o=R(se(1,this.seen),this.totals[r]);e[r]=o,this.totals[r].dispose(),Tn(e[r])}))})}},fw=class extends Hu{onTrainBegin(n){return B(this,null,function*(){this.epoch=[],this.history={}})}onEpochEnd(n,e){return B(this,null,function*(){e==null&&(e={}),this.epoch.push(n);for(let r in e)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(e[r])})}syncData(){return B(this,null,function*(){let n=[],e=[],r=[];for(let i in this.history){let s=this.history[i];for(let a=0;a<s.length;++a)if(typeof s[a]!="number"){let l=s[a];n.push(l.data()),e.push(i),r.push(a)}}let o=yield Promise.all(n);for(let i=0;i<o.length;++i)this.history[e[i]][r[i]].dispose(),this.history[e[i]][r[i]]=o[i][0]})}},dw=class extends Hu{constructor(n,e){if(super(),this.currentEpoch=0,this.nowFunc=n.nowFunc,this.nextFrameFunc=n.nextFrameFunc||sy,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=_fe),this.yieldEvery==="never"&&n.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");v.isNumber(this.yieldEvery)&&(this.maybeWait=N3(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=n.onTrainBegin,this.trainEnd=n.onTrainEnd,this.epochBegin=n.onEpochBegin,this.epochEnd=n.onEpochEnd,this.batchBegin=n.onBatchBegin,this.batchEnd=n.onBatchEnd,this.yield=n.onYield}maybeWait(n,e,r){return B(this,null,function*(){let o=[];this.yield!=null&&(yield el(r),o.push(this.yield(n,e,r))),o.push(this.nextFrameFunc()),yield Promise.all(o)})}onEpochBegin(n,e){return B(this,null,function*(){this.currentEpoch=n,this.epochBegin!=null&&(yield el(e),yield this.epochBegin(n,e))})}onEpochEnd(n,e){return B(this,null,function*(){let r=[];this.epochEnd!=null&&(yield el(e),r.push(this.epochEnd(n,e))),this.yieldEvery==="epoch"&&r.push(this.nextFrameFunc()),yield Promise.all(r)})}onBatchBegin(n,e){return B(this,null,function*(){this.batchBegin!=null&&(yield el(e),yield this.batchBegin(n,e))})}onBatchEnd(n,e){return B(this,null,function*(){let r=[];this.batchEnd!=null&&(yield el(e),r.push(this.batchEnd(n,e))),this.yieldEvery==="batch"?r.push(this.nextFrameFunc()):v.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,n,e)),yield Promise.all(r)})}onTrainBegin(n){return B(this,null,function*(){this.trainBegin!=null&&(yield el(n),yield this.trainBegin(n))})}onTrainEnd(n){return B(this,null,function*(){this.trainEnd!=null&&(yield el(n),yield this.trainEnd(n))})}};function hw(t,n){return t==null&&(t={}),t instanceof Hu?[t]:Array.isArray(t)&&t[0]instanceof Hu?t:ut(t).map(r=>new dw(r,n))}var pU=(()=>{class t{constructor(){}static registerCallbackConstructor(e,r){v.assert(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),t.checkForDuplicate(r),t.constructors[e]==null&&(t.constructors[e]=[]),t.constructors[e].push(r)}static checkForDuplicate(e){for(let r in t.constructors)t.constructors[+r].forEach(i=>{if(i===e)throw new F("Duplicate callback constructor.")})}static clear(){t.constructors={}}static createCallbacks(e){let r=[];for(let o in t.constructors){let i=+o;e>=i&&r.push(...t.constructors[i])}return r.map(o=>new o)}}return t.constructors={},t})();function mw(t,n,e,r,o,i,s,a,l){let u=new fw,c=[new F1,...pU.createCallbacks(n)];t!=null&&c.push(...t),c.push(u);let p=new pw(c);return p.setParams({epochs:e,initialEpoch:r,samples:o,steps:i,batchSize:s,verbose:n,doValidation:a,metrics:l}),{callbackList:p,history:u}}function co(t,n={},e=!1){return ms(t,K.SerializationMap.getMap().classNameMap,n,"layer",e)}function dy(t,n){return L(()=>{t.dtype!=="float32"&&(t=J(t,"float32"));let e=ue(Ep(t),n,!0),r=Ga(e.shape,pn()),o=wt(so(e,r));return se(t,o)})}function Np(t,n){return L(()=>$t(Ep(pe(n,t)),-1))}function my(t,n){return L(()=>$t(cn(pe(n,t)),-1))}function gy(t,n){return L(()=>{let e=pe(t,n),r=zn(cn(t),pn(),Number.MAX_VALUE),o=cn(se(e,r));return R(100,$t(o,-1))})}function Nfe(t,n){return L(()=>{let e=zn(n,pn(),Number.MAX_VALUE),r=Sr(Z(1,e)),o=zn(t,pn(),Number.MAX_VALUE),i=Sr(Z(1,o));return $t(Ep(pe(r,i)),-1)})}function Dfe(t,n){return L(()=>{let e=so(0,pe(1,R(t,n)));return $t(Ep(e),-1)})}function kfe(t,n){return L(()=>{let e=so(0,pe(1,R(t,n)));return $t(e,-1)})}function Afe(t,n){return L(()=>{let e=ue(R(t,n),-1),r=Un(R(pe(1,t),n),-1);return so(0,Z(1,pe(r,e)))})}function Rfe(t,n){return L(()=>{let e=Math.log(2),r=pe(n,t),o=pe(Z(r,fs(R(-2,r))),e);return $t(o,-1)})}function Dp(t,n,e=!1){return L(()=>{if(e)n=xp(n);else{let r=ue(n,n.shape.length-1,!0);n=se(n,r)}return n=zn(n,pn(),1-pn()),Qe(ue(R(J(t,"float32"),Sr(n)),n.shape.length-1))})}function Ch(t,n,e=!1){return L(()=>{let r=J(ja(V3(t)),"int32");n=zn(n,pn(),1-pn());let o=n.shape,i=M(rh(r,o[o.length-1]),o);return Dp(i,n,e)})}function Mfe(t,n){if(!v.arraysEqual(t.shape,n.shape))throw new F(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(n.shape)}`);return L(()=>{let e=ao(n),r=Qe(cn(n));return Z(pe(e,R(n,t)),Wg(Nn(r)))})}function Sh(t,n){return L(()=>{let e;return e=zn(n,pn(),1-pn()),e=Sr(se(e,pe(1,e))),$t(Mfe(t,e),-1)})}function Ofe(t,n){return L(()=>{let e=zn(t,pn(),1),r=zn(n,pn(),1);return ue(R(t,Sr(se(e,r))),-1)})}function Ffe(t,n){return L(()=>{let e=Sr(Z(pn(),n));return $t(pe(n,R(t,e)),-1)})}function gw(t,n){return L(()=>{let e=dy(t,-1),r=dy(n,-1),o=R(e,r);return Qe(ue(o,-1))})}var hy={meanSquaredError:Np,meanAbsoluteError:my,meanAbsolutePercentageError:gy,meanSquaredLogarithmicError:Nfe,squaredHinge:Dfe,hinge:kfe,categoricalHinge:Afe,logcosh:Rfe,categoricalCrossentropy:Dp,sparseCategoricalCrossentropy:Ch,binaryCrossentropy:Sh,kullbackLeiblerDivergence:Ofe,poisson:Ffe,cosineProximity:gw};function yw(t){if(typeof t=="string"){if(t in hy)return hy[t];let n=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(n=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new F(n)}else return t}function vw(t,n){return L(()=>{let e=R(.5,Dn(n)),r=pr(Zt(n,e),t.dtype);return $t(Cr(t,r),-1)})}function bw(t,n){return L(()=>pr(Cr(za(t,-1),za(n,-1)),"float32"))}function $fe(t,n){return L(()=>J(ue(ur(Cr(t,1),Cr(n,1))),"float32"))}function Pfe(t,n){return L(()=>J(ue(ur(Cr(t,0),Cr(n,1))),"float32"))}function dU(t,n){return L(()=>{let e=$fe(t,n),r=Pfe(t,n),o=Z(e,r);return J(kt(Zt(o,0),se(e,o),0),"float32")})}function $1(t,n){return Sh(t,n)}function P1(t,n){return t.rank===n.rank&&(t=Ri(t,[t.rank-1])),n=za(n,-1),n.dtype!==t.dtype&&(n=J(n,t.dtype)),J(Cr(t,n),"float32")}var Lfe=Np,Vfe=Np,Bfe=my,zfe=my,Ufe=gy,Gfe=gy,ww=Dp,Wfe=gw,L1=Ch,xw={binaryAccuracy:vw,categoricalAccuracy:bw,precision:dU,categoricalCrossentropy:ww,sparseCategoricalCrossentropy:L1,mse:Lfe,MSE:Vfe,mae:Bfe,MAE:zfe,mape:Ufe,MAPE:Gfe,cosine:Wfe};function hU(t){if(typeof t=="string"&&t in xw)return xw[t];if(typeof t!="string"&&t!=null)return t;throw new F(`Unknown metric ${t}`)}function yy(t){if(Oo(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let n;for(let e of Object.keys(hy))if(hy[e]===t){n=e;break}if(n!==void 0)return n;for(let e of Object.keys(xw))if(xw[e]===t){n=e;break}return n!==void 0?n:t.name}}function gU(t){let n={Adagrad:()=>hs.adagrad(.01),Adadelta:()=>hs.adadelta(1,.95,pn()),Adam:()=>hs.adam(.001,.9,.999,pn()),Adamax:()=>hs.adamax(.002,.9,.999,pn(),0),RMSProp:()=>hs.rmsprop(.001,.9,0,pn()),SGD:()=>hs.sgd(.01)};if(n.adagrad=n.Adagrad,n.adadelta=n.Adadelta,n.adam=n.Adam,n.adamax=n.Adamax,n.rmsprop=n.RMSProp,n.sgd=n.SGD,t in n)return n[t]();throw new F(`Unknown Optimizer ${t}`)}function B1(t,n,e=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!V1(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){let r=JSON.stringify(t);r.length>1048576&&console.warn(`User-defined metadata of model "${n}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function V1(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){let n=Object.keys(t);for(let e of n)if(typeof e!="string"||!V1(t[e]))return!1;return!0}else if(Array.isArray(t)){for(let n of t)if(!V1(n))return!1;return!0}else return!1;else{let n=typeof t;return n==="string"||n==="number"||n==="boolean"}}function yU(t,n,e,r=console.log){let o=qfe(t),i=["Layer (type)","Input Shape","Output shape","Param #"];o?(n=n||90,e=e||[.32,.61,.89,1]):(n=n||115,e=e||[.24,.48,.7,.8,1]),e[e.length-1]<=1&&(e=e.map(c=>Math.floor(n*c)));let s;if(!o){i.push("Receives inputs"),s=[];for(let c in t.nodesByDepth)s.push(...t.nodesByDepth[c])}r("_".repeat(n)),Cw(i,e,r),r("=".repeat(n));let a=t.layers;for(let c=0;c<a.length;++c)o?Kfe(a[c],e,r):Xfe(a[c],e,s,r),r((c===a.length-1?"=":"_").repeat(n));t.checkTrainableWeightsConsistency();let l=jfe(t),u=bh(t.nonTrainableWeights);r(`Total params: ${l+u}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${u}`),r("_".repeat(n))}function jfe(t){let n;return t.collectedTrainableWeights!=null?n=bh(t.collectedTrainableWeights):n=bh(t.trainableWeights),n}function qfe(t){let n=!0,e=[],r=[];for(let o in t.nodesByDepth)e.push(t.nodesByDepth[o]);for(let o of e){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){n=!1;break}r.push(...o)}if(n)for(let o of t.layers){let i=!1;for(let s of o.inboundNodes)if(r.indexOf(s)!==-1)if(i){n=!1;break}else i=!0;if(!n)break}return n}function Cw(t,n,e=console.log){let r="";for(let o=0;o<t.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=t[o],r=r.slice(0,n[o]),r+=" ".repeat(n[o]-r.length);e(r)}function Kfe(t,n,e){let r,o;try{o=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}let i=t.name,s=t.getClassName(),a=[`${i} (${s})`,o,r,t.countParams().toString()];Cw(a,n,e)}function Xfe(t,n,e,r){let o,i;try{i=t.inboundNodes.map(p=>JSON.stringify(p.inputShapes)).join(",")}catch{i="multiple"}try{o=JSON.stringify(t.outputShape)}catch{o="multiple"}let s=[];for(let p of t.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(p)===-1))for(let f=0;f<p.inboundLayers.length;++f){let d=p.inboundLayers[f].name,h=p.nodeIndices[f],m=p.tensorIndices[f];s.push(`${d}[${h}][${m}]`)}let a=t.name,l=t.getClassName(),u=s.length===0?"":s[0],c=[`${a} (${l})`,i,o,t.countParams().toString(),u];Cw(c,n,r);for(let p=1;p<s.length;++p)Cw(["","","","",s[p]],n,r)}function xU(t,n,e){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&n===0&&typeof e=="string"}function xy(t,n){if(t===null)return null;if(typeof t=="string")return Ya(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];xU(n,o,i)?e.push(i):e.push(xy(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r];if(r==="name"&&typeof o=="string")e[r]=o;else{let i=Ya(r);e[i]=xy(o,i)}}return e}}function Sw(t,n){if(t==null)return null;if(typeof t=="string")return ii(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];xU(n,o,i)?e.push(i):e.push(Sw(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r],i=ii(r);(r==="name"||r==="className")&&typeof o=="string"?e[i]=o:e[i]=Sw(o,r)}return e}}var Ih="4.22.0";var Yfe=t=>{let n=Object.keys(t);if(n.length===0)return!1;let e=n[0].split("/");return!isNaN(parseInt(e[e.length-1],10))},Iw=class t extends Ie{constructor(n){if(super({}),this.containerNodes=new Set,this.name=n.name,this.name==null){let x=this.getClassName().toLowerCase();this.name=Uu(x)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(n.inputs)?this.inputs=n.inputs.slice():this.inputs=[n.inputs],Array.isArray(n.outputs)?this.outputs=n.outputs.slice():this.outputs=[n.outputs],si(this.inputs).length!==this.inputs.length)throw new F(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(x=>x.name)}`);si(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(x=>x.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let x of this.outputs){let b=x.sourceLayer,w=x.nodeIndex,C=x.tensorIndex;this.outputLayers.push(b),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(C)}for(let x of this.inputs){let b=x.sourceLayer,w=x.nodeIndex,C=x.tensorIndex;Oo(w===0,"input layer has >1 nodes"),Oo(C===0,"input layer has >1 tensors"),this.inputLayers.push(b),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(C)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let x=0;x<this.inputLayers.length;x++){let b=this.inputLayers[x];if(!(b instanceof Wu))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${n.inputs}. Input ${x} (0-based) originates from layer type ${b.getClassName()}.`);this.inputNames.push(b.name),this.feedInputShapes.push(b.batchInputShape),this.feedInputNames.push(b.name)}for(let x of this.outputLayers)this.outputNames.push(x.name);this.internalInputShapes=this.inputs.map(x=>x.shape),this.internalOutputShapes=this.outputs.map(x=>x.shape);let e={},r={},o={},i={},s={},a=[],l=(x,b,w,C,N,D)=>{(C==null||N==null||D==null)&&(C=x.sourceLayer,N=x.nodeIndex,D=x.tensorIndex);let k=C.inboundNodes[N];if(w.indexOf(k)!==-1)throw new Er(`The tensor ${x.name} at layer "${C.name}" is part of a cycle.`);if(b.indexOf(k)!==-1)return;this.containerNodes.add(t.nodeKey(C,N)),C.id in s||(s[C.id]=Object.keys(s).length),w.indexOf(k)===-1&&w.push(k);let O=k.inboundLayers.length;for(let $=0;$<O;$++){let V=k.inputTensors[$],G=k.inboundLayers[$],W=k.nodeIndices[$],H=k.tensorIndices[$];l(V,b,w,G,W,H)}for(b.push(k);w.indexOf(k)>=0;)w.splice(w.indexOf(k),1);a.push(k)},u=[],c=[];for(let x of this.outputs)l(x,u,c);let p=a.slice().reverse();for(let x of p){r[x.id]=x,x.id in e||(e[x.id]=0);let b=e[x.id],w=o[x.outboundLayer.id]==null?0:o[x.outboundLayer.id];b=Math.max(b,w),o[x.outboundLayer.id]=b,i[x.outboundLayer.id]=x.outboundLayer,e[x.id]=b;for(let C=0;C<x.inboundLayers.length;C++){let N=x.inboundLayers[C],D=x.nodeIndices[C],k=N.inboundNodes[D],O=e[k.id]==null?0:e[k.id];e[k.id]=Math.max(b+1,O),r[k.id]=k}}let f={};for(let x in e){let b=e[x];b in f||(f[b]=[]),f[b].push(r[x])}let d={};for(let x in o){let b=o[x];b in d||(d[b]=[]),d[b].push(i[x])}let h=Object.keys(d).map(x=>parseInt(x,10)).sort(ly);this.layers=[];for(let x of h){let b=d[x];b.sort((w,C)=>{let N=s[w.id],D=s[C.id];return N<D?-1:N>D?1:0});for(let w of b)w instanceof t&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=d,h=Object.keys(f).map(x=>parseInt(x,10)).sort(ly);let m=this.inputs.slice(),g=[];for(let x of h)for(let b of f[x]){let w=b.outboundLayer;if(w!=null){for(let C of b.inputTensors)if(m.indexOf(C)===-1)throw new Er(`Graph disconnected: cannot obtain value for tensor ${C} at layer "${w.name}". The following previous layers were accessed without issue: ${g}`);for(let C of b.outputTensors)m.push(C);g.push(w.name)}}this.nodesByDepth=f;let y=this.layers.map(x=>x.name);for(let x of y){let b=y.filter(w=>w===x).length;if(b!==1)throw new Er(`The name "${x}" is used ${b} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Ja({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(x=>null),outputMasks:this.outputs.map(x=>null),inputShapes:this.inputs.map(x=>x.shape),outputShapes:this.outputs.map(x=>x.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let n={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let e of this.layers)n.numDisposedVariables+=e.dispose().numDisposedVariables;for(let e of this.internalContainerRefs)n.numDisposedVariables+=e.dispose().numDisposedVariables}return n.refCountAfterDispose=this._refCount,n}get trainable(){return this.trainable_}set trainable(n){this.layers.forEach(e=>{e._trainableWeights.forEach(r=>r.trainable=n)}),this.trainable_=n}get trainableWeights(){if(this._trainableWeights.length>0)throw new F("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let n=[];for(let e of this.layers)n=n.concat(e.trainableWeights);return n}get nonTrainableWeights(){let n=[];for(let e of this.layers)n.push(...e.nonTrainableWeights);if(!this.trainable){let e=[];for(let r of this.layers)e.push(...r.trainableWeights);return e.concat(n)}return n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(n,e=!0){let r={},o=0,i=Yfe(n);i&&this.parseWeights(n);for(let a of this.layers)for(let[l,u]of a.weights.entries()){let c=i?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(r[c]!=null)throw new F(`Duplicate weight name: ${c}`);r[c]=u,o++}let s=[];for(let a in n){let l=a;if(r[a]==null){let u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(r[l]!=null)s.push([r[l],n[a]]);else if(e)throw new F(`Provided weight data has no target variable: ${a}`);delete r[l]}if(e){let a=[];for(let l in r)a.push(l);if(a.length>0)throw new F(`${a.length} of ${o} weights are not set: ${a}`)}wh(s)}parseWeights(n){for(let e in Object.keys(n)){let r=e.split("/"),o=["vars","layer_checkpoint_dependencies"],i=r.map(s=>s.startsWith("_")?s.slice(1):s).filter(s=>!o.includes(s)).join("/");i!==e&&(n[i]=n[e],delete n[e])}}updatedConfig(){let n=this.getConfig(),e={};return e.className=this.getClassName(),e.config=n,e.kerasVersion=`tfjs-layers ${Ih}`,e.backend="TensorFlow.js",e}toJSON(n,e=!0){let r=Sw(this.updatedConfig());return e?JSON.stringify(r):r}call(n,e){return L(()=>{n=ut(n);let r=new ys;for(let o=0;o<this.inputs.length;++o)r.add(this.inputs[o],n[o]);return Tp(this.outputs,r,e)})}computeMask(n,e){return L(()=>{n=ut(n);let r;return e==null?r=oi(null,n.length):r=ut(e),this.runInternalGraph(n,r)[1]})}computeOutputShape(n){let e=vh(n);if(e.length!==this.inputLayers.length)throw new F(`Invalid inputShape argument ${n}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let a=0;a<e.length;a++){let l=this.inputLayers[a],u=e[a],c=l.name+"_0_0";r[c]=u}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(ly);if(o.length>1)for(let a of o){let l=this.nodesByDepth[a];for(let u of l){let c=u.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(c.id)!==-1)continue;let p=[];for(let m=0;m<u.inboundLayers.length;m++){let g=u.inboundLayers[m],y=u.nodeIndices[m],x=u.tensorIndices[m],b=`${g.name}_${y}_${x}`,w=r[b];p.push(w)}let f=c.computeOutputShape(An(p)),d=vh(f),h=c.inboundNodes.indexOf(u);for(let m=0;m<d.length;m++){let g=`${c.name}_${h}_${m}`;r[g]=d[m]}}}let i=[],s=[];for(let a=0;a<this.outputLayers.length;a++){let l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],p=`${l.name}_${u}_${c}`;s.push(p)}for(let a=0;a<s.length;a++){let l=s[a];Oo(l in r),i.push(r[l])}return An(i)}runInternalGraph(n,e){e==null&&(e=oi(null,n.length));let r={};for(let l=0;l<this.inputs.length;++l){let u=this.inputs[l],c=n[l],p=e[l];r[u.id]=[c,p]}let o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(ly);for(let l of o){let u=this.nodesByDepth[l];for(let c of u){let p=c.outboundLayer,f=c.inputTensors,d=c.outputTensors,h=new Array;for(let m of f)m.id in r&&h.push(r[m.id]);if(h.length===f.length){let m={},g,y,x,b;if(c.callArgs!=null&&(m=c.callArgs),h.length===1){let[w,C]=h[0];m.mask==null&&(m.mask=C),x=ut(p.call(w,m)),b=ut(p.computeMask(w,C)),g=[w],y=[C]}else g=h.map(w=>w[0]),y=h.map(w=>w[1]),m.mask==null&&(m.mask=y),x=ut(p.call(g,m)),b=ut(p.computeMask(g,y));if(p.activityRegularizer)throw new Ee("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<d.length;++w){let C=d[w],N=x[w],D=b[w];r[C.id]=[N,D]}}}}let i=[],s=[],a=[];for(let l of this.outputs){Oo(l.id in r,`Could not compute output ${l.name} : ${l.id}`);let[u,c]=r[l.id];a.push(u.shape),i.push(u),s.push(c)}return[i,s,a]}buildNodeConversionMap(n){let e={},r;for(let o of this.layers){r=o instanceof t?1:0;for(let i=0;i<o.inboundNodes.length;i++){let s=t.nodeKey(o,i);this.containerNodes.has(s)&&(e[s]=r,r+=1)}}return e}getLayer(n,e){if(e!=null)return this.findLayer(e);if(n==null)throw new F("Provide either a layer name or layer index");if(typeof n=="number")return this.findLayer(n);for(let r of this.layers)if(r.name===n)return r;throw new F(`No such layer: ${n}`)}findLayer(n){if(this.layers.length<=n)throw new F(`Was asked to retrieve layer at index ${n}, but model only has ${this.layers.length} layer(s).`);return this.layers[n]}calculateLosses(){return L(()=>{let n=[];for(let e of this.layers)for(let r=0;r<e.inboundNodes.length;++r){let o=t.nodeKey(e,r);this.containerNodes.has(o)&&n.push(...e.calculateLosses())}return n})}getConfig(){let n={name:this.name},e=this.buildNodeConversionMap(this.layers),r=[];for(let s of this.layers){let a=s.getClassName(),l=s.getConfig(),u=[];for(let p=0;p<s.inboundNodes.length;p++){let f=s.inboundNodes[p],d=t.nodeKey(s,p),h={};if(this.containerNodes.has(d)){if(f.callArgs)try{JSON.stringify(f.callArgs),h=f.callArgs}catch{console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),h={}}if(f.inboundLayers.length>0){let m=[];for(let g=0;g<f.inboundLayers.length;g++){let y=f.inboundLayers[g],x=f.nodeIndices[g],b=f.tensorIndices[g],w=t.nodeKey(y,x),C=e[w];C==null&&(C=0),m.push([y.name,C,b,h])}u.push(m)}}}let c={};c.name=s.name,c.className=a,c.config=l,c.inboundNodes=u,r.push(c)}n.layers=r;let o=[];for(let s=0;s<this.inputLayers.length;s++){let a=this.inputLayers[s],l=this.inputLayersNodeIndices[s],u=t.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=e[u];c==null&&(c=0);let p=this.inputLayersTensorIndices[s];o.push([a.name,c,p])}n.inputLayers=o;let i=[];for(let s=0;s<this.outputLayers.length;s++){let a=this.outputLayers[s],l=this.outputLayersNodeIndices[s],u=t.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=e[u];c==null&&(c=0);let p=this.outputLayersTensorIndices[s];i.push([a.name,c,p])}return n.outputLayers=i,n}static fromConfig(n,e,r={},o=!1){let i={},s={};function a(g,y){g.name in s?s[g.name].push(y):s[g.name]=[y]}function l(g,y){let x=[],b;for(let w of y){let C=w[0],N=w[1],D=w[2];if(b=w[3]==null?{}:w[3],!(C in i)){a(g,y);return}let k=i[C];if(k.inboundNodes.length<=N){a(g,y);return}let O=k.inboundNodes[N];x.push(O.outputTensors[D])}x.length>0&&g.apply(An(x),b)}function u(g){let y=g.name,x=co(g,e.customObjects!=null?e.customObjects:{});x.setFastWeightInitDuringBuild(o),i[y]=x,g.inboundNodes.forEach(w=>{if(!(w instanceof Array))throw new F(`Corrupted configuration, expected array for nodeData: ${w}`);a(x,w)})}let c=e.name,p=e.layers;for(let g of p)u(g);for(;!T3(s);)for(let g of p){let y=i[g.name];if(y.name in s){let x=s[y.name];delete s[y.name];for(let b of x)l(y,b)}}let f=[],d=[],h=e.inputLayers;for(let g of h){let y=g[0],x=g[1],b=g[2];Oo(y in i);let C=i[y].inboundNodes[x].outputTensors;f.push(C[b])}let m=e.outputLayers;for(let g of m){let y=g[0],x=g[1],b=g[2];Oo(y in i);let C=i[y].inboundNodes[x].outputTensors;d.push(C[b])}return new n({inputs:f,outputs:d,name:c})}get stateful(){if(this._stateful)throw new F("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let n of this.layers)if(n.stateful)return!0;return!1}resetStates(){L(()=>{this.layers.forEach(n=>{n.stateful&&n.resetStates()})})}};function Zfe(t,n,e){let r=n.length;if(t==null||Array.isArray(t)&&t.length===0)return n.map(o=>null);if(r===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&n[0]in t?[t[n[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${e} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){let o=[];return n.forEach(i=>{i in t?o.push(t[i]):o.push(null)}),o}else throw new Error(`The model has multiple (${r}) outputs, so ${e} must be either an array with ${r} elements or an object with ${n} keys. Provided ${e} not understood: ${JSON.stringify(t)}`)}function Ew(t,n){return Zfe(t,n,"classWeight")}function Tw(t,n,e,r){return B(this,null,function*(){if(n!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){let o=L(()=>{if(t.shape.length===1)return ro(t);if(t.shape.length===2){if(t.shape[1]>1)return za(t,1);if(t.shape[1]===1)return M(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(yield o.data());De(o);let s=[];return i.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);s.push(e[a])}),an(s,"float32")}else return null})}function vU(t,n){return R(t,n)}var Qfe=32;function CU(t,n){let e,r,o=n;e=o.xs,r=o.ys,v.assert(e!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${n}`);let i=bU("input",t.inputNames,e),s=bU("output",t.outputNames,r),a=i[0].shape[0];v.assert(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),v.assert(s.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${s.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)v.assert(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<s.length;l++)v.assert(s[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:s}}function bU(t,n,e){if(e instanceof lt)return[e];if(Array.isArray(e))return v.assert(e.length===n.length,()=>`Received an array of ${e.length} Tensors, but expected ${n.length} to match the ${t} keys ${n}.`),e;{let r=[];for(let o of n){if(e[o]==null)throw new F(`The feature data generated by the dataset lacks the required ${t} key '${o}'.`);r.push(e[o])}return r}}function Jfe(t){if(t.length===3)throw new Ee("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}function SU(t,n,e){return B(this,null,function*(){let r=e.batchesPerEpoch!=null;if(v.assert(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),v.assert(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),v.assert(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),v.assert(!r||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),v.assert(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{let o=e.validationData!=null,i,s;if(o)if(wU(e.validationData))v.assert(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{let g=Jfe(e.validationData);i=g.xs,s=g.ys}let a=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),u;o?u=l.slice().concat(l.map(g=>"val_"+g)):u=l.slice();let c=hw(e.callbacks,e.yieldEvery),p=e.verbose==null?1:e.verbose,{callbackList:f,history:d}=mw(c,p,e.epochs,null,null,ede(n,e),null,o,u);f.setModel(t),t.history=d,yield f.onTrainBegin(),t.stopTraining_=!1;let h=e.initialEpoch==null?0:e.initialEpoch,m=yield n.iterator();for(;h<e.epochs;){let g={};yield f.onEpochBegin(h);let y=0,x=0;for(r||(m=yield n.iterator());!r||y<e.batchesPerEpoch;){let b=yield m.next();if(r&&b.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(b.value!=null){let{xs:w,ys:C}=CU(t,b.value),N={};N.batch=x,N.size=w[0].shape[0],yield f.onBatchBegin(x,N);let D=[];if(e.classWeight!=null){let $=Ew(e.classWeight,t.outputNames);for(let V=0;V<$.length;++V)D.push(yield Tw(C[V],null,$[V]))}let k=w.concat(C).concat(D),O=a(k);De(k);for(let $=0;$<l.length;++$){let V=l[$],G=O[$];N[V]=G,Tn(G)}yield f.onBatchEnd(x,N),cw(N),x++,y++}if(r?y>=e.batchesPerEpoch:b.done){if(o){let w;wU(e.validationData)?w=ut(yield t.evaluateDataset(e.validationData,{batches:e.validationBatches})):w=ut(t.evaluate(i,s,{batchSize:e.validationBatchSize==null?Qfe:e.validationBatchSize,verbose:0}));for(let C=0;C<t.metricsNames.length;++C)g[`val_${t.metricsNames[C]}`]=w[C]}break}if(t.stopTraining_)break}if(yield f.onEpochEnd(h,g),h++,t.stopTraining_)break}return yield f.onTrainEnd(),yield t.history.syncData(),t.history}finally{t.isTraining=!1}})}function ede(t,n){let e=null;return n.batchesPerEpoch!=null?e=n.batchesPerEpoch:Number.isFinite(t.size)&&(e=t.size),e}function wU(t){return typeof t.iterator=="function"}function tde(t){return typeof t.next=="function"}function IU(t,n,e){return B(this,null,function*(){e=e||{};let r=e.batches!=null,o=t.testFunction,i=[];if(e.verbose>0)throw new Ee("Verbose mode is not implemented yet.");v.assert(!r||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);let s=tde(n)?n:yield n.iterator(),a=0,l=0;for(;!r||l<e.batches;){let u=yield s.next();if(i=L(()=>{if(u.value){let{xs:c,ys:p}=CU(t,u.value),f=c.concat(p),d=L(()=>o(f));if(De(f),l===0)for(let m=0;m<d.length;++m)i.push(Se(0));let h=f[0].shape[0];for(let m=0;m<d.length;++m){let g=d[m],y=i[m];i[m]=L(()=>Z(i[m],R(h,g))),l>0&&De(y)}De(d),a+=h,++l}return i}),u.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<i.length;++u){let c=i[u];i[u]=se(i[u],a),De(c)}return An(i)})}function _w(t){v.assert(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Eh(t,n,e){return t==null?[null]:Array.isArray(t)?t.map(r=>Za(r,n,e-n)):Za(t,n,e-n)}function Nw(t,n){return L(()=>t==null?null:Array.isArray(t)?t.map(e=>Nw(e,n)):rw(t,n.dtype==="int32"?n:J(n,"int32")))}function Dw(t,n){let e=[],r=0,o=null;for(;r<t;)o=r+n,o>=t&&(o=t),e.push([r,o]),r=o;return e}function z1(t){let n=[];t instanceof lt&&(t=[t]);for(let e=0;e<t.length;++e){let r=t[e];if(r.rank===1)n.push(Qa(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");n.push(r)}}return n}function ui(t,n){if(t==null)return;let e=[];if(n instanceof lt)e.push(n.id);else if(Array.isArray(n))n.forEach(o=>e.push(o.id));else if(n!=null)for(let o in n){let i=n[o];e.push(i.id)}let r=[];if(t instanceof lt)e.indexOf(t.id)===-1&&r.push(t);else if(Array.isArray(t))t.forEach(o=>{e.indexOf(o.id)===-1&&r.push(o)});else if(t!=null)for(let o in t){let i=t[o];e.indexOf(i.id)===-1&&r.push(i)}r.forEach(o=>{o.isDisposed||o.dispose()})}function nde(t){return t instanceof lt}function U1(t){return Array.isArray(t)}function EU(t){return!nde(t)&&!U1(t)}function TU(t,n,e,r=!0,o=""){if(n==null||n.length===0){if(t!=null){let s=!1;if(U1(t)&&t.length>0)s=!0;else if(EU(t)){for(let a in t)if(t.hasOwnProperty(a)){s=!0;break}}else s=!0;if(s)throw new F(`Error when checking model ${o} expected no data, but got ${t}`)}return[]}if(t==null)return n.map(s=>null);let i;if(EU(t)){t=t,i=[];for(let s of n){if(t[s]==null)throw new F(`No data provided for "${s}". Need data for each key in: ${n}`);i.push(t[s])}}else if(U1(t)){if(t=t,t.length!==n.length)throw new F(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${n.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,n.length>1)throw new F(`The model ${o} expects ${n.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=z1(i),e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new F(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let u=a.shape[l],c=e[s][l];if(c!=null&&c>=0&&u!==c)throw new F(`${o} expected a batch of elements where each example has shape [${e[s].slice(1,e[s].length)}] (i.e.,tensor shape [*,${e[s].slice(1,e[s].length)}]) but the ${o} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function rde(t,n,e){let r=si(t.map(i=>i.shape[0]));r.sort();let o=si(n.map(i=>i.shape[0]));if(o.sort(),r.length>1)throw new F(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(o.length>1)throw new F(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>0&&o.length>0&&!v.arraysEqual(r,o))throw new F(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${o[0]} target sample(s).`)}function ode(t,n,e){let r=[Np,Sh,Dp];for(let o=0;o<t.length;++o){let i=t[o],s=n[o],a=e[o];if(s!=null){if(s===Dp&&i.shape[i.shape.length-1]===1)throw new F(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(s)!==-1){let l=i.shape.slice(1),u=a.slice(1);for(let c=0;c<l.length;++c){let p=l[c],f=u[c];if(f!=null&&p!==f)throw new F(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function _U(t,n,e,r=!0,o=""){let i;if(Array.isArray(t)){if(t.length!==n.length)throw new F(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${n.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(n.length>1)throw new F(`The model expects ${n.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new F(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let u=a.shape[l],c=e[s][l];if(c!=null&&c!==u)throw new F(`Error when checking ${o}: expected ${n[s]} to have shape ${JSON.stringify(e[s])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function ide(t,n){if(t==null||Array.isArray(t)&&t.length===0)return n.map(r=>[]);let e;if(typeof t=="string"||typeof t=="function")e=[t];else if(Array.isArray(t)||typeof t=="object")e=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(e))return n.map(r=>e);{let r=[];for(let o of n){let i=e.hasOwnProperty(o)?e[o]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}var sde="layers-model",tl=(()=>{class t extends Iw{constructor(e){super(e),this.isTraining=!1}summary(e,r,o=console.log){if(!this.built)throw new F("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");yU(this,e,r,o)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=gU(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof tr))throw new F("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let r=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let a in e.loss)if(this.outputNames.indexOf(a)===-1)throw new F(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(let a of this.outputNames)e.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),r.push(yw(e.loss[a]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new F(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);r=e.loss.map(l=>yw(l))}else{let a=yw(e.loss);this.outputs.forEach(l=>{r.push(a)})}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){let l=this.internalOutputShapes[a],u=this.outputNames[a];this.feedOutputNames.push(u),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[a])}let o=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Fi("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([l,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});let i=ide(e.metrics,this.outputNames),s=(a,l,u)=>{this.outputNames.length>1&&(l=this.outputNames[a]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([u,a])};Fi("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=i[a];(c=>{let p="",f,d,h;for(let m of c){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){let y=this.internalOutputShapes[a];y[y.length-1]===1||this.lossFunctions[a]===Sh?["accuracy","acc"].indexOf(m)!==-1?d=vw:["crossentropy","ce"].indexOf(m)!==-1&&(d=$1):this.lossFunctions[a]===Ch?["accuracy","acc"].indexOf(m)!==-1?d=P1:["crossentropy","ce"].indexOf(m)!==-1&&(d=L1):["accuracy","acc"].indexOf(m)!==-1?d=bw:["crossentropy","ce"].indexOf(m)!==-1&&(d=ww);let x;["accuracy","acc"].indexOf(m)!==-1?x="acc":["crossentropy","ce"].indexOf(m)!==-1&&(x="ce"),h=d,f=p+x}else h=hU(m),f=p+yy(m);let g;Fi(f,()=>{g=h}),s(a,f,g)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,r,o={}){let i=o.batchSize==null?32:o.batchSize;_w(i);let a=this.standardizeUserDataXY(e,r,!0,i);try{let l=a[0].concat(a[1]);this.makeTestFunction();let u=this.testFunction,c=this.testLoop(u,l,i,o.verbose,o.steps);return An(c)}finally{ui(a[0],e),ui(a[1],r)}}evaluateDataset(e,r){return B(this,null,function*(){return this.makeTestFunction(),IU(this,e,r)})}checkNumSamples(e,r,o,i="steps"){let s;if(o!=null){if(s=null,r!=null)throw new F(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${r}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new F(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(e,r){if(Array.isArray(r)&&r.length===0)throw new F("`outputs` is an empty Array, which is not allowed.");let o=Array.isArray(r),i=o?r:[r],s=this.retrieveSymbolicTensors(i),a=new ys;if(e instanceof lt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new F(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let u=0;u<this.inputs.length;++u)a.add(this.inputs[u],e[u])}else for(let u of this.inputs){let c=e[u.name];if(c==null)throw new F(`No value is provided for the model's input ${u.name}`);a.add(u,c)}let l=Tp(s,a);return o?l:l[0]}retrieveSymbolicTensors(e){let r=oi(null,e.length),o=e.length;for(let i of this.layers){let s=Array.isArray(i.output)?i.output:[i.output],a=s.map(l=>l.name);for(let l=0;l<e.length;++l){let u=a.indexOf(e[l]);if(u!==-1&&(r[l]=s[u],o--),o===0)break}if(o===0)break}if(o>0){let i=[];throw r.forEach((s,a)=>{s==null&&i.push(e[a])}),new F(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return r}predictLoop(e,r=32,o=!1){return L(()=>{let i=this.checkNumSamples(e);if(o)throw new Ee("Verbose predictLoop() is not implemented yet.");let s=Dw(i,r),a=this.outputs.map(l=>[]);for(let l=0;l<s.length;++l)L(()=>{let c=s[l][0],p=s[l][1],f=Eh(e,c,p),d=[];if(Array.isArray(f))for(let m=0;m<f.length;++m)d.push({key:this.inputs[m],value:f[m]});else d.push({key:this.inputs[0],value:f});let h=new ys(d);return Tp(this.outputs,h)}).forEach((c,p)=>a[p].push(c));return An(a.map(l=>Dt(l,0)))})}predict(e,r={}){let o=z1(e);_U(o,this.inputNames,this.feedInputShapes,!1);try{let i=r.batchSize==null?32:r.batchSize;return _w(i),this.predictLoop(o,i)}finally{ui(o,e)}}predictOnBatch(e){_U(e,this.inputNames,this.feedInputShapes,!0);let r=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,r)}standardizeUserDataXY(e,r,o=!0,i){if(this.optimizer_==null)throw new Er("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let s=[];for(let a=0;a<this.feedOutputShapes.length;++a){let l=this.feedOutputShapes[a];this.feedLossFns[a]===Ch?s.push(l.slice(0,l.length-1).concat([1])):s.push(l)}if(e=TU(e,this.feedInputNames,this.feedInputShapes,!1,"input"),r=TU(r,this.feedOutputNames,s,!1,"target"),rde(e,r,null),ode(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!==0)throw new F(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,r]}standardizeUserData(e,r,o,i,s=!0,a){return B(this,null,function*(){let[l,u]=this.standardizeUserDataXY(e,r,s,a);if(o!=null)throw new Error("sample weight is not supported yet.");let c=null;if(i!=null){let p=Ew(i,this.outputNames);c=[];for(let f=0;f<p.length;++f)c.push(yield Tw(u[f],null,p[f]))}return[l,u,c]})}testLoop(e,r,o,i=0,s){return L(()=>{let a=this.checkNumSamples(r,o,s,"steps"),l=[];if(i>0)throw new Ee("Verbose mode is not implemented yet.");if(s!=null)throw new Ee("steps mode in testLoop() is not implemented yet");{let u=Dw(a,o),c=an(_r(0,a));for(let p=0;p<u.length;++p){let f=u[p][0],d=u[p][1],h=Za(c,f,d-f),m=Nw(r,h),g=e(m);if(p===0)for(let y=0;y<g.length;++y)l.push(Se(0));for(let y=0;y<g.length;++y){let x=g[y];l[y]=Z(l[y],R(d-f,x))}}for(let p=0;p<l.length;++p)l[p]=se(l[p],a)}return l})}getDedupedMetricsNames(){let e=this.metricsNames,r=[];for(let o=0;o<e.length;++o){let i=e[o],s=i;if(w1(e,i)>1){let a=w1(e.slice(0,o),i);s+=`_${a}`}r.push(s)}return r}makeTrainFunction(){return e=>{let r=[],o=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],l=()=>{let f=[];for(let g=0;g<this.inputs.length;++g)f.push({key:this.inputs[g],value:o[g]});let d=new ys(f),h=Tp(this.outputs,d,{training:!0}),m;for(let g=0;g<this.lossFunctions.length;++g){let y=this.lossFunctions[g],x=y(i[g],h[g]);s[g]!=null&&(x=vU(x,s[g]));let b=$t(x);r.push(b),g===0?m=x:m=Z(m,x)}for(let g=0;g<this.metricsTensors.length;++g){let y;if(this.outputs.length>1&&g<this.outputs.length)y=r[g];else{let x=this.metricsTensors[g][0],b=this.metricsTensors[g][1];y=$t(x(i[b],h[b]))}Tn(y),a.push(y)}return m=$t(m),this.calculateLosses().forEach(g=>{m=Z(m,g)}),m},u=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(l,!0,u)].concat(a)}}makeTestFunction(){this.testFunction=e=>L(()=>{let r=[],o,i=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let c=0;c<this.inputs.length;++c)a.push({key:this.inputs[c],value:i[c]});let l=new ys(a),u=Tp(this.outputs,l);for(let c=0;c<this.lossFunctions.length;++c){let p=this.lossFunctions[c],f=$t(p(s[c],u[c]));c===0?o=f:o=Z(o,f),r.push(o)}for(let c=0;c<this.metricsTensors.length;++c){let p=this.metricsTensors[c][0],f=this.metricsTensors[c][1],d=$t(p(s[f],u[f]));r.push(d)}return r})}fit(i,s){return B(this,arguments,function*(e,r,o={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let a,l,u,c,p,f,d,h,m;try{let g=o.batchSize==null?32:o.batchSize;_w(g);let x=yield this.standardizeUserData(e,r,o.sampleWeight,o.classWeight,!1,g);a=x[0],l=x[1],m=x[2];let b=!1,w;if(o.validationData!=null&&o.validationData.length>0){if(b=!0,o.validationData.length===2)p=o.validationData[0],f=o.validationData[1];else throw o.validationData.length===3?new Ee("validationData including sample weights is not supported yet."):new F(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${o.validationData} is invalid.`);let W=yield this.standardizeUserData(p,f,null,null,!0,g);d=W[0],h=W[1],w=d.concat(h)}else if(o.validationSplit!=null&&o.validationSplit>0&&o.validationSplit<1){b=!0;let G=Math.floor(a[0].shape[0]*(1-o.validationSplit)),W=a[0].shape[0];d=Eh(a,G,W),u=a,a=Eh(a,0,G),h=Eh(l,G,W),c=l,l=Eh(l,0,G),w=d.concat(h)}else o.validationSteps!=null&&(b=!0);let C=a.concat(l).concat(m);this.checkTrainableWeightsConsistency();let N=this.makeTrainFunction(),D=this.getDedupedMetricsNames(),k,O;b?(this.makeTestFunction(),k=this.testFunction,O=D.slice().concat(D.map(G=>"val_"+G))):(k=null,w=[],O=D.slice());let $=hw(o.callbacks,o.yieldEvery);return yield this.fitLoop(N,C,D,g,o.epochs,o.verbose,$,k,w,o.shuffle,O,o.initialEpoch,null,null)}finally{this.isTraining=!1,ui(a,e),ui(l,r),ui(u,e),ui(c,r),ui(d,p),ui(h,f),m!=null&&De(m)}})}fitLoop(e,r,o,i,s,a,l,u,c,p,f,d,h,m){return B(this,null,function*(){i==null&&(i=32),s==null&&(s=1),p==null&&(p=!0),d==null&&(d=0);let g=!1;if(u!=null&&c!=null&&(g=!0),m!=null&&(g=!0,h==null))throw new F("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let y=this.checkNumSamples(r,i,h,"steps_per_epoch"),x;y!=null&&(x=_r(0,y)),a==null&&(a=1);let{callbackList:b,history:w}=mw(l,a,s,d,y,h,i,g,f);b.setModel(this),this.history=w,yield b.onTrainBegin(),this.stopTraining_=!1;for(let C=d;C<s;++C){yield b.onEpochBegin(C);let N={};if(h!=null)throw new Ee("stepsPerEpoch mode is not implemented yet.");{if(p==="batch")throw new Ee("batch shuffling is not implemneted yet");p&&v.shuffle(x);let D=an(x),k=Dw(y,i);for(let O=0;O<k.length;++O){let $={};if(yield b.onBatchBegin(O,$),L(()=>{let V=k[O][0],G=k[O][1],W=Za(D,V,G-V);$.batch=O,$.size=G-V;let H=Nw(r,W),j=e(H);for(let Y=0;Y<o.length;++Y){let ee=o[Y],X=j[Y];$[ee]=X,Tn(X)}if(O===k.length-1&&g){let Y=this.testLoop(u,c,i);for(let ee=0;ee<o.length;++ee){let X=o[ee],te=Y[ee];Tn(te),N["val_"+X]=te}}}),yield b.onBatchEnd(O,$),cw($),this.stopTraining_)break}D.dispose()}if(yield b.onEpochEnd(C,N),this.stopTraining_)break}return yield b.onTrainEnd(),yield this.history.syncData(),this.history})}fitDataset(e,r){return B(this,null,function*(){return SU(this,e,r)})}trainOnBatch(e,r){return B(this,null,function*(){let o=yield this.standardizeUserData(e,r),i=o[0],s=o[1],l=this.makeTrainFunction()(i.concat(s)),u=[];for(let c of l){let p=yield c.data();u.push(p[0])}return De(l),ui(o[0],e),ui(o[1],r),An(u)})}getNamedWeights(e){let r=[],o=e!=null&&e.trainableOnly,i=o?this.trainableWeights:this.weights,s=this.getWeights(o);for(let a=0;a<i.length;++a)o&&!i[a].trainable||r.push({name:i[a].originalName,tensor:s[a]});return r}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let r=Mg().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-Mg().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ii(this.loss);else if(Array.isArray(this.loss)){for(let r of this.loss)if(typeof r!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(r=>ii(r))}else{let r=Object.keys(this.loss);e={};let o=this.loss;for(let i of r)if(typeof o[i]=="string")e[i]=ii(o[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ii(yy(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ii(yy(e)));{let e={};for(let r in this.metrics)e[r]=ii(yy(this.metrics[r]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let r=xy(e.optimizer_config),o=co(r),i;if(typeof e.loss=="string")i=Ya(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(a=>Ya(a));else if(e.loss!=null){i={};for(let a in e.loss)i[a]=Ya(e.loss[a])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(a=>Ya(a));else if(e.metrics!=null){s={};for(let a in e.metrics)s[a]=Ya(e.metrics[a])}this.compile({loss:i,metrics:s,optimizer:o})}save(e,r){return B(this,null,function*(){if(typeof e=="string"){let c=Ka.getSaveHandlers(e);if(c.length===0)throw new F(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new F(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new F("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let o=yield Ka.encodeWeights(this.getNamedWeights(r)),l={modelTopology:this.toJSON(null,!1),format:sde,generatedBy:`TensorFlow.js tfjs-layers v${Ih}`,convertedBy:null};if((r==null?!1:r.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();let c="optimizer",{data:p,specs:f}=yield Ka.encodeWeights(yield this.optimizer.getWeights(),c);o.specs.push(...f),o.data=Ka.concatenateArrayBuffers([o.data,p])}return this.userDefinedMetadata!=null&&(B1(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=o.data,l.weightSpecs=o.specs,e.save(l)})}setUserDefinedMetadata(e){B1(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}return t.className="Model",t})();K.registerClass(tl);var ade=(()=>{class t extends tl{}return t.className="Functional",t})();K.registerClass(ade);var kw=(()=>{class t extends tl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Uu("sequential_"),e.layers!=null)for(let r of e.layers)this.add(r)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(o=>o<0))throw new F(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let r=e instanceof t||e instanceof tl,o;if(r){if(o=e,o.outputs.length!==1)throw new F("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(o.inputs.length!==1)throw new F("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new F("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let i=aw({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=o.outputs,this.inputs=o.inputs;else{if(e.inboundNodes.length!==1)throw new F(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new F("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=M1(this.outputs[0])}this.inboundNodes=[],new Ja({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:oi(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{let i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,r){return this.model==null&&this.build(),this.model.call(e,r)}build(e){if(Fe(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new tl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,r,o=console.log){this.built||this.build(),super.summary(e,r,o)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,r,o={}){if(!this.built)throw new Er("The model needs to be compiled before being used.");return this.model.evaluate(e,r,o)}evaluateDataset(e,r){return B(this,null,function*(){if(!this.built)throw new Er("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,r)})}predict(e,r={}){return this.model==null&&this.build(),this.model.predict(e,r)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}fit(i,s){return B(this,arguments,function*(e,r,o={}){if(!this.built)throw new Er("The model needs to be compiled before being used.");return this.model.fit(e,r,o)})}fitDataset(e,r){return B(this,null,function*(){if(!this.built)throw new Er("The model needs to be compiled before being used.");return this.model.fitDataset(e,r)})}trainOnBatch(e,r){return B(this,null,function*(){return this.model.trainOnBatch(e,r)})}static fromConfig(e,r,o={},i=!1){let s,a={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new F("Legacy serialization format not supported yet.");s=r}else v.assert(r.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=r.layers,delete r.layers,a=r;let l=new e(a);if(!(l instanceof t))throw new Ee(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(let u of s){let p=co(u,void 0,i);i&&p.setFastWeightInitDuringBuild(!0),l.add(p)}return l}set stopTraining(e){if(this.model==null)throw new F("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new F("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let r of this.layers){let o={};o.className=r.getClassName(),o.config=r.getConfig(),e.push(o)}return{name:this.name,layers:e}}}return t.className="Sequential",t})();K.registerClass(kw);function G1(t){return new kw(t)}function W1(t){return aw(t)}var Gn=class extends K.Serializable{getConfig(){return{}}},ude=(()=>{class t extends Gn{apply(e,r=1){return z3(e,r)}}return t.className="elu",t})();K.registerClass(ude);var cde=(()=>{class t extends Gn{apply(e){return Yg(e)}}return t.className="selu",t})();K.registerClass(cde);var pde=(()=>{class t extends Gn{apply(e){return ao(e)}}return t.className="relu",t})();K.registerClass(pde);var fde=(()=>{class t extends Gn{apply(e){return L(()=>ds(6,ao(e)))}}return t.className="relu6",t})();K.registerClass(fde);var dde=(()=>{class t extends Gn{apply(e){return e}}return t.className="linear",t})();K.registerClass(dde);var hde=(()=>{class t extends Gn{apply(e){return ei(e)}}return t.className="sigmoid",t})();K.registerClass(hde);var mde=(()=>{class t extends Gn{apply(e){return G3(e)}}return t.className="hardSigmoid",t})();K.registerClass(mde);var gde=(()=>{class t extends Gn{apply(e){return fs(e)}}return t.className="softplus",t})();K.registerClass(gde);var yde=(()=>{class t extends Gn{apply(e){return U3(e)}}return t.className="softsign",t})();K.registerClass(yde);var xde=(()=>{class t extends Gn{apply(e){return lp(e)}}return t.className="tanh",t})();K.registerClass(xde);var j1=(()=>{class t extends Gn{apply(e,r=-1){return xp(e,r)}}return t.className="softmax",t})();K.registerClass(j1);var vde=(()=>{class t extends Gn{apply(e,r=-1){return Hg(e,r)}}return t.className="logSoftmax",t})();K.registerClass(vde);var bde=(()=>{class t extends Gn{apply(e){return L(()=>L(()=>{let r=Math.sqrt(2),o=R(.5,Z(1,Ug(se(e,r))));return R(e,o)}))}}return t.className="gelu",t})();K.registerClass(bde);var wde=(()=>{class t extends Gn{apply(e){return L(()=>R(.5,R(e,Z(1,lp(R(wt(se(2,Math.PI)),Z(e,R(.044715,$r(e,3)))))))))}}return t.className="gelu_new",t})();K.registerClass(wde);var Cde=(()=>{class t extends Gn{apply(e){return L(()=>R(e,lp(fs(e))))}}return t.className="mish",t})();K.registerClass(Cde);var Sde=(()=>{class t extends Gn{apply(e,r=1){return L(()=>R(ei(R(e,r)),e))}}return t.className="swish",t})();K.registerClass(Sde);function Pi(t){return t.getClassName()}function H1(t,n={}){return ms(t,K.SerializationMap.getMap().classNameMap,n,"activation")}function Li(t){if(t==null){let n={};return n.className="linear",n.config={},H1(n)}if(typeof t=="string"){let n={};return n.className=t,n.config={},H1(n)}else return t instanceof Gn?t:H1(t)}function Ide(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}var Aw=class extends K.Serializable{},kU=(()=>{class t extends Aw{constructor(e){super(),Ide(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return L(()=>{let r=At([1]);return this.hasL1&&(r=Z(r,ue(R(this.l1,cn(e))))),this.hasL2&&(r=Z(r,ue(R(this.l2,Ep(e))))),M(r,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,r){return new e({l1:r.l1,l2:r.l2})}}return t.className="L1L2",t})();K.registerClass(kU);var NU={l1l2:"L1L2"};function dt(t){return mh(t)}function DU(t,n={}){return ms(t,K.SerializationMap.getMap().classNameMap,n,"regularizer")}function St(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in NU?NU[t]:t,config:{}};return DU(e)}else return t instanceof Aw?t:DU(t)}var q1=(()=>{class t extends Ie{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,r){e=we(e);let o=ao(e);return this.maxValue!=null&&(o=zn(o,0,this.maxValue)),o}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ReLU",t})();K.registerClass(q1);var K1=(()=>{class t extends Ie{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=we(e);return pp(o,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LeakyReLU",t})();K.registerClass(K1);var X1=(()=>{class t extends Ie{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=yt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=St(e.alphaRegularizer),this.alphaConstraint=Wt(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new F(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Fe(e);let r=e.slice(1);if(this.sharedAxes!=null)for(let i of this.sharedAxes)r[i-1]=1;this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let o={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)o[i]=e[i];this.inputSpec=[new Ct({ndim:e.length,axes:o})],this.built=!0}call(e,r){return e=we(e),mp(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Et(this.alphaInitializer),alphaRegularizer:dt(this.alphaRegularizer),alphaConstraint:Gt(this.alphaConstraint),sharedAxes:this.sharedAxes},r=super.getConfig();return Object.assign(e,r),e}}return t.className="PReLU",t})();K.registerClass(X1);var Y1=(()=>{class t extends Ie{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ee(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=we(e);return Ha(o)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ELU",t})();K.registerClass(Y1);var Z1=(()=>{class t extends Ie{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,r){let o=we(e);return R(o,J(Zt(o,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ThresholdedReLU",t})();K.registerClass(Z1);var Q1=(()=>{class t extends Ie{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new j1().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,r){return L(()=>{let o=we(e),i=r.mask;if(i!=null){let s=R(pe(Ir(o.shape),J(i,o.dtype)),Se(-1e9));o=Z(o,s)}return this.axis instanceof Array?this.axis.length>1?Nn(pe(o,jg(o,this.axis,!0))):this.softmax(o,this.axis[0]):this.softmax(o,this.axis)})}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Softmax",t})();K.registerClass(Q1);function ju(t,n,e){if(typeof t=="number")return oi(t,n);if(t.length!==n)throw new F(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${t.length} elements.`);for(let r=0;r<n;++r){let o=t[r];if(!P3(o))throw new F(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t}function Vr(t,n,e,r,o=1){if(t==null)return t;let i=n+(n-1)*(o-1),s;return e==="same"?s=t:s=t-i+1,Math.floor((s+r-1)/r)}function Vi(t,n,e,r){if(t==null)return null;if(r==="valid")t=t*n+$i([e-n,0]);else if(r==="same")t=t*n;else throw new F(`Unsupport padding mode: ${r}.`);return t}function by(t,n){return L(()=>(Pt(n),n==="channelsFirst"?$e(t,[0,2,3,1]):t))}function J1(t,n){return L(()=>(Pt(n),n==="channelsFirst"?$e(t,[0,2,3,4,1]):t))}function Tde(t,n,e,r=1,o="valid",i,s=1){return L(()=>{if(i==null&&(i=Nr()),Pt(i),t.shape.length!==3)throw new F(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(n.shape.length!==3)throw new F(`The kernel for a conv1dWithBias operation should be 3, but is ${n.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new F(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(i==="channelsFirst"&&(t=$e(t,[0,2,1])),o==="causal")throw new Ee("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Lg(t,n,r,o==="same"?"same":"valid","NWC",s);return e!=null&&(a=Dr(a,e)),a})}function AU(t,n,e,r=[1,1],o="valid",i,s,a=null){return L(()=>{if(i==null&&(i=Nr()),Pt(i),t.rank!==3&&t.rank!==4)throw new F(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(n.rank!==3&&n.rank!==4)throw new F(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=by(t,i);if(o==="causal")throw new Ee("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=Sp.conv2d({x:l,filter:n,strides:r,pad:o==="same"?"same":"valid",dilations:s,dataFormat:"NHWC",bias:e,activation:a}),i==="channelsFirst"&&(l=$e(l,[0,3,1,2])),l})}function _de(t,n,e,r=[1,1,1],o="valid",i,s){return L(()=>{if(i==null&&(i=Nr()),Pt(i),t.rank!==4&&t.rank!==5)throw new F(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(n.rank!==4&&n.rank!==5)throw new F(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=J1(t,i);if(o==="causal")throw new Ee("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=_D(a,n,r,o==="same"?"same":"valid","NDHWC",s),e!=null&&(a=Dr(a,e)),i==="channelsFirst"&&(a=$e(a,[0,4,1,2,3])),a})}var vy=class t extends Ie{constructor(n,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyArgs(e),this.rank=n,tn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ee(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=ju(e.kernelSize,n,"kernelSize"),this.strides=ju(e.strides==null?1:e.strides,n,"strides"),this.padding=e.padding==null?"valid":e.padding,Tr(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Pt(this.dataFormat),this.activation=Li(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=yt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Wt(e.biasConstraint),this.biasRegularizer=St(e.biasRegularizer),this.activityRegularizer=St(e.activityRegularizer),this.dilationRate=ju(e.dilationRate==null?1:e.dilationRate,n,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new F(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new F(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new F(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(n){if(Oo("kernelSize"in n,"required key 'kernelSize' not in config"),typeof n.kernelSize!="number"&&!X0(n.kernelSize,"number",1,3))throw new F(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(n.kernelSize)}.`)}getConfig(){let n={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Pi(this.activation),useBias:this.useBias,biasInitializer:Et(this.biasInitializer),biasRegularizer:dt(this.biasRegularizer),activityRegularizer:dt(this.activityRegularizer),biasConstraint:Gt(this.biasConstraint)},e=super.getConfig();return Object.assign(n,e),n}},Th=class t extends vy{constructor(n,e){super(n,e),this.kernel=null,t.verifyArgs(e),this.filters=e.filters,tn(this.filters,"filters"),this.kernelInitializer=yt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Wt(e.kernelConstraint),this.kernelRegularizer=St(e.kernelRegularizer)}build(n){n=Fe(n);let e=this.dataFormat==="channelsFirst"?1:n.length-1;if(n[e]==null)throw new F(`The channel dimension of the input should be defined. Found ${n[e]}`);let r=n[e],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:r}}],this.built=!0}call(n,e){return L(()=>{n=we(n);let r,o=this.bias==null?null:this.bias.read(),i=Y0(this.activation.getClassName());if(i!=null&&this.rank===2)r=AU(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=Tde(n,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=AU(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=_de(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ee("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(n){n=Fe(n);let e=[],r=this.dataFormat==="channelsLast"?n.slice(1,n.length-1):n.slice(2);for(let i=0;i<r.length;++i){let s=Vr(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);e.push(s)}let o=[n[0]];return this.dataFormat==="channelsLast"?(o=o.concat(e),o.push(this.filters)):(o.push(this.filters),o=o.concat(e)),o}getConfig(){let n={filters:this.filters,kernelInitializer:Et(this.kernelInitializer),kernelRegularizer:dt(this.kernelRegularizer),kernelConstraint:Gt(this.kernelConstraint)},e=super.getConfig();return Object.assign(n,e),n}static verifyArgs(n){if(!("filters"in n)||typeof n.filters!="number"||n.filters<1)throw new F(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(n.filters)}`)}},Rw=(()=>{class t extends Th{constructor(e){super(2,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!X0(e.kernelSize,"number",1,2))throw new F(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv2D",t})();K.registerClass(Rw);var Mw=(()=>{class t extends Th{constructor(e){super(3,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new F(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv3D",t})();K.registerClass(Mw);var ek=(()=>{class t extends Rw{constructor(e){if(super(e),this.inputSpec=[new Ct({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new F(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Fe(e),e.length!==4)throw new F("Input should have rank 4; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new F("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ct({ndim:4,axes:{[r]:o}})],this.built=!0}call(e,r){return L(()=>{let o=we(e);if(o.shape.length!==4)throw new F(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l;this.dataFormat==="channelsFirst"?(a=2,l=3):(a=1,l=2);let u=i[a],c=i[l],p=this.kernelSize[0],f=this.kernelSize[1],d=this.strides[0],h=this.strides[1],m=Vi(u,d,p,this.padding),g=Vi(c,h,f,this.padding),y=[s,m,g,this.filters];this.dataFormat!=="channelsLast"&&(o=$e(o,[0,2,3,1]));let x=Vg(o,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=$e(x,[0,3,1,2])),this.bias!=null&&(x=Dr(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(e){e=Fe(e);let r=e.slice(),o,i,s;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3):(o=3,i=1,s=2);let a=this.kernelSize[0],l=this.kernelSize[1],u=this.strides[0],c=this.strides[1];return r[o]=this.filters,r[i]=Vi(r[i],u,a,this.padding),r[s]=Vi(r[s],c,l,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv2DTranspose",t})();K.registerClass(ek);var tk=(()=>{class t extends Mw{constructor(e){if(super(e),this.inputSpec=[new Ct({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new F(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Fe(e),e.length!==5)throw new F("Input should have rank 5; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new F("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ct({ndim:5,axes:{[r]:o}})],this.built=!0}call(e,r){return L(()=>{let o=we(e);if(o.shape.length!==5)throw new F(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l,u;this.dataFormat==="channelsFirst"?(u=2,a=3,l=4):(u=1,a=2,l=3);let c=i[u],p=i[a],f=i[l],d=this.kernelSize[0],h=this.kernelSize[1],m=this.kernelSize[2],g=this.strides[0],y=this.strides[1],x=this.strides[2],b=Vi(c,g,d,this.padding),w=Vi(p,y,h,this.padding),C=Vi(f,x,m,this.padding),N=[s,b,w,C,this.filters];this.dataFormat!=="channelsLast"&&(o=$e(o,[0,2,3,4,1]));let D=ND(o,this.kernel.read(),N,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(D=$e(D,[0,4,1,2,3])),this.bias!==null&&(D=Dr(D,this.bias.read(),this.dataFormat)),this.activation!==null&&(D=this.activation.apply(D)),D})}computeOutputShape(e){e=Fe(e);let r=e.slice(),o,i,s,a;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3,a=4):(o=4,i=1,s=2,a=3);let l=this.kernelSize[0],u=this.kernelSize[1],c=this.kernelSize[2],p=this.strides[0],f=this.strides[1],d=this.strides[2];return r[o]=this.filters,r[i]=Vi(r[i],p,l,this.padding),r[s]=Vi(r[s],f,u,this.padding),r[a]=Vi(r[a],d,c,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv3DTranspose",t})();K.registerClass(tk);var Nde=(()=>{class t extends Th{constructor(e,r){if(super(e,r),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,r.filters==null)throw new F("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new F("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new F(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(r.padding)}`);this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=yt(r.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=St(r.depthwiseRegularizer),this.depthwiseConstraint=Wt(r.depthwiseConstraint),this.pointwiseInitializer=yt(r.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=St(r.pointwiseRegularizer),this.pointwiseConstraint=Wt(r.pointwiseConstraint)}build(e){if(e=Fe(e),e.length<this.rank+2)throw new F(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null||e[r]<0)throw new F(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[r])}`);let o=e[r],i=this.kernelSize.concat([o,this.depthMultiplier]),s=[];for(let l=0;l<this.rank;++l)s.push(1);s.push(o*this.depthMultiplier,this.filters);let a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new Ct({ndim:this.rank+2,axes:{[r]:o}})],this.built=!0}call(e,r){return L(()=>{e=we(e);let o;if(this.rank===1)throw new Ee("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=$e(e,[0,2,3,1])),o=Zg(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(o=Dr(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),this.dataFormat==="channelsFirst"&&(o=$e(o,[0,3,1,2])),o})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Et(this.depthwiseInitializer),e.pointwiseInitializer=Et(this.pointwiseInitializer),e.depthwiseRegularizer=dt(this.depthwiseRegularizer),e.pointwiseRegularizer=dt(this.pointwiseRegularizer),e.depthwiseConstraint=Gt(this.depthwiseConstraint),e.pointwiseConstraint=Gt(this.pointwiseConstraint),e}}return t.className="SeparableConv",t})();var nk=(()=>{class t extends Nde{constructor(e){super(2,e)}}return t.className="SeparableConv2D",t})();K.registerClass(nk);var rk=(()=>{class t extends Th{constructor(e){super(1,e),t.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!X0(e.kernelSize,"number",1,1))throw new F(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv1D",t})();K.registerClass(rk);var ok=(()=>{class t extends Ie{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,r){return L(()=>{if(e=we(e),this.dataFormat==="channelsLast"){let o=cy(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return cy(o,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let o=cy(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return cy(o,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Cropping2D",t})();K.registerClass(ok);var ik=(()=>{class t extends Ie{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Pt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,F3(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let r=e[2]==null?null:this.size[0]*e[2],o=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],r,o]}else{let r=e[1]==null?null:this.size[0]*e[1],o=e[2]==null?null:this.size[1]*e[2];return[e[0],r,o,e[3]]}}call(e,r){return L(()=>{let o=we(e),i=o.shape;if(this.dataFormat==="channelsFirst"){o=$e(o,[0,2,3,1]);let s=this.size[0]*i[2],a=this.size[1]*i[3],l=this.interpolation==="nearest"?lo.resizeNearestNeighbor(o,[s,a]):lo.resizeBilinear(o,[s,a]);return $e(l,[0,3,1,2])}else{let s=this.size[0]*i[1],a=this.size[1]*i[2];return this.interpolation==="nearest"?lo.resizeNearestNeighbor(o,[s,a]):lo.resizeBilinear(o,[s,a])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},r=super.getConfig();return Object.assign(e,r),e}}return t.className="UpSampling2D",t})();K.registerClass(ik);function Dde(t,n,e=[1,1],r="valid",o,i){return L(()=>{o==null&&(o=Nr()),Pt(o);let s=by(t,o);if(t.rank!==4)throw new F(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(n.rank!==4)throw new F(`depthwiseKernel is required to be 4-D, but is instead ${n.rank}-D`);return s=Wa(s,n,e,r==="same"?"same":"valid","NHWC",i),o==="channelsFirst"&&(s=$e(s,[0,3,1,2])),s})}var sk=(()=>{class t extends vy{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=yt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Wt(e.depthwiseConstraint),this.depthwiseRegularizer=St(e.depthwiseRegularizer)}build(e){if(e=Fe(e),e.length<4)throw new F(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let r=this.dataFormat==="channelsFirst"?1:3;if(e[r]==null||e[r]<0)throw new F(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[r]}).`);let o=e[r],i=[this.kernelSize[0],this.kernelSize[1],o,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[o*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return L(()=>{e=we(e);let o=Dde(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(o=Dr(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),o})}computeOutputShape(e){e=Fe(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],o=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=Vr(r,this.kernelSize[0],this.padding,this.strides[0]),a=Vr(o,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,s,a]:[e[0],s,a,i]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Et(this.depthwiseInitializer),e.depthwiseRegularizer=dt(this.depthwiseRegularizer),e.depthwiseConstraint=Gt(this.depthwiseRegularizer),e}}return t.className="DepthwiseConv2D",t})();K.registerClass(sk);function ak(t,n,e,r){if(Array.isArray(t)){if(n!=null||e!=null)throw new F("When inputs is an array, neither initialState or constants should be provided");r!=null&&(e=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(n=t.slice(1,t.length)),t=t[0]}function o(i){return i==null||Array.isArray(i)?i:[i]}return n=o(n),e=o(e),{inputs:t,initialState:n,constants:e}}function lk(t,n,e,r=!1,o,i,s=!1,a=!1){return L(()=>{let l=n.shape.length;if(l<3)throw new F(`Input should be at least 3D, but is ${l}D.`);let u=[1,0].concat(_r(2,l));if(n=$e(n,u),i!=null)throw new Ee("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=J(J(o,"bool"),"float32"),o.rank===l-1&&(o=sn(o,-1)),o=$e(o,u)),r&&(n=Ro(n,0),o!=null&&(o=Ro(o,0)));let c=[],p,f=e,d=n.shape[0],h=cr(n),m;o!=null&&(m=cr(o));for(let y=0;y<d;++y){let x=h[y],b=L(()=>t(x,f));if(o==null)p=b[0],f=b[1];else{let w=L(()=>{let C=m[y],N=pe(Dn(C),C),D=Z(R(b[0],C),R(f[0],N)),k=f.map((O,$)=>Z(R(b[1][$],C),R(O,N)));return{output:D,newStates:k}});p=w.output,f=w.newStates}a&&c.push(p)}let g;return a&&(g=mn(c,1)),[p,g,f]})}var xs=(()=>{class t extends Ie{constructor(e){super(e);let r;if(e.cell==null)throw new F("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?r=new $w({cells:e.cell}):r=e.cell,r.stateSize==null)throw new F("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=r,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Ct({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return _r(0,e).map(r=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){sw(e)&&(e=e[0]),e=e;let r=this.cell.stateSize;Array.isArray(r)||(r=[r]);let o=r[0],i;if(this.returnSequences?i=[e[0],e[1],o]:i=[e[0],o],this.returnState){let s=[];for(let a of r)s.push([e[0],a]);return[i].concat(s)}else return i}computeMask(e,r){return L(()=>{Array.isArray(r)&&(r=r[0]);let o=this.returnSequences?r:null;if(this.returnState){let i=this.states.map(s=>null);return[o].concat(i)}else return o})}get states(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[];for(let o=0;o<e;++o)r.push(null);return r}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ee("Constants support is not implemented in RNN yet.");sw(e)&&(e=e[0]),e=e;let o=this.stateful?e[0]:null,i=e.slice(2);this.inputSpec[0]=new Ct({shape:[o,null,...i]});let s=[e[0]].concat(e.slice(2));this.cell.build(s);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!v.arraysEqual(this.stateSpec.map(l=>l.shape[l.shape.length-1]),a))throw new F(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(l=>new Ct({shape:[null,l]}));this.stateful&&this.resetStates()}resetStates(e,r=!1){L(()=>{if(!this.stateful)throw new Mo("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape[0];if(o==null)throw new F("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>At([o,i])):this.states_=[At([o,this.cell.stateSize])];else if(e==null)De(this.states_),this.keptStates!=null&&(De(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>At([o,i])):this.states_[0]=At([o,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new F(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r===!0?this.keptStates.push(this.states_.slice()):De(this.states_);for(let i=0;i<this.states_.length;++i){let s=e[i],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,l=[o,a];if(!v.arraysEqual(s.shape,l))throw new F(`State ${i} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>Tn(i.clone()))})}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=ak(e,o,i,this.numConstants);e=s.inputs,o=s.initialState,i=s.constants;let a=[],l=[];if(o!=null){r.initialState=o,a=a.concat(o),this.stateSpec=[];for(let c of o)this.stateSpec.push(new Ct({shape:c.shape}));l=l.concat(this.stateSpec)}if(i!=null&&(r.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof fr){let c=[e].concat(a),p=this.inputSpec.concat(l),f=this.inputSpec;this.inputSpec=p;let d=super.apply(c,r);return this.inputSpec=f,d}else return super.apply(e,r)}call(e,r){return L(()=>{let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;e=we(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));let a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==a)throw new F(`RNN Layer has ${a} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let l={training:i},c=lk((m,g)=>{let y=this.cell.call([m].concat(g),l);return[y[0],y.slice(1)]},e,s,this.goBackwards,o,null,this.unroll,this.returnSequences),p=c[0],f=c[1],d=c[2];this.stateful&&this.resetStates(d,i);let h=this.returnSequences?f:p;return this.returnState?[h].concat(d):h})}getInitialState(e){return L(()=>{let r=At(e.shape);return r=ue(r,[1,2]),r=Qa(r),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(o=>o>1?nw(r,[1,o]):r):this.cell.stateSize>1?[nw(r,[1,this.cell.stateSize])]:[r]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);let o=this.cell.getConfig();return this.getClassName()===t.className&&(r.cell={className:this.cell.getClassName(),config:o}),Object.assign(Object.assign(Object.assign({},o),e),r)}static fromConfig(e,r,o={}){let i=r.cell,s=co(i,o);return new e(Object.assign(r,{cell:s}))}}return t.className="RNN",t})();K.registerClass(xs);var nl=class extends Ie{},Ow=(()=>{class t extends nl{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,tn(this.units,"units"),this.activation=Li(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=yt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=yt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=yt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=St(e.kernelRegularizer),this.recurrentRegularizer=St(e.recurrentRegularizer),this.biasRegularizer=St(e.biasRegularizer),this.kernelConstraint=Wt(e.kernelConstraint),this.recurrentConstraint=Wt(e.recurrentConstraint),this.biasConstraint=Wt(e.biasConstraint),this.dropout=Ip([1,$i([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ip([1,$i([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Fe(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return L(()=>{if(e=e,e.length!==2)throw new F(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let o=e[1];e=e[0];let i=r.training==null?!1:r.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=rl({ones:()=>Dn(e),rate:this.dropout,training:i,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=rl({ones:()=>Dn(o),rate:this.recurrentDropout,training:i,dropoutFunc:this.dropoutFunc}));let s,a=this.dropoutMask,l=this.recurrentDropoutMask;a!=null?s=li(R(e,a),this.kernel.read()):s=li(e,this.kernel.read()),this.bias!=null&&(s=Dr(s,this.bias.read())),l!=null&&(o=R(o,l));let u=Z(s,li(o,this.recurrentKernel.read()));return this.activation!=null&&(u=this.activation.apply(u)),[u,u]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Pi(this.activation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:dt(this.kernelRegularizer),recurrentRegularizer:dt(this.recurrentRegularizer),biasRegularizer:dt(this.biasRegularizer),activityRegularizer:dt(this.activityRegularizer),kernelConstraint:Gt(this.kernelConstraint),recurrentConstraint:Gt(this.recurrentConstraint),biasConstraint:Gt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),r)}}return t.className="SimpleRNNCell",t})();K.registerClass(Ow);var uk=(()=>{class t extends xs{constructor(e){e.cell=new Ow(e),super(e)}call(e,r){return L(()=>{this.cell.dropoutMask!=null&&(De(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(De(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return new e(r)}}return t.className="SimpleRNN",t})();K.registerClass(uk);var Fw=(()=>{class t extends nl{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new F("GRUCell does not support reset_after parameter set to true.");this.units=e.units,tn(this.units,"units"),this.activation=Li(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Li(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=yt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=yt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=yt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=St(e.kernelRegularizer),this.recurrentRegularizer=St(e.recurrentRegularizer),this.biasRegularizer=St(e.biasRegularizer),this.kernelConstraint=Wt(e.kernelConstraint),this.recurrentConstraint=Wt(e.recurrentConstraint),this.biasConstraint=Wt(e.biasConstraint),this.dropout=Ip([1,$i([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ip([1,$i([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Fe(e);let r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return L(()=>{if(e=e,e.length!==2)throw new F(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training==null?!1:r.training,i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=rl({ones:()=>Dn(e),rate:this.dropout,training:o,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=rl({ones:()=>Dn(i),rate:this.recurrentDropout,training:o,count:3,dropoutFunc:this.dropoutFunc}));let s=this.dropoutMask,a=this.recurrentDropoutMask,l,u,c;0<this.dropout&&this.dropout<1&&(e=R(e,s[0]));let p=li(e,this.kernel.read());this.useBias&&(p=Dr(p,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=R(i,a[0]));let f=this.recurrentKernel.read(),[d,h]=bn(f,[2*this.units,this.units],f.rank-1),m=li(i,d),[g,y,x]=bn(p,3,p.rank-1),[b,w]=bn(m,2,m.rank-1);l=this.recurrentActivation.apply(Z(g,b)),u=this.recurrentActivation.apply(Z(y,w));let C=li(R(u,i),h);c=this.activation.apply(Z(x,C));let N=Z(R(l,i),R(Z(1,Qe(l)),c));return[N,N]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Pi(this.activation),recurrentActivation:Pi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:dt(this.kernelRegularizer),recurrentRegularizer:dt(this.recurrentRegularizer),biasRegularizer:dt(this.biasRegularizer),activityRegularizer:dt(this.activityRegularizer),kernelConstraint:Gt(this.kernelConstraint),recurrentConstraint:Gt(this.recurrentConstraint),biasConstraint:Gt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),r)}}return t.className="GRUCell",t})();K.registerClass(Fw);var ck=(()=>{class t extends xs{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Fw(e),super(e)}call(e,r){return L(()=>{this.cell.dropoutMask!=null&&(De(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(De(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="GRU",t})();K.registerClass(ck);var _h=(()=>{class t extends nl{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,tn(this.units,"units"),this.activation=Li(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Li(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=yt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=yt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=yt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=St(e.kernelRegularizer),this.recurrentRegularizer=St(e.recurrentRegularizer),this.biasRegularizer=St(e.biasRegularizer),this.kernelConstraint=Wt(e.kernelConstraint),this.recurrentConstraint=Wt(e.recurrentConstraint),this.biasConstraint=Wt(e.biasConstraint),this.dropout=Ip([1,$i([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ip([1,$i([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var r;e=Fe(e);let o=e[e.length-1];this.kernel=this.addWeight("kernel",[o,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){let s=this.biasInitializer,a=this.units;i=new(r=class extends kr{apply(u,c){let p=s.apply([a]),f=new iw().apply([a]),d=s.apply([a*2]);return T1(T1(p,f),d)}},r.className="CustomInit",r)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,r){return L(()=>{let o=r.training==null?!1:r.training;if(e=e,e.length!==3)throw new F(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1],s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=rl({ones:()=>Dn(e),rate:this.dropout,training:o,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=rl({ones:()=>Dn(i),rate:this.recurrentDropout,training:o,count:4,dropoutFunc:this.dropoutFunc}));let a=this.dropoutMask,l=this.recurrentDropoutMask,u,c,p,f;0<this.dropout&&this.dropout<1&&(e=R(e,a[0]));let d=li(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=R(i,l[0])),d=Z(d,li(i,this.recurrentKernel.read())),this.useBias&&(d=Dr(d,this.bias.read()));let[h,m,g,y]=bn(d,4,d.rank-1);u=this.recurrentActivation.apply(h),c=this.recurrentActivation.apply(m),p=Z(R(c,s),R(u,this.activation.apply(g))),f=this.recurrentActivation.apply(y);let x=R(f,this.activation.apply(p));return[x,x,p]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Pi(this.activation),recurrentActivation:Pi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:dt(this.kernelRegularizer),recurrentRegularizer:dt(this.recurrentRegularizer),biasRegularizer:dt(this.biasRegularizer),activityRegularizer:dt(this.activityRegularizer),kernelConstraint:Gt(this.kernelConstraint),recurrentConstraint:Gt(this.recurrentConstraint),biasConstraint:Gt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),r)}}return t.className="LSTMCell",t})();K.registerClass(_h);var pk=(()=>{class t extends xs{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new _h(e),super(e)}call(e,r){return L(()=>{this.cell.dropoutMask!=null&&(De(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(De(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="LSTM",t})();K.registerClass(pk);var $w=(()=>{class t extends nl{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let r of this.cells.slice().reverse())Array.isArray(r.stateSize)?e.push(...r.stateSize):e.push(r.stateSize);return e}call(e,r){return L(()=>{e=e;let o=e.slice(1),i=[];for(let l of this.cells.slice().reverse())Array.isArray(l.stateSize)?i.push(o.splice(0,l.stateSize.length)):i.push(o.splice(0,1));i.reverse();let s=[],a;for(let l=0;l<this.cells.length;++l){let u=this.cells[l];o=i[l],l===0?a=[e[0]].concat(o):a=[a[0]].concat(o),a=u.call(a,r),s.push(a.slice(1))}o=[];for(let l of s.slice().reverse())o.push(...l);return[a[0]].concat(o)})}build(e){sw(e)&&(e=e[0]),e=e;let r;this.cells.forEach((o,i)=>{Fi(`RNNCell_${i}`,()=>{o.build(e),Array.isArray(o.stateSize)?r=o.stateSize[0]:r=o.stateSize,e=[e[0],r]})}),this.built=!0}getConfig(){let e=super.getConfig(),r=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(r)};return Object.assign(Object.assign({},e),i)}static fromConfig(e,r,o={}){let i=[];for(let s of r.cells)i.push(co(s,o));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let r of this.cells)e.push(...r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.cells)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let o of this.cells)r.push(...o.trainableWeights);return r.concat(e)}return e}getWeights(){let e=[];for(let r of this.cells)e.push(...r.weights);return fy(e)}setWeights(e){let r=[];for(let o of this.cells){let i=o.weights.length,s=e.splice(i);for(let a=0;a<o.weights.length;++a)r.push([o.weights[a],s[a]])}wh(r)}}return t.className="StackedRNNCells",t})();K.registerClass($w);function rl(t){let{ones:n,rate:e,training:r=!1,count:o=1,dropoutFunc:i}=t,s=()=>i!=null?i(n(),e):ow(n(),e),a=()=>Gu(s,n,r);return!o||o<=1?Tn(a().clone()):Array(o).fill(void 0).map(a).map(u=>Tn(u.clone()))}var kde=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e};var Ade=(()=>{class t extends xs{constructor(e){if(e.unroll)throw new Ee("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ee("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Ct({ndim:5})]}call(e,r){return L(()=>{if(this.cell.dropoutMask!=null&&(De(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(De(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),r&&r.constants)throw new F("ConvRNN2D cell does not support constants");let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}computeOutputShape(e){let r=this.computeSingleOutputShape(e);return this.returnSequences||(r=[r[0],...r.slice(2)]),this.returnState&&(r=[r,...Array(2).fill([e[0],...r.slice(-3)])]),r}getInitialState(e){return L(()=>{let{stateSize:r}=this.cell,o=e.shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)],a=At(s);return Array.isArray(r)?Array(r.length).fill(a):[a]})}resetStates(e,r=!1){L(()=>{if(!this.stateful)throw new Mo("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)];if(o[0]==null)throw new F("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>At(s)):this.states_=[At(s)];else if(e==null)De(this.states_),this.keptStates!=null&&(De(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>At(s)):this.states_[0]=At(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new F(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r?this.keptStates.push(this.states_.slice()):De(this.states_);for(let l=0;l<this.states_.length;++l){let u=e[l],c=s;if(!v.arraysEqual(u.shape,c))throw new F(`State ${l} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${u.shape}`);this.states_[l]=u}}this.states_=this.states_.map(l=>Tn(l.clone()))})}computeSingleOutputShape(e){let{dataFormat:r,filters:o,kernelSize:i,padding:s,strides:a,dilationRate:l}=this.cell,u=r==="channelsFirst",c=e[u?3:2],p=e[u?4:3],f=Vr(c,i[0],s,a[0],l[0]),d=Vr(p,i[1],s,a[1],l[1]);return[...e.slice(0,2),...u?[o,f,d]:[f,d,o]]}}return t.className="ConvRNN2D",t})(),Pw=(()=>{class t extends _h{constructor(e){let{filters:r,kernelSize:o,strides:i,padding:s,dataFormat:a,dilationRate:l}=e;super(Object.assign(Object.assign({},e),{units:r})),this.filters=r,tn(this.filters,"filters"),this.kernelSize=ju(o,2,"kernelSize"),this.kernelSize.forEach(u=>tn(u,"kernelSize")),this.strides=ju(i||1,2,"strides"),this.strides.forEach(u=>tn(u,"strides")),this.padding=s||"valid",Tr(this.padding),this.dataFormat=a||"channelsLast",Pt(this.dataFormat),this.dilationRate=ju(l||1,2,"dilationRate"),this.dilationRate.forEach(u=>tn(u,"dilationRate"))}build(e){var r;e=Fe(e);let o=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[o]==null)throw new F(`The channel dimension of the input should be defined. Found ${e[o]}`);let i=e[o],s=4,a=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let l=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let u;if(this.unitForgetBias){let c=this.biasInitializer,p=this.filters;u=new(r=class extends kr{apply(d,h){let m=c.apply([p]),g=Ir([p]),y=c.apply([p*2]);return yh([m,g,y])}},r.className="CustomInit",r)}else u=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,u,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,r){return L(()=>{if(e.length!==3)throw new F(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training||!1,i=e[0],s=e[1],a=e[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=rl({ones:()=>Dn(i),rate:this.dropout,training:o,count:l,dropoutFunc:this.dropoutFunc}));let u=this.dropoutMask,c=(oe,ae,ie)=>!ae||!ae[ie]?oe:R(ae[ie],oe),p=c(i,u,0),f=c(i,u,1),d=c(i,u,2),h=c(i,u,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=rl({ones:()=>Dn(s),rate:this.recurrentDropout,training:o,count:l,dropoutFunc:this.dropoutFunc}));let m=this.recurrentDropoutMask,g=c(s,m,0),y=c(s,m,1),x=c(s,m,2),b=c(s,m,3),w=3,[C,N,D,k]=bn(this.kernel.read(),l,w),[O,$,V,G]=this.useBias?bn(this.bias.read(),l):[null,null,null,null];p=this.inputConv(p,C,O,this.padding),f=this.inputConv(f,N,$,this.padding),d=this.inputConv(d,D,V,this.padding),h=this.inputConv(h,k,G,this.padding);let[W,H,j,Y]=bn(this.recurrentKernel.read(),l,w);g=this.recurrentConv(g,W),y=this.recurrentConv(y,H),x=this.recurrentConv(x,j),b=this.recurrentConv(b,Y);let ee=this.recurrentActivation.apply(Z(p,g)),X=this.recurrentActivation.apply(Z(f,y)),te=Z(R(X,a),R(ee,this.activation.apply(Z(d,x)))),re=R(this.recurrentActivation.apply(Z(h,b)),this.activation.apply(te));return[re,re,te]})}getConfig(){let e=super.getConfig(),{units:r}=e,o=kde(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},o),i)}inputConv(e,r,o,i){let s=oo(e,r,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return o?Dr(s,o,this.dataFormat):s}recurrentConv(e,r){return oo(e,r,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}return t.className="ConvLSTM2DCell",t})();K.registerClass(Pw);var fk=(()=>{class t extends Ade{constructor(e){let r=new Pw(e);super(Object.assign(Object.assign({},e),{cell:r}))}static fromConfig(e,r){return new e(r)}}return t.className="ConvLSTM2D",t})();K.registerClass(fk);var Lw=(()=>{class t extends Ie{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let r=e.shape,o=[];for(let i=0;i<this.noiseShape.length;++i)o.push(this.noiseShape[i]==null?r[i]:this.noiseShape[i]);return o}call(e,r){return L(()=>{this.invokeCallHook(e,r);let o=we(e);if(0<this.rate&&this.rate<1){let i=r.training==null?!1:r.training,s=this.getNoiseShape(o);return Gu(()=>ow(o,this.rate,s,this.seed),()=>o,i)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=super.getConfig();return Object.assign(e,r),e}dispose(){return super.dispose()}}return t.className="Dropout",t})();K.registerClass(Lw);var dk=(()=>{class t extends Lw{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let r=e.shape;return[r[0],1,r[2]]}}return t.className="SpatialDropout1D",t})();K.registerClass(dk);var hk=(()=>{class t extends Ie{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),this.batchInputShape=[r,e.inputDim]}this.units=e.units,tn(this.units,"units"),this.activation=Li(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=yt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=yt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Wt(e.kernelConstraint),this.biasConstraint=Wt(e.biasConstraint),this.kernelRegularizer=St(e.kernelRegularizer),this.biasRegularizer=St(e.biasRegularizer),this.activityRegularizer=St(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Fe(e);let r=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:r}}],this.built=!0}computeOutputShape(e){e=Fe(e);let r=e.slice();return r[r.length-1]=this.units,r}call(e,r){return L(()=>{this.invokeCallHook(e,r);let o=we(e),i=Y0(this.activation.getClassName()),s;return i!=null?s=li(o,this.kernel.read(),i,this.bias?this.bias.read():null):(s=li(o,this.kernel.read()),this.bias!=null&&(s=Dr(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){let e={units:this.units,activation:Pi(this.activation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:dt(this.kernelRegularizer),biasRegularizer:dt(this.biasRegularizer),activityRegularizer:dt(this.activityRegularizer),kernelConstraint:Gt(this.kernelConstraint),biasConstraint:Gt(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dense",t})();K.registerClass(hk);var mk=(()=>{class t extends Ie{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Fe(e);for(let r of e.slice(1))if(r==null)throw new F(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],ai(e,1)]}call(e,r){return L(()=>{this.invokeCallHook(e,r);let o=we(e);if(this.dataFormat==="channelsFirst"&&o.rank>1){let i=[0];for(let s=2;s<o.rank;++s)i.push(s);i.push(1),o=$e(o,i)}return B3(o)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let r=super.getConfig();return Object.assign(e,r),e}}return t.className="Flatten",t})();K.registerClass(mk);var gk=(()=>{class t extends Ie{constructor(e){super(e),this.supportsMasking=!0,this.activation=Li(e.activation)}call(e,r){return L(()=>{this.invokeCallHook(e,r);let o=we(e);return this.activation.apply(o)})}getConfig(){let e={activation:Pi(this.activation)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Activation",t})();K.registerClass(gk);var yk=(()=>{class t extends Ie{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,r){return L(()=>(e=we(e),L3(e,this.n)))}getConfig(){let e={n:this.n},r=super.getConfig();return Object.assign(e,r),e}}return t.className="RepeatVector",t})();K.registerClass(yk);var xk=(()=>{class t extends Ie{constructor(e){super(e),this.targetShape=e.targetShape;for(let r=0;r<this.targetShape.length;++r)this.isUnknown(this.targetShape[r])&&(this.targetShape[r]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,r){let o="Total size of new array must be unchanged.",i=r.slice(),s=1,a=null;for(let u=0;u<i.length;++u){let c=i[u];if(this.isUnknown(c))if(a===null)a=u;else throw new F("Can only specifiy one unknown dimension.");else s*=c}let l=ai(e);if(a!==null){if(s===0||l%s!==0)throw new F(o);i[a]=l/s}else if(l!==s)throw new F(o);return i}computeOutputShape(e){let r=!1;for(let o=0;o<e.length;++o)if(this.isUnknown(e[o])){r=!0;break}return r?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,r){return L(()=>{this.invokeCallHook(e,r);let o=we(e),i=o.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return M(o,s)})}getConfig(){let e={targetShape:this.targetShape},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Reshape",t})();K.registerClass(xk);var vk=(()=>{class t extends Ie{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let r=_r(1,e.dims.length+1);if(!v.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Ct({ndim:this.dims.length+1})]}computeOutputShape(e){e=Fe(e);let r=e.slice();return this.dims.forEach((o,i)=>{r[i+1]=e[o]}),r}call(e,r){return $e(we(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Permute",t})();K.registerClass(vk);var bk=(()=>{class t extends Ie{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={maskValue:this.maskValue};return Object.assign(r,e),r}computeMask(e,r){let o=we(e);return Kd(Bu(o,this.maskValue),-1)}call(e,r){return L(()=>{this.invokeCallHook(e,r);let o=we(e),a=Kd(Bu(o,this.maskValue),-1,!0);return R(o,J(a,o.dtype))})}}return t.className="Masking",t})();K.registerClass(bk);var wk=(()=>{class t extends Ie{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let r=null;e.batchSize!=null&&(r=e.batchSize),e.inputLength==null?this.batchInputShape=[r,null]:this.batchInputShape=[r].concat(ut(e.inputLength))}this.inputDim=e.inputDim,tn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,tn(this.outputDim,"outputDim"),this.embeddingsInitializer=yt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=St(e.embeddingsRegularizer),this.activityRegularizer=St(e.activityRegularizer),this.embeddingsConstraint=Wt(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,r){return L(()=>this.maskZero?(e=we(e),Bu(e,be(e))):null)}computeOutputShape(e){if(e=Fe(e),this.inputLength==null)return[...e,this.outputDim];let r=ut(this.inputLength);if(r.length!==e.length-1)throw new F(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let o=0;for(let i=0;i<r.length;++i){let s=r[i],a=e[i+1];if(s!=null&&a!=null&&s!==a)throw new F(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(r[o]=a),o++}}return[e[0],...r,this.outputDim]}call(e,r){return L(()=>{this.invokeCallHook(e,r);let o=we(e);o.dtype!=="int32"&&(o=pr(o,"int32"));let i=rw(this.embeddings.read(),M(o,[o.size]));return M(i,Fe(this.computeOutputShape(o.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Et(this.embeddingsInitializer),embeddingsRegularizer:dt(this.embeddingsRegularizer),activityRegularizer:dt(this.activityRegularizer),embeddingsConstraint:Gt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Embedding",t})();K.registerClass(wk);var ol=class extends Ie{constructor(n){super(n||{}),this.supportsMasking=!0}mergeFunction(n){throw new Ee}computeElementwiseOpOutputShape(n,e){if(n==null||e==null)return null;if(n.length<e.length)return this.computeElementwiseOpOutputShape(e,n);if(e.length===0)return n;let r=n.slice(0,n.length-e.length);for(let o=0;o<e.length;++o){let i=n[n.length-e.length+o],s=e[o];if(i==null||s==null||i<0||s<0)r.push(null);else if(i===1)r.push(s);else if(s===1)r.push(i);else{if(i!==s)throw new F("Operands could not be broadcast together with shapes "+JSON.stringify(n)+" "+JSON.stringify(e));r.push(i)}}return r}build(n){if(Array.isArray(n)&&!Array.isArray(n[0])&&(n=[Fe(n)]),n=n,n.length<2)throw new F(`A merge layer should be called on an Array of at least 2 inputs. Got ${n.length} input(s).`);let e=[];for(let i of n)i!=null&&i[0]!==null&&e.push(i[0]);if(e=si(e),e.length>1)throw new F(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(n)}.`);let r=n[0]==null?null:n[0].slice(1);for(let i=1;i<n.length;++i){let s=n[i]==null?null:n[i].slice(1);r=this.computeElementwiseOpOutputShape(r,s)}let o=n.map(i=>i.length);n.indexOf(null)===-1&&si(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(n,e){return L(()=>{if(n=n,this.reshapeRequired){let r=[],o=n.map(i=>i.rank);if(o.indexOf(null)===-1){let i=$i(o);for(let s of n){let a=s.rank;for(let l=0;l<i-a;++l)s=Qa(s,1);r.push(s)}return this.mergeFunction(r)}else{let i=!1;for(let l of n){let u=l.rank;if(u==null){let c=l.shape,p=c[0],f=c.slice(1).concat([p]),d=M(l,[p].concat(ai(c.slice(1))));d=$e(d,[1,0]),d=M(d,f),r.push(d),i=!0}else if(u>1){let c=_r(1,u).concat([0]);r.push($e(l,c)),i=!0}else r.push(l)}let s=this.mergeFunction(r),a=s.rank;if(i){if(a==null){let l=s.shape,u=l.length,c=l[u-1],p=[c].concat(l.slice(0,l.length-1));s=M($e(M(s,[-1,c]),[1,0]),p)}else if(a>1){let l=[a-1].concat(_r(0,a-1));s=$e(s,l)}}return s}}else return this.mergeFunction(n)})}computeOutputShape(n){n=n;let e;n[0]==null?e=null:e=n[0].slice(1);for(let o=1;o<n.length;++o){let i=n[o]==null?null:n[o].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let r=[];for(let o of n)o!=null&&o[0]!==null&&r.push(o[0]);return r=si(r),r.length===1?e=r.concat(e):e=[null].concat(e),e}computeMask(n,e){return L(()=>{if(e==null)return null;if(!Array.isArray(e))throw new F("`mask` should be an Array");if(!Array.isArray(n))throw new F("`inputs` should be an Array");if(e.length!==n.length)throw new F(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${n.length} vs ${e.length})`);if(e.every(o=>o==null))return null;e=e.map(o=>o==null?o:sn(o,0));let r=e[0];for(let o=1;o<e.length-1;++o)r=ur(r,e[o]);return r})}},Ck=(()=>{class t extends ol{constructor(e){super(e)}mergeFunction(e){return L(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=Z(r,e[o]);return r})}}return t.className="Add",t})();K.registerClass(Ck);var Sk=(()=>{class t extends ol{constructor(e){super(e)}mergeFunction(e){return L(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=R(r,e[o]);return r})}}return t.className="Multiply",t})();K.registerClass(Sk);var Ik=(()=>{class t extends ol{constructor(e){super(e)}mergeFunction(e){return L(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=Z(r,e[o]);return R(1/e.length,r)})}}return t.className="Average",t})();K.registerClass(Ik);var Ek=(()=>{class t extends ol{constructor(e){super(e)}mergeFunction(e){return L(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=so(r,e[o]);return r})}}return t.className="Maximum",t})();K.registerClass(Ek);var Tk=(()=>{class t extends ol{constructor(e){super(e)}mergeFunction(e){return L(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=ds(r,e[o]);return r})}}return t.className="Minimum",t})();K.registerClass(Tk);var _k=(()=>{class t extends ol{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new F("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let r=!0;for(let i of e)if(i!=null){r=!1;break}if(r)return;let o=[];for(let i=0;i<e.length;++i){let s=e[i].slice();s.splice(this.axis,1);let a=!1;for(let l of o)if(v.arraysEqual(l,s)){a=!0;break}a||o.push(s)}if(o.length>1)throw new F("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return L(()=>yh(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new F("A `Concatenate` layer should be called on a list of inputs.");let r=e,o=r[0].slice(),i=this.axis<0?o.length+this.axis:this.axis;for(let s of r.slice(1)){if(o[i]==null||s[i]==null){o[i]=null;break}o[i]+=s[i]}return o}computeMask(e,r){if(r==null)return null;if(!Array.isArray(r))throw new F("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new F("`inputs` should be an array for Concatenate");if(r.length!==e.length)throw new F(`Mismatch in the length of mask (${r.length}) and the legnth of inputs (${e.length})`);return L(()=>{let o=!0;if(r.forEach(a=>{if(a!=null){o=!1;return}}),o)return null;let i=[];for(let a=0;a<e.length;++a)r[a]==null?i.push(J(Dn(e[a]),"bool")):r[a].rank<e[a].rank?i.push(sn(r[a],-1)):i.push(r[a]);let s=Dt(i,this.axis);return Fg(s,-1,!1)})}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Concatenate",t})();K.registerClass(_k);function wy(t,n){for(;t<0;)t+=n;return t}function Rde(t,n,e){if(t.shape.length>3||n.shape.length>3)throw new Ee("batchDot is not implemented for tensors of 4D or higher rank yet");if(v.assert(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),v.assert(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${n.shape.length}`),typeof e=="number"&&(e=[e,e]),t.dtype==="complex64"||n.dtype==="complex64")throw new Ee("batchDot is not implemented for complex64-type Tensors yet.");let r=t.shape.length,o=n.shape.length;e==null&&(e=[r-1,o-2]);let i=e;return L(()=>{let s;if(r>o){s=r-o;let l=[];for(let u=0;u<s;++u)l.push(1);n=M(n,n.shape.concat(l))}else if(o>r){s=o-r;let l=[];for(let u=0;u<s;++u)l.push(1);t=M(t,t.shape.concat(l))}else s=0;let a;if(t.shape.length===2&&n.shape.length===2)i[0]===i[1]?a=ue(R(t,n),i[0]):a=ue(R($e(t,[1,0]),n),i[1]);else{let l=i[0]!==t.shape.length-1,u=i[1]===n.shape.length-1;a=it(t,n,l,u)}if(s>0){let l;r>o?l=r+o-3:l=r-1;let u=[];for(let c=l;c<l+s;++c)u.push(c);a=Ri(a,u)}return a.shape.length===1&&(a=sn(a,1)),a})}var Nk=(()=>{class t extends ol{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){v.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0],o=e[1];if(r.length>3||o.length>3)throw new Ee("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);if(r[i[0]]!==o[i[1]])throw new F(`Dimension incompatibility: ${r[i[0]]} !== ${o[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new F(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let r=e[0],o=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,a)=>wy(s,e[a].shape.length)):i=[wy(this.axes,r.shape.length),wy(this.axes,o.shape.length)],this.normalize&&(r=dy(r,i[0]),o=dy(o,i[1])),Rde(r,o,i)}interpretAxes(e,r){let o;return Array.isArray(this.axes)?o=this.axes:o=[wy(this.axes,e.length),wy(this.axes,r.length)],o}computeOutputShape(e){v.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0].slice(),o=e[1].slice();if(r.length>3||o.length>3)throw new Ee("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);r.splice(i[0],1),o.splice(i[1],1),o.splice(0,1);let s=r.concat(o);return s.length===1&&s.push(1),s}computeMask(e,r){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dot",t})();K.registerClass(Nk);var Dk=(()=>{class t extends Ie{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={stddev:this.stddev};return Object.assign(r,e),r}call(e,r){return L(()=>{this.invokeCallHook(e,r);let o=we(e);return Gu(()=>Z(xh(o.shape,0,this.stddev),o),()=>o,r.training||!1)})}}return t.className="GaussianNoise",t})();K.registerClass(Dk);var kk=(()=>{class t extends Ie{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return L(()=>{this.invokeCallHook(e,r);let o=we(e);return this.rate>0&&this.rate<1?Gu(()=>{let s=Math.sqrt(this.rate/(1-this.rate));return R(o,xh(o.shape,1,s))},()=>o,r.training||!1):o})}}return t.className="GaussianDropout",t})();K.registerClass(kk);var Ak=(()=>{class t extends Ie{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||we(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return L(()=>{if(this.rate<1&&this.rate>0){let o=this._getNoiseShape(e);return Gu(()=>{let s=we(e),u=-1.6732632423543772*1.0507009873554805,c=Pr(Ai(o),this.rate);c=pr(c,"float32");let p=((1-this.rate)*(1+this.rate*u**2))**-.5,f=-p*u*this.rate,d=Z(R(s,c),R(Z(c,-1),u));return Z(R(d,p),f)},()=>we(e),r.training||!1)}return e})}}return t.className="AlphaDropout",t})();K.registerClass(Ak);function Cy(t,n,e,r,o,i=.001){let s;if(t.rank===2)s=vD(t,n,e,r,o,i);else if(t.rank===3)s=bD(t,n,e,r,o,i);else if(t.rank===4)s=wD(t,n,e,r,o,i);else throw new Ee(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return s}function Mde(t,n,e,r,o=.001){return L(()=>{let i=nh(t,r),s=i.mean,a=i.variance;return[Cy(t,s,a,e,n,o),s,a]})}function Ode(t,n,e,r,o=.001){return L(()=>{let i=nh(t,r),s=i.mean,a=i.variance,l=[];for(let h of _r(0,t.rank))r.indexOf(h)!==-1?l.push(1):l.push(t.shape[h]);let u=M(s,l),c=M(a,l),p=n==null?null:M(n,l),f=e==null?null:M(e,l);return[Cy(t,u,c,f,p,o),s,a]})}function Fde(t,n,e,r,o=.001){return v.arraysEqual(r.slice().sort(),_r(0,t.rank-1))?Mde(t,n,e,r,o):Ode(t,n,e,r,o)}var Rk=(()=>{class t extends Ie{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=yt(e.betaInitializer||"zeros"),this.gammaInitializer=yt(e.gammaInitializer||"ones"),this.movingMeanInitializer=yt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=yt(e.movingVarianceInitializer||"ones"),this.betaConstraint=Wt(e.betaConstraint),this.gammaConstraint=Wt(e.gammaConstraint),this.betaRegularizer=St(e.betaRegularizer),this.gammaRegularizer=St(e.gammaRegularizer)}build(e){e=Fe(e);let r=this.axis>=0?this.axis:this.axis+e.length,o=e[r];if(o==null)throw new F(`Axis ${r} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Ct({ndim:e.length,axes:{[r]:o}})];let i=[o];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,r){return L(()=>{let o=r.training==null?!1:r.training,i=we(e),s=i.shape,a=s.length,l=_r(0,a),u=this.axis>=0?this.axis:this.axis+a;l.splice(u,1);let c=oi(1,a);c[u]=s[u];let p=l.slice();p.sort();let f=!v.arraysEqual(p,_r(0,a).slice(0,a-1)),d=()=>{if(f){let b=M(this.movingMean.read(),c),w=M(this.movingVariance.read(),c),C=this.center?M(this.beta.read(),c):null,N=this.scale?M(this.gamma.read(),c):null;return Cy(i,b,w,C,N,this.epsilon)}else return Cy(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!o)return d();let[h,m,g]=Fde(i,this.gamma.read(),this.beta.read(),l,this.epsilon),y=(b,w,C)=>{L(()=>{let N=1-C,D=b.read(),k=R(pe(D,w),N);b.write(pe(D,k))})};return(()=>{y(this.movingMean,m,this.momentum),y(this.movingVariance,g,this.momentum)})(),h})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Et(this.betaInitializer),gammaInitializer:Et(this.gammaInitializer),movingMeanInitializer:Et(this.movingMeanInitializer),movingVarianceInitializer:Et(this.movingVarianceInitializer),betaRegularizer:dt(this.betaRegularizer),gammaRegularizer:dt(this.gammaRegularizer),betaConstraint:Gt(this.betaConstraint),gammaConstraint:Gt(this.gammaConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="BatchNormalization",t})();K.registerClass(Rk);var Mk=(()=>{class t extends Ie{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let r of this.axis)if(!Number.isInteger(r))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=yt(e.betaInitializer||"zeros"),this.gammaInitializer=yt(e.gammaInitializer||"ones"),this.betaRegularizer=St(e.betaRegularizer),this.gammaRegularizer=St(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Fe(e);let r=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=r);for(let s of this.axis)if(s<0||s>=r)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==si(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let o=this.axis.map(s=>e[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,r){let o=we(e),i=o.shape,s=i.length;return L(()=>{let{mean:l,variance:u}=nh(o,this.axis,!0),c=oi(1,s);for(let g of this.axis)c[g]=i[g];let p=g=>g!=null&&g.shape.length!==s?M(g,c):g,f=this.scale?p(this.gamma.read()):null,d=this.center?p(this.beta.read()):null,h=[],m=[];for(let g=0;g<s;++g)this.axis.indexOf(g)!==-1?(h.push(i[g]),m.push(1)):(h.push(1),m.push(i[g]));return l=er(l,h),u=er(u,h),f!=null&&(f=er(f,m)),d!=null&&(d=er(d,m)),Cy(o,l,u,d,f,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Et(this.betaInitializer),gammaInitializer:Et(this.gammaInitializer),betaRegularizer:dt(this.betaRegularizer),gammaRegularizer:dt(this.gammaRegularizer)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LayerNormalization",t})();K.registerClass(Mk);function $de(t,n,e){return L(()=>{if(t.rank!==4)throw new F(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(n==null&&(n=[[1,1],[1,1]]),n.length!==2||n[0].length!==2||n[1].length!==2)throw new F("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=Nr()),e!=="channelsLast"&&e!=="channelsFirst")throw new F(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return e==="channelsFirst"?r=[[0,0],[0,0],n[0],n[1]]:r=[[0,0],n[0],n[1],[0,0]],hp(t,r)})}var Ok=(()=>{class t extends Ie{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Nr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new F(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let r,o;if(typeof e.padding[0]=="number")r=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new F(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(r=e.padding[0],e.padding[1].length!==2)throw new F(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);o=e.padding[1]}this.padding=[r,o]}this.inputSpec=[new Ct({ndim:4})]}computeOutputShape(e){e=Fe(e);let r,o;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?r=e[2]+this.padding[0][0]+this.padding[0][1]:r=null,e[3]!=null&&e[3]>=0?o=e[3]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],e[1],r,o]):(e[1]!=null&&e[1]>=0?r=e[1]+this.padding[0][0]+this.padding[0][1]:r=null,e[2]!=null&&e[2]>=0?o=e[2]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],r,o,e[3]])}call(e,r){return L(()=>$de(we(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ZeroPadding2D",t})();K.registerClass(Ok);function Ww(t,n,e,r,o,i){return L(()=>{Pt(o),C1(i),Tr(r),e==null&&(e=[1,1]),r==null&&(r="valid"),o==null&&(o=Nr()),i==null&&(i="max"),t=by(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=dp(t,n,e,a):s=ap(t,n,e,a),o==="channelsFirst"&&(s=$e(s,[0,3,1,2])),s})}function RU(t,n,e,r,o,i){return L(()=>{Pt(o),C1(i),Tr(r),e==null&&(e=[1,1,1]),r==null&&(r="valid"),o==null&&(o=Nr()),i==null&&(i="max"),t=J1(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=VD(t,n,e,a):s=xD(t,n,e,a),o==="channelsFirst"&&(s=$e(s,[0,4,1,2,3])),s})}var Vw=class extends Ie{constructor(n){if(n.poolSize==null&&(n.poolSize=2),super(n),typeof n.poolSize=="number")this.poolSize=[n.poolSize];else if(Array.isArray(n.poolSize)&&n.poolSize.length===1&&typeof n.poolSize[0]=="number")this.poolSize=n.poolSize;else throw new F(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.poolSize)}`);if(tn(this.poolSize,"poolSize"),n.strides==null)this.strides=this.poolSize;else if(typeof n.strides=="number")this.strides=[n.strides];else if(Array.isArray(n.strides)&&n.strides.length===1&&typeof n.strides[0]=="number")this.strides=n.strides;else throw new F(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.strides)}`);tn(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,Tr(this.padding),this.inputSpec=[new Ct({ndim:3})]}computeOutputShape(n){n=Fe(n);let e=Vr(n[1],this.poolSize[0],this.padding,this.strides[0]);return[n[0],e,n[2]]}call(n,e){return L(()=>{this.invokeCallHook(n,e),n=Qa(we(n),2);let r=this.poolingFunction(we(n),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ri(r,[2])})}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(n,e),n}},Fk=(()=>{class t extends Vw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Pt(s),Tr(i),Ww(e,r,o,i,s,"max")}}return t.className="MaxPooling1D",t})();K.registerClass(Fk);var $k=(()=>{class t extends Vw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Pt(s),Tr(i),Ww(e,r,o,i,s,"avg")}}return t.className="AveragePooling1D",t})();K.registerClass($k);var Bw=class extends Ie{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==2)throw new F(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides];tn(this.poolSize,"poolSize"),tn(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Pt(this.dataFormat),Tr(this.padding),this.inputSpec=[new Ct({ndim:4})]}computeOutputShape(n){n=Fe(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2];return e=Vr(e,this.poolSize[0],this.padding,this.strides[0]),r=Vr(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r]:[n[0],e,r,n[3]]}call(n,e){return L(()=>(this.invokeCallHook(n,e),this.poolingFunction(we(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},Pk=(()=>{class t extends Bw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Pt(s),Tr(i),Ww(e,r,o,i,s,"max")}}return t.className="MaxPooling2D",t})();K.registerClass(Pk);var Lk=(()=>{class t extends Bw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Pt(s),Tr(i),Ww(e,r,o,i,s,"avg")}}return t.className="AveragePooling2D",t})();K.registerClass(Lk);var zw=class extends Ie{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==3)throw new F(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides,n.strides];tn(this.poolSize,"poolSize"),tn(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Pt(this.dataFormat),Tr(this.padding),this.inputSpec=[new Ct({ndim:5})]}computeOutputShape(n){n=Fe(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2],o=this.dataFormat==="channelsFirst"?n[4]:n[3];return e=Vr(e,this.poolSize[0],this.padding,this.strides[0]),r=Vr(r,this.poolSize[1],this.padding,this.strides[1]),o=Vr(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r,o]:[n[0],e,r,o,n[4]]}call(n,e){return L(()=>(this.invokeCallHook(n,e),this.poolingFunction(we(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},Vk=(()=>{class t extends zw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Pt(s),Tr(i),RU(e,r,o,i,s,"max")}}return t.className="MaxPooling3D",t})();K.registerClass(Vk);var Bk=(()=>{class t extends zw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Pt(s),Tr(i),RU(e,r,o,i,s,"avg")}}return t.className="AveragePooling3D",t})();K.registerClass(Bk);var Uw=class extends Ie{constructor(n){super(n),this.inputSpec=[new Ct({ndim:3})]}computeOutputShape(n){return[n[0],n[2]]}call(n,e){throw new Ee}},zk=(()=>{class t extends Uw{constructor(e){super(e||{})}call(e,r){return L(()=>{let o=we(e);return $t(o,1)})}}return t.className="GlobalAveragePooling1D",t})();K.registerClass(zk);var Uk=(()=>{class t extends Uw{constructor(e){super(e||{})}call(e,r){return L(()=>{let o=we(e);return Un(o,1)})}}return t.className="GlobalMaxPooling1D",t})();K.registerClass(Uk);var Gw=class extends Ie{constructor(n){super(n),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Pt(this.dataFormat),this.inputSpec=[new Ct({ndim:4})]}computeOutputShape(n){return n=n,this.dataFormat==="channelsLast"?[n[0],n[3]]:[n[0],n[1]]}call(n,e){throw new Ee}getConfig(){let n={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},Gk=(()=>{class t extends Gw{call(e,r){return L(()=>{let o=we(e);return this.dataFormat==="channelsLast"?$t(o,[1,2]):$t(o,[2,3])})}}return t.className="GlobalAveragePooling2D",t})();K.registerClass(Gk);var Wk=(()=>{class t extends Gw{call(e,r){return L(()=>{let o=we(e);return this.dataFormat==="channelsLast"?Un(o,[1,2]):Un(o,[2,3])})}}return t.className="GlobalMaxPooling2D",t})();K.registerClass(Wk);var Hw=class extends Ie{constructor(n){super(n),this.layer=n.layer}build(n){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(n){this.layer!=null&&(this.layer.trainable=n)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(n){this.layer.setWeights(n)}getConfig(){let n={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(n,e),n}setFastWeightInitDuringBuild(n){super.setFastWeightInitDuringBuild(n),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(n)}static fromConfig(n,e,r={}){let o=e.layer,i=co(o,r);delete e.layer;let s={layer:i};return Object.assign(s,e),new n(s)}},Hk=(()=>{class t extends Hw{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Fe(e),e.length<3)throw new F(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Fe(e);let r=[e[0]].concat(e.slice(2)),o=this.layer.computeOutputShape(r),i=e[1];return[o[0],i].concat(o.slice(1))}call(e,r){return L(()=>(e=we(e),lk((a,l)=>[we(this.layer.call(a,r)),[]],e,[],!1,null,null,!1,!0)[1]))}}return t.className="TimeDistributed",t})();K.registerClass(Hk);function Pde(t){gs(M3,"BidirectionalMergeMode",t)}var Lde="concat",jk=(()=>{class t extends Hw{constructor(e){super(e);let r=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=r,this.forwardLayer=co(o),r.goBackwards=r.goBackwards!==!0;let i={};if(i.className=e.layer.getClassName(),i.config=r,this.backwardLayer=co(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?Lde:e.mergeMode,Pde(this.mergeMode),e.weights)throw new Ee("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let r=e.length,o=Math.floor(r/2);this.forwardLayer.setWeights(e.slice(0,o)),this.backwardLayer.setWeights(e.slice(o))}computeOutputShape(e){let r=this.forwardLayer.computeOutputShape(e);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;let o,i,s;return this.returnState&&(s=r.slice(1)),o=r[0],o=o,this.mergeMode==="concat"?(o[o.length-1]*=2,i=[o]):this.mergeMode==null?i=[o,o.slice()]:i=[o],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[o].concat(s).concat(s.slice()):An(i)}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=ak(e,o,i,this.numConstants);if(e=s.inputs,o=s.initialState,i=s.constants,Array.isArray(e)&&(o=e.slice(1),e=e[0]),(o==null||o.length===0)&&i==null)return super.apply(e,r);let a=[],l=[];if(o!=null){let c=o.length;if(c%2>0)throw new F("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,a.push(...o);let p=o.map(f=>new Ct({shape:f.shape}));this.forwardLayer.stateSpec=p.slice(0,c/2),this.backwardLayer.stateSpec=p.slice(c/2),l.push(...p)}if(i!=null)throw new Ee("Support for constants in Bidirectional layers is not implemented yet.");let u=a[0]instanceof fr;for(let c of a)if(c instanceof fr!==u)throw new F("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(u){let c=[e].concat(a),p=this.inputSpec.concat(l),f=this.inputSpec;this.inputSpec=p;let d=super.apply(c,r);return this.inputSpec=f,d}else return super.apply(e,r)}call(e,r){return L(()=>{let o=r.initialState,i,s;if(o==null)i=this.forwardLayer.call(e,r),s=this.backwardLayer.call(e,r);else{let u=o.slice(0,o.length/2),c=o.slice(o.length/2);i=this.forwardLayer.call(e,Object.assign(r,{initialState:u})),s=this.backwardLayer.call(e,Object.assign(r,{initialState:c}))}let a;this.returnState&&(Array.isArray(i)&&(a=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=Ro(s,1));let l;return this.mergeMode==="concat"?l=yh([i,s]):this.mergeMode==="sum"?l=Z(i,s):this.mergeMode==="ave"?l=R(.5,Z(i,s)):this.mergeMode==="mul"?l=R(i,s):this.mergeMode==null&&(l=[i,s]),this.returnState?this.mergeMode==null?l.concat(a):[l].concat(a):l})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Fi(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Fi(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,r){Array.isArray(r)&&(r=r[0]);let o;if(this.returnSequences?this.mergeMode==null?o=[r,r]:o=r:this.mergeMode==null?o=[null,null]:o=null,this.returnState){let s=this.forwardLayer.states.map(a=>null);return Array.isArray(o)?o.concat(s).concat(s):[o].concat(s).concat(s)}else return o}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},r=super.getConfig();return Object.assign(e,r),e}static fromConfig(e,r){let o=co(r.layer);if(delete r.layer,r.numConstants!=null)throw new Ee("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let i=r;return i.layer=o,new e(i)}}return t.className="Bidirectional",t})();K.registerClass(jk);var qk=(()=>{class t extends Ie{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){let e={scale:this.scale,offset:this.offset},r=super.getConfig();return Object.assign(e,r),e}call(e,r){return L(()=>(e=we(e),e.dtype!=="float32"&&(e=pr(e,"float32")),Z(R(e,this.scale),this.offset)))}}return t.className="Rescaling",t})();K.registerClass(qk);var{resizeBilinear:Vde,cropAndResize:Bde}=lo,Kk=(()=>{class t extends Ie{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,r,o,i,s,a,l,u){return L(()=>{let c,p=!1,f=r/a,d=o/l,h=(i+r)/a,m=(s+o)/l,g=[f,d,h,m],y=[];e.rank===3?(p=!0,c=mn([e])):c=e;for(let N=0;N<c.shape[0];N++)y.push(g);let x=Fr(y,[y.length,4]),b=qa(0,y.length,1,"int32"),C=Bde(c,x,b,[i,s],"nearest");return p?pr(we(cr(C)),u):pr(C,u)})}upsize(e,r,o,i){return L(()=>{let s=Vde(e,[r,o]);return pr(s,i)})}call(e,r){return L(()=>{let o=we(e),i=o.dtype,s=o.shape,a=s[s.length-3],l=s[s.length-2],u=0;a!==this.height&&(u=Math.floor((a-this.height)/2));let c=0;return l!==this.width&&(c=Math.floor((l-this.width)/2),c===0&&(c=1)),u>=0&&c>=0?this.centerCrop(o,u,c,this.height,this.width,a,l,i):this.upsize(e,this.height,this.width,i)})}getConfig(){let e={height:this.height,width:this.width},r=super.getConfig();return Object.assign(e,r),e}computeOutputShape(e){e=Fe(e);let r=e.length-3,o=e.length-2;return e[r]=this.height,e[o]=this.width,e}}return t.className="CenterCrop",t})();K.registerClass(Kk);function MU(t,n,e,r){let o=we(t);if(o.dtype!=="int32"&&(o=pr(o,"int32")),n==="int")return o;let i=o.shape;if(o.rank===0&&(o=sn(o,-1)),n==="oneHot"&&o.shape[o.shape.length-1]!==1&&(o=sn(o,-1)),o.rank>2)throw new F(`When outputMode is not int, maximum output rank is 2 Received outputMode ${n} and input shape ${i} which would result in output rank ${o.rank}.`);let s=["multiHot","oneHot"].includes(n),a=o,l;if(typeof r<"u"&&n==="count"?l=E0(a,r,e,s):l=E0(a,[],e,s),n!=="tfIdf")return l;if(r)return R(l,r);throw new F("When outputMode is 'tfIdf', weights must be provided.")}var Xk=(()=>{class t extends Ie{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){let e={numTokens:this.numTokens,outputMode:this.outputMode},r=super.getConfig();return Object.assign(e,r),e}computeOutputShape(e){return e=Fe(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,r){return L(()=>{e=we(e),e.dtype!=="int32"&&(e=pr(e,"int32"));let o;if(typeof r.countWeights<"u"){if(this.outputMode!=="count")throw new F(`countWeights is not used when outputMode !== count.
              Received countWeights=${r.countWeights}`);o=we(r.countWeights)}let i=Un(e),s=Lu(e),a=Zt(this.numTokens,i).bufferSync().get(0),l=Pr(s,0).bufferSync().get(0);if(!(a&&l))throw new F(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return MU(e,this.outputMode,this.numTokens,o)})}}return t.className="CategoryEncoding",t})();K.registerClass(Xk);var Ude=["bilinear","nearest"],OU=new Set(Ude),Yk=(()=>{class t extends Ie{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(OU.has(e.interpolation))this.interpolation=e.interpolation;else throw new F(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Fe(e);let r=e[2];return[this.height,this.width,r]}getConfig(){let e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},r=super.getConfig();return Object.assign(e,r),e}call(e,r){return L(()=>{let o=[this.height,this.width];if(this.interpolation==="bilinear")return lo.resizeBilinear(e,o,!this.cropToAspectRatio);if(this.interpolation==="nearest")return lo.resizeNearestNeighbor(e,o,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...OU]} are supported`)})}}return t.className="Resizing",t})();K.registerClass(Yk);var FU=(()=>{class t{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}return t.className="RandomSeed",t})();var $U=(()=>{class t extends Ie{constructor(e){super(e),this.randomGenerator=new FU(e.seed)}getConfig(){let e={seed:this.randomGenerator.seed},r=super.getConfig();return Object.assign(e,r),e}}return t.className="BaseRandomLayer",t})();var Gde=["bilinear","nearest"],PU=new Set(Gde),Zk=(()=>{class t extends $U{constructor(e){super(e);let{factor:r,interpolation:o="bilinear"}=e;if(this.factor=r,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new F(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new F(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new F(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(o)if(PU.has(o))this.interpolation=o;else throw new F(`Invalid interpolation parameter: ${o} is not implemented`)}getConfig(){let e={factor:this.factor,interpolation:this.interpolation},r=super.getConfig();return Object.assign(e,r),e}computeOutputShape(e){e=Fe(e);let r=e[2];return[this.imgHeight,-1,r]}call(e,r){return L(()=>{let o=we(e);this.imgHeight=o.shape[o.shape.length-3];let i=o.shape[o.shape.length-2];this.widthFactor=Ai([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let s=this.widthFactor.dataSync()[0]*i;s=Math.round(s);let a=[this.imgHeight,s];switch(this.interpolation){case"bilinear":return lo.resizeBilinear(e,a);case"nearest":return lo.resizeNearestNeighbor(e,a);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...PU]} are supported`)}})}}return t.className="RandomWidth",t})();K.registerClass(Zk);function Wde(t){return new Wu(t)}function Hde(t){return new Y1(t)}function jde(t){return new q1(t)}function qde(t){return new K1(t)}function Kde(t){return new X1(t)}function Xde(t){return new Q1(t)}function Yde(t){return new Z1(t)}function Zde(t){return new rk(t)}function Qde(t){return new Rw(t)}function Jde(t){return new ek(t)}function ehe(t){return new Mw(t)}function the(t){return new tk(t)}function nhe(t){return new nk(t)}function rhe(t){return new ok(t)}function ohe(t){return new ik(t)}function ihe(t){return new sk(t)}function she(t){return new gk(t)}function ahe(t){return new hk(t)}function lhe(t){return new Lw(t)}function uhe(t){return new dk(t)}function che(t){return new mk(t)}function phe(t){return new yk(t)}function fhe(t){return new xk(t)}function dhe(t){return new vk(t)}function hhe(t){return new wk(t)}function mhe(t){return new Ck(t)}function ghe(t){return new Ik(t)}function yhe(t){return new _k(t)}function xhe(t){return new Ek(t)}function vhe(t){return new Tk(t)}function bhe(t){return new Sk(t)}function whe(t){return new Nk(t)}function Che(t){return new Rk(t)}function She(t){return new Mk(t)}function Ihe(t){return new Ok(t)}function Qk(t){return new $k(t)}function Ehe(t){return Qk(t)}function The(t){return Qk(t)}function Jk(t){return new Lk(t)}function _he(t){return Jk(t)}function Nhe(t){return Jk(t)}function eA(t){return new Bk(t)}function Dhe(t){return eA(t)}function khe(t){return eA(t)}function Ahe(t){return new zk(t)}function Rhe(t){return new Gk(t)}function LU(t){return new Uk(t)}function VU(t){return new Wk(t)}function BU(t){return new Fk(t)}function zU(t){return new Pk(t)}function Mhe(t){return new Vk(t)}function Ohe(t){return new ck(t)}function Fhe(t){return new Fw(t)}function $he(t){return new pk(t)}function Phe(t){return new _h(t)}function Lhe(t){return new uk(t)}function Vhe(t){return new Ow(t)}function Bhe(t){return new fk(t)}function zhe(t){return new Pw(t)}function Uhe(t){return new xs(t)}function Ghe(t){return new $w(t)}function Whe(t){return new jk(t)}function Hhe(t){return new Hk(t)}var jhe=LU,qhe=VU,Khe=BU,Xhe=zU;function Yhe(t){return new Dk(t)}function Zhe(t){return new kk(t)}function Qhe(t){return new Ak(t)}function Jhe(t){return new bk(t)}function eme(t){return new qk(t)}function tme(t){return new Kk(t)}function nme(t){return new Yk(t)}function rme(t){return new Xk(t)}function ome(t){return new Zk(t)}var lme=P();lme.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var UU;(function(t){let n;(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(UU||(UU={}));var sge=am(qg());var oge=am(qg());var CMt=Symbol("out"),SMt=Symbol("field"),IMt=Symbol("quote"),EMt=Symbol("quoteafterquote"),TMt=Symbol("quoteinquote");function Q(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&v.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the CPU backend.`)})}var yge=nr.whereImpl,WU=(()=>{class t extends Ws{nextDataId(){return t.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Oc(this,Jo())}write(e,r,o){this.firstUse&&(this.firstUse=!1,P().get("IS_NODE")&&S.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));let i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:o,refCount:1}),i}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&v.isString(o[0])){let s=o.map(a=>v.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return{dataId:i,shape:e,dtype:r}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){let r=this.data.get(e);r.refCount++}decRef(e){if(this.data.has(e)){let r=this.data.get(e);r.refCount--}}move(e,r,o,i,s){this.data.set(e,{values:r,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}read(e){return B(this,null,function*(){return this.readSync(e)})}readSync(e){let{dtype:r,complexTensorInfos:o}=this.data.get(e);if(r==="complex64"){let i=this.readSync(o.real.dataId),s=this.readSync(o.imag.dataId);return S.mergeRealAndImagArrays(i,s)}return v.convertBackendValuesAndArrayBuffer(this.data.get(e).values,r)}bufferSync(e){let r=this.readSync(e.dataId);if(e.dtype==="string")try{let o=r.map(i=>v.decodeString(i));return ve(e.shape,e.dtype,o)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ve(e.shape,e.dtype,r)}makeOutput(e,r,o){return Jo().makeTensorFromTensorInfo(this.makeTensorInfo(r,o,e),this)}disposeData(e,r=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!r&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:o}=this.data.get(e);o!=null&&(this.disposeData(o.real.dataId,!0),this.disposeData(o.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}time(e){return B(this,null,function*(){let r=v.now();return e(),{kernelMs:v.now()-r}})}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Q([e],"where");let r=this.readSync(e.dataId);return yge(e.shape,r)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}return t.nextDataId=0,t})();var RA={};Po(RA,{addImpl:()=>oA,bincountImpl:()=>kh,bincountReduceImpl:()=>qw,bitwiseAndImpl:()=>iA,castImpl:()=>rA,ceilImpl:()=>sA,concatImpl:()=>Kw,equalImpl:()=>aA,expImpl:()=>uA,expm1Impl:()=>pA,floorDivImpl:()=>dA,floorImpl:()=>fA,gatherNdImpl:()=>Xw,gatherV2Impl:()=>Yw,greaterEqualImpl:()=>mA,greaterImpl:()=>hA,lessEqualImpl:()=>yA,lessImpl:()=>gA,linSpaceImpl:()=>Zw,logImpl:()=>xA,maxImpl:()=>Qw,maximumImpl:()=>vA,minimumImpl:()=>bA,multiplyImpl:()=>Sy,negImpl:()=>wA,notEqualImpl:()=>CA,prodImpl:()=>SA,raggedGatherImpl:()=>Jw,raggedRangeImpl:()=>eC,raggedTensorToTensorImpl:()=>tC,rangeImpl:()=>nC,rsqrtImpl:()=>EA,scatterImpl:()=>Bi,sigmoidImpl:()=>wG,simpleAbsImpl:()=>nA,sliceImpl:()=>_A,sparseFillEmptyRowsImpl:()=>rC,sparseReshapeImpl:()=>oC,sparseSegmentReductionImpl:()=>Rh,sqrtImpl:()=>IG,squaredDifferenceImpl:()=>NA,staticRegexReplaceImpl:()=>DA,stridedSliceImpl:()=>iC,stringNGramsImpl:()=>sC,stringSplitImpl:()=>aC,stringToHashBucketFastImpl:()=>lC,subImpl:()=>AA,tileImpl:()=>uC,topKImpl:()=>cC,transposeImpl:()=>Ah,uniqueImpl:()=>pC});function nA(t){let n=new Float32Array(t.length);for(let e=0;e<t.length;++e)n[e]=Math.abs(t[e]);return n}var xge=t=>{let{x:n}=t.inputs,e=t.backend;Q(n,"abs");let r=new Float32Array(v.sizeFromShape(n.shape)),o=e.data.get(n.dataId).values;return r=nA(o),e.makeOutput(r,n.shape,n.dtype)},HU={kernelName:Vl,backendName:"cpu",kernelFunc:xge};function Be(t){return(n,e,r,o,i)=>{let s=S.assertAndGetBroadcastShape(n,e),a=s.length,l=v.computeStrides(s),u=v.sizeFromShape(s),c=v.getTypedArrayFromDType(i,u),p=n.length,f=e.length,d=v.computeStrides(n),h=v.computeStrides(e),m=S.getBroadcastDims(n,s),g=S.getBroadcastDims(e,s);if(m.length+g.length===0)for(let y=0;y<c.length;++y)c[y]=t(r[y%r.length],o[y%o.length]);else for(let y=0;y<c.length;++y){let x=v.indexToLoc(y,a,l),b=x.slice(-p);m.forEach(D=>b[D]=0);let w=v.locToIndex(b,p,d),C=x.slice(-f);g.forEach(D=>C[D]=0);let N=v.locToIndex(C,f,h);c[y]=t(r[w],o[N])}return[c,s]}}function wn(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,a=e.makeTensorInfo(r.shape,"complex64"),l=e.data.get(a.dataId);return l.complexTensorInfos={real:e.makeTensorInfo(r.shape,"float32",i),imag:e.makeTensorInfo(o.shape,"float32",s)},a}var jU={kernelName:id,backendName:"cpu",kernelFunc:wn};function Nh(t,n,e="float32"){if(e==="complex64"){let o=Nh(t,n,"float32"),i=Nh(t,n,"float32");return wn({inputs:{real:o,imag:i},backend:t})}let r=v.makeZerosTypedArray(v.sizeFromShape(n),e);return t.makeTensorInfo(n,e,r)}function rr(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var qU={kernelName:is,backendName:"cpu",kernelFunc:rr};function ci(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.real,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var KU={kernelName:Dd,backendName:"cpu",kernelFunc:ci};function rA(t,n,e,r){if(r==="int32"){let o=Int32Array.from(t);return[n,"int32",o]}if(r==="bool"){let o=v.toTypedArray([0],e),[i,s]=Be((a,l)=>a!==l?1:0)(n,[],t,o,"bool");return[s,"bool",i]}throw new Error(`Error in Cast: failed to cast ${e} to ${r}`)}function pi(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return rr({inputs:{x:o},backend:e});let c=Nh(e,o.shape,o.dtype),p=pi({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),f=wn({inputs:{real:p,imag:c},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(p),f}if(o.dtype==="complex64"){let c=ci({inputs:{input:o},backend:e}),p=pi({inputs:{x:c},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(c),p}if(!v.hasEncodingLoss(o.dtype,i)){let c=rr({inputs:{x:o},backend:e});return{dataId:c.dataId,shape:c.shape,dtype:i}}let s=e.data.get(o.dataId).values,[a,l,u]=rA(s,o.shape,o.dtype,i);return e.makeTensorInfo(a,l,u)}var XU={kernelName:os,backendName:"cpu",kernelFunc:pi};function et(t,n,e,r){return e==null?({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;Q([s,a],t);let u=l.data.get(s.dataId).values,c=l.data.get(a.dataId).values,p=s.dtype==="string"?S.fromUint8ToStringArray(u):u,f=s.dtype==="string"?S.fromUint8ToStringArray(c):c,d=r||s.dtype,[h,m]=n(s.shape,a.shape,p,f,d);return l.makeTensorInfo(m,d,h)}:({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;if(s.dtype==="complex64"||a.dtype==="complex64"){let u=pi({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(u.dataId),p=c.complexTensorInfos.real,f=c.complexTensorInfos.imag,d=l.data.get(p.dataId).values,h=l.data.get(f.dataId).values,m=pi({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(m.dataId),y=g.complexTensorInfos.real,x=g.complexTensorInfos.imag,b=l.data.get(y.dataId).values,w=l.data.get(x.dataId).values,[C,N,D]=e(s.shape,a.shape,d,h,b,w),k=l.makeTensorInfo(D,"float32",C),O=l.makeTensorInfo(D,"float32",N),$=wn({inputs:{real:k,imag:O},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(k),l.disposeIntermediateTensorInfo(O),$}else{let u=l.data.get(s.dataId).values,c=l.data.get(a.dataId).values,p=r||s.dtype,[f,d]=n(s.shape,a.shape,u,c,p);return l.makeTensorInfo(d,p,f)}}}function Dh(t){return(n,e,r,o,i,s)=>{let a=S.assertAndGetBroadcastShape(n,e),l=v.sizeFromShape(a),u=a.length,c=v.computeStrides(a),p=v.getTypedArrayFromDType("float32",l),f=v.getTypedArrayFromDType("float32",l),d=S.getBroadcastDims(n,a),h=S.getBroadcastDims(e,a),m=S.mergeRealAndImagArrays(r,o),g=S.mergeRealAndImagArrays(i,s),y=n.length,x=v.computeStrides(n),b=e.length,w=v.computeStrides(e);if(d.length+h.length===0)for(let C=0;C<p.length;C++){let N=C%m.length,D=C%g.length,k=t(m[N*2],m[N*2+1],g[D*2],g[D*2+1]);p[C]=k.real,f[C]=k.imag}else for(let C=0;C<p.length;C++){let N=v.indexToLoc(C,u,c),D=N.slice(-y);d.forEach(G=>D[G]=0);let k=v.locToIndex(D,y,x),O=N.slice(-b);h.forEach(G=>O[G]=0);let $=v.locToIndex(O,b,w),V=t(m[k*2],m[k*2+1],g[$*2],g[$*2+1]);p[C]=V.real,f[C]=V.imag}return[p,f,a]}}var oA=Be((t,n)=>t+n),vge=Dh((t,n,e,r)=>({real:t+e,imag:n+r})),vs=et(_i,oA,vge),YU={kernelName:_i,backendName:"cpu",kernelFunc:vs};function kh(t,n,e,r,o){let i=v.sizeFromShape(r),s=v.makeZerosTypedArray(o,e);for(let a=0;a<t.length;a++){let l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(i>0?s[l]+=n[a]:s[l]+=1)}return s}function qw(t,n,e,r=!1){let o=t.shape[0],i=t.shape[1],s=ve([o,e],n.dtype);for(let a=0;a<o;a++)for(let l=0;l<i;l++){let u=t.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=e||(r?s.set(1,a,u):n.size>0?s.set(s.get(a,u)+n.get(a,l),a,u):s.set(s.get(a,u)+1,a,u))}return s}var iA=Be((t,n)=>t&n),bge=et(Eg,iA),ZU={kernelName:Eg,backendName:"cpu",kernelFunc:bge};function On(t){return(n,e,r)=>{let o=v.getArrayFromDType(e,n.length);for(let i=0;i<n.length;++i)o[i]=t(n[i],r);return o}}function Te(t,n,e){let r=On(n);return Br(t,r,e)}function Br(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;Q(s,t);let a=i,l=a.data.get(s.dataId).values,u;if(s.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=S.fromUint8ToStringArray(l)}else u=l;let c=e||s.dtype,p=n(u,c,o);return a.makeTensorInfo(s.shape,c,p)}}var sA=On(t=>Math.ceil(t)),wge=Br(Js,sA),QU={kernelName:Js,backendName:"cpu",kernelFunc:wge};function Kw(t,n,e,r){let o=v.getArrayFromDType(e,v.sizeFromShape(n));if(r&&e!=="string"){let i=0;t.forEach(s=>{let a=v.sizeFromShape(s.shape);o.set(s.vals,i),i+=a})}else{let i=0;t.forEach(s=>{let a=e==="string"?S.fromUint8ToStringArray(s.vals):s.vals,l=0;for(let u=0;u<s.shape[0];++u){let c=u*n[1]+i;for(let p=0;p<s.shape[1];++p)o[c+p]=a[l++]}i+=s.shape[1]})}return o}var aA=Be((t,n)=>t===n?1:0),lA=et(Lc,aA,null,"bool"),JU={kernelName:Lc,backendName:"cpu",kernelFunc:lA};var uA=On(t=>Math.exp(t)),cA=Br(sa,uA,"float32"),eG={kernelName:sa,backendName:"cpu",kernelFunc:cA};var pA=On(t=>Math.expm1(t)),Cge=Br(aa,pA),tG={kernelName:aa,backendName:"cpu",kernelFunc:Cge};var fA=On(t=>Math.floor(t)),Sge=Br(la,fA),nG={kernelName:la,backendName:"cpu",kernelFunc:Sge};var dA=Be((t,n)=>Math.floor(t/n)),Ige=et(ua,dA,null,"int32"),rG={kernelName:ua,backendName:"cpu",kernelFunc:Ige};function Xw(t,n,e,r,o,i,s,a,l){let u=ve([r,i],e);for(let c=0;c<r;c++){let p=[],f=0;for(let d=0;d<o;d++){let h=t[c*o+d];f+=h*s[d],p.push(h)}if(f<0||f>=l/i)throw new Error(`Invalid indices: ${p} does not index into ${a}`);for(let d=0;d<i;d++)u.values[c*i+d]=n.get(...n.indexToLoc(f*i+d))}return u}function Yw(t,n,e){let r=ve(e,t.dtype);for(let o=0;o<r.size;++o){let s=r.indexToLoc(o).slice(),a=s[0],l=s[2],u=n.locToIndex([a,l]);s[2]=n.values[u];let c=t.locToIndex(s);0<=c&&c<t.values.length&&(r.values[o]=t.values[c])}return r}var hA=Be((t,n)=>t>n?1:0),Ege=et(Vc,hA,null,"bool"),oG={kernelName:Vc,backendName:"cpu",kernelFunc:Ege};var mA=Be((t,n)=>t>=n?1:0),Tge=et(ca,mA,null,"bool"),iG={kernelName:ca,backendName:"cpu",kernelFunc:Tge};var gA=Be((t,n)=>t<n?1:0),_ge=et(Bc,gA,null,"bool"),sG={kernelName:Bc,backendName:"cpu",kernelFunc:_ge};var yA=Be((t,n)=>t<=n?1:0),Nge=et(zc,yA,null,"bool"),aG={kernelName:zc,backendName:"cpu",kernelFunc:Nge};function Zw(t,n,e){let r=(n-t)/(e-1),o=v.makeZerosTypedArray(e,"float32");o[0]=t;for(let i=1;i<o.length;i++)o[i]=o[i-1]+r;return o}var xA=On(t=>Math.log(t)),Dge=Br(ha,xA),lG={kernelName:ha,backendName:"cpu",kernelFunc:Dge};function Qw(t,n,e,r){let o=v.getTypedArrayFromDType(r,v.sizeFromShape(e));for(let i=0;i<o.length;++i){let s=i*n,a=t[s];for(let l=0;l<n;++l){let u=t[s+l];(Number.isNaN(u)||u>a)&&(a=u)}o[i]=a}return o}var vA=Be((t,n)=>Math.max(t,n)),kge=et(ga,vA),uG={kernelName:ga,backendName:"cpu",kernelFunc:kge};var bA=Be((t,n)=>Math.min(t,n)),Age=et(ya,bA),cG={kernelName:ya,backendName:"cpu",kernelFunc:Age};var Sy=Be((t,n)=>t*n),Rge=Dh((t,n,e,r)=>({real:t*e-n*r,imag:t*r+n*e})),kp=et(va,Sy,Rge),pG={kernelName:va,backendName:"cpu",kernelFunc:kp};function wA(t,n,e){let r=v.createScalarValue(-1,e);return Sy([],n,r,t,e)}function Mge(t){let{inputs:n,backend:e}=t,{x:r}=n;Q(r,"neg");let o=e.data.get(r.dataId).values,[i,s]=wA(o,r.shape,r.dtype);return e.makeTensorInfo(s,r.dtype,i)}var fG={kernelName:pu,backendName:"cpu",kernelFunc:Mge};var CA=Be((t,n)=>t!==n?1:0),Oge=et(Hc,CA,null,"bool"),dG={kernelName:Hc,backendName:"cpu",kernelFunc:Oge};function Ah(t,n,e,r,o){let i=n.length,s=v.sizeFromShape(n),a=v.computeStrides(n),l=v.computeStrides(o),u=v.getTypedArrayFromDType(e,v.sizeFromShape(o));for(let c=0;c<s;++c){let p=v.indexToLoc(c,i,a),f=new Array(p.length);for(let h=0;h<f.length;h++)f[h]=p[r[h]];let d=v.locToIndex(f,i,l);u[d]=t[c]}return u}function Ht(t){let{inputs:n,attrs:e,backend:r}=t,{x:o}=n,{perm:i}=e;Q(o,"transpose");let s=o.shape.length,a=new Array(s);for(let p=0;p<a.length;p++)a[p]=o.shape[i[p]];let l=r.data.get(o.dataId).values,u=Ah(l,o.shape,o.dtype,i,a);return{dataId:r.write(u,a,o.dtype),shape:a,dtype:o.dtype}}var hG={kernelName:as,backendName:"cpu",kernelFunc:Ht};function SA(t,n,e,r){let[o,i]=S.computeOutAndReduceShapes(t,r),s=un(n,"int32"),a=v.makeZerosTypedArray(v.sizeFromShape(o),s),l=v.sizeFromShape(i);for(let u=0;u<a.length;++u){let c=u*l,p=1;for(let f=0;f<l;++f)p*=e[c+f];a[u]=p}return{outVals:a,outShape:o,outDtype:s}}function Fge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Q(o,"prod");let a=o.shape.length,l=v.parseAxisParam(i,o.shape),u=S.getAxesPermutation(l,a),c=l,p=o,f=[];u!=null&&(p=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),f.push(p),c=S.getInnerMostAxes(c.length,a));let d=e.data.get(p.dataId).values,{outVals:h,outShape:m,outDtype:g}=SA(p.shape,p.dtype,d,c),y=m;return s&&(y=S.expandShapeToKeepDim(m,l)),f.forEach(x=>e.disposeIntermediateTensorInfo(x)),e.makeTensorInfo(y,g,h)}var mG={kernelName:yu,backendName:"cpu",kernelFunc:Fge};function $ge(t,n,e){t.forEach((r,o)=>{if(r<0||r>=e){let i=v.indexToLoc(o,n.length,v.computeStrides(n)).join(",");throw new Error(`indices[${i}] = ${r} is not in [0, ${e})`)}})}function Pge(t,n){for(let e=0;e<t.length;++e){let r=t[e],o=e===t.length-1?n:t[e+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>o)throw new Error("Ragged splits must not point past values");for(let i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function Lge(t,n,e,r){let o=[],i=0,s=n.length-1+e.length,a=new Array(s).fill(null).map(()=>[0]);Pge(e,r);let l=1;for(let u=0;u<n.length-1;++u){l*=n[u];let c=n[u+1];for(let p=1;p<l+1;++p)a[u].push(p*c)}for(let u=0;u<t.length;++u){let c=t[u],p=t[u]+1;for(let f=0;f<e.length;++f){let d=e[f],h=f+n.length-1;if(h>=0){let m=a[h],g=m[m.length-1]-d[c];for(let y=c;y<p;++y)a[h].push(d[y+1]+g)}c=d[c],p=d[p]}p!==c&&(o.push([c,p]),i+=p-c)}return{outSplits:a,valueSlices:o,numValues:i}}function Vge(t){let n=[];for(let e=0;e<t.length;++e){let r=t[e].length,o=v.getArrayFromDType("int32",r);n.push(o),t[e].forEach((i,s)=>o[s]=i)}return n}function gG(t,n){let e=t.slice(0,n);for(;e.length<n;)e.push(1);for(let r=n;r<t.length;r++)e[n-1]*=t[r];return e}function Bge(t,n,e,r,o,i){let s=gG(n,2)[1],a=gG(i,2)[1],l=0;for(let u of e)for(let c=u[0];c<u[1];++c){for(let p=0;p<r;++p)o[l*a+p]=t[c*s+p];++l}}function zge(t,n,e,r,o){let i=n.slice();i[0]=o;let s=v.getArrayFromDType(e,v.sizeFromShape(i)),a=t.length,l=a===0?0:a/n[0];return Bge(t,n,r,l,s,i),[s,i]}function Jw(t,n,e,r,o,i,s,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(n[0].length===0)throw new Error("Split tensors must not be scalars");let l=n[0][0]-1;if($ge(i,s,l),r.length===0)throw new Error("params.rank must be nonzero");let u=r[0],{outSplits:c,valueSlices:p,numValues:f}=Lge(i,s,t,u),d=Vge(c),h=zge(e,r,o,p,f);return[d,h[0],h[1]]}var yG=2147483647;function eC(t,n,e,r,o,i,s){if(n.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(s.length>1)throw new Error("deltas must be a scalar or vector");let a=n.length===0,l=o.length===0,u=s.length===0,c=[];a||c.push(n[0]),l||c.push(o[0]),u||c.push(s[0]);for(let g=1;g<c.length;++g)if(c[g]!==c[g-1])throw new Error("starts, limits, and deltas must have the same shape");let p=c.length===0?1:c[0],f=v.getArrayFromDType("int32",p+1);f[0]=0;for(let g=0;g<p;++g){let y=a?t[0]:t[g],x=l?r[0]:r[g],b=u?i[0]:i[g];if(b===0)throw new Error("Requires delta != 0");let w;if(b>0&&x<y||b<0&&x>y)w=0;else if(w=Math.ceil(Math.abs((x-y)/b)),w>yG)throw new Error(`Requires ((limit - start) / delta) <= ${yG}`);f[g+1]=f[g]+w}let d=f[p],h=v.getArrayFromDType(e,d),m=0;for(let g=0;g<p;++g){let y=f[g+1]-f[g],x=a?t[0]:t[g],b=u?i[0]:i[g];for(let w=0;w<y;++w)h[m++]=x,x+=b}return[f,h]}var fi=S.RowPartitionType,IA=class t{constructor(n,e,r,o,i,s,a,l,u,c){this.shape=n,this.shapeShape=e,this.values=r,this.valuesShape=o,this.valuesDType=i,this.defaultValue=s,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=S.getRowPartitionTypesHelper(c),this.raggedRank=S.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(n){return this.rowPartitionTypes[0]===fi.FIRST_DIM_SIZE?this.rowPartitionTypes[n+1]:this.rowPartitionTypes[n]}getRowPartitionTensor(n){return this.rowPartitionTypes[0]===fi.FIRST_DIM_SIZE?this.rowPartitionValues[n+1]:this.rowPartitionValues[n]}getMaxWidth(n){let e=this.getRowPartitionTensor(n-1);switch(this.getRowPartitionTypeByDimension(n-1)){case fi.VALUE_ROWIDS:return t.getMaxWidthValueRowID(e);case fi.ROW_SPLITS:return t.getMaxWidthRowSplit(e);default:throw new Error(`Cannot handle partition type ${fi[this.getRowPartitionTypeByDimension(n-1)]}`)}}static getMaxWidthRowSplit(n){let e=n.length;if(e===0||e===1)return 0;let r=0;for(let o=0;o<e-1;++o){let i=n[o+1]-n[o];i>r&&(r=i)}return r}static getMaxWidthValueRowID(n){let e=n.length;if(e===0)return 0;let r=0,o=n[0],i=0;for(let s=1;s<e;++s){let a=n[s];a!==o&&(o=a,i=Math.max(s-r,i),r=s)}return Math.max(e-r,i)}tensorShapeFromTensor(n,e,r=!0){if(e.length===0){if(n[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return vG(n,r)}calculateOutputSize(n){let e=this.valuesShape,r=this.defaultValueShape;S.validateDefaultValueShape(r,e);let o=this.tensorShapeFromTensor(this.shape,this.shapeShape),s=S.combineRaggedTensorToTensorShapes(this.raggedRank,o,e);s[0]<0&&(s[0]=n);for(let a=1;a<=this.raggedRank;++a)s[a]<0&&(s[a]=this.getMaxWidth(a));return s}calculateFirstParentOutputIndex(n,e,r){let o=Math.min(n,r),i=[],s=0;for(let a=0;a<o;++a,s+=e)i.push(s);for(let a=o;a<n;++a)i.push(-1);return v.assert(i.length===n,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(n,e,r,o){let i=n.length,s=[];for(let a=0;a<i-1;++a){let l=n[a+1]-n[a],u=Math.min(o,l),c=e[a];c===-1&&(u=0);for(let p=0;p<u;++p)s.push(c),c+=r;for(let p=0;p<l-u;++p)s.push(-1)}if(i>0&&s.length!==n[i-1])throw new Error("Invalid row split size.");return s}calculateOutputIndexValueRowID(n,e,r,o){let i=n.length,s=[];if(i===0)return[];let a=0,l=n[0];if(l>=e.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${e.length}`);let u=e[l];s.push(u);for(let c=1;c<i;++c){let p=n[c];if(p===l)u>=0&&(++a,a<o?u+=r:u=-1);else{if(a=0,l=p,p>=e.length)throw new Error(`Got nextValueRowId=${p} which is not less than ${e.length}`);u=e[p]}s.push(u)}if(s.length!==n.length)throw new Error("Invalid row ids.");return s}calculateOutputIndex(n,e,r,o){let i=this.getRowPartitionTensor(n),s=this.getRowPartitionTypeByDimension(n);switch(s){case fi.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,e,r,o);case fi.ROW_SPLITS:if(i.length-1>e.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${e.length}`);return this.calculateOutputIndexRowSplit(i,e,r,o);default:throw new Error(`Unsupported partition type: ${fi[s]}`)}}getFirstDimensionSize(){let n=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");let e=this.rowPartitionTypes[0];switch(e){case fi.FIRST_DIM_SIZE:return n[0];case fi.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case fi.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${fi[e]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");let e=this.getFirstDimensionSize(),r=this.calculateOutputSize(e),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let l=o.length-2;l>=0;--l)o[l]=o[l+1]*r[l+1];let i=vG(r,!1),s=v.getArrayFromDType(this.valuesDType,v.sizeFromShape(i));if(o[0]*r[0]>0){let l=this.calculateFirstParentOutputIndex(e,o[0],r[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,o[u],r[u]);this.setOutput(this.raggedRank,l,s,i)}return[i,s]}setOutput(n,e,r,o){if(r.length===0)return;let i=this.values,s=r,a=o.slice();a=a.slice(n+1);let l=v.sizeFromShape(a),u=e.length,c=this.defaultValue;if(c.length!==l&&c.length!==1){let h=this.defaultValueShape;L(()=>{let m=M(c,h);c=Ua(m,a).dataSync()})}let p=0,f=0,d=0;for(let h=0;h<=u;++h){let m=h<u?e[h]:-1;if(m===d){++d;continue}if(f<d){let g=i.subarray(p*l),y=s.subarray(f*l),x=(d-f)*l;xG(y,g,x)}if(h>=u){let g=r.length;m=Math.floor(g/l)}if(m>d)if(this.defaultValue.length===1)s.subarray(d*l,m*l).fill(this.defaultValue[0]),d=m;else for(;m>d;){let g=s.slice(d*l);xG(g,c,l),++d}m<0?(p=h+1,f=d):(p=h,f=d,d=f+1)}}};function xG(t,n,e){for(let r=0;r<e;r++)t[r]=n[r]}function vG(t,n){let e=[];for(let r of t){if(r<0){if(!n)throw new Error(`Dimension ${r} must be >= 0`);if(r<-1)throw new Error(`Dimension ${r} must be >= -1`);r=-1}e.push(r)}return e}function tC(t,n,e,r,o,i,s,a,l,u){return new IA(t,n,e,r,o,i,s,a,l,u).compute()}function nC(t,n,e,r){let o=t===n,i=t<n&&e<0,s=n<t&&e>1;if(o||i||s)return v.makeZerosTypedArray(0,r);let a=Math.abs(Math.ceil((n-t)/e)),l=v.makeZerosTypedArray(a,r);n<t&&e===1&&(e=-1),l[0]=t;for(let u=1;u<l.length;u++)l[u]=l[u-1]+e;return l}var EA=On(t=>1/Math.sqrt(t)),Uge=Br(Ea,EA),bG={kernelName:Ea,backendName:"cpu",kernelFunc:Uge};function Bi(t,n,e,r,o,i,s,a,l,u){let c=[r/o,o],p=t.values,f=n.values;if(r===0)return ve(e,n.dtype);let d=l instanceof mt?l:ve(c,n.dtype);typeof l=="string"||typeof l=="number"?d.values.fill(l):typeof l=="boolean"&&d.values.fill(+l);for(let h=0;h<i;h++){let m=[],g=0;for(let y=0;y<s;y++){let x=p[h*s+y];m.push(x),g+=x*a[y]}if(g<0||g>=r/o)throw new Error(`Invalid indices: ${m} does not index into ${e}`);for(let y=0;y<o;y++)u?d.values[g*o+y]+=f[h*o+y]:d.values[g*o+y]=n.rank===0?f[0]:f[h*o+y]}return d}var wG=On(t=>1/(1+Math.exp(-t))),TA=Te(ka,t=>1/(1+Math.exp(-t))),CG={kernelName:ka,backendName:"cpu",kernelFunc:TA};function _A(t,n,e,r,o){let i=kn.isSliceContinous(r,n,e),s=v.sizeFromShape(e),a=v.computeStrides(r);if(i){let p=kn.computeFlatOffset(n,a);return o==="string"?t.slice(p,p+s):t.subarray(p,p+s)}let l=o==="string"?S.fromUint8ToStringArray(t):t,u=ve(r,o,l),c=ve(e,o);for(let p=0;p<c.size;++p){let f=c.indexToLoc(p),d=f.map((h,m)=>h+n[m]);c.set(u.get(...d),...f)}return o==="string"?S.fromStringArrayToUint8(c.values):c.values}function di(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r;Q(o,"slice");let[a,l]=kn.parseSliceParams(o,i,s);kn.assertParamsValid(o,a,l);let u=e.data.get(o.dataId).values,c=_A(u,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,c)}var SG={kernelName:Su,backendName:"cpu",kernelFunc:di};function rC(t,n,e,r,o,i,s){let a=n[0],l=i[0],u=new Array(l),c=new Array(a),p=n[1];if(l===0){if(a!==0)throw new Error(S.getSparseFillEmptyRowsIndicesDenseShapeMismatch(a));let g=v.getArrayFromDType(e,0),y=v.getArrayFromDType(o,0);return[g,[0,p],y,u,c]}let f=!0,d=0,h=new Array(l).fill(0);for(let g=0;g<a;++g){let y=t[g*p];if(y<0)throw new Error(S.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=l)throw new Error(S.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,l));++h[y],f=f&&y>=d,d=y}let m=!0;for(let g=0;g<l;++g){let y=h[g]===0;u[g]=y,m=m&&!y,h[g]=Math.max(h[g],1),g>0&&(h[g]+=h[g-1])}if(m&&f){let g=t,y=r;for(let x=0;x<a;++x)c[x]=x;return[g,[a,p],y,u,c]}else{let g=h[l-1],y=v.getArrayFromDType(e,g*p),x=v.getArrayFromDType(o,g),b=new Array(l).fill(0);for(let w=0;w<a;++w){let C=t[w*p],N=b[C],D=(C===0?0:h[C-1])+N;b[C]++;for(let k=0;k<p;++k)y[D*p+k]=t[w*p+k];x[D]=r[w],c[w]=D}for(let w=0;w<l;++w)if(b[w]===0){let N=w===0?0:h[w-1];y[N*p+0]=w;for(let D=1;D<p;++D)y[N*p+D]=0;x[N]=s}return[y,[g,p],x,u,c]}}function oC(t,n,e,r,o){let i=v.sizeFromShape(r),s=n[0],a=o.length,l=[],u=1,c=-1;for(let g=0;g<a;++g){let y=o[g];if(y===-1){if(c!==-1)throw new Error(S.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,g));c=g,l.push(1)}else{if(y<0)throw new Error(S.getSparseReshapeNegativeOutputDimErrorMessage(g,y));u*=y,l.push(y)}}if(c!==-1){if(u<=0)throw new Error(S.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());let g=Math.trunc(i/u);if(u*g!==i)throw new Error(S.getSparseReshapeInputOutputMultipleErrorMessage(r,l));l[c]=g}if(v.sizeFromShape(l)!==i)throw new Error(S.getSparseReshapeInputOutputMismatchErrorMessage(r,l));let f=r.length,d=[];if(f>0){d[f-1]=1;for(let g=f-2;g>=0;--g)d[g]=d[g+1]*r[g+1]}let h=[];if(a>0){h[a-1]=1;for(let g=a-2;g>=0;--g)h[g]=h[g+1]*l[g+1]}let m=v.getArrayFromDType(e,s*a);for(let g=0;g<s;++g){let y=0;for(let x=0;x<f;++x)y+=t[g*f+x]*d[x];for(let x=0;x<a;++x)m[g*a+x]=Math.trunc(y/h[x]),y%=h[x]}return[m,[s,a],l]}function Rh(t,n,e,r,o,i=!1,s=0){let a=r.length,l=[n[0],t.length/n[0]],u=l[1],p=a>0?o[a-1]+1:0;if(p<0)throw new Error(S.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let f=n.slice();f[0]=p;let d=f.reduce((b,w)=>b*w,1),h=v.getArrayFromDType(e,d);if(a===0)return p>0&&h.fill(s),[h,f];if(p<=0)throw new Error(S.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let m=0,g=1,y=0,x=o[m];for(;;){let b=0;if(g<a){if(b=o[g],x===b){++g;continue}if(x>=b)throw new Error(S.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(x<0||x>=p)throw new Error(S.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(x,p));x>y&&h.fill(s,y*u,x*u);for(let w=m;w<g;++w){let C=r[w];if(C<0||C>=l[0])throw new Error(S.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,r[w],l[0]));for(let N=0;N<u;N++)h[x*u+N]+=t[C*u+N]}if(i)for(let w=0;w<u;w++)h[x*u+w]/=g-m;if(m=g,++g,y=x+1,x=b,g>a)break}return y<p&&h.fill(s,y*u,p*u),[h,f]}var IG=On(t=>Math.sqrt(t)),Gge=Te(Ra,t=>Math.sqrt(t)),EG={kernelName:Ra,backendName:"cpu",kernelFunc:Gge};var NA=Be((t,n)=>{let e=t-n;return e*e}),Wge=et(Ma,NA),TG={kernelName:Ma,backendName:"cpu",kernelFunc:Wge};var DA=On((t,n)=>{let{pattern:e,replaceGlobal:r,rewrite:o}=n;return t.replace(new RegExp(e,r?"g":""),o)}),Hge=Br(Ng,DA),_G={kernelName:Ng,backendName:"cpu",kernelFunc:Hge};function iC(t,n,e,r){let o=ve(t,n.dtype);for(let i=0;i<o.size;i++){let s=o.indexToLoc(i),a=new Array(s.length);for(let l=0;l<a.length;l++)a[l]=s[l]*e[l]+r[l];o.set(n.get(...a),...s)}return o}var kA=class{constructor(n,e,r,o,i,s){this.separator=v.encodeString(n),this.nGramWidths=e,this.leftPad=v.encodeString(r),this.rightPad=v.encodeString(o),this.padWidth=i,this.preserveShort=s}getPadWidth(n){return Math.min(this.padWidth<0?n-1:this.padWidth,n-1)}getNumNGrams(n,e){let r=this.getPadWidth(e);return Math.max(0,n+2*r-e+1)}createNGrams(n,e,r,o,i,s){for(let a=0;a<i;++a){let l=this.getPadWidth(s),u=Math.max(0,l-a),c=Math.max(0,l-(i-(a+1))),p=s-(u+c),f=e+(u>0?0:a-l),d=0;d+=u*this.leftPad.length;for(let x=0;x<p;++x)d+=n[f+x].length;d+=c*this.rightPad.length;let h=u+c+p-1;d+=h*this.separator.length,r[o+a]=new Uint8Array(d);let m=r[o+a],g=0,y=x=>x.forEach(b=>m[g++]=b);for(let x=0;x<u;++x)y(this.leftPad),y(this.separator);for(let x=0;x<p-1;++x)y(n[f+x]),y(this.separator);if(p>0){y(n[f+p-1]);for(let x=0;x<c;++x)y(this.separator),y(this.rightPad)}else{for(let x=0;x<c-1;++x)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(n,e){let r=n.length,o=e.length;if(o>0){let l=e[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<o;++u){let c=e[u]>=l;if(c=c&&e[u]<=r,!c)throw new Error(`Invalid split value ${e[u]}, must be in [${l}, ${r}]`);l=e[u]}if(l!==r)throw new Error(`Last split value must be data size. Expected ${r}, got ${l}`)}let i=o-1,s=v.getArrayFromDType("int32",o);if(r===0||o===0){let l=new Array(r);for(let u=0;u<=i;++u)s[u]=0;return[l,s]}s[0]=0;for(let l=1;l<=i;++l){let u=e[l]-e[l-1],c=0;this.nGramWidths.forEach(p=>{c+=this.getNumNGrams(u,p)}),this.preserveShort&&u>0&&c===0&&(c=1),s[l]=s[l-1]+c}let a=new Array(s[i]);for(let l=0;l<i;++l){let u=e[l],c=s[l];if(this.nGramWidths.forEach(p=>{let f=e[l+1]-e[l],d=this.getNumNGrams(f,p);this.createNGrams(n,u,a,c,d,p),c+=d}),this.preserveShort&&c===s[l]){let p=e[l+1]-e[l];if(p===0)continue;let f=p+2*this.padWidth;this.createNGrams(n,u,a,c,1,f)}}return[a,s]}};function sC(t,n,e,r,o,i,s,a){return new kA(e,r,o,i,s,a).compute(t,n)}function jge(t,n,e,r){if(!t.length)return;if(n.length===0){for(let i=0;i<t.length;++i)r.push(t.subarray(i,i+1));return}if(n.length===1){let i=n[0],s=t.indexOf(i);for(;s!==-1;){let a=t.subarray(0,s);(!e||a.length!==0)&&r.push(a),t=t.subarray(s+1),s=t.indexOf(i)}(!e||t.length!==0)&&r.push(t);return}let o=0;for(let i=0;i<t.length+1;i++)if(i===t.length||n.indexOf(t[i])!==-1){let s=t.subarray(o,i);(!e||s.length!==0)&&r.push(s),o=i+1}}function aC(t,n,e){let r=t.length,o=[],i=0,s=0,a=new Array(r);for(let f=0;f<r;++f){let d=o.length;jge(t[f],n,e,o);let h=o.length-d;a[f]=h,i+=h,s=Math.max(s,h)}let l=v.getArrayFromDType("int32",i*2),u=new Array(i),c=[r,s],p=0;for(let f=0;f<r;++f)for(let d=0;d<a[f];++d)l[p*2]=f,l[p*2+1]=d,u[p]=o[p],++p;return[l,u,c]}function lC(t,n){let e=v.getArrayFromDType("int32",t.length);for(let r=0;r<t.length;++r)e[r]=v.fingerPrint64(t[r]).modulo(n).getLowBitsUnsigned();return e}var AA=Be((t,n)=>t-n),qge=Dh((t,n,e,r)=>({real:t-e,imag:n-r})),Iy=et(Oa,AA,qge),NG={kernelName:Oa,backendName:"cpu",kernelFunc:Iy};function uC(t,n){let e=new Array(t.rank);for(let o=0;o<e.length;o++)e[o]=t.shape[o]*n[o];let r=ve(e,t.dtype);for(let o=0;o<r.values.length;++o){let i=r.indexToLoc(o),s=new Array(t.rank);for(let l=0;l<s.length;l++)s[l]=i[l]%t.shape[l];let a=t.locToIndex(s);r.values[o]=t.values[a]}return r}var Ey=(t,n)=>{let e=n.value-t.value;return e===0?t.index-n.index:e};function DG(t,n,e=0,r=t.length-1){for(;r>e;){if(r-e>600){let a=r-e+1,l=n-e+1,u=Math.log(a),c=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*c*(a-c)/a)*Math.sign(l-a/2),f=Math.max(e,Math.floor(n-l*c/a+p)),d=Math.min(r,Math.floor(n+(a-l)*c/a+p));DG(t,n,f,d)}let o=t[n],i=e,s=r;for(v.swap(t,e,n),Ey(t[r],o)>0&&v.swap(t,e,r);i<s;){for(v.swap(t,i,s),i++,s--;Ey(t[i],o)<0;)i=i+1;for(;Ey(t[s],o)>0;)s=s-1}Ey(t[e],o)===0?v.swap(t,e,s):(s=s+1,v.swap(t,s,r)),s<=n&&(e=s+1),n<=s&&(r=s-1)}}function cC(t,n,e,r,o){let i=n[n.length-1],[s,a]=[t.length/i,i],l=v.getTypedArrayFromDType(e,s*r),u=v.getTypedArrayFromDType("int32",s*r);for(let p=0;p<s;p++){let f=p*a,d=t.subarray(f,f+a),h=new Array(d.length);d.forEach((x,b)=>h[b]={value:x,index:b}),r<h.length&&(DG(h,r),h=h.slice(0,r)),o&&h.sort(Ey);let m=p*r,g=l.subarray(m,m+r),y=u.subarray(m,m+r);for(let x=0;x<r;x++)g[x]=h[x].value,y[x]=h[x].index}let c=n.slice();return c[c.length-1]=r,[ve(c,e,l),ve(c,"int32",u)]}function pC(t,n,e,r){let o=v.parseAxisParam(n,e)[0],i=[1,e[0],1];for(let h=0;h<o;h++)i[0]*=e[h];i[1]=e[o];for(let h=o+1;h<e.length;h++)i[2]*=e[h];let s=new Map,a=new Int32Array(e[o]),l=new mt(i,r,t),u=[],c=i[0]===1&&i[2]===1;for(let h=0;h<e[o];h++){let m;if(c)m=t[h].toString();else{let y=[];for(let x=0;x<i[0];x++)for(let b=0;b<i[2];b++)y.push(l.get(x,h,b));m=y.join(",")}let g=s.get(m);if(g!=null)a[h]=g;else{let y=s.size;s.set(m,y),a[h]=y,u.push(h)}}let p=i.slice();p[1]=s.size;let f=new mt(p,r);u.forEach((h,m)=>{for(let g=0;g<i[0];g++)for(let y=0;y<i[2];y++)f.set(l.get(g,h,y),g,m,y)});let d=e.slice();return d[o]=p[1],{outputValues:f.values,outputShape:d,indices:a}}m0("cpu",()=>new WU,1);var MA=Te(oa,t=>t>=0?t:Math.exp(t)-1),kG={kernelName:oa,backendName:"cpu",kernelFunc:MA};function OA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r;Q([o],"leakyRelu");let s=v.sizeFromShape(o.shape),a=e.data.get(o.dataId).values,l=v.getTypedArrayFromDType("float32",s);for(let u=0;u<a.length;u++)l[u]=a[u]<0?i*a[u]:a[u];return e.makeTensorInfo(o.shape,"float32",l)}var AG={kernelName:ru,backendName:"cpu",kernelFunc:OA};var Kge=Be((t,n)=>t<0?n*t:t);function FA(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n;Q([r,o],"prelu");let i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,[a,l]=Kge(r.shape,o.shape,i,s,"float32");return e.makeTensorInfo(l,"float32",a)}var RG={kernelName:gu,backendName:"cpu",kernelFunc:FA};var $A=Te(Ca,t=>Math.max(0,t)),MG={kernelName:Ca,backendName:"cpu",kernelFunc:$A};var PA=Te(Sa,t=>Math.min(Math.max(0,t),6)),OG={kernelName:Sa,backendName:"cpu",kernelFunc:PA};function Ap(t,n,e,r,o){if(e==="linear")return rr({inputs:{x:n},backend:t});if(e==="relu")return $A({inputs:{x:n},backend:t});if(e==="elu")return MA({inputs:{x:n},backend:t});if(e==="relu6")return PA({inputs:{x:n},backend:t});if(e==="prelu")return FA({inputs:{x:n,alpha:r},backend:t});if(e==="leakyrelu")return OA({inputs:{x:n},backend:t,attrs:{alpha:o}});if(e==="sigmoid")return TA({inputs:{x:n},backend:t});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}function ze(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=v.sizeFromShape(o.shape),a=v.inferFromImplicitShape(i,s),l=v.sizeFromShape(a);v.assert(s===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`),e.incRef(o.dataId);let u=e.data.get(o.dataId);if(u.complexTensorInfos!=null){let c=u.complexTensorInfos.real,p=u.complexTensorInfos.imag;c.shape=a,p.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var FG={kernelName:xu,backendName:"cpu",kernelFunc:ze};function LA(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;Q([o,i],"matMul");let l=o.shape.length,u=i.shape.length,c=s?o.shape[l-2]:o.shape[l-1],p=a?i.shape[u-1]:i.shape[u-2],f=s?o.shape[l-1]:o.shape[l-2],d=a?i.shape[u-2]:i.shape[u-1],h=o.shape.slice(0,-2),m=i.shape.slice(0,-2),g=v.sizeFromShape(h),y=v.sizeFromShape(m),b=io.assertAndGetBroadcastShape(o.shape.slice(0,-2),i.shape.slice(0,-2)).concat([f,d]);v.assert(c===p,()=>`Error in matMul: inner shapes (${c}) and (${p}) of Tensors with shapes ${o.shape} and ${i.shape} and transposeA=${s} and transposeB=${a} must match.`);let w=s?[g,c,f]:[g,f,c],C=a?[y,d,p]:[y,p,d],N=ze({inputs:{x:o},backend:e,attrs:{shape:w}}),D=ze({inputs:{x:i},backend:e,attrs:{shape:C}}),k=s?N.shape[1]:N.shape[2],O=s?N.shape[2]:N.shape[1],$=a?D.shape[1]:D.shape[2],V=Math.max(g,y),G=e.data.get(N.dataId).values,W=e.data.get(D.dataId).values,H=v.computeStrides(N.shape),j=v.computeStrides(D.shape),[Y,ee,X]=s?[H[0],1,H[1]]:[H[0],H[1],1],[te,re,oe]=a?[1,j[1],j[0]]:[j[1],1,j[0]],ae=O*$,ie=ve([V,O,$],N.dtype),fe=ie.values,le=e.blockSize;for(let ye=0;ye<V;ye++){let _e=ye%g,Oe=ye%y;for(let Ae=0;Ae<O;Ae+=le){let Ke=Math.min(Ae+le,O);for(let Xe=0;Xe<$;Xe+=le){let Tt=Math.min(Xe+le,$);for(let Vt=0;Vt<k;Vt+=le){let ln=Math.min(Vt+le,k);for(let Bt=Ae;Bt<Ke;Bt++)for(let Rt=Xe;Rt<Tt;Rt++){let on=0;for(let Qt=Vt;Qt<ln;Qt++){let Ts=G[_e*Y+Bt*ee+Qt*X],Yn=W[Qt*te+Rt*re+Oe*oe];on+=Ts*Yn}fe[ye*ae+(Bt*$+Rt)]+=on}}}}}return e.disposeIntermediateTensorInfo(N),e.disposeIntermediateTensorInfo(D),e.makeTensorInfo(b,ie.dtype,ie.values)}var $G={kernelName:Wl,backendName:"cpu",kernelFunc:LA};function Xge(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:p}=r,f,d,h,m=[];f=LA({inputs:{a:o,b:i},attrs:{transposeA:l,transposeB:u},backend:e}),s&&(d=vs({inputs:{a:f,b:s},backend:e}),m.push(f),f=d),c&&(h=Ap(e,f,c,a,p),m.push(f),f=h);for(let y of m)e.disposeIntermediateTensorInfo(y);return f}var PG={kernelName:jc,backendName:"cpu",kernelFunc:Xge};var Yge=Te(js,t=>Math.acos(t)),LG={kernelName:js,backendName:"cpu",kernelFunc:Yge};var Zge=Te(qs,t=>Math.acosh(t)),VG={kernelName:qs,backendName:"cpu",kernelFunc:Zge};function Qge(t){let{inputs:n,backend:e}=t,r=n;Q(n,"addN");let o=r.map(a=>e.data.get(a.dataId).values),i=ve(r[0].shape,r[0].dtype),s=i.values;for(let a=0;a<r.length;a++){let l=o[a];for(let u=0;u<s.length;u++)s[u]+=l[u]}return e.makeTensorInfo(i.shape,i.dtype,i.values)}var BG={kernelName:Jf,backendName:"cpu",kernelFunc:Qge};function Jge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Q(o,"all");let a=v.parseAxisParam(i,o.shape),l=a,u=S.getAxesPermutation(l,o.shape.length),c=o;u!=null&&(c=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),l=S.getInnerMostAxes(l.length,o.shape.length)),S.assertAxesAreInnerMostDims("all",l,c.shape.length);let[p,f]=S.computeOutAndReduceShapes(c.shape,l),d=v.sizeFromShape(f),h=v.makeZerosTypedArray(v.sizeFromShape(p),c.dtype),m=e.data.get(c.dataId).values;for(let y=0;y<h.length;++y){let x=y*d,b=m[x];for(let w=0;w<d;++w){let C=m[x+w];b=b&&C}h[y]=b}u!=null&&e.disposeIntermediateTensorInfo(c);let g=e.makeTensorInfo(p,c.dtype,h);if(s){let y=S.expandShapeToKeepDim(p,a),x=ze({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),x}return g}var zG={kernelName:ed,backendName:"cpu",kernelFunc:Jge};function eye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Q(o,"any");let a=v.parseAxisParam(i,o.shape),l=a,u=S.getAxesPermutation(l,o.shape.length),c=o;u!=null&&(c=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),l=S.getInnerMostAxes(l.length,o.shape.length)),S.assertAxesAreInnerMostDims("any",l,c.shape.length);let[p,f]=S.computeOutAndReduceShapes(c.shape,l),d=v.sizeFromShape(f),h=v.makeZerosTypedArray(v.sizeFromShape(p),c.dtype),m=e.data.get(c.dataId).values;for(let y=0;y<h.length;++y){let x=y*d,b=m[x];for(let w=0;w<d;++w){let C=m[x+w];b=b||C}h[y]=b}u!=null&&e.disposeIntermediateTensorInfo(c);let g=e.makeTensorInfo(p,c.dtype,h);if(s){let y=S.expandShapeToKeepDim(p,a),x=ze({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),x}return g}var UG={kernelName:td,backendName:"cpu",kernelFunc:eye};function tye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;Q(o,"argMax");let s=v.parseAxisParam(i,o.shape),a=S.getAxesPermutation(s,o.shape.length),l=o,u=[];a!=null&&(l=Ht({inputs:{x:o},backend:e,attrs:{perm:a}}),u.push(l),s=S.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],S.assertAxesAreInnerMostDims("argMax",s,l.shape.length);let[c,p]=S.computeOutAndReduceShapes(l.shape,s),f=v.sizeFromShape(c),d=v.makeZerosTypedArray(f,"int32"),h=v.sizeFromShape(p),m=e.data.get(l.dataId).values;for(let g=0;g<d.length;++g){let y=g*h,x=m[y],b=0;for(let w=0;w<h;++w){let C=m[y+w];C>x&&(x=C,b=w)}d[g]=b}return u.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(c,"int32",d)}var GG={kernelName:Bl,backendName:"cpu",kernelFunc:tye};function nye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;Q(o,"argMin");let s=v.parseAxisParam(i,o.shape),a=S.getAxesPermutation(s,o.shape.length),l=o,u=[];a!=null&&(l=Ht({inputs:{x:o},backend:e,attrs:{perm:a}}),u.push(l),s=S.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],S.assertAxesAreInnerMostDims("argMin",s,l.shape.length);let[c,p]=S.computeOutAndReduceShapes(l.shape,s),f=v.sizeFromShape(c),d=v.makeZerosTypedArray(f,"int32"),h=v.sizeFromShape(p),m=e.data.get(l.dataId).values;for(let g=0;g<d.length;++g){let y=g*h,x=m[y],b=0;for(let w=0;w<h;++w){let C=m[y+w];C<x&&(x=C,b=w)}d[g]=b}return u.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(c,"int32",d)}var WG={kernelName:zl,backendName:"cpu",kernelFunc:nye};var rye=Te(Ks,t=>Math.asin(t)),HG={kernelName:Ks,backendName:"cpu",kernelFunc:rye};var oye=Te(Xs,t=>Math.asinh(t)),jG={kernelName:Xs,backendName:"cpu",kernelFunc:oye};var iye=Te(Ys,t=>Math.atan(t)),qG={kernelName:Ys,backendName:"cpu",kernelFunc:iye};var sye=Be((t,n)=>Math.atan2(t,n)),aye=et(Qs,sye),KG={kernelName:Qs,backendName:"cpu",kernelFunc:aye};var lye=Te(Zs,t=>Math.atanh(t)),XG={kernelName:Zs,backendName:"cpu",kernelFunc:lye};function Mh(t,n,e,r,o,i){let s=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,u=o.dilationWidth,c=o.effectiveFilterHeight,p=o.effectiveFilterWidth,f=o.padInfo.top,d=o.padInfo.left,h=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=ve(o.outShape,e),g=m.values,y=o.outShape[1]*o.outShape[2]*o.outShape[3],x=o.outShape[2]*o.outShape[3],b=o.outShape[3];for(let w=0;w<o.batchSize;++w){let C=w*y,N=w*r[0];for(let D=0;D<o.inChannels;++D)for(let k=0;k<o.outHeight;++k){let O=k*s-f,$=Math.max(0,O),V=Math.min(o.inHeight,c+O),G=C+k*x;for(let W=0;W<o.outWidth;++W){let H=W*a-d,j=Math.max(0,H),Y=Math.min(o.inWidth,p+H),ee=h,X=0,te=0;for(let oe=$;oe<V;oe+=l){let ae=N+oe*r[1];for(let ie=j;ie<Y;ie+=u){let fe=ae+ie*r[2],le=t[fe+D];i==="max"&&le>ee?ee=le:i==="avg"&&(X+=le,te++)}if(isNaN(ee))break}let re=G+W*b+D;g[re]=i==="avg"?X/te:ee}}}return m}function fC(t,n,e,r,o=!1,i=!1){let s=ve(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,p=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=r.padInfo.top,h=r.padInfo.left,m=ve(n,e,t);for(let g=0;g<r.batchSize;++g)for(let y=0;y<r.inChannels;++y)for(let x=0;x<r.outHeight;++x){let b=x*a-d,w=b;for(;w<0;)w+=u;let C=Math.min(r.inHeight,p+b);for(let N=0;N<r.outWidth;++N){let D=N*l-h,k=D;for(;k<0;)k+=c;let O=Math.min(r.inWidth,f+D),$=Number.NEGATIVE_INFINITY,V=-1;for(let G=w;G<C;G+=u){let W=G-b;for(let H=k;H<O;H+=c){let j=H-D,Y=m.get(g,G,H,y);Y>$&&($=Y,o?V=i?((g*r.inHeight+G)*r.inWidth+H)*r.inChannels+y:(G*r.inWidth+H)*r.inChannels+y:V=W*f+j)}}s.set(V,g,x,N,y)}}return s}function dC(t,n,e,r,o,i){let s=o.strideDepth,a=o.strideHeight,l=o.strideWidth,u=o.dilationDepth,c=o.dilationHeight,p=o.dilationWidth,f=o.effectiveFilterDepth,d=o.effectiveFilterHeight,h=o.effectiveFilterWidth,m=o.padInfo.front,g=o.padInfo.top,y=o.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=ve(o.outShape,e),w=b.values,C=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],N=o.outShape[2]*o.outShape[3]*o.outShape[4],D=o.outShape[3]*o.outShape[4],k=o.outShape[4];for(let O=0;O<o.batchSize;++O){let $=O*C,V=O*r[0];for(let G=0;G<o.inChannels;++G)for(let W=0;W<o.outDepth;++W){let H=W*s-m,j=H;for(;j<0;)j+=u;let Y=Math.min(o.inDepth,f+H),ee=$+W*N;for(let X=0;X<o.outHeight;++X){let te=X*a-g,re=te;for(;re<0;)re+=c;let oe=Math.min(o.inHeight,d+te),ae=ee+X*D;for(let ie=0;ie<o.outWidth;++ie){let fe=ie*l-y,le=fe;for(;le<0;)le+=p;let ye=Math.min(o.inWidth,h+fe),_e=ae+ie*k,Oe=x,Ae=0,Ke=0;for(let Tt=j;Tt<Y;Tt+=u){let Vt=V+Tt*r[1];for(let ln=re;ln<oe;ln+=c){let Bt=Vt+ln*r[2];for(let Rt=le;Rt<ye;Rt+=p){let on=Bt+Rt*r[3],Qt=t[on+G];if(i==="max"&&Qt>Oe?Oe=Qt:i==="avg"&&(Ae+=Qt,Ke++),isNaN(Oe))break}if(isNaN(Oe))break}if(isNaN(Oe))break}let Xe=_e+G;w[Xe]=i==="avg"?Ae/Math.max(Ke,1):Oe}}}}return b}function YG(t,n){let e=ve(n.outShape,"int32"),r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,a=n.dilationHeight,l=n.dilationWidth,u=n.effectiveFilterDepth,c=n.effectiveFilterHeight,p=n.effectiveFilterWidth,f=n.padInfo.front,d=n.padInfo.top,h=n.padInfo.left;for(let m=0;m<n.batchSize;++m)for(let g=0;g<n.inChannels;++g)for(let y=0;y<n.outDepth;++y){let x=y*r-f,b=x;for(;b<0;)b+=s;let w=Math.min(n.inDepth,u+x);for(let C=0;C<n.outHeight;++C){let N=C*o-d,D=N;for(;D<0;)D+=a;let k=Math.min(n.inHeight,c+N);for(let O=0;O<n.outWidth;++O){let $=O*i-h,V=$;for(;V<0;)V+=l;let G=Math.min(n.inWidth,p+$),W=Number.NEGATIVE_INFINITY,H=-1;for(let j=b;j<w;j+=s){let Y=j-x;for(let ee=D;ee<k;ee+=a){let X=ee-N;for(let te=V;te<G;te+=l){let re=te-$,oe=t.get(m,j,ee,te,g);oe>=W&&(W=oe,H=Y*c*p+X*c+re)}}}e.set(H,m,y,C,O,g)}}}return e}function uye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Q(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,u=1;v.assert(S.eitherStridesOrDilationsAreOne(s,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let c=S.computePool2DInfo(o.shape,i,s,u,a,l),p;if(c.filterWidth===1&&c.filterHeight===1&&v.arraysEqual(c.inShape,c.outShape))p=rr({inputs:{x:o},backend:e});else{let f=e.data.get(o.dataId).values,d=v.computeStrides(o.shape),h=Mh(f,o.shape,o.dtype,d,c,"avg");p=e.makeTensorInfo(c.outShape,o.dtype,h.values)}return p}var ZG={kernelName:Ul,backendName:"cpu",kernelFunc:uye};function cye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:u}=r;Q(o,"avgPool3d");let c=S.computePool3DInfo(o.shape,i,s,1,a,l,u),p=e.data.get(o.dataId).values,f=dC(p,o.shape,o.dtype,v.computeStrides(o.shape),c,"avg");return e.makeTensorInfo(f.shape,"float32",f.values)}var QG={kernelName:Gl,backendName:"cpu",kernelFunc:cye};function pye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:u}=r;Q([o,i],"avgPool3DGrad");let c=S.computePool3DInfo(i.shape,s,a,1,l,u),p=c.strideDepth,f=c.strideHeight,d=c.strideWidth,h=c.filterDepth,m=c.filterHeight,g=c.filterWidth,y=c.dilationDepth,x=c.dilationHeight,b=c.dilationWidth,w=c.effectiveFilterDepth,C=c.effectiveFilterHeight,N=c.effectiveFilterWidth,D=w-1-c.padInfo.front,k=N-1-c.padInfo.left,O=C-1-c.padInfo.top,$=ve(i.shape,"float32"),V=1/(h*m*g),G=e.bufferSync(o);for(let W=0;W<c.batchSize;++W)for(let H=0;H<c.inChannels;++H)for(let j=0;j<c.inDepth;++j)for(let Y=0;Y<c.inHeight;++Y)for(let ee=0;ee<c.inWidth;++ee){let X=j-D,te=Y-O,re=ee-k,oe=0;for(let ae=0;ae<w;ae+=y){let ie=(X+ae)/p;if(!(ie<0||ie>=c.outDepth||Math.floor(ie)!==ie))for(let fe=0;fe<C;fe+=x){let le=(te+fe)/f;if(!(le<0||le>=c.outHeight||Math.floor(le)!==le))for(let ye=0;ye<N;ye+=b){let _e=(re+ye)/d;if(_e<0||_e>=c.outWidth||Math.floor(_e)!==_e)continue;let Oe=G.get(W,ie,le,_e,H);oe+=Oe}}}$.set(oe*V,W,j,Y,ee,H)}return e.makeTensorInfo($.shape,$.dtype,$.values)}var JG={kernelName:rd,backendName:"cpu",kernelFunc:pye};function fye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;Q([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:u}=r,c=S.computePool2DInfo(s.shape,a,l,1,u),p=c.strideHeight,f=c.strideWidth,d=c.filterHeight,h=c.filterWidth,m=c.dilationHeight,g=c.dilationWidth,y=c.effectiveFilterHeight,x=c.effectiveFilterWidth,b=x-1-c.padInfo.left,w=y-1-c.padInfo.top,C=ve(s.shape,"float32"),N=1/(d*h),D=e.data.get(o.dataId).values,k=ve(o.shape,"float32",D);for(let O=0;O<c.batchSize;++O)for(let $=0;$<c.inChannels;++$)for(let V=0;V<c.inHeight;++V)for(let G=0;G<c.inWidth;++G){let W=V-w,H=G-b,j=0;for(let Y=0;Y<y;Y+=m){let ee=(W+Y)/p;if(!(ee<0||ee>=c.outHeight||Math.floor(ee)!==ee))for(let X=0;X<x;X+=g){let te=(H+X)/f;if(te<0||te>=c.outWidth||Math.floor(te)!==te)continue;let re=k.get(O,ee,te,$);j+=re}}C.set(j*N,O,V,G,$)}return e.makeTensorInfo(C.shape,C.dtype,C.values)}var e4={kernelName:nd,backendName:"cpu",kernelFunc:fye};function dye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,scale:i,offset:s,mean:a,variance:l}=n;v.assert(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),v.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),v.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Q([o,a,l,i,s],"batchNorm");let{varianceEpsilon:u}=r;u==null&&(u=.001);let c=e.data.get(o.dataId).values,p=e.data.get(a.dataId).values,f=e.data.get(l.dataId).values,d=i?e.data.get(i.dataId).values:new Float32Array([1]),h=s?e.data.get(s.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),g=h.length,y=d.length,x=f.length,b=p.length,w=0,C=0,N=0,D=0;for(let k=0;k<c.length;++k)m[k]=h[w++]+(c[k]-p[C++])*d[N++]/Math.sqrt(f[D++]+u),w>=g&&(w=0),C>=b&&(C=0),N>=y&&(N=0),D>=x&&(D=0);return e.makeTensorInfo(o.shape,o.dtype,m)}var t4={kernelName:tu,backendName:"cpu",kernelFunc:dye};function hye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;Q([o],"batchToSpaceND");let a=i.reduce((y,x)=>y*x),l=S.getReshaped(o.shape,i,a),u=S.getPermuted(l.length,i.length),c=S.getReshapedPermuted(o.shape,i,a),p=S.getSliceBeginCoords(s,i.length),f=S.getSliceSize(c,s,i.length),d=ze({inputs:{x:o},backend:e,attrs:{shape:l}}),h=Ht({inputs:{x:d},backend:e,attrs:{perm:u}}),m=ze({inputs:{x:h},backend:e,attrs:{shape:c}}),g=di({inputs:{x:m},backend:e,attrs:{begin:p,size:f}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(m),g}var n4={kernelName:Hl,backendName:"cpu",kernelFunc:hye};function mye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,u=kh(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}var r4={kernelName:od,backendName:"cpu",kernelFunc:mye};function gye(t){let{inputs:n,backend:e}=t,{s0:r,s1:o}=n,i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,a=S.assertAndGetBroadcastShape(Array.from(i),Array.from(s));return e.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var o4={kernelName:Pb,backendName:"cpu",kernelFunc:gye};var yye=Te(ea,(t,n)=>{let e=n;return t>e.clipValueMax?e.clipValueMax:t<e.clipValueMin?e.clipValueMin:t}),i4={kernelName:ea,backendName:"cpu",kernelFunc:yye};var xye=t=>{let{x:n}=t.inputs,e=t.backend,r=new Float32Array(v.sizeFromShape(n.shape)),o=e.data.get(n.dataId),i=o.complexTensorInfos.real,s=o.complexTensorInfos.imag,a=e.data.get(i.dataId).values,l=e.data.get(s.dataId).values;for(let u=0;u<a.length;u++){let c=a[u],p=l[u];r[u]=Math.hypot(c,p)}return e.makeOutput(r,n.shape,"float32")},s4={kernelName:jl,backendName:"cpu",kernelFunc:xye};function bs(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.imag,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var a4={kernelName:wd,backendName:"cpu",kernelFunc:bs};function qu(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=v.parseAxisParam(o,n[0].shape)[0],s=n.map(m=>m.shape);S.assertParamsConsistent(s,i);let a=S.computeOutShape(n.map(m=>m.shape),i);if(v.sizeFromShape(a)===0)return e.makeTensorInfo(a,n[0].dtype,[]);let l=n.filter(m=>v.sizeFromShape(m.shape)>0);if(l.length===1)return rr({inputs:{x:l[0]},backend:e});if(l[0].dtype==="complex64"){let m=l.map(w=>ci({inputs:{input:w},backend:e})),g=l.map(w=>bs({inputs:{input:w},backend:e})),y=qu({inputs:m,backend:e,attrs:{axis:i}}),x=qu({inputs:g,backend:e,attrs:{axis:i}}),b=wn({inputs:{real:y,imag:x},backend:e});return m.forEach(w=>e.disposeIntermediateTensorInfo(w)),g.forEach(w=>e.disposeIntermediateTensorInfo(w)),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),b}let u=l.map(m=>{let y=[-1,v.sizeFromShape(m.shape.slice(i))];return ze({inputs:{x:m},backend:e,attrs:{shape:y}})}),c=u.map(m=>({vals:e.data.get(m.dataId).values,shape:m.shape}));a=S.computeOutShape(u.map(m=>m.shape),1);let p=u[0].shape[0]===1,f=Kw(c,a,n[0].dtype,p),d=S.computeOutShape(l.map(m=>m.shape),i),h=e.makeTensorInfo(d,n[0].dtype,f);return u.forEach(m=>e.disposeIntermediateTensorInfo(m)),h}var l4={kernelName:ql,backendName:"cpu",kernelFunc:qu};function VA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=r;Q([o,i],"conv2d");let p=S.convertConv2DDataFormat(l),f=S.computeConv2DInfo(o.shape,i.shape,s,u,a,c,!1,p),d=f.filterHeight,h=f.filterWidth,m=f.dilationHeight,g=f.dilationWidth,y=f.padInfo.left,x=f.padInfo.top,b=f.dataFormat==="channelsLast",w=new mt(f.outShape,o.dtype),C=v.computeStrides(o.shape),N=v.computeStrides(i.shape),D=C[0],k=b?C[1]:C[2],O=b?C[2]:1,$=b?1:C[1],V=w.strides[0],G=b?w.strides[1]:w.strides[2],W=b?w.strides[2]:1,H=b?1:w.strides[1],j=e.data.get(o.dataId).values,Y=e.data.get(i.dataId).values,ee=w.values;for(let X=0;X<f.batchSize;++X){let te=X*D,re=X*V;for(let oe=0;oe<f.outHeight;++oe){let ae=re+oe*G,ie=oe*f.strideHeight-x;for(let fe=0;fe<d;++fe){let le=ie+fe*m;if(le<0||le>=f.inHeight)continue;let ye=fe*N[0],_e=te+le*k;for(let Oe=0;Oe<f.outWidth;++Oe){let Ae=ae+Oe*W,Ke=Oe*f.strideWidth-y;for(let Xe=0;Xe<h;++Xe){let Tt=Ke+Xe*g;if(Tt<0||Tt>=f.inWidth)continue;let Vt=ye+Xe*N[1],ln=_e+Tt*O,Bt=Vt;for(let Rt=0;Rt<f.inChannels;++Rt){let on=j[ln+Rt*$];for(let Qt=0;Qt<f.outChannels;++Qt)ee[Ae+Qt*H]+=on*Y[Bt+Qt];Bt+=f.outChannels}}}}}}return e.makeTensorInfo(w.shape,w.dtype,ee)}var u4={kernelName:Kl,backendName:"cpu",kernelFunc:VA};function vye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=r;Q([o,i],"conv2dBackpropFilter");let p=S.convertConv2DDataFormat(l),f=S.computeConv2DInfo(o.shape,c,s,1,a,u,!1,p),{strideHeight:d,strideWidth:h,filterHeight:m,filterWidth:g}=f,y=f.dataFormat==="channelsLast",x=new mt(f.filterShape,"float32"),b=f.padInfo.left,w=f.padInfo.top,C=e.data.get(o.dataId).values,N=e.data.get(i.dataId).values,D=new mt(o.shape,o.dtype,C),k=new mt(i.shape,i.dtype,N);for(let O=0;O<m;++O){let $=Math.max(0,Math.ceil((w-O)/d)),V=Math.min(f.outHeight,(f.inHeight+w-O)/d);for(let G=0;G<g;++G){let W=Math.max(0,Math.ceil((b-G)/h)),H=Math.min(f.outWidth,(f.inWidth+b-G)/h);for(let j=0;j<f.inChannels;++j)for(let Y=0;Y<f.outChannels;++Y){let ee=0;for(let X=0;X<f.batchSize;++X)for(let te=$;te<V;++te){let re=O+te*d-w;for(let oe=W;oe<H;++oe){let ae=G+oe*h-b;y?ee+=D.get(X,re,ae,j)*k.get(X,te,oe,Y):ee+=D.get(X,j,re,ae)*k.get(X,Y,te,oe)}}x.set(ee,O,G,j,Y)}}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}var c4={kernelName:sd,backendName:"cpu",kernelFunc:vye};function bye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=r;Q([o,i],"conv2dBackpropInput");let p=v.computeStrides(i.shape),f=v.computeStrides(o.shape),d=S.convertConv2DDataFormat(u),h=S.computeConv2DInfo(s,i.shape,a,1,l,c,!1,d),m=new mt(h.inShape,"float32"),g=m.values,y=e.data.get(o.dataId).values,x=e.data.get(i.dataId).values,[b,w,C]=p,{batchSize:N,filterHeight:D,filterWidth:k,inChannels:O,inHeight:$,inWidth:V,outChannels:G,outHeight:W,outWidth:H,strideHeight:j,strideWidth:Y}=h;d=h.dataFormat;let ee=D-1-h.padInfo.top,X=k-1-h.padInfo.left,te=d==="channelsLast",re=m.strides[0],oe=te?m.strides[1]:m.strides[2],ae=te?m.strides[2]:1,ie=te?1:m.strides[1],fe=f[0],le=te?f[1]:f[2],ye=te?f[2]:1,_e=te?1:f[1];for(let Oe=0;Oe<N;++Oe)for(let Ae=0;Ae<O;++Ae)for(let Ke=0;Ke<$;++Ke){let Xe=Ke-ee,Tt=Math.max(0,Math.ceil(Xe/j)),Vt=Math.min(W,(D+Xe)/j);for(let ln=0;ln<V;++ln){let Bt=ln-X,Rt=Math.max(0,Math.ceil(Bt/Y)),on=Math.min(H,(k+Bt)/Y),Qt=0;for(let Yn=Tt;Yn<Vt;++Yn){let wl=Yn*j-Xe;for(let vo=Rt;vo<on;++vo){let lc=vo*Y-Bt,mi=fe*Oe+le*Yn+ye*vo,_s=b*(D-1-wl)+w*(k-1-lc)+C*Ae;for(let Cl=0;Cl<G;++Cl){let Sl=y[mi+_e*Cl],Il=x[_s+Cl];Qt+=Sl*Il}}}let Ts=re*Oe+oe*Ke+ae*ln+ie*Ae;g[Ts]=Qt}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}var p4={kernelName:Xl,backendName:"cpu",kernelFunc:bye};function wye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r;Q([o,i],"conv3d");let u=S.computeConv3DInfo(o.shape,i.shape,s,l,a),{filterDepth:c,filterHeight:p,filterWidth:f,dilationDepth:d,dilationHeight:h,dilationWidth:m,padInfo:g}=u,y=g.front,x=g.left,b=g.top,w=new mt(u.outShape,o.dtype),C=e.data.get(o.dataId).values,N=e.data.get(i.dataId).values,D=w.values,k=v.computeStrides(o.shape),O=v.computeStrides(i.shape);for(let $=0;$<u.batchSize;++$){let V=$*k[0],G=$*w.strides[0];for(let W=0;W<u.outDepth;++W){let H=G+W*w.strides[1],j=W*u.strideDepth-y;for(let Y=0;Y<c;++Y){let ee=j+Y*d;if(ee<0||ee>=u.inDepth)continue;let X=Y*O[0],te=V+ee*k[1];for(let re=0;re<u.outHeight;++re){let oe=H+re*w.strides[2],ae=re*u.strideHeight-b;for(let ie=0;ie<p;++ie){let fe=ae+ie*h;if(fe<0||fe>=u.inHeight)continue;let le=X+ie*O[1],ye=te+fe*k[2];for(let _e=0;_e<u.outWidth;++_e){let Oe=oe+_e*u.outChannels,Ae=_e*u.strideWidth-x;for(let Ke=0;Ke<f;++Ke){let Xe=Ae+Ke*m;if(Xe<0||Xe>=u.inWidth)continue;let Tt=le+Ke*O[2],Vt=ye+Xe*u.inChannels,ln=Tt;for(let Bt=0;Bt<u.inChannels;++Bt){let Rt=C[Vt+Bt];for(let on=0;on<u.outChannels;++on)D[Oe+on]+=Rt*N[ln+on];ln+=u.outChannels}}}}}}}}return e.makeTensorInfo(w.shape,w.dtype,w.values)}var f4={kernelName:Yl,backendName:"cpu",kernelFunc:wye};function Cye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r;Q([o,i],"conv3dBackpropFilterV2");let u=v.computeStrides(o.shape),c=v.computeStrides(i.shape),p=S.computeConv3DInfo(o.shape,l,s,1,a),f=p.strideDepth,d=p.strideHeight,h=p.strideWidth,m=p.filterDepth,g=p.filterHeight,y=p.filterWidth,x=new mt(p.filterShape,"float32"),b=x.values,[w,C,N,D]=x.strides,k=e.data.get(i.dataId).values,[O,$,V,G]=c,W=e.data.get(o.dataId).values,[H,j,Y,ee]=u,X=p.padInfo.front,te=p.padInfo.left,re=p.padInfo.top;for(let oe=0;oe<m;++oe){let ae=Math.max(0,Math.ceil((X-oe)/f)),ie=Math.min(p.outDepth,(p.inDepth+X-oe)/f),fe=oe*w;for(let le=0;le<g;++le){let ye=Math.max(0,Math.ceil((re-le)/d)),_e=Math.min(p.outHeight,(p.inHeight+re-le)/d),Oe=le*C+fe;for(let Ae=0;Ae<y;++Ae){let Ke=Math.max(0,Math.ceil((te-Ae)/h)),Xe=Math.min(p.outWidth,(p.inWidth+te-Ae)/h),Tt=Ae*N+Oe;for(let Vt=0;Vt<p.inChannels;++Vt){let ln=Vt*D+Tt;for(let Bt=0;Bt<p.outChannels;++Bt){let Rt=0;for(let on=0;on<p.batchSize;++on){let Qt=on*H,Ts=on*O;for(let Yn=ae;Yn<ie;++Yn){let vo=(oe+Yn*f-X)*j+Qt,lc=Yn*$+Ts;for(let mi=ye;mi<_e;++mi){let Cl=(le+mi*d-re)*Y+vo,Sl=mi*V+lc;for(let Il=Ke;Il<Xe;++Il){let jI=(Ae+Il*h-te)*ee+Cl,qI=Il*G+Sl;Rt+=W[jI+Vt]*k[qI+Bt]}}}}b[ln+Bt]=Rt}}}}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}var d4={kernelName:ad,backendName:"cpu",kernelFunc:Cye};function Sye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r;Q([o],"conv3dBackpropInputV2");let u=v.computeStrides(o.shape),c=v.computeStrides(i.shape),p=S.computeConv3DInfo(l,i.shape,a,1,s),f=new mt(p.inShape,"float32"),d=f.values,[h,m,g,y]=f.strides,x=e.data.get(o.dataId).values,[b,w,C,N]=u,D=e.data.get(i.dataId).values,[k,O,$,V]=c,{batchSize:G,filterDepth:W,filterHeight:H,filterWidth:j,inChannels:Y,inDepth:ee,inHeight:X,inWidth:te,outChannels:re,outDepth:oe,outHeight:ae,outWidth:ie,strideDepth:fe,strideHeight:le,strideWidth:ye}=p,_e=W-1-p.padInfo.front,Oe=H-1-p.padInfo.top,Ae=j-1-p.padInfo.left;for(let Ke=0;Ke<G;++Ke)for(let Xe=0;Xe<Y;++Xe)for(let Tt=0;Tt<ee;++Tt){let Vt=Tt-_e,ln=Math.max(0,Math.ceil(Vt/fe)),Bt=Math.min(oe,(W+Vt)/fe);for(let Rt=0;Rt<X;++Rt){let on=Rt-Oe,Qt=Math.max(0,Math.ceil(on/le)),Ts=Math.min(ae,(H+on)/le);for(let Yn=0;Yn<te;++Yn){let wl=Yn-Ae,vo=Math.max(0,Math.ceil(wl/ye)),lc=Math.min(ie,(j+wl)/ye),mi=0;for(let _s=ln;_s<Bt;++_s){let Cl=_s*fe-Vt;for(let Sl=Qt;Sl<Ts;++Sl){let Il=Sl*le-on;for(let sm=vo;sm<lc;++sm){let jI=sm*ye-wl,qI=b*Ke+w*_s+C*Sl+N*sm,oY=k*(W-1-Cl)+O*(H-1-Il)+$*(j-1-jI)+V*Xe;for(let dx=0;dx<re;++dx){let iY=x[qI+dx],sY=D[oY+dx];mi+=iY*sY}}}}d[h*Ke+m*Tt+g*Rt+y*Yn+Xe]=mi}}}return e.makeTensorInfo(f.shape,f.dtype,f.values)}var h4={kernelName:ld,backendName:"cpu",kernelFunc:Sye};var Iye=Te(ta,t=>Math.cos(t)),m4={kernelName:ta,backendName:"cpu",kernelFunc:Iye};var Eye=Te(na,t=>Math.cosh(t)),g4={kernelName:na,backendName:"cpu",kernelFunc:Eye};function Tye(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:u}=r,[c,p,f,d]=o.shape,h=i.shape[0],[m,g]=a,y=ve([h,m,g,d],"float32"),x=e.data.get(i.dataId).values,b=e.data.get(s.dataId).values,w=e.data.get(o.dataId).values,C=v.computeStrides(o.shape),N=v.computeStrides(y.shape);for(let D=0;D<h;D++){let k=D*4,O=x[k],$=x[k+1],V=x[k+2],G=x[k+3],W=b[D];if(W>=c)continue;let H=m>1?(V-O)*(p-1)/(m-1):0,j=g>1?(G-$)*(f-1)/(g-1):0;for(let Y=0;Y<m;Y++){let ee=m>1?O*(p-1)+Y*H:.5*(O+V)*(p-1);if(ee<0||ee>p-1){for(let X=0;X<g;X++)for(let te=0;te<d;te++){let re=te+X*N[2]+Y*N[1]+D*N[0];y.values[re]=u}continue}if(l==="bilinear"){let X=Math.floor(ee),te=Math.ceil(ee),re=ee-X;for(let oe=0;oe<g;oe++){let ae=g>1?$*(f-1)+oe*j:.5*($+G)*(f-1);if(ae<0||ae>f-1){for(let ye=0;ye<d;ye++){let _e=ye+oe*N[2]+Y*N[1]+D*N[0];y.values[_e]=u}continue}let ie=Math.floor(ae),fe=Math.ceil(ae),le=ae-ie;for(let ye=0;ye<d;ye++){let _e=ye+ie*C[2]+X*C[1]+W*C[0],Oe=w[_e];_e=ye+fe*C[2]+X*C[1]+W*C[0];let Ae=w[_e];_e=ye+ie*C[2]+te*C[1]+W*C[0];let Ke=w[_e];_e=ye+fe*C[2]+te*C[1]+W*C[0];let Xe=w[_e],Tt=Oe+(Ae-Oe)*le,Vt=Ke+(Xe-Ke)*le;_e=ye+oe*N[2]+Y*N[1]+D*N[0],y.values[_e]=Tt+(Vt-Tt)*re}}}else for(let X=0;X<g;++X){let te=g>1?$*(f-1)+X*j:.5*($+G)*(f-1);if(te<0||te>f-1){for(let ae=0;ae<d;ae++){let ie=ae+X*N[2]+Y*N[1]+D*N[0];y.values[ie]=u}continue}let re=Math.round(te),oe=Math.round(ee);for(let ae=0;ae<d;ae++){let ie=ae+re*C[2]+oe*C[1]+W*C[0],fe=ae+X*N[2]+Y*N[1]+D*N[0];y.values[fe]=w[ie]}}}}return e.makeTensorInfo(y.shape,y.dtype,y.values)}var y4={kernelName:cd,backendName:"cpu",kernelFunc:Tye};function _ye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r;Q(o,"cumprod");let l=S.getAxesPermutation([i],o.shape.length),u=o;l!=null&&(u=Ht({inputs:{x:o},backend:e,attrs:{perm:l}}));let c=S.getInnerMostAxes(1,o.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);let p=un(u.dtype,"int32"),f=v.makeOnesTypedArray(v.sizeFromShape(u.shape),p),d=e.data.get(u.dataId).values,h=u.shape[u.shape.length-1],m=a?(y,x)=>y+h-x-1:(y,x)=>y+x;for(let y=0;y<d.length;y+=h)for(let x=0;x<h;x++){let b=m(y,x);if(x===0)f[b]=s?1:d[b];else{let w=m(y,x-1);f[b]=s?d[w]*f[w]:d[b]*f[w]}}let g=e.makeTensorInfo(u.shape,p,f);if(l!=null){let y=S.getUndoAxesPermutation(l),x=Ht({inputs:{x:g},backend:e,attrs:{perm:y}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(u),x}return g}var x4={kernelName:ud,backendName:"cpu",kernelFunc:_ye};function Nye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r;Q(o,"cumsum");let l=S.getAxesPermutation([i],o.shape.length),u=o;l!=null&&(u=Ht({inputs:{x:o},backend:e,attrs:{perm:l}}));let c=S.getInnerMostAxes(1,o.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);let p=un(u.dtype,"int32"),f=v.makeZerosTypedArray(v.sizeFromShape(u.shape),p),d=e.data.get(u.dataId).values,h=u.shape[u.shape.length-1],m=a?(y,x)=>y+h-x-1:(y,x)=>y+x;for(let y=0;y<d.length;y+=h)for(let x=0;x<h;x++){let b=m(y,x);if(x===0)f[b]=s?0:d[b];else{let w=m(y,x-1);f[b]=s?d[w]+f[w]:d[b]+f[w]}}let g=e.makeTensorInfo(u.shape,p,f);if(l!=null){let y=S.getUndoAxesPermutation(l),x=Ht({inputs:{x:g},backend:e,attrs:{perm:y}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(u),x}return g}var v4={kernelName:Zl,backendName:"cpu",kernelFunc:Nye};function Dye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.data.get(o.dataId).values,u=e.data.get(i.dataId).values,c=kh(l,u,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}else if(o.shape.length===2){let l=e.bufferSync(o),u=e.bufferSync(i),c=qw(l,u,s,a);return e.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var b4={kernelName:pd,backendName:"cpu",kernelFunc:Dye};function kye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;v.assert(s==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`);let a=o.shape[0],l=o.shape[1],u=o.shape[2],c=o.shape[3],p=l*i,f=u*i,d=c/(i*i),h=e.data.get(o.dataId).values,m=new Float32Array(a*p*f*d),g=0;for(let y=0;y<a;++y)for(let x=0;x<p;++x){let b=Math.floor(x/i),w=x%i;for(let C=0;C<f;++C){let N=Math.floor(C/i),D=C%i,k=(w*i+D)*d;for(let O=0;O<d;++O){let V=O+k+c*(N+u*(b+l*y));m[g++]=h[V]}}}return e.makeTensorInfo([a,p,f,d],o.dtype,m)}var w4={kernelName:fd,backendName:"cpu",kernelFunc:kye};function BA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:u}=r;Q([o,i],"depthwiseConv2DNative");let c=v.computeStrides(o.shape),p=v.computeStrides(i.shape),f=l;f==null&&(f=[1,1]),v.assert(S.eitherStridesOrDilationsAreOne(s,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${f}'`);let d=S.computeConv2DInfo(o.shape,i.shape,s,f,a,u,!0),{filterHeight:h,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:x}=d,b=x.left,w=x.top,C=d.outChannels/d.inChannels,N=new mt(d.outShape,o.dtype),D=e.data.get(o.dataId).values,k=e.data.get(i.dataId).values,O=N.values;for(let $=0;$<d.batchSize;++$){let V=$*c[0],G=$*N.strides[0];for(let W=0;W<d.outHeight;++W){let H=G+W*N.strides[1],j=W*d.strideHeight-w;for(let Y=0;Y<h;++Y){let ee=j+Y*g;if(ee<0||ee>=d.inHeight)continue;let X=Y*p[0],te=V+ee*c[1];for(let re=0;re<d.outWidth;++re){let oe=H+re*N.strides[2],ae=re*d.strideWidth-b;for(let ie=0;ie<m;++ie){let fe=ae+ie*y;if(fe<0||fe>=d.inWidth)continue;let le=X+ie*p[1],ye=te+fe*d.inChannels,_e=oe,Oe=le;for(let Ae=0;Ae<d.inChannels;++Ae){let Ke=D[ye+Ae];for(let Xe=0;Xe<C;++Xe)O[_e+Xe]+=Ke*k[Oe+Xe];_e+=C,Oe+=C}}}}}}return e.makeTensorInfo(N.shape,N.dtype,N.values)}var C4={kernelName:Ql,backendName:"cpu",kernelFunc:BA};function Aye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=r;Q([o,i],"depthwiseConv2dNativeBackpropFilter");let p=S.computeConv2DInfo(o.shape,c,s,a,l,u,!0),{strideHeight:f,strideWidth:d,filterHeight:h,filterWidth:m}=p,g=new mt(p.filterShape,"float32"),y=p.padInfo.left,x=p.padInfo.top,b=p.outChannels/p.inChannels,w=e.data.get(o.dataId).values,C=new mt(o.shape,o.dtype,w),N=e.data.get(i.dataId).values,D=new mt(i.shape,i.dtype,N);for(let k=0;k<h;++k){let O=Math.max(0,Math.ceil((x-k)/f)),$=Math.min(p.outHeight,(p.inHeight+x-k)/f);for(let V=0;V<m;++V){let G=Math.max(0,Math.ceil((y-V)/d)),W=Math.min(p.outWidth,(p.inWidth+y-V)/d);for(let H=0;H<p.outChannels;++H){let j=Math.trunc(H/b),Y=H%b,ee=0;for(let X=0;X<p.batchSize;++X)for(let te=O;te<$;++te){let re=k+te*f-x;for(let oe=G;oe<W;++oe){let ae=V+oe*d-y;ee+=C.get(X,re,ae,j)*D.get(X,te,oe,H)}}g.set(ee,k,V,j,Y)}}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}var S4={kernelName:dd,backendName:"cpu",kernelFunc:Aye};function Rye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=r;Q([o,i],"depthwiseConv2DNativeBackpropInput");let p=v.computeStrides(o.shape),f=v.computeStrides(i.shape),d=S.computeConv2DInfo(c,i.shape,s,a,l,u,!0),h=new mt(d.inShape,"float32"),m=h.values,[g,y,x]=h.strides,b=e.data.get(o.dataId).values,[w,C,N]=p,D=e.data.get(i.dataId).values,[k,O,$]=f,{batchSize:V,filterHeight:G,filterWidth:W,inChannels:H,inHeight:j,inWidth:Y,outChannels:ee,outHeight:X,outWidth:te,strideHeight:re,strideWidth:oe}=d,ae=G-1-d.padInfo.top,ie=W-1-d.padInfo.left,fe=ee/H;for(let le=0;le<V;++le)for(let ye=0;ye<H;++ye)for(let _e=0;_e<j;++_e){let Oe=_e-ae,Ae=Math.max(0,Math.ceil(Oe/re)),Ke=Math.min(X,(G+Oe)/re);for(let Xe=0;Xe<Y;++Xe){let Tt=Xe-ie,Vt=Math.max(0,Math.ceil(Tt/oe)),ln=Math.min(te,(W+Tt)/oe),Bt=0;for(let Rt=Ae;Rt<Ke;++Rt){let on=Rt*re-Oe;for(let Qt=Vt;Qt<ln;++Qt){let Ts=Qt*oe-Tt,Yn=w*le+C*Rt+N*Qt,wl=k*(G-1-on)+O*(W-1-Ts)+$*ye;for(let vo=0;vo<fe;++vo){let lc=ye*fe+vo,mi=b[Yn+lc],_s=D[wl+vo];Bt+=mi*_s}}}m[g*le+y*_e+x*Xe+ye]=Bt}}return e.makeTensorInfo(h.shape,h.dtype,h.values)}var I4={kernelName:hd,backendName:"cpu",kernelFunc:Rye};function Mye(t){let{inputs:n,backend:e}=t,{x:r}=n,o=v.sizeFromShape(r.shape),i=e.data.get(r.dataId).values,s=ve([o,o],r.dtype),a=s.values;for(let u=0;u<i.length;u++)a[u*o+u]=i[u];let l=[...r.shape,...r.shape];return e.makeTensorInfo(l,s.dtype,s.values)}var E4={kernelName:Lb,backendName:"cpu",kernelFunc:Mye};var T4={kernelName:Jl,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o}=t,{strides:i,pad:s,dilations:a}=e,l=n,u=l.data.get(r.dataId).values,c=r.shape.length,p=l.data.get(o.dataId).values,f=o.shape.length,{batchSize:d,inHeight:h,inWidth:m,inChannels:g,outHeight:y,outWidth:x,padInfo:b,strideHeight:w,strideWidth:C,filterHeight:N,filterWidth:D,dilationHeight:k,dilationWidth:O,outShape:$}=S.computeDilation2DInfo(r.shape,o.shape,i,s,"NHWC",a),V=v.sizeFromShape($),G=$.length,W=v.getArrayFromDType(r.dtype,V);for(let j=0;j<d;++j)for(let Y=0;Y<y;++Y){let ee=Y*w-b.top;for(let X=0;X<x;++X){let te=X*C-b.left;for(let re=0;re<g;++re){let oe=Number.MIN_SAFE_INTEGER;for(let ie=0;ie<N;++ie){let fe=ee+ie*k;if(fe>=0&&fe<h)for(let le=0;le<D;++le){let ye=te+le*O;if(ye>=0&&ye<m){let _e=v.locToIndex([j,fe,ye,re],c,v.computeStrides(r.shape)),Oe=v.locToIndex([ie,le,re],f,v.computeStrides(o.shape)),Ae=u[_e]+p[Oe];Ae>oe&&(oe=Ae)}}}let ae=v.locToIndex([j,Y,X,re],G,v.computeStrides($));W[ae]=oe}}}return{dataId:l.write(v.toTypedArray(W,r.dtype),$,r.dtype),shape:$,dtype:r.dtype}}};var _4={kernelName:_g,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,u=n,c=v.toNestedArray(r.shape,u.data.get(r.dataId).values),p=v.toNestedArray(o.shape,u.data.get(o.dataId).values),{batchSize:f,inHeight:d,inWidth:h,inChannels:m,outHeight:g,outWidth:y,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:C,filterWidth:N,dilationHeight:D,dilationWidth:k,outShape:O}=S.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);v.assert(i.rank===O.length,()=>`Error in ${_g}, dy must have the same rank as output ${O.length}, but got ${i.rank}`);let $=v.toNestedArray(O,u.data.get(i.dataId).values),V=v.makeZerosNestedTypedArray(o.shape,o.dtype);for(let W=0;W<f;++W)for(let H=0;H<g;++H){let j=H*b-x.top;for(let Y=0;Y<y;++Y){let ee=Y*w-x.left;for(let X=0;X<m;++X){let te=Number.MIN_SAFE_INTEGER,re=0,oe=0;for(let ae=0;ae<C;++ae){let ie=j+ae*D;if(ie>=0&&ie<d)for(let fe=0;fe<N;++fe){let le=ee+fe*k;if(le>=0&&le<h){let ye=c[W][ie][le][X]+p[ae][fe][X];ye>te&&(te=ye,re=ae,oe=fe)}}}V[re][oe][X]+=$[W][H][Y][X]}}}return{dataId:u.write(v.toTypedArray(V,r.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};var N4={kernelName:Tg,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,u=n,c=v.toNestedArray(r.shape,u.data.get(r.dataId).values),p=v.toNestedArray(o.shape,u.data.get(o.dataId).values),{batchSize:f,inHeight:d,inWidth:h,inChannels:m,outHeight:g,outWidth:y,padInfo:x,strideHeight:b,strideWidth:w,filterHeight:C,filterWidth:N,dilationHeight:D,dilationWidth:k,outShape:O}=S.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);v.assert(i.rank===O.length,()=>`Error in ${Tg}, dy must have the same rank as output ${O.length}, but got ${i.rank}`);let $=v.toNestedArray(O,u.data.get(i.dataId).values),V=v.makeZerosNestedTypedArray(r.shape,r.dtype);for(let W=0;W<f;++W)for(let H=0;H<g;++H){let j=H*b-x.top;for(let Y=0;Y<y;++Y){let ee=Y*w-x.left;for(let X=0;X<m;++X){let te=Number.MIN_SAFE_INTEGER,re=j<0?0:j,oe=ee<0?0:ee;for(let ae=0;ae<C;++ae){let ie=j+ae*D;if(ie>=0&&ie<d)for(let fe=0;fe<N;++fe){let le=ee+fe*k;if(le>=0&&le<h){let ye=c[W][ie][le][X]+p[ae][fe][X];ye>te&&(te=ye,re=ie,oe=le)}}}V[W][re][oe][X]+=$[W][H][Y][X]}}}return{dataId:u.write(v.toTypedArray(V,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function Oye(t){let{inputs:n,backend:e,attrs:r}=t,{image:o}=n,{canvas:i,options:s}=r,{contextOptions:a,imageOptions:l}=s||{},u=l?.alpha||1,c=a?.contextType||"2d";if(c!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);let p=i.getContext(c,a?.contextAttributes||{});if(p==null)throw new Error(`Could not get the context with ${c} type.`);let[f,d]=o.shape.slice(0,2),h=o.shape.length===2?1:o.shape[2],m=e.data.get(o.dataId).values,g=o.dtype==="float32"?255:1,y=new Uint8ClampedArray(d*f*4);for(let b=0;b<f*d;++b){let w=[0,0,0,255*u];for(let N=0;N<h;N++){let D=m[b*h+N];if(o.dtype==="float32"){if(D<0||D>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${D}.`)}else if(o.dtype==="int32"&&(D<0||D>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${D}.`);h===1?(w[0]=D*g,w[1]=D*g,w[2]=D*g):w[N]=D*g}let C=b*4;y[C+0]=Math.round(w[0]),y[C+1]=Math.round(w[1]),y[C+2]=Math.round(w[2]),y[C+3]=Math.round(w[3])}i.width=d,i.height=f;let x=new ImageData(y,d,f);return p.putImageData(x,0,0),o}var D4={kernelName:zP,backendName:"cpu",kernelFunc:Oye};function sl(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Q(o,"sum");let a;o.dtype==="bool"?a=pi({inputs:{x:o},backend:e,attrs:{dtype:"int32"}}):a=rr({inputs:{x:o},backend:e});let l=a.shape.length,u=v.parseAxisParam(i,a.shape),c=S.getAxesPermutation(u,l),p=u,f=a;c!=null&&(f=Ht({inputs:{x:a},backend:e,attrs:{perm:c}}),p=S.getInnerMostAxes(p.length,l)),S.assertAxesAreInnerMostDims("sum",p,f.shape.length);let[d,h]=S.computeOutAndReduceShapes(f.shape,p),m=S.upcastType(f.dtype,"int32"),g=Nh(e,d,m),y=v.sizeFromShape(h),x=e.data.get(g.dataId).values,b=e.data.get(f.dataId).values;for(let w=0;w<x.length;++w){let C=w*y,N=0;for(let D=0;D<y;++D)N+=b[C+D];x[w]=N}if(s){let w=S.expandShapeToKeepDim(g.shape,u),C=g;g=ze({inputs:{x:g},backend:e,attrs:{shape:w}}),e.disposeIntermediateTensorInfo(C)}return e.disposeIntermediateTensorInfo(a),c!=null&&e.disposeIntermediateTensorInfo(f),g}var k4={kernelName:Iu,backendName:"cpu",kernelFunc:sl};function Fye(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=S.decodeEinsumEquation(o,i.length);S.checkEinsumDimSizes(s.length,l,i);let{path:u,steps:c}=S.getEinsumComputePath(a,l),p=c.length,f=null,d=s.length,h=[];for(let m=0;m<p;++m){for(let g of c[m]){let{permutationIndices:y,expandDims:x}=S.getEinsumPermutation(d,l[g]),b;S.isIdentityPermutation(y)?b=i[g]:(b=Ht({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),h.push(b));let w=b.shape.slice();for(let C=0;C<x.length;++C)w.splice(x[C],0,1);v.arraysEqual(b.shape,w)||(b=ze({inputs:{x:b},backend:e,attrs:{shape:w}}),h.push(b)),f===null?f=b:(f=kp({inputs:{a:b,b:f},backend:e}),h.push(f))}m<p-1&&(u[m]>=0&&(f=sl({inputs:{x:f},backend:e,attrs:{axis:u[m]-(s.length-d),keepDims:!1}}),h.push(f)),d--)}for(let m of h)m!==f&&e.disposeIntermediateTensorInfo(m);return f}var A4={kernelName:md,backendName:"cpu",kernelFunc:Fye};function $ye(t){let{inputs:n,backend:e}=t,{dy:r,y:o}=n;Q([r,o],"eluGrad");let i=new Float32Array(v.sizeFromShape(o.shape)),s=e.data.get(o.dataId).values,a=e.data.get(r.dataId).values;for(let l=0;l<s.length;++l){let u=s[l];u>=0?i[l]=a[l]:i[l]=a[l]*(u+1)}return e.makeTensorInfo(o.shape,"float32",i)}var R4={kernelName:gd,backendName:"cpu",kernelFunc:$ye};var Pye=S.ERF_P,Lye=S.ERF_A1,Vye=S.ERF_A2,Bye=S.ERF_A3,zye=S.ERF_A4,Uye=S.ERF_A5,Gye=Te(ia,t=>{let n=Math.sign(t),e=Math.abs(t),r=1/(1+Pye*e);return n*(1-((((Uye*r+zye)*r+Bye)*r+Vye)*r+Lye)*r*Math.exp(-e*e))}),M4={kernelName:ia,backendName:"cpu",kernelFunc:Gye};function Oh(t){let{inputs:n,backend:e,attrs:r}=t,{input:o}=n,{dim:i}=r,s=o.shape.length,a=o.shape.slice(),l=i;return i<0&&(v.assert(-(s+1)<=i,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+i+1),a.splice(l,0,1),ze({inputs:{x:o},backend:e,attrs:{shape:a}})}var O4={kernelName:eu,backendName:"cpu",kernelFunc:Oh};var Wye=Be((t,n)=>t/n),Ty=et(ra,Wye),_y={kernelName:ra,backendName:"cpu",kernelFunc:Ty};function hC(t,n,e){let r=t.shape,o=r[0],i=r[1],s=e.data.get(t.dataId),a=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,u=[o,i],c=v.sizeFromShape(u),p=v.getTypedArrayFromDType("float32",c),f=v.getTypedArrayFromDType("float32",c);for(let g=0;g<o;g++){let y=di({inputs:{x:a},backend:e,attrs:{begin:[g,0],size:[1,i]}}),x=di({inputs:{x:l},backend:e,attrs:{begin:[g,0],size:[1,i]}}),b=wn({inputs:{real:y,imag:x},backend:e}),{real:w,imag:C}=Hye(b,n,e),N=S.mergeRealAndImagArrays(w,C);for(let D=0;D<i;D++){let k=S.getComplexWithIndex(N,D);p[g*i+D]=k.real,f[g*i+D]=k.imag}e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b)}let d=e.makeTensorInfo(u,"float32",p),h=e.makeTensorInfo(u,"float32",f),m=wn({inputs:{real:d,imag:h},backend:e});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(h),m}function Hye(t,n,e){let r=v.sizeFromShape(t.shape),o=e.data.get(t.dataId),i=e.data.get(o.complexTensorInfos.real.dataId).values,s=e.data.get(o.complexTensorInfos.imag.dataId).values;if(jye(r)){let a=zA(i,s,r,n,e),l=[t.shape[0],t.shape[1]];if(n){let u=e.makeTensorInfo(l,"float32",a.real),c=e.makeTensorInfo(l,"float32",a.imag),p=e.makeTensorInfo([],"float32",v.createScalarValue(r,"float32")),f=rr({inputs:{x:p},backend:e}),d=_y.kernelFunc({inputs:{a:u,b:p},backend:e}),h=_y.kernelFunc({inputs:{a:c,b:f},backend:e}),m=e.data.get(d.dataId).values,g=e.data.get(h.dataId).values;return e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(h),{real:m,imag:g}}return a}else{let a=S.mergeRealAndImagArrays(i,s),l=qye(a,r,n);return S.splitRealAndImagArrays(l)}}function jye(t){return(t&t-1)===0}function zA(t,n,e,r,o){if(e===1)return{real:t,imag:n};let i=S.mergeRealAndImagArrays(t,n),s=e/2,a=S.complexWithEvenIndex(i),l=a.real,u=a.imag,c=[l.length],p=o.makeTensorInfo(c,"float32",l),f=o.makeTensorInfo(c,"float32",u),d=wn({inputs:{real:p,imag:f},backend:o}),h=S.complexWithOddIndex(i),m=h.real,g=h.imag,y=[m.length],x=o.makeTensorInfo(y,"float32",m),b=o.makeTensorInfo(y,"float32",g),w=wn({inputs:{real:x,imag:b},backend:o}),C=zA(l,u,s,r,o),N=C.real,D=C.imag,k=[N.length],O=o.makeTensorInfo(k,"float32",N),$=o.makeTensorInfo(k,"float32",D),V=wn({inputs:{real:O,imag:$},backend:o}),G=zA(m,g,s,r,o),W=G.real,H=G.imag,j=[W.length],Y=o.makeTensorInfo(j,"float32",W),ee=o.makeTensorInfo(j,"float32",H),X=wn({inputs:{real:Y,imag:ee},backend:o}),te=S.exponents(e,r),re=[te.real.length],oe=o.makeTensorInfo(re,"float32",te.real),ae=o.makeTensorInfo(re,"float32",te.imag),ie=wn({inputs:{real:oe,imag:ae},backend:o}),fe=kp({inputs:{a:ie,b:X},backend:o}),le=vs({inputs:{a:V,b:fe},backend:o}),ye=Iy({inputs:{a:V,b:fe},backend:o}),_e=ci({inputs:{input:le},backend:o}),Oe=ci({inputs:{input:ye},backend:o}),Ae=bs({inputs:{input:le},backend:o}),Ke=bs({inputs:{input:ye},backend:o}),Xe=qu({inputs:[_e,Oe],backend:o,attrs:{axis:0}}),Tt=qu({inputs:[Ae,Ke],backend:o,attrs:{axis:0}}),Vt=o.data.get(Xe.dataId).values,ln=o.data.get(Tt.dataId).values;return o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(x),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo($),o.disposeIntermediateTensorInfo(V),o.disposeIntermediateTensorInfo(Y),o.disposeIntermediateTensorInfo(ee),o.disposeIntermediateTensorInfo(X),o.disposeIntermediateTensorInfo(oe),o.disposeIntermediateTensorInfo(ae),o.disposeIntermediateTensorInfo(ie),o.disposeIntermediateTensorInfo(fe),o.disposeIntermediateTensorInfo(le),o.disposeIntermediateTensorInfo(ye),o.disposeIntermediateTensorInfo(_e),o.disposeIntermediateTensorInfo(Ae),o.disposeIntermediateTensorInfo(Oe),o.disposeIntermediateTensorInfo(Ke),o.disposeIntermediateTensorInfo(Xe),o.disposeIntermediateTensorInfo(Tt),{real:Vt,imag:ln}}function qye(t,n,e){let r=new Float32Array(n*2);for(let o=0;o<n;o++){let i=0,s=0;for(let a=0;a<n;a++){let l=S.exponent(o*a,n,e),u=S.getComplexWithIndex(t,a);i+=u.real*l.real-u.imag*l.imag,s+=u.real*l.imag+u.imag*l.real}e&&(i/=n,s/=n),S.assignToTypedArray(r,i,s,o)}return r}function Kye(t){let{inputs:n,backend:e}=t,{input:r}=n,o=v.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=ze({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=hC(a,!1,e),u=ze({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),u}var F4={kernelName:yd,backendName:"cpu",kernelFunc:Kye};function Ny(t){let{backend:n,attrs:e}=t,{shape:r,value:o,dtype:i}=e,s=i||v.inferDtype(o),a=v.getArrayFromDType(s,v.sizeFromShape(r));return Xye(a,o,s),n.makeTensorInfo(r,s,a)}var $4={kernelName:xd,backendName:"cpu",kernelFunc:Ny};function Xye(t,n,e){t.fill(n)}var P4={kernelName:vd,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,o=e,i=v.getTypedArrayFromDType(r.dtype,v.sizeFromShape(r.shape)),[s,a,l,u]=r.shape,c=o.data.get(r.dataId).values;for(let f=0;f<s;f++){let d=f*l*a*u;for(let h=0;h<a;h++){let m=h*(l*u);for(let g=0;g<l;g++){let y=g*u;for(let x=0;x<u;x++){let b=Math.round(l-g-1),w=d+m+y+x,C=c[w];if(b>=0&&b<l){let N=b*u,D=d+m+N+x;C=c[D]}i[w]=C}}}}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function Yye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f,activation:d,leakyreluAlpha:h}=r,m=VA({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f}});if(s){let g=m;if(c==="NCHW"&&s.shape.length===1&&s.shape[0]!==1){let y=ze({inputs:{x:s},backend:e,attrs:{shape:[s.shape[0],1,1]}});m=vs({inputs:{a:m,b:y},backend:e}),e.disposeIntermediateTensorInfo(y)}else m=vs({inputs:{a:m,b:s},backend:e});e.disposeIntermediateTensorInfo(g)}if(d){let g=m;if(c==="NCHW"&&d==="prelu"&&a.shape.length===1&&a.shape[0]!==1){let y=ze({inputs:{x:a},backend:e,attrs:{shape:[a.shape[0],1,1]}});m=Ap(e,m,d,y,h),e.disposeIntermediateTensorInfo(y)}else m=Ap(e,m,d,a,h);e.disposeIntermediateTensorInfo(g)}return m}var L4={kernelName:qc,backendName:"cpu",kernelFunc:Yye};function Zye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f,activation:d,leakyreluAlpha:h}=r,m=BA({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f}});if(s){let g=m;m=vs({inputs:{a:m,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(d){let g=m;m=Ap(e,m,d,a,h),e.disposeIntermediateTensorInfo(g)}return m}var V4={kernelName:Kc,backendName:"cpu",kernelFunc:Zye};function Qye(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=v.sizeFromShape(r.shape),s=o.shape,a=s[s.length-1],[l,u,c,p]=S.prepareAndValidate(r,o);if(u===0)return e.makeTensorInfo(l,r.dtype,[]);let f=e.data.get(o.dataId).values,d=e.bufferSync(r),h=Xw(f,d,r.dtype,u,a,c,p,r.shape,i);return e.makeTensorInfo(l,r.dtype,h.values)}var B4={kernelName:Vb,backendName:"cpu",kernelFunc:Qye};function Jye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r;Q([o,i],"gatherV2");let l=v.parseAxisParam(s,o.shape)[0],u=e.data.get(i.dataId).values,c=o.shape[l];for(let w=0;w<u.length;++w){let C=u[w];v.assert(C<=c-1&&C>=0,()=>`GatherV2: the index value ${C} is not in [0, ${c-1}]`)}let p=a;a==null&&(p=0);let f=v.sizeFromShape(i.shape),d=S.segment_util.collectGatherOpShapeInfo(o,i,l,p),h=ze({inputs:{x:o},backend:e,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),m=ze({inputs:{x:i},backend:e,attrs:{shape:[d.batchSize,f/d.batchSize]}}),g=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize],y=e.bufferSync(m),x=e.bufferSync(h),b=Yw(x,y,g);return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(m),e.makeTensorInfo(d.outputShape,b.dtype,b.values)}var z4={kernelName:nu,backendName:"cpu",kernelFunc:Jye};function exe(t){let{inputs:n,backend:e}=t,{input:r}=n,o=v.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=ze({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=hC(a,!0,e),u=ze({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),u}var U4={kernelName:bd,backendName:"cpu",kernelFunc:exe};var txe=Te(pa,t=>Number.isFinite(t)?1:0,"bool"),G4={kernelName:pa,backendName:"cpu",kernelFunc:txe};var nxe=Te(fa,t=>Math.abs(t)===1/0?1:0,"bool"),W4={kernelName:fa,backendName:"cpu",kernelFunc:nxe};var rxe=Te(da,t=>Number.isNaN(t)?1:0,"bool"),H4={kernelName:da,backendName:"cpu",kernelFunc:rxe};function oxe(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=Zw(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var j4={kernelName:Bb,backendName:"cpu",kernelFunc:oxe};var ixe=Te(ma,t=>Math.log1p(t)),q4={kernelName:ma,backendName:"cpu",kernelFunc:ixe};var sxe=Be((t,n)=>t&&n),axe=et(Uc,sxe,null,"bool"),K4={kernelName:Uc,backendName:"cpu",kernelFunc:axe};var lxe=Te(Gc,t=>t?0:1,"bool"),X4={kernelName:Gc,backendName:"cpu",kernelFunc:lxe};var uxe=Be((t,n)=>t||n),cxe=et(Wc,uxe,null,"bool"),Y4={kernelName:Wc,backendName:"cpu",kernelFunc:cxe};function pxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r;Q(o,"LRN");let u=o.shape[3],c=u-1,p=e.data.get(o.dataId).values,f=v.sizeFromShape(o.shape),d=new Float32Array(f);function h(m){let g=m%u,y=m-g+Math.max(0,g-i),x=m-g+Math.min(g+i,c),b=0;for(;y<=x;y++){let w=p[y];b+=w*w}return b}for(let m=0;m<f;m++){let g=h(m),y=p[m]*Math.pow(s+a*g,-l);d[m]=y}return e.makeTensorInfo(o.shape,o.dtype,d)}var Z4={kernelName:ou,backendName:"cpu",kernelFunc:pxe};function fxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:u,beta:c}=r;Q(s,"LRNGrad");let p=v.sizeFromShape(s.shape),f=s.shape[3],d=e.data.get(s.dataId).values,h=e.data.get(o.dataId).values,m=e.data.get(i.dataId).values,g=new Float32Array(p),y=p;for(let x=0;x<y;x++){let b=x%f,w=x-b+Math.max(0,b-a),C=x-b+Math.min(f,b+a+1),N=0;for(let D=w;D<C;D++)N+=Math.pow(h[D],2);N=u*N+l;for(let D=w;D<C;D++){let k=-2*u*c*h[D]*m[x]/N;x===D&&(k+=Math.pow(N,-c)),k*=d[x],g[D]+=k}}return e.makeTensorInfo(s.shape,o.dtype,g)}var Q4={kernelName:Cd,backendName:"cpu",kernelFunc:fxe};function UA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=e,l=o.shape,u=l.length,c=v.parseAxisParam(i,l),p=c,f=S.getAxesPermutation(p,u),d=a.data.get(o.dataId).values;if(f!=null){let w=new Array(u);for(let C=0;C<w.length;C++)w[C]=l[f[C]];d=Ah(d,l,o.dtype,f,w),p=S.getInnerMostAxes(p.length,u),l=w}Q(o,"max"),S.assertAxesAreInnerMostDims("max",p,u);let[h,m]=S.computeOutAndReduceShapes(l,p),g=v.sizeFromShape(m),y=Qw(d,g,h,o.dtype),x=a.write(y,h,o.dtype),b=h;return s&&(b=S.expandShapeToKeepDim(h,c)),{dataId:x,shape:b,dtype:o.dtype}}var J4={kernelName:iu,backendName:"cpu",kernelFunc:UA};function dxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Q(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,u=1;v.assert(S.eitherStridesOrDilationsAreOne(s,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let c=S.computePool2DInfo(o.shape,i,s,u,a,l),p;if(c.filterWidth===1&&c.filterHeight===1&&v.arraysEqual(c.inShape,c.outShape))p=rr({inputs:{x:o},backend:e});else{let f=e.data.get(o.dataId).values,d=v.computeStrides(o.shape),h=Mh(f,o.shape,o.dtype,d,c,"max");p=e.makeTensorInfo(c.outShape,o.dtype,h.values)}return p}var eW={kernelName:su,backendName:"cpu",kernelFunc:dxe};function hxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:u}=r;Q(o,"maxPool3d");let c=S.computePool3DInfo(o.shape,i,s,1,a,l,u),p=e.data.get(o.dataId).values,f=dC(p,o.shape,o.dtype,v.computeStrides(o.shape),c,"max");return e.makeTensorInfo(f.shape,"float32",f.values)}var tW={kernelName:au,backendName:"cpu",kernelFunc:hxe};function mxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:u}=r;Q([o,i],"maxPool3DGrad");let c=S.computePool3DInfo(i.shape,s,a,1,l,u),p=e.bufferSync(i),f=YG(p,c),d=c.strideDepth,h=c.strideHeight,m=c.strideWidth,g=c.dilationDepth,y=c.dilationHeight,x=c.dilationWidth,b=c.effectiveFilterDepth,w=c.effectiveFilterHeight,C=c.effectiveFilterWidth,N=b-1-c.padInfo.front,D=C-1-c.padInfo.left,k=w-1-c.padInfo.top,O=ve(i.shape,"float32"),$=e.bufferSync(o);for(let V=0;V<c.batchSize;++V)for(let G=0;G<c.inChannels;++G)for(let W=0;W<c.inDepth;++W)for(let H=0;H<c.inHeight;++H)for(let j=0;j<c.inWidth;++j){let Y=W-N,ee=H-k,X=j-D,te=0;for(let re=0;re<b;re+=g){let oe=(Y+re)/d;if(!(oe<0||oe>=c.outDepth||Math.floor(oe)!==oe))for(let ae=0;ae<w;ae+=y){let ie=(ee+ae)/h;if(!(ie<0||ie>=c.outHeight||Math.floor(ie)!==ie))for(let fe=0;fe<C;fe+=x){let le=(X+fe)/m;if(le<0||le>=c.outWidth||Math.floor(le)!==le)continue;let ye=b*w*C-1-f.get(V,oe,ie,le,G),_e=re*w*C+ae*C+fe,Oe=ye===_e?1:0;if(Oe===0)continue;let Ae=$.get(V,oe,ie,le,G);te+=Ae*Oe}}}O.set(te,V,W,H,j,G)}return e.makeTensorInfo(O.shape,O.dtype,O.values)}var nW={kernelName:Id,backendName:"cpu",kernelFunc:mxe};function gxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;Q([i,s],"maxPoolGrad");let{filterSize:l,strides:u,pad:c,dimRoundingMode:p}=r,f=S.computePool2DInfo(a.shape,l,u,1,c,p),d=e.data.get(a.dataId).values,h=ve(f.outShape,a.dtype,fC(d,a.shape,a.dtype,f).values),m=f.strideHeight,g=f.strideWidth,y=f.dilationHeight,x=f.dilationWidth,b=f.effectiveFilterHeight,w=f.effectiveFilterWidth,C=w-1-f.padInfo.left,N=b-1-f.padInfo.top,D=ve(a.shape,"float32"),k=e.data.get(o.dataId).values,O=ve(o.shape,"float32",k);for(let $=0;$<f.batchSize;++$)for(let V=0;V<f.inChannels;++V)for(let G=0;G<f.inHeight;++G)for(let W=0;W<f.inWidth;++W){let H=G-N,j=W-C,Y=0;for(let ee=0;ee<b;ee+=y){let X=(H+ee)/m;if(!(X<0||X>=f.outHeight||Math.floor(X)!==X))for(let te=0;te<w;te+=x){let re=(j+te)/g;if(re<0||re>=f.outWidth||Math.floor(re)!==re)continue;let oe=b*w-1-h.get($,X,re,V),ae=ee*w+te,ie=oe===ae?1:0;if(ie===0)continue;let fe=O.get($,X,re,V);Y+=fe*ie}}D.set(Y,$,G,W,V)}return e.makeTensorInfo(D.shape,D.dtype,D.values)}var rW={kernelName:Sd,backendName:"cpu",kernelFunc:gxe};function oW(t,n,e,r,o){let i=v.computeStrides(n),s=Mh(t,n,e,i,o,"max"),a=fC(t,n,e,o,!0,r);return[s.values,a.values]}var iW={kernelName:zb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;Q(r,"MaxPoolWithArgmax");let u=l.data.get(r.dataId).values,c=S.computePool2DInfo(r.shape,o,i,[1,1],s),[p,f]=oW(u,r.shape,r.dtype,a,c),d=l.write(p,c.outShape,r.dtype),h=l.write(f,c.outShape,r.dtype);return[{dataId:d,shape:c.outShape,dtype:r.dtype},{dataId:h,shape:c.outShape,dtype:"int32"}]}};function yxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=v.parseAxisParam(i,o.shape),u=S.computeOutAndReduceShapes(o.shape,a)[1],c=v.sizeFromShape(u),p=[],f=e.makeTensorInfo([],"float32",new Float32Array([c]));p.push(f);let d=pi({inputs:{x:o},backend:e,attrs:{dtype:"float32"}});p.push(d);let h=Ty({inputs:{a:d,b:f},backend:e});p.push(h);let m=sl({inputs:{x:h},backend:e,attrs:{axis:i,keepDims:s}});return p.forEach(g=>e.disposeIntermediateTensorInfo(g)),m}var sW={kernelName:lu,backendName:"cpu",kernelFunc:yxe};function xxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Q(o,"min");let a=v.parseAxisParam(i,o.shape),l=a,u=S.getAxesPermutation(l,o.shape.length),c=o;u!=null&&(c=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),l=S.getInnerMostAxes(l.length,o.shape.length)),S.assertAxesAreInnerMostDims("min",l,c.shape.length);let[p,f]=S.computeOutAndReduceShapes(c.shape,l),d=v.sizeFromShape(f),h=v.makeZerosTypedArray(v.sizeFromShape(p),c.dtype),m=e.data.get(c.dataId).values;for(let y=0;y<h.length;++y){let x=y*d,b=m[x];for(let w=0;w<d;++w){let C=m[x+w];(Number.isNaN(C)||C<b)&&(b=C)}h[y]=b}u!=null&&e.disposeIntermediateTensorInfo(c);let g=e.makeTensorInfo(p,c.dtype,h);if(s){let y=S.expandShapeToKeepDim(p,a),x=ze({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),x}return g}var aW={kernelName:uu,backendName:"cpu",kernelFunc:xxe};function vxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,mode:s}=r;Q(o,"mirrorPad");let a=i.map((b,w)=>b[0]+o.shape[w]+b[1]),l=i.map(b=>b[0]),u=i.map((b,w)=>b[0]+o.shape[w]),c=s==="reflect"?0:1,p=e.data.get(o.dataId).values,f=o.shape.length,d=v.computeStrides(o.shape),h=v.sizeFromShape(a),m=a.length,g=v.computeStrides(a),y=v.getTypedArrayFromDType(o.dtype,h);for(let b=0;b<h;b++){let w=v.indexToLoc(b,m,g);for(let N=0;N<m;N++)w[N]<l[N]?w[N]=l[N]*2-w[N]-c:w[N]>=u[N]&&(w[N]=(u[N]-1)*2-w[N]+c);w=w.map((N,D)=>N-l[D]);let C=v.locToIndex(w,f,d);y[b]=p[C]}return{dataId:e.write(y,a,o.dtype),shape:a,dtype:o.dtype}}var lW={kernelName:cu,backendName:"cpu",kernelFunc:vxe};var bxe=Be((t,n)=>{let e=t%n;return t<0&&n<0||t>=0&&n>=0?e:(e+n)%n}),wxe=et(xa,bxe),uW={kernelName:xa,backendName:"cpu",kernelFunc:wxe};var pW=am(qg());function GA(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=o.shape.length,a=i;if(a===-1&&(a=s-1),a!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${a}`);let l=v.parseAxisParam([a],o.shape),u=UA({inputs:{x:o},backend:e,attrs:{reductionIndices:l,keepDims:!1}}),c=S.expandShapeToKeepDim(u.shape,l),p=ze({inputs:{x:u},backend:e,attrs:{shape:c}}),f=Iy({inputs:{a:o,b:p},backend:e}),d=cA({inputs:{x:f},backend:e}),h=sl({inputs:{x:d},backend:e,attrs:{axis:l,keepDims:!1}}),m=ze({inputs:{x:h},backend:e,attrs:{shape:c}}),g=Ty({inputs:{a:d,b:m},backend:e});return e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(m),g}var cW={kernelName:_u,backendName:"cpu",kernelFunc:GA};function Cxe(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r;Q(o,"multinomial");let l=a?o:GA({inputs:{logits:o},backend:e,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],p=e.data.get(l.dataId).values,f=[u,i],d=v.makeZerosTypedArray(v.sizeFromShape(f),"int32");for(let h=0;h<u;++h){let m=h*c,g=new Float32Array(c-1);g[0]=p[m];for(let b=1;b<g.length;++b)g[b]=g[b-1]+p[m+b];let y=pW.alea(s.toString()),x=h*i;for(let b=0;b<i;++b){let w=y();d[x+b]=g.length;for(let C=0;C<g.length;C++)if(w<g[C]){d[x+b]=C;break}}}return a||e.disposeIntermediateTensorInfo(l),e.makeTensorInfo(f,"int32",d)}var fW={kernelName:Ub,backendName:"cpu",kernelFunc:Cxe};var Sxe=nr.nonMaxSuppressionV3Impl;function Ixe(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r;Q(o,"NonMaxSuppression");let u=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,{selectedIndices:p}=Sxe(u,c,s,a,l);return e.makeTensorInfo([p.length],"int32",new Int32Array(p))}var dW={kernelName:Ed,backendName:"cpu",kernelFunc:Ixe};var Exe=nr.nonMaxSuppressionV4Impl;function Txe(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=r;Q(o,"NonMaxSuppressionPadded");let c=e.data.get(o.dataId).values,p=e.data.get(i.dataId).values,{selectedIndices:f,validOutputs:d}=Exe(c,p,s,a,l,u);return[e.makeTensorInfo([f.length],"int32",new Int32Array(f)),e.makeTensorInfo([],"int32",new Int32Array([d]))]}var hW={kernelName:Td,backendName:"cpu",kernelFunc:Txe};var _xe=nr.nonMaxSuppressionV5Impl;function Nxe(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=r;Q(o,"NonMaxSuppressionWithScore");let c=e.data.get(o.dataId).values,p=e.data.get(i.dataId).values,f=s,d=a,h=l,m=u,{selectedIndices:g,selectedScores:y}=_xe(c,p,f,d,h,m);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var mW={kernelName:_d,backendName:"cpu",kernelFunc:Nxe};function Dxe(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{dtype:i,depth:s,onValue:a,offValue:l}=r;Q(o,"oneHot");let u=v.sizeFromShape(o.shape),c=new Float32Array(u*s);c.fill(l);let p=e.data.get(o.dataId).values;for(let f=0;f<u;++f)p[f]>=0&&p[f]<s&&(c[f*s+p[f]]=a);return e.makeTensorInfo([...o.shape,s],i,c)}var gW={kernelName:du,backendName:"cpu",kernelFunc:Dxe};function Dy(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let o=ci({inputs:{input:r},backend:e}),i=Dy({inputs:{x:o},backend:e}),s=bs({inputs:{input:r},backend:e}),a=Dy({inputs:{x:s},backend:e}),l=wn({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Ny({backend:e,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var yW={kernelName:ku,backendName:"cpu",kernelFunc:Dy};function xW(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let o=ci({inputs:{input:r},backend:e}),i=xW({inputs:{x:o},backend:e}),s=bs({inputs:{input:r},backend:e}),a=Dy({inputs:{x:s},backend:e}),l=wn({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Ny({backend:e,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var vW={kernelName:fu,backendName:"cpu",kernelFunc:xW};function WA(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return Oh({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(c=>{v.assertShapesMatch(i,c.shape,"All tensors passed to stack must have matching shapes"),v.assert(s===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(c=>{let p=Oh({inputs:{input:c},backend:e,attrs:{dim:o}});return a.push(p),p}),u=qu({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(c=>e.disposeIntermediateTensorInfo(c)),u}var bW={kernelName:hu,backendName:"cpu",kernelFunc:WA};function kxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r;Q(o,"pad");let a=i.map((x,b)=>x[0]+o.shape[b]+x[1]),l=i.map(x=>x[0]),u=e.data.get(o.dataId).values,c=v.sizeFromShape(o.shape),p=o.shape.length,f=v.computeStrides(o.shape),d=v.sizeFromShape(a),h=a.length,m=v.computeStrides(a),g=v.getTypedArrayFromDType(o.dtype,d);s!==0&&g.fill(s);for(let x=0;x<c;x++){let w=v.indexToLoc(x,p,f).map((N,D)=>N+l[D]),C=v.locToIndex(w,h,m);g[C]=u[x]}return{dataId:e.write(g,a,o.dtype),shape:a,dtype:o.dtype}}var mC={kernelName:mu,backendName:"cpu",kernelFunc:kxe};var Axe=Be((t,n)=>Math.pow(t,n)),Rxe=et(ba,Axe),wW={kernelName:ba,backendName:"cpu",kernelFunc:Rxe};function Mxe(t){let{inputs:n,backend:e,attrs:r}=t,{paramsNestedSplits:o,paramsDenseValues:i,indices:s}=n,{outputRaggedRank:a}=r,l=o.map(y=>e.data.get(y.dataId).values),u=o.map(y=>y.shape),c=e.data.get(i.dataId).values,p=e.data.get(s.dataId).values,[f,d,h]=Jw(l,u,c,i.shape,i.dtype,p,s.shape,a),m=f.map(y=>e.makeTensorInfo([y.length],"int32",y)),g=e.makeTensorInfo(h,i.dtype,d);return m.concat([g])}var CW={kernelName:Gb,backendName:"cpu",kernelFunc:Mxe};function Oxe(t){let{inputs:n,backend:e}=t,{starts:r,limits:o,deltas:i}=n,s=e.data.get(r.dataId).values,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,[u,c]=eC(s,r.shape,r.dtype,a,o.shape,l,i.shape),p=e.makeTensorInfo([u.length],"int32",u),f=e.makeTensorInfo([c.length],r.dtype,c);return[p,f]}var SW={kernelName:Wb,backendName:"cpu",kernelFunc:Oxe};function Fxe(t){let{inputs:n,backend:e,attrs:r}=t,{shape:o,values:i,defaultValue:s,rowPartitionTensors:a}=n,{rowPartitionTypes:l}=r,u=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,p=e.data.get(s.dataId).values,f=a.map(g=>e.data.get(g.dataId).values),d=a.map(g=>g.shape),[h,m]=tC(u,o.shape,c,i.shape,i.dtype,p,s.shape,f,d,l);return e.makeTensorInfo(h,i.dtype,m)}var IW={kernelName:Hb,backendName:"cpu",kernelFunc:Fxe};function $xe(t){let{backend:n,attrs:e}=t,{start:r,stop:o,dtype:i,step:s}=e,a=nC(r,o,s,i);return n.makeTensorInfo([a.length],i,a)}var EW={kernelName:Nd,backendName:"cpu",kernelFunc:$xe};var Pxe=Te(wa,t=>1/t),TW={kernelName:wa,backendName:"cpu",kernelFunc:Pxe};function Lxe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;Q(o,"resizeBilinear");let l=v.computeStrides(o.shape),[u,c]=a,[p,f,d,h]=o.shape,m=e.data.get(o.dataId).values,g=new Float32Array(v.sizeFromShape([p,u,c,h])),y=[i&&u>1?f-1:f,i&&c>1?d-1:d],x=[i&&u>1?u-1:u,i&&c>1?c-1:c],b=0,w=y[0]/x[0],C=y[1]/x[1];for(let N=0;N<p;N++)for(let D=0;D<u;D++){let k;s?k=w*(D+.5)-.5:k=w*D;let O=Math.max(0,Math.floor(k)),$=k-O,V=Math.min(f-1,Math.ceil(k)),G=N*l[0]+O*l[1],W=N*l[0]+V*l[1];for(let H=0;H<c;H++){let j;s?j=C*(H+.5)-.5:j=C*H;let Y=Math.max(0,Math.floor(j)),ee=j-Y,X=Math.min(d-1,Math.ceil(j)),te=G+Y*l[2],re=W+Y*l[2],oe=G+X*l[2],ae=W+X*l[2];for(let ie=0;ie<h;ie++){let fe=m[te+ie],le=m[re+ie],ye=m[oe+ie],_e=m[ae+ie],Oe=fe+(ye-fe)*ee,Ae=le+(_e-le)*ee,Ke=Oe+(Ae-Oe)*$;g[b++]=Ke}}}return e.makeTensorInfo([p,u,c,h],"float32",g)}var _W={kernelName:bu,backendName:"cpu",kernelFunc:Lxe};function Vxe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;Q([i,o],"resizeBilinearGrad");let a=v.computeStrides(o.shape),[l,u,c,p]=o.shape,[,f,d]=i.shape,h=new Float32Array(l*u*c*p),m=[s&&f>1?u-1:u,s&&d>1?c-1:c],g=[s&&f>1?f-1:f,s&&d>1?d-1:d],y=m[0]/g[0],x=m[1]/g[1],b=e.data.get(i.dataId).values,w=0;for(let C=0;C<l;C++){let N=C*a[0];for(let D=0;D<f;D++){let k=D*y,O=Math.floor(k),$=Math.min(Math.ceil(k),u-1),V=N+O*a[1],G=N+$*a[1],W=k-O,H=1-W;for(let j=0;j<d;j++){let Y=j*x,ee=Math.floor(Y),X=Math.min(Math.ceil(Y),c-1),te=Y-ee,re=1-te,oe=V+ee*a[2],ae=V+X*a[2],ie=G+ee*a[2],fe=G+X*a[2],le=H*re,ye=H*te,_e=W*re,Oe=W*te;for(let Ae=0;Ae<p;Ae++){let Ke=b[w++];h[oe+Ae]+=Ke*le,h[ae+Ae]+=Ke*ye,h[ie+Ae]+=Ke*_e,h[fe+Ae]+=Ke*Oe}}}}return e.makeTensorInfo([l,c,u,p],"float32",h)}var NW={kernelName:Ad,backendName:"cpu",kernelFunc:Vxe};function Bxe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;Q(o,"resizeNearestNeighbor");let l=v.computeStrides(o.shape),[u,c]=a,[p,f,d,h]=o.shape,m=e.data.get(o.dataId).values,g=new Float32Array(p*u*c*h),y=[i&&u>1?f-1:f,i&&c>1?d-1:d],x=[i&&u>1?u-1:u,i&&c>1?c-1:c],b=y[0]/x[0],w=y[1]/x[1],C=0;for(let N=0;N<p;N++){let D=N*l[0];for(let k=0;k<u;k++){let O=s?b*(k+.5):b*k,$=Math.min(f-1,i?Math.round(O):Math.floor(O));s&&($=Math.max(0,$));let V=D+$*l[1];for(let G=0;G<c;G++){let W=s?w*(G+.5):w*G,H=Math.min(d-1,i?Math.round(W):Math.floor(W));s&&(H=Math.max(0,H));let j=V+H*l[2];for(let Y=0;Y<h;Y++){let ee=m[j+Y];g[C++]=ee}}}}return e.makeTensorInfo([p,u,c,h],o.dtype,g)}var DW={kernelName:vu,backendName:"cpu",kernelFunc:Bxe};function zxe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;Q([i,o],"resizeNearestNeighborGrad");let a=v.computeStrides(o.shape),l=v.computeStrides(i.shape),[u,c,p,f]=o.shape,[,d,h]=i.shape,m=new Float32Array(u*c*p*f),g=e.data.get(i.dataId).values,y=[s&&d>1?c-1:c,s&&h>1?p-1:p],x=[s&&d>1?d-1:d,s&&h>1?h-1:h],b=y[0]/x[0],w=y[1]/x[1],C=1/b,N=1/w,D=Math.ceil(C)*2+2,k=Math.ceil(N)*2+2;for(let O=0;O<u;O++){let $=O*a[0];for(let V=0;V<c;V++){let G=$+V*a[1],W=Math.floor(V*C),H=Math.floor(W-D/2);for(let j=0;j<p;j++){let Y=G+j*a[2],ee=Math.floor(j*N),X=Math.floor(ee-k/2);for(let te=0;te<f;te++){let re=0;for(let oe=0;oe<D;oe++){let ae=oe+H;if(ae<0||ae>=d)continue;let ie=$+ae*l[1],fe=ae*b,le=Math.min(c-1,s?Math.round(fe):Math.floor(fe));if(V===le)for(let ye=0;ye<k;ye++){let _e=ye+X;if(_e<0||_e>=h)continue;let Oe=ie+_e*l[2],Ae=_e*w,Ke=Math.min(p-1,s?Math.round(Ae):Math.floor(Ae));j===Ke&&(re+=g[Oe+te])}}m[Y+te]=re}}}}return e.makeTensorInfo(o.shape,o.dtype,m)}var kW={kernelName:kd,backendName:"cpu",kernelFunc:zxe};function Uxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r;Q(o,"reverse");let s=o.shape.length,a=v.parseAxisParam(i,o.shape);if(s===0)return rr({inputs:{x:o},backend:e});let l=new mt(o.shape,o.dtype),u=e.bufferSync(o);for(let c=0;c<l.size;c++){let p=l.indexToLoc(c),f=p.slice();a.forEach(d=>f[d]=o.shape[d]-1-f[d]),l.set(u.get(...f),...p)}return e.makeTensorInfo(l.shape,l.dtype,l.values)}var AW={kernelName:wu,backendName:"cpu",kernelFunc:Uxe};var RW={kernelName:Pd,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=v.getTypedArrayFromDType(r.dtype,v.sizeFromShape(r.shape)),[u,c,p,f]=r.shape,[d,h]=S.getImageCenter(s,c,p),m=255,g=Math.sin(o),y=Math.cos(o),x=a.data.get(r.dataId).values;for(let w=0;w<u;w++){let C=w*p*c*f;for(let N=0;N<c;N++){let D=N*(p*f);for(let k=0;k<p;k++){let O=k*f;for(let $=0;$<f;$++){let V=[u,N,k,$],G=V[2],W=V[1],H=(G-d)*y-(W-h)*g,j=(G-d)*g+(W-h)*y;H=Math.round(H+d),j=Math.round(j+h);let Y=i;if(typeof i!="number"&&($===3?Y=m:Y=i[$]),H>=0&&H<p&&j>=0&&j<c){let X=j*(p*f),te=H*f,re=C+X+te+$;Y=x[re]}let ee=C+D+O+$;l[ee]=Y}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var Gxe=Te(Ia,t=>{let n=Math.floor(t);return t-n<.5?Math.floor(t):t-n>.5?Math.ceil(t):n%2===0?n:n+1}),MW={kernelName:Ia,backendName:"cpu",kernelFunc:Gxe};function Wxe(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:p}=S.calculateShapes(i,o,s),f=!0,d=e.bufferSync(o),h=e.bufferSync(i),m=Bi(d,h,s,p,u,l,a,c,0,f);return e.makeTensorInfo(s,m.dtype,m.values)}var OW={kernelName:jb,backendName:"cpu",kernelFunc:Wxe};function Hxe(t,n){let e=0,r=t.length,o=0;for(;e<r;)o=Math.floor((e+r)/2),t[o]<n?e=o+1:r=o;return r}function jxe(t,n){let e=0,r=t.length,o=0;for(;e<r;)o=Math.floor((e+r)/2),t[o]<=n?e=o+1:r=o;return r}function FW(t,n,e,r,o,i){let s=v.getArrayFromDType("int32",e*o);for(let a=0;a<e;++a){let l=t.slice(a*r,(a+1)*r),u=a*o;for(let c=0;c<o;++c)s[u+c]=i==="left"?Hxe(l,n[c+u]):jxe(l,n[c+u])}return s}function qxe(t){let{inputs:n,backend:e,attrs:r}=t,{sortedSequence:o,values:i}=n,{side:s}=r,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,u=FW(a,l,o.shape[0],o.shape[1],i.shape[1],s);return e.makeTensorInfo(i.shape,"int32",u)}var $W={kernelName:Kb,backendName:"cpu",kernelFunc:qxe};function Kxe(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n;Q([r,o,i],"select");let s=r.shape.length,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,u=e.data.get(i.dataId).values,c=un(o.dtype,i.dtype),p=v.makeZerosTypedArray(v.sizeFromShape(o.shape),c),f=0,d=s===0||s>1||o.shape.length===1?1:v.sizeFromShape(o.shape.slice(1));for(let h=0;h<a.length;h++)for(let m=0;m<d;m++)a[h]===1?p[f++]=l[h]:p[f++]=u[h];return e.makeTensorInfo(o.shape,c,p)}var PW={kernelName:Cu,backendName:"cpu",kernelFunc:Kxe};var Xxe=S.SELU_SCALEALPHA,Yxe=S.SELU_SCALE,Zxe=Te(Ta,t=>t>=0?Yxe*t:Xxe*(Math.exp(t)-1)),LW={kernelName:Ta,backendName:"cpu",kernelFunc:Zxe};var Qxe=Te(Da,t=>t<0?-1:t>0?1:0),VW={kernelName:Da,backendName:"cpu",kernelFunc:Qxe};var Jxe=Te(_a,t=>Math.sin(t)),BW={kernelName:_a,backendName:"cpu",kernelFunc:Jxe};var eve=Te(Na,t=>Math.sinh(t)),zW={kernelName:Na,backendName:"cpu",kernelFunc:eve};var tve=11920928955078125e-23,UW=Math.log(tve)+2,nve=Te(Aa,t=>{let n=t>-UW,e=t<UW,r=Math.exp(t),o;return e?o=r:n?o=t:o=Math.log(1+r),o}),GW={kernelName:Aa,backendName:"cpu",kernelFunc:nve};function rve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;Q([o],"spaceToBatchND");let a=v.sizeFromShape(i),l=[[0,0]];l.push(...s);for(let N=1+i.length;N<o.shape.length;++N)l.push([0,0]);let u=mC.kernelFunc({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),c=S.getReshaped(u.shape,i,a,!1),p=S.getPermuted(c.length,i.length,!1),f=S.getReshapedPermuted(u.shape,i,a,!1),m=ze({inputs:{x:u},backend:e,attrs:{shape:c}}),x=Ht({inputs:{x:m},backend:e,attrs:{perm:p}}),C=ze({inputs:{x},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(x),C}var WW={kernelName:Eu,backendName:"cpu",kernelFunc:rve};function ove(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,u=e.data.get(i.dataId).values,c=e.data.get(s.dataId).values[0],[p,f,d,h,m]=rC(a,r.shape,r.dtype,l,o.dtype,u,c);return[e.makeTensorInfo(f,r.dtype,p),e.makeTensorInfo([f[0]],o.dtype,d),e.makeTensorInfo([h.length],"bool",new Uint8Array(h.map(g=>Number(g)))),e.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}var HW={kernelName:Xb,backendName:"cpu",kernelFunc:ove};function ive(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.data.get(o.dataId).values),a=e.data.get(r.dataId).values,l=Array.from(e.data.get(i.dataId).values),[u,c,p]=oC(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(c,r.dtype,u),e.makeTensorInfo([p.length],i.dtype,new Int32Array(p))]}var jW={kernelName:Yb,backendName:"cpu",kernelFunc:ive};function sve(t){let{inputs:n,backend:e}=t,{data:r,indices:o,segmentIds:i}=n;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${o.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(o.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");let s=e.data.get(r.dataId).values,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,[u,c]=Rh(s,r.shape,r.dtype,a,l,!0);return e.makeTensorInfo(c,r.dtype,u)}var qW={kernelName:Zb,backendName:"cpu",kernelFunc:sve};function ave(t){let{inputs:n,backend:e}=t,{data:r,indices:o,segmentIds:i}=n;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${o.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(o.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");let s=e.data.get(r.dataId).values,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,[u,c]=Rh(s,r.shape,r.dtype,a,l);return e.makeTensorInfo(c,r.dtype,u)}var KW={kernelName:Qb,backendName:"cpu",kernelFunc:ave};function lve(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:u,sliceSize:c,strides:p,outputSize:f}=S.calculateShapes(i,o,a),d=!1,h=e.bufferSync(o),m;switch(i.dtype){case"bool":{let g=e.bufferSync(i),y=!!e.data.get(s.dataId).values[0];m=Bi(h,g,a,f,c,u,l,p,y,d);break}case"float32":{let g=e.bufferSync(i),y=e.data.get(s.dataId).values[0];m=Bi(h,g,a,f,c,u,l,p,y,d);break}case"int32":{let g=e.bufferSync(i),y=e.data.get(s.dataId).values[0];m=Bi(h,g,a,f,c,u,l,p,y,d);break}case"string":{let g=e.bufferSync(i),y=v.decodeString(e.data.get(s.dataId).values[0]);m=Bi(h,g,a,f,c,u,l,p,y,d);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return e.makeTensorInfo(a,m.dtype,m.values)}var XW={kernelName:Jb,backendName:"cpu",kernelFunc:lve};function uve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=v.parseAxisParam(s,o.shape)[0],l=S.prepareSplitSize(o,i,a),u=new Array(o.shape.length).fill(0),c=o.shape.slice();return l.map(p=>{let f=[...c];f[a]=p;let d=di({inputs:{x:o},backend:e,attrs:{begin:u,size:f}});return u[a]+=p,d})}var YW={kernelName:Tu,backendName:"cpu",kernelFunc:uve};var ZW={kernelName:Rd,backendName:"cpu",kernelFunc:({inputs:t,backend:n})=>{let{x:e}=t,r=n;Q(e,"square");let o=r.data.get(e.dataId).values,i=new Float32Array(o.length);for(let a=0;a<o.length;++a){let l=o[a];i[a]=l*l}return{dataId:r.write(i,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};var cve=Te(Pa,(t,n)=>{let e=n;return isNaN(t)?NaN:t>0?1:e.alpha}),QW={kernelName:Pa,backendName:"cpu",kernelFunc:cve};function pve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:p,shrinkAxisMask:f}=r;Q(o,"stridedSlice");let{finalShapeSparse:d,finalShape:h,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:x,end:b,strides:w}=kn.sliceInfo(o.shape,i,s,a,l,u,c,p,f),C;if(m)C=ze({inputs:{x:o},backend:e,attrs:{shape:h}});else if(g||y){v.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let N=kn.computeOutShape(x,b,w),D=di({inputs:{x:o},backend:e,attrs:{begin:x,size:N}});C=ze({inputs:{x:D},backend:e,attrs:{shape:h}}),e.disposeIntermediateTensorInfo(D)}else{let N=e.bufferSync(o),D=iC(d,N,w,x);C=e.makeTensorInfo(h,D.dtype,D.values)}return C}var JW={kernelName:Md,backendName:"cpu",kernelFunc:pve};function fve(t){let{inputs:n,backend:e,attrs:r}=t,{separator:o,nGramWidths:i,leftPad:s,rightPad:a,padWidth:l,preserveShortSequences:u}=r,{data:c,dataSplits:p}=n,f=e.data.get(c.dataId).values,d=e.data.get(p.dataId).values,[h,m]=sC(f,d,o,i,s,a,l,u);return[e.makeTensorInfo([h.length],"string",h),e.makeTensorInfo(p.shape,"int32",m)]}var eH={kernelName:e0,backendName:"cpu",kernelFunc:fve};function dve(t){let{inputs:n,backend:e,attrs:r}=t,{skipEmpty:o}=r,{input:i,delimiter:s}=n;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(s.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);let a=e.data.get(i.dataId).values,l=e.data.get(s.dataId).values[0],[u,c,p]=aC(a,l,o),f=c.length;return[e.makeTensorInfo([f,2],"int32",u),e.makeTensorInfo([f],"string",c),e.makeTensorInfo([2],"int32",new Int32Array(p))]}var tH={kernelName:t0,backendName:"cpu",kernelFunc:dve};function hve(t){let{inputs:n,backend:e,attrs:r}=t,{numBuckets:o}=r,{input:i}=n;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let s=e.data.get(i.dataId).values,a=lC(s,o);return e.makeTensorInfo(i.shape,"int32",a)}var nH={kernelName:n0,backendName:"cpu",kernelFunc:hve};var mve=Te(Fa,t=>Math.tan(t)),rH={kernelName:Fa,backendName:"cpu",kernelFunc:mve};var gve=Te($a,t=>Math.tanh(t)),oH={kernelName:$a,backendName:"cpu",kernelFunc:gve};function yve(t){let{inputs:n,backend:e}=t,{tensor:r,indices:o,updates:i}=n,{sliceRank:s,numUpdates:a,sliceSize:l,strides:u,outputSize:c}=S.calculateShapes(i,o,r.shape),p=!1,f=e.bufferSync(o),d=e.bufferSync(i),h=e.bufferSync(r),m=Bi(f,d,r.shape,c,l,a,s,u,h,p);return e.makeTensorInfo(r.shape,m.dtype,m.values)}var iH={kernelName:qb,backendName:"cpu",kernelFunc:yve};function xve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;Q(o,"tile");let s=uC(e.bufferSync(o),i);return e.makeTensorInfo(s.shape,s.dtype,s.values)}var sH={kernelName:ss,backendName:"cpu",kernelFunc:xve};function vve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r;Q(o,"topk");let a=e.data.get(o.dataId).values,[l,u]=cC(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(u.shape,u.dtype,u.values)]}var aH={kernelName:Od,backendName:"cpu",kernelFunc:vve};function bve(t){let{inputs:n,attrs:e,backend:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:u}=e,[c,p,f,d]=o.shape,[h,m]=u??[p,f],g=[c,h,m,d],y=v.computeStrides(o.shape),x=y[0],b=y[1],w=y[2],C=v.computeStrides(g),N=C[0],D=C[1],k=C[2],O=v.getTypedArrayFromDType(o.dtype,v.sizeFromShape(g));O.fill(l);let $=r.data.get(o.dataId).values,V=r.data.get(i.dataId).values;for(let W=0;W<c;++W){let H=i.shape[0]===1?V:V.subarray(W*8,W*8+8);for(let j=0;j<h;++j)for(let Y=0;Y<m;++Y)for(let ee=0;ee<d;++ee){let X,te=H[6]*Y+H[7]*j+1;if(te===0)continue;let re=(H[0]*Y+H[1]*j+H[2])/te,oe=(H[3]*Y+H[4]*j+H[5])/te,ae=lH(re,f,a),ie=lH(oe,p,a);switch(s){case"nearest":X=Eve($,p,f,x,b,w,W,ie,ae,ee,l);break;case"bilinear":X=Tve($,p,f,x,b,w,W,ie,ae,ee,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}let fe=W*N+j*D+Y*k+ee;O[fe]=X}return r.makeTensorInfo(g,o.dtype,O)}return{dataId:r.write(O,g,o.dtype),shape:o.shape,dtype:o.dtype}}var uH={kernelName:Fd,backendName:"cpu",kernelFunc:bve};function lH(t,n,e){switch(e){case"reflect":return wve(t,n);case"wrap":return Cve(t,n);case"nearest":return Ive(t,n);case"constant":default:return Sve(t,n)}}function wve(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=2*n;e<r&&(e=r*Math.trunc(-e/r)+e),e=e<-n?e+r:-e-1}else if(e>n-1)if(n<=1)e=0;else{let r=2*n;e-=r*Math.trunc(e/r),e>=n&&(e=r-e-1)}return v.clamp(0,e,n-1)}function Cve(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=n-1;e+=n*(Math.trunc(-e/r)+1)}else if(e>n-1)if(n<=1)e=0;else{let r=n-1;e-=n*Math.trunc(e/r)}return v.clamp(0,e,n-1)}function Sve(t,n){return t}function Ive(t,n){return v.clamp(0,t,n-1)}function ky(t,n,e,r,o,i,s,a,l,u,c){let p=s*r+a*o+l*i+u;return 0<=a&&a<n&&0<=l&&l<e?t[p]:c}function Eve(t,n,e,r,o,i,s,a,l,u,c){let p=Math.round(a),f=Math.round(l);return ky(t,n,e,r,o,i,s,p,f,u,c)}function Tve(t,n,e,r,o,i,s,a,l,u,c){let p=Math.floor(a),f=Math.floor(l),d=p+1,h=f+1,m=(h-l)*ky(t,n,e,r,o,i,s,p,f,u,c)+(l-f)*ky(t,n,e,r,o,i,s,p,h,u,c),g=(h-l)*ky(t,n,e,r,o,i,s,d,f,u,c)+(l-f)*ky(t,n,e,r,o,i,s,d,h,u,c);return(d-a)*m+(a-p)*g}function _ve(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;Q(i,"unique");let s=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:u}=pC(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([u.length],"int32",u)]}var cH={kernelName:$d,backendName:"cpu",kernelFunc:_ve};function Nve(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o.shape.length,a=o.shape[i],l=new Array(s-1),u=0;for(let d=0;d<s;d++)d!==i&&(l[u++]=o.shape[d]);let c=new Array(s).fill(0),p=o.shape.slice();p[i]=1;let f=new Array(a);for(let d=0;d<f.length;d++){c[i]=d;let h=di({inputs:{x:o},backend:e,attrs:{begin:c,size:p}});f[d]=ze({inputs:{x:h},backend:e,attrs:{shape:l}}),e.disposeIntermediateTensorInfo(h)}return f}var pH={kernelName:Nu,backendName:"cpu",kernelFunc:Nve};function Dve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r;Q(o,"unsortedSegmentSum");let a=o.shape.length,l=i.shape.length,u=[],c=[],p=a-l,f=i;for(let h=0;h<p;++h){let m=Oh({inputs:{input:f},backend:e,attrs:{dim:h+1}});f=m,c.push(m)}for(let h=0;h<s;++h){let m=v.createScalarValue(h,"int32"),g=e.makeTensorInfo([],"int32",m),y=lA({inputs:{a:g,b:f},backend:e}),x=pi({inputs:{x:y},backend:e,attrs:{dtype:"float32"}}),b=kp({inputs:{a:x,b:o},backend:e}),w=sl({inputs:{x:b},backend:e,attrs:{axis:0,keepDims:!1}});u.push(w),c.push(g),c.push(y),c.push(x),c.push(b),c.push(w)}let d=WA({inputs:u,backend:e,attrs:{axis:0}});return c.forEach(h=>e.disposeIntermediateTensorInfo(h)),d}var fH={kernelName:Du,backendName:"cpu",kernelFunc:Dve};var kve=[PG,HU,LG,VG,YU,BG,zG,UG,GG,WG,HG,jG,qG,KG,XG,ZG,QG,JG,e4,$G,t4,n4,r4,ZU,o4,XU,QU,i4,jU,s4,l4,u4,c4,p4,f4,d4,h4,m4,g4,y4,x4,v4,b4,w4,C4,S4,I4,E4,T4,_4,N4,D4,A4,kG,R4,JU,M4,eG,O4,tG,F4,$4,P4,nG,rG,L4,V4,B4,z4,oG,iG,qU,U4,a4,G4,W4,H4,AG,sG,aG,j4,lG,q4,K4,X4,Y4,Z4,Q4,J4,uG,eW,tW,nW,rW,iW,sW,aW,cG,lW,uW,fW,pG,fG,dW,hW,mW,dG,gW,vW,bW,mC,wW,RG,mG,CW,SW,IW,EW,KU,_y,TW,MG,OG,FG,_W,NW,DW,kW,AW,RW,MW,bG,OW,$W,PW,LW,CG,VW,BW,zW,SG,cW,GW,WW,HW,jW,qW,KW,XW,YW,EG,ZW,TG,_G,QW,JW,eH,tH,nH,NG,k4,rH,oH,iH,sH,aH,uH,hG,cH,pH,fH,yW];for(let t of kve)o0(t);var Rp={},gC={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function dH(t,n){Rp[t]=n}function po(t,n){if(!(t in Rp)||n!=null){let r=Rve(t,n);if(r!==null)Rp[t]=r;else return console.log("Could not get context for WebGL version",t),null}let e=Rp[t];return e==null||e.isContextLost()?(delete Rp[t],po(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Rp[t])}function Ave(t){if(!P().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Rve(t,n){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let e=n??Ave(t);return e.addEventListener("webglcontextlost",r=>{r.preventDefault(),delete Rp[t]},!1),P().getBool("SOFTWARE_WEBGL_ENABLED")&&(gC.failIfMajorPerformanceCaveat=!1),t===1?e.getContext("webgl",gC)||e.getContext("experimental-webgl",gC):e.getContext("webgl2",gC)}var Mp=function(t){return t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH",t}(Mp||{}),dr=function(t){return t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD",t}(dr||{}),or=function(t){return t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16",t}(or||{});function Op(t,n){return[n,t]}function hH(t,n){return t*n}function Ay(t){let n=v.sizeFromShape(t),e=Math.ceil(n/4);return v.sizeToSquarishShape(e)}function ws(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function mH(t,n){let[e,r]=ws(t,n);return e*r*4}function Ry(t,n){let e=t,r,o,i,s,a,l,u,c,p,f;return P().getNumber("WEBGL_VERSION")===2?(r=e.R32F,o=e.R16F,i=e.RGBA16F,s=e.RGBA32F,a=e.RED,u=4,c=1,p=e.HALF_FLOAT,f=e.FLOAT,l=e.RGBA8):(r=t.RGBA,o=t.RGBA,i=t.RGBA,s=e.RGBA,a=t.RGBA,u=4,c=4,p=n!=null?n.HALF_FLOAT_OES:null,f=t.FLOAT,l=t.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:p,textureTypeFloat:f}}function de(t,n){let e=n();return P().getBool("DEBUG")&&Mve(t),e}function Mve(t){let n=t.getError();if(n!==t.NO_ERROR)throw new Error("WebGL Error: "+$ve(t,n))}var Ove=596e-10,Fve=65504;function gH(t){return!!(P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||Ove<Math.abs(t)&&Math.abs(t)<Fve)}function $ve(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${n}`}}function My(t,n){return al(t,()=>t.getExtension(n),'Extension "'+n+'" not supported on this browser.')}function yH(t,n){let e=al(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(de(t,()=>t.shaderSource(e,n)),de(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function xH(t,n){let e=al(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(de(t,()=>t.shaderSource(e,n)),de(t,()=>t.compileShader(e)),P().get("ENGINE_COMPILE_ONLY"))return e;if(t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw XA(n,t.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}var Pve=/ERROR: [0-9]+:([0-9]+):/g;function XA(t,n){let e=Pve.exec(n);if(e==null){console.log(`Couldn't parse line number in error: ${n}`),console.log(t);return}let r=+e[1],o=t.split(`
`),i=o.length.toString().length+2,s=o.map((p,f)=>v.rightPad((f+1).toString(),i)+p),a=0;for(let p=0;p<s.length;p++)a=Math.max(s[p].length,a);let l=s.slice(0,r-1),u=s.slice(r-1,r),c=s.slice(r);console.log(l.join(`
`)),console.log(n.split(`
`)[0]),console.log(`%c ${v.rightPad(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function vH(t){return al(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function bH(t,n){if(de(t,()=>t.linkProgram(n)),!P().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(n,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function xC(t,n){if(de(t,()=>t.validateProgram(n)),t.getProgramParameter(n,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function wH(t,n){let e=al(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return de(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),de(t,()=>t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function CH(t,n){let e=al(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return de(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e)),de(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function SH(t){return al(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function IH(t,n){let e=P().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){let r=`[${t}x${n}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e){let r=`[${t}x${n}]`,o=`[${e}x${e}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function EH(t){return al(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function YA(t,n,e,r,o,i,s){let a=t.getAttribLocation(n,e);return a===-1?!1:(de(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),de(t,()=>t.vertexAttribPointer(a,o,t.FLOAT,!1,i,s)),de(t,()=>t.enableVertexAttribArray(a)),!0)}function Lve(t,n,e){Bve(t,e),de(t,()=>t.activeTexture(t.TEXTURE0+e)),de(t,()=>t.bindTexture(t.TEXTURE_2D,n))}function TH(t,n,e){return al(t,()=>t.getUniformLocation(n,e),'uniform "'+e+'" not present in program.')}function _H(t,n,e){return t.getUniformLocation(n,e)}function NH(t,n,e,r){de(t,()=>Lve(t,n,r)),de(t,()=>t.uniform1i(e,r))}function vC(t,n,e){de(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),de(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0))}function ZA(t,n){de(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),de(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function Oy(t){let n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Vve(t,n))}function Vve(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${n}`}}function al(t,n,e){let r=de(t,()=>n());if(r==null)throw new Error(e);return r}function Bve(t,n){let e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e){let o=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${o}.`)}}function Ku(t,n=2){return v.sizeFromShape(t.slice(0,t.length-n))}function Xu(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Fy(t){let n=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(n=[Ku(t),...Xu(t)]),n}function DH(t,n=!1){let e=P().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=P().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&P().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=e/2),n&&(e=e*2,r=r*2,t=t.map((a,l)=>l>=t.length-2?v.nearestLargerEven(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=v.squeezeShape(t).newShape);let o=v.sizeFromShape(t),i=null;t.length<=1&&o<=e?i=[1,o]:t.length===2&&t[0]<=e&&t[1]<=e?i=t:t.length===3&&t[0]*t[1]<=e&&t[2]<=e?i=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=e&&t[1]*t[2]<=e?i=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=e&&t[3]<=e?i=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=e&&t[1]*t[2]*t[3]<=e&&(i=[t[0],t[1]*t[2]*t[3]]);let s=i!=null&&Math.max(...i)>r&&Math.min(...i)<=(n?2:1)&&Math.min(...i)>0;if(i==null||s)if(n){let a=Ku(t),l=2,u=2;t.length&&([l,u]=Xu(t)),o=a*(l/2)*(u/2),i=v.sizeToSquarishShape(o).map(c=>c*2)}else i=v.sizeToSquarishShape(o);return i}function yC(t){return t%2===0}function Fp(t,n){if(t=t.slice(-2),n=n.slice(-2),v.arraysEqual(t,n)||!t.length||!n.length||t[0]===0||t[1]===0||n[0]===0||n[1]===0)return!0;if(t.length!==n.length){let e=t[t.length-1],r=n[n.length-1];if(e===r||yC(e)&&yC(r)&&(t[0]===1||n[0]===1))return!0}return t[1]===n[1]&&yC(t[0])&&yC(n[0])}var jA,qA;function kH(t){if(jA==null){let n=po(t);jA=n.getParameter(n.MAX_TEXTURE_SIZE)}return jA}function AH(t){if(qA==null){let n=po(t);qA=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,qA)}function RH(t){if(t===0)return 0;let n,e=po(t);return Fo(e,"EXT_disjoint_timer_query_webgl2")&&t===2?n=2:Fo(e,"EXT_disjoint_timer_query")?n=1:n=0,n}function Fo(t,n){return t.getExtension(n)!=null}function QA(t){try{if(po(t)!=null)return!0}catch(n){return console.log("Error when getting WebGL context: ",n),!1}return!1}function MH(t){if(t===0)return!1;let n=po(t);if(t===1){if(!Fo(n,"OES_texture_float"))return!1}else if(!Fo(n,"EXT_color_buffer_float"))return!1;return KA(n)}function OH(t){if(t===0)return!1;let n=po(t);if(t===1){if(!Fo(n,"OES_texture_float")||!Fo(n,"WEBGL_color_buffer_float"))return!1}else{if(Fo(n,"EXT_color_buffer_float"))return KA(n);let r="EXT_color_buffer_half_float";if(Fo(n,r)){let o=n.getExtension(r);return zve(n,o)}return!1}return KA(n)}function KA(t){let n=Ry(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);let i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);let s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(i),s}function zve(t,n){let e=Ry(t,n),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatHalfFloat,1,1,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);let s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);let a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(s),a}function FH(t){return t!==2?!1:po(t).fenceSync!=null}function Cs(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&v.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the WebGL backend.`)})}var Ce=P();Ce.registerFlag("HAS_WEBGL",()=>Ce.getNumber("WEBGL_VERSION")>0);Ce.registerFlag("WEBGL_VERSION",()=>QA(2)?2:QA(1)?1:0);Ce.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ce.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ce.get("WEBGL_VERSION")===2);Ce.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ce.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ce.registerFlag("WEBGL_PACK",()=>Ce.getBool("HAS_WEBGL"));Ce.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_PACK_CLIP",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_PACK_REDUCE",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_CONV_IM2COL",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ce.getBool("WEBGL_PACK"));Ce.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>kH(Ce.getNumber("WEBGL_VERSION")));Ce.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>AH(Ce.getNumber("WEBGL_VERSION")));Ce.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let t=Ce.getNumber("WEBGL_VERSION");return t===0?0:RH(t)});Ce.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Mu.isMobile());Ce.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>MH(Ce.getNumber("WEBGL_VERSION")));Ce.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ce.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ce.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ce.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>OH(Ce.getNumber("WEBGL_VERSION")));Ce.registerFlag("WEBGL_FENCE_API_ENABLED",()=>FH(Ce.getNumber("WEBGL_VERSION")));Ce.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ce.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ce.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Ce.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Mu.isMobile()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});Ce.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ce.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ce.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ce.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ce.registerFlag("WEBGL_EXP_CONV",()=>!1);Ce.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ce.getBool("IS_TEST"));Ce.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ce.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ce.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ce.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function jt(){let t,n,e,r,o,i,s,a,l,u;return P().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",n="in",e="out",r="in",o="texture",i="outputColor",s="out vec4 outputColor;",a=P().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",n="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}function zi(t,n,e="index"){let r=v.computeStrides(n);return r.map((o,i)=>{let s=`int ${t[i]} = ${e} / ${o}`,a=i===r.length-1?`int ${t[i+1]} = ${e} - ${t[i]} * ${o}`:`index -= ${t[i]} * ${o}`;return`${s}; ${a};`}).join("")}function $p(t,n,e="index"){let r=v.computeStrides(n);return r.map((o,i)=>{let s=`int ${t[i]} = ${e} / outShapeStrides[${i}]`,a=i===r.length-1?`int ${t[i+1]} = ${e} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`;return`${s}; ${a};`}).join("")}function Uve(t,n){let e=t.length,r=t.map(i=>`${n}[${i}]`),o=new Array(e-1);o[e-2]=r[e-1];for(let i=e-3;i>=0;--i)o[i]=`(${o[i+1]} * ${r[i+1]})`;return o}function $H(t,n,e="index"){let r=t.map((i,s)=>s),o=Uve(r,n);return o.map((i,s)=>{let a=`int ${t[s]} = ${e} / ${o[s]}`,l=s===o.length-1?`int ${t[s+1]} = ${e} - ${t[s]} * ${o[s]}`:`index -= ${t[s]} * ${o[s]}`;return`${a}; ${l};`}).join("")}function Fh(t){let n=v.computeStrides(t).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${n[0]} + coords.y * ${n[1]} + coords.z;
  }
`}function $h(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var wC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var{getBroadcastDims:PH}=S;function LH(t,n,e){let r=[];if(t.forEach(d=>{let h=v.sizeFromShape(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?r.push(`uniform float ${d.name}${h>1?`[${h}]`:""};`):(r.push(`uniform sampler2D ${d.name};`),r.push(`uniform int offset${d.name};`)),e.enableShapeUniforms){let{uniformShape:m}=CC(e.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape);switch(m.length){case 1:r.push(`uniform int ${d.name}Shape;`);break;case 2:r.push(`uniform ivec2 ${d.name}Shape;`);break;case 3:r.push(`uniform ivec3 ${d.name}Shape;`);break;case 4:r.push(`uniform ivec4 ${d.name}Shape;`);break;default:break}r.push(`uniform ivec2 ${d.name}TexShape;`)}}),e.enableShapeUniforms){switch(n.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break;default:break}r.push("uniform ivec2 outTexShape;")}e.customUniforms&&e.customUniforms.forEach(d=>{r.push(`uniform ${d.type} ${d.name}${d.arrayIndex?`[${d.arrayIndex}]`:""};`)});let o=r.join(`
`),i=t.map(d=>Gve(d,n,e.packedInputs,e.enableShapeUniforms)).join(`
`),s=n.texShape,a=jt(),l=jve(a),u,c,p=Xve(a);return n.isPacked?(u=Wve(n.logicalShape,s,e.enableShapeUniforms),c=Kve(a)):(u=Hve(n.logicalShape,s,e.enableShapeUniforms),c=qve(a)),e.packedInputs&&(p+=Jve),[p,l,c,o,u,i,e.userCode].join(`
`)}function Lh(t,n=!1){let e=t.shapeInfo.logicalShape;switch(e.length){case 0:return pbe(t,n);case 1:return dbe(t,n);case 2:return mbe(t,n);case 3:return ybe(t,n);case 4:return vbe(t,n);case 5:return bbe(t);case 6:return wbe(t);default:throw new Error(`${e.length}-D input sampling is not yet supported`)}}function VH(t,n){switch(t.shapeInfo.logicalShape.length){case 0:return cbe(t);case 1:return fbe(t,n);case 2:return hbe(t,n);case 3:return gbe(t,n);default:return xbe(t,n)}}function Gve(t,n,e=!1,r){let o="";e?o+=VH(t,r):o+=Lh(t,r);let i=t.shapeInfo.logicalShape,s=n.logicalShape;return i.length<=s.length&&(e?o+=Cbe(t,n):o+=Sbe(t,n)),o}function Wve(t,n,e){switch(t.length){case 0:return BH();case 1:return ebe(t,n,e);case 2:return lbe(t,n,e);case 3:return nbe(t,n,e);default:return obe(t,n,e)}}function Hve(t,n,e){switch(t.length){case 0:return BH();case 1:return tbe(t,n,e);case 2:return ube(t,n,e);case 3:return rbe(t,n,e);case 4:return ibe(t,n,e);case 5:return sbe(t,n);case 6:return abe(t,n);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function jve(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function qve(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function Kve(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function Xve(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Yve}
    ${Zve}
    ${Qve}
  `}var Yve=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Zve=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Qve=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Jve=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function BH(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function ebe(t,n,e){let r=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];return r[0]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?e?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${r[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return 2 * (resTexRC.x * ${r[1]} + resTexRC.y);
    }
  `}function tbe(t,n,e){return n[0]===1?e?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?e?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${n[0]}.0);
      }
    `:e?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return resTexRC.x * ${n[1]} + resTexRC.y;
    }
  `}function nbe(t,n,e){if(e)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let r=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],o=Math.ceil(t[2]/2),i=o*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function rbe(t,n,e){if(e)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${$p(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;let r=zi(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${r}
      return ivec3(r, c, d);
    }
  `}function obe(t,n,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let r=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],o=Math.ceil(t[t.length-1]/2),i=o*Math.ceil(t[t.length-2]/2),s=i,a="",l="b, r, c";for(let u=2;u<t.length-1;u++)s*=t[t.length-u-1],a=`
      int b${u} = index / ${s};
      index -= b${u} * ${s};
    `+a,l=`b${u}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${t.length}(${l});
    }
  `}function ibe(t,n,e){if(e)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${$p(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;let r=zi(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${r}
      return ivec4(r, c, d, d2);
    }
  `}function sbe(t,n){let e=zi(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${n[0]},
                             ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function abe(t,n){let e=zi(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function lbe(t,n,e){let r=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];if(v.arraysEqual(t,n))return e?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `;let o=Math.ceil(t[1]/2);return e?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function ube(t,n,e){return v.arraysEqual(t,n)?e?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `:t[1]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?e?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:e?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Pp(t){return`offset${t}`}function cbe(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=jt();return`
    vec4 ${e}() {
      return ${r.texture2D}(${n}, halfCR);
    }
  `}function pbe(t,n){let e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return`float ${r}() {return ${e};}`;let[o,i]=t.shapeInfo.texShape;if(o===1&&i===1)return`
      float ${r}() {
        return sampleTexture(${e}, halfCR);
      }
    `;let s=Pp(e);if(n)return`
    float ${r}() {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], ${s});
      return sampleTexture(${e}, uv);
    }
  `;let[a,l]=t.shapeInfo.texShape;return`
    float ${r}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${s});
      return sampleTexture(${e}, uv);
    }
  `}function fbe(t,n){let e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=jt();if(n)return`
    vec4 ${r}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${e}, uv);
    }
  `;let s=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${r}(int index) {
      vec2 uv = packedUVfrom1D(
        ${s[0]}, ${s[1]}, index);
      return ${i.texture2D}(${e}, uv);
    }
  `}function dbe(t,n){let e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return`
      float ${r}(int index) {
        ${Vh(t)}
      }
    `;let o=t.shapeInfo.texShape,i=o[0],s=o[1];if(s===1&&i===1)return`
      float ${r}(int index) {
        return sampleTexture(${e}, halfCR);
      }
    `;let a=Pp(e);return s===1?n?`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${e}TexShape[0]));
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${e}, uv);
      }
    `:i===1?n?`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${e}TexShape[1]), 0.5);
        return sampleTexture(${e}, uv);
      }
    `:`
      float ${r}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${s}.0, 0.5);
        return sampleTexture(${e}, uv);
      }
    `:n?`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${e}TexShape[0], ${e}TexShape[1], index + ${a});
      return sampleTexture(${e}, uv);
    }
  `:`
    float ${r}(int index) {
      vec2 uv = uvFromFlat(${i}, ${s}, index + ${a});
      return sampleTexture(${e}, uv);
    }
  `}function hbe(t,n){let e=t.shapeInfo.logicalShape,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,s=i[0],a=i[1],l=jt();if(i!=null&&v.arraysEqual(e,i))return n?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);

        return ${l.texture2D}(${r}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${s}.0);

        return ${l.texture2D}(${r}, uv);
      }
    `;if(n)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `;let u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(e[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${r}, uv);
    }
  `}function mbe(t,n){let e=t.shapeInfo.logicalShape,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape;if(i!=null&&v.arraysEqual(e,i)){if(n)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `;let f=i[0],d=i[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${f}.0);
      return sampleTexture(${r}, uv);
    }
  `}let{newShape:s,keptDims:a}=v.squeezeShape(e),l=s;if(l.length<e.length){let f=Bh(t,l),d=["row","col"];return`
      ${Lh(f,n)}
      float ${o}(int row, int col) {
        return ${o}(${zh(d,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${e[1]}, 1)));
        ${Vh(t)}
      }
    `;let u=i[0],c=i[1],p=Pp(r);return c===1?n?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${r}, uv);
    }
  `:u===1?n?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${r}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${e[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${r}, uv);
    }
  `:n?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${r}Shape[1] + col + ${p};
        vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
        return sampleTexture(${r}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${e[1]} + col + ${p};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${r}, uv);
  }
`}function gbe(t,n){let e=t.shapeInfo.logicalShape,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(e[0]===1){let f=e.slice(1),d=[1,2],h=Bh(t,f),m=["b","row","col"];return`
        ${VH(h,n)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${zh(m,d)});
        }
      `}let a=jt();if(n)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${r}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `;let l=s[0],u=s[1],c=Math.ceil(e[2]/2),p=c*Math.ceil(e[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${p}, ${c}, b, row, col);
      return ${a.texture2D}(${r}, uv);
    }
  `}function ybe(t,n){let e=t.shapeInfo.logicalShape,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e[1]*e[2],s=e[2],{newShape:a,keptDims:l}=v.squeezeShape(e),u=a;if(u.length<e.length){let m=Bh(t,u),g=["row","col","depth"];return`
        ${Lh(m,n)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${zh(g,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${s}, 1)));
        ${Vh(t)}
      }
    `;let c=t.shapeInfo.texShape,p=c[0],f=c[1],d=t.shapeInfo.flatOffset;if(f===i&&d==null)return n?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${r}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${s}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${p}.0);
          return sampleTexture(${r}, uv);
        }
      `;if(f===s&&d==null)return n?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${r}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${e[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${p}.0);
      return sampleTexture(${r}, uv);
    }
  `;let h=Pp(r);return n?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${r}Shape[1] * ${r}Shape[2];
      int stride1 = ${r}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${h};
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index);
      return sampleTexture(${r}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${s} + depth + ${h};
        vec2 uv = uvFromFlat(${p}, ${f}, index);
        return sampleTexture(${r}, uv);
      }
  `}function xbe(t,n){let e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=jt();if(n)return`
    vec4 ${r}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${e}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${e}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${e}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${e}TexShape[0]) / 2.0), ceil(float(${e}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${e}, uv);
    }
  `;let i=t.shapeInfo.logicalShape,s=i.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],c=l[1],p=Math.ceil(i[s-1]/2),f=p*Math.ceil(i[s-2]/2),d="int b, int row, int col",h=`b * ${f} + (row / 2) * ${p} + (col / 2)`;for(let m=2;m<s-1;m++)d=`int b${m}, `+d,f*=i[s-m-1],h=`b${m} * ${f} + `+h;return`
    vec4 ${r}(${d}) {
      int index = ${h};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${o.texture2D}(${e}, uv);
    }
  `}function vbe(t,n){let e=t.shapeInfo.logicalShape,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e[3],s=e[2]*i,a=e[1]*s,{newShape:l,keptDims:u}=v.squeezeShape(e);if(l.length<e.length){let x=Bh(t,l),b=["row","col","depth","depth2"];return`
      ${Lh(x,n)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${zh(b,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${s}, ${i}, 1)));
        ${Vh(t)}
      }
    `;let c=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],d=p[1],h=`int stride2 = ${r}Shape[3];`,m=`int stride1 = ${r}Shape[2] * stride2;`,g=`int stride0 = ${r}Shape[1] * stride1;`;if(d===a&&c==null)return n?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${h}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${s}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(d===i&&c==null)return n?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r}Shape[1] * ${r}Shape[2], ${r}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${r}TexShape[1], ${r}TexShape[0]);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${e[1]*e[2]}, ${e[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;let y=Pp(r);return n?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${h}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${y});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${f}, ${d}, index + ${y});
      return sampleTexture(${r}, uv);
    }
  `}function bbe(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[4],i=n[3]*o,s=n[2]*i,a=n[1]*s,{newShape:l,keptDims:u}=v.squeezeShape(n);if(l.length<n.length){let m=Bh(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${Lh(m)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${zh(g,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${s}, ${i}, ${o})) +
          depth3;
        ${Vh(t)}
      }
    `;let c=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],d=p[1];if(d===a&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${s}, ${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(d===o&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]},
               ${n[2]*n[3]}, ${n[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;let h=Pp(e);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} + depth * ${i} +
          depth2 * ${o} + depth3 + ${h};
      vec2 uv = uvFromFlat(${f}, ${d}, index);
      return sampleTexture(${e}, uv);
    }
  `}function wbe(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:o,keptDims:i}=v.squeezeShape(n);if(o.length<n.length){let g=Bh(t,o),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Lh(g)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${zh(y,i)});
      }
    `}let s=n[5],a=n[4]*s,l=n[3]*a,u=n[2]*l,c=n[1]*u;if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${s}, 1)));
        ${Vh(t)}
      }
    `;let p=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,d=f[0],h=f[1];if(h===c&&p==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${s})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${h}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(h===s&&p==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]*n[4]},
               ${n[2]*n[3]*n[4]},
               ${n[3]*n[4]},
               ${n[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${h}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;let m=Pp(e);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${s} + depth4 + ${m};
      vec2 uv = uvFromFlat(${d}, ${h}, index);
      return sampleTexture(${e}, uv);
    }
  `}function Vh(t){let n=t.name,e=v.sizeFromShape(t.shapeInfo.logicalShape);return e<2?`return ${n};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${n}[i];
      }
    }
  `}function Cbe(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,s=n.logicalShape.length,a=PH(t.shapeInfo.logicalShape,n.logicalShape),l=Me(s),u=s-i,c,p=["x","y","z","w","u","v"];i===0?c="":s<2&&a.length>=1?c="coords = 0;":c=a.map(x=>`coords.${p[x+u]} = 0;`).join(`
`);let f="";s<2&&i>0?f="coords":f=t.shapeInfo.logicalShape.map((x,b)=>`coords.${p[b+u]}`).join(", ");let d="return outputValue;",m=v.sizeFromShape(t.shapeInfo.logicalShape)===1,y=v.sizeFromShape(n.logicalShape)===1;if(i===1&&!m&&!y)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!y)s===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(a.length){let x=i-2,b=i-1;a.indexOf(x)>-1&&a.indexOf(b)>-1?d="return vec4(outputValue.x);":a.indexOf(x)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${r}(${f});
      ${d}
    }
  `}function Sbe(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=n.texShape,s=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=n.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&v.arraysEqual(s,i))return`
      float ${o}() {
        return sampleTexture(${e}, resultUV);
      }
    `;let u=Me(l),c=PH(t.shapeInfo.logicalShape,n.logicalShape),p=l-a,f,d=["x","y","z","w","u","v"];a===0?f="":l<2&&c.length>=1?f="coords = 0;":f=c.map(m=>`coords.${d[m+p]} = 0;`).join(`
`);let h="";return l<2&&a>0?h="coords":h=t.shapeInfo.logicalShape.map((m,g)=>`coords.${d[g+p]}`).join(", "),`
    float ${o}() {
      ${u} coords = getOutputCoords();
      ${f}
      return get${r}(${h});
    }
  `}function Me(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function CC(t,n,e){let{newShape:r,keptDims:o}=v.squeezeShape(n),i=n.length,s=t&&i===3&&n[0]===1,a=s?n.slice(1):r,l=!t&&i>1&&!v.arraysEqual(n,e)&&r.length<i||s;return{useSqueezeShape:l,uniformShape:l?a:n,keptDims:o}}function Bh(t,n){let e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function zh(t,n){return n.map(e=>t[e]).join(", ")}function UH(t,n,e,r){let o=e.map((c,p)=>{let f={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(f.flatOffset=c.texData.slice.flatOffset),{name:n.variableNames[p],shapeInfo:f}}),i=o.map(c=>c.shapeInfo),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},a=LH(o,s,n),l=xH(t.gl,a),u=t.createProgram(l);return P().get("ENGINE_COMPILE_ONLY")?{program:n,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:s,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(u),Object.assign({program:n,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:i,outShapeInfo:s},JA(t,n,u)))}function JA(t,n,e){let r=[],o=[],i,s,a,l=null,u=null;u=t.getUniformLocation(e,"NAN",!1),P().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(e,"INFINITY",!1));let c=!1;for(let p of n.variableNames){let f={name:p,uniform:t.getUniformLocation(e,p,c),offset:t.getUniformLocation(e,`offset${p}`,c)};n.enableShapeUniforms&&(f.shape=t.getUniformLocation(e,`${p}Shape`,c),f.texShape=t.getUniformLocation(e,`${p}TexShape`,c)),r.push(f)}if(n.enableShapeUniforms&&(i=t.getUniformLocation(e,"outShape",c),a=t.getUniformLocation(e,"outShapeStrides",c),s=t.getUniformLocation(e,"outTexShape",c)),n.customUniforms)for(let p of n.customUniforms)o.push(t.getUniformLocation(e,p.name,c));return{variablesLocations:r,customUniformLocations:o,infLoc:l,nanLoc:u,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:s}}function zH(t,n){if(t.length!==n.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${n.length} inputs`);t.forEach((e,r)=>{let o=e.logicalShape,i=n[r],s=i.shape;if(!v.arraysEqual(o,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${s} must match`);if(e.isUniform&&i.isUniform)return;let a=e.texShape,l=i.isUniform?null:i.texData.texShape;if(!v.arraysEqual(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function GH(t,n,e,r,o){n.program.enableShapeUniforms||(zH(n.inShapeInfos,e),zH([n.outShapeInfo],[r]));let i=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i.texture,s[0],s[1]):t.setOutputMatrixTexture(i.texture,s[0],s[1]),t.setProgram(n.webGLProgram),t.bindVertexArray(n.webGLProgram.vao),P().getNumber("WEBGL_VERSION")===1&&n.infLoc!==null&&t.gl.uniform1f(n.infLoc,1/0),n.nanLoc!==null&&t.gl.uniform1f(n.nanLoc,NaN);for(let l=0;l<e.length;++l){let u=e[l],{uniform:c,offset:p,shape:f,texShape:d}=n.variablesLocations[l];if(f){let{uniformShape:h}=CC(n.program.packedInputs,u.shape,u.texData.texShape);switch(h.length){case 1:t.gl.uniform1iv(f,new Int32Array(h));break;case 2:t.gl.uniform2iv(f,new Int32Array(h));break;case 3:t.gl.uniform3iv(f,new Int32Array(h));break;case 4:t.gl.uniform4iv(f,new Int32Array(h));break;default:break}}if(d&&t.gl.uniform2i(d,u.texData.texShape[0],u.texData.texShape[1]),c!=null){if(u.isUniform){if(v.sizeFromShape(u.shape)<2)t.gl.uniform1f(c,u.uniformValues[0]);else{let h=u.uniformValues;h instanceof Float32Array||(h=new Float32Array(h)),t.gl.uniform1fv(c,h)}continue}u.texData.slice!=null&&p!=null&&t.gl.uniform1i(p,u.texData.slice.flatOffset),t.setInputMatrixTexture(u.texData.texture.texture,c,l)}}let a=n.outShapeLocation;if(a)switch(r.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(r.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(r.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(r.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(r.shape));break;default:break}if(n.outShapeStridesLocation){let l=v.computeStrides(r.shape);switch(r.shape.length){case 2:t.gl.uniform1iv(n.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(n.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(n.outShapeStridesLocation,new Int32Array(l));break;default:break}}if(n.outTexShapeLocation&&t.gl.uniform2i(n.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),n.program.customUniforms&&o)for(let l=0;l<n.program.customUniforms.length;++l){let u=n.program.customUniforms[l],c=n.customUniformLocations[l],p=o[l];if(u.type==="float")t.gl.uniform1fv(c,p);else if(u.type==="vec2")t.gl.uniform2fv(c,p);else if(u.type==="vec3")t.gl.uniform3fv(c,p);else if(u.type==="vec4")t.gl.uniform4fv(c,p);else if(u.type==="int")t.gl.uniform1iv(c,p);else if(u.type==="ivec2")t.gl.uniform2iv(c,p);else if(u.type==="ivec3")t.gl.uniform3iv(c,p);else if(u.type==="ivec4")t.gl.uniform4iv(c,p);else throw Error(`uniform type ${u.type} is not supported yet.`)}t.executeProgram()}function WH(t,n,e){let r="";n.concat(e).forEach(s=>{let a=s.texData!=null&&s.texData.slice!=null&&s.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!s.isUniform){let l=s.texData.texShape,{useSqueezeShape:u,uniformShape:c,keptDims:p}=CC(t.packedInputs,s.shape,l),f="",d="",h="";if(c.length===1&&t.packedInputs){let C=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${C[0]>1}_${C[1]>1}`}else if(c.length===2&&!t.packedInputs)d=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!t.packedInputs){let C=v.computeStrides(c);h=`${C[0]===l[1]}_${C[C.length-1]===l[1]}`}let m=s.shape.length,g=c.length===2&&v.arraysEqual(s.shape,l),y=v.sizeFromShape(s.shape)===1,x=S.getBroadcastDims(s.shape,e.shape),b=!t.packedInputs&&m===e.shape.length&&v.arraysEqual(l,e.texData.texShape),w=t.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;r+=`${m}_${b}_${u?p:""}_${c.length}_${y}_${x}_${g}_${f}_${d}_${h}_${w}_${a}`}else{let l=s.isUniform?"uniform":s.texData.texShape;r+=`${s.shape}_${l}_${a}`}});let o=t.userCode,i=t.constructor.name;return i+="_"+r+"_"+o+`${P().getNumber("WEBGL_VERSION")}`,i}function gt(t){return P().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}var SC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Mp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let e=jt();this.outputShape=n,this.enableShapeUniforms=gt(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?$p(["r","c","d"],n):zi(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${e.output} = result;
      }
    `}};var IC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Mp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let e=jt();this.outputShape=n,this.enableShapeUniforms=gt(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?$p(["r","c","d"],n):zi(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${e.output} = result;
      }
    `}};var EC=class{constructor(n){this.variableNames=["A"],this.outTexUsage=dr.DOWNLOAD;let e=jt();this.outputShape=n,this.userCode=`
      ${wC}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}};var TC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=dr.DOWNLOAD;let e=jt();this.outputShape=n,this.userCode=`
      ${wC}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}};var Tbe={R:0,G:1,B:2,A:3},$y=class{constructor(n,e=!1,r="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let o=jt();this.outputShape=n,this.enableShapeUniforms=gt(this.outputShape.length);let i="result";e&&(i="floor(result * 255. + 0.5)");let s="";for(let a=0;a<r.length;a++){let l=r[a];s+=`
          if(offset == ${a}) {
            result = values[${Tbe[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?$h():Fh(n)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${r.length});

        flatIndex = idiv(flatIndex, ${r.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${s}
        }
        ${o.output} = vec4(${i}, 0., 0., 0.);
      }
    `}};var _C=class{constructor(n,e=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=jt();this.outputShape=n,this.enableShapeUniforms=gt(this.outputShape.length);let o="",i="result";e&&(i="floor(result * 255. + 0.5)");for(let s=0;s<=1;s++)for(let a=0;a<=1;a++){let l=s*2+a;o+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${n[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${s} < ${this.enableShapeUniforms?"outShape[1]":`${n[1]}`}) {
            localCoords[1] += ${s};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${r.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?$h():Fh(n)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${r.output} = ${i};
        }
    `}};function HH(t){let n=jt(),e=`${n.version}
    precision highp float;
    ${n.attribute} vec3 clipSpacePos;
    ${n.attribute} vec2 uv;
    ${n.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return yH(t,e)}function jH(t){let n=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return wH(t,n)}function qH(t){let n=new Uint16Array([0,1,2,2,1,3]);return CH(t,n)}function Py(t,n,e,r,o,i){IH(n,e);let s=SH(t),a=t.TEXTURE_2D;return de(t,()=>t.bindTexture(a,s)),de(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),de(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),de(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),de(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),P().getNumber("WEBGL_VERSION")===1?de(t,()=>t.texImage2D(a,0,r,n,e,0,o,i,null)):de(t,()=>t.texStorage2D(a,1,r,n,e)),de(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:s,texShape:[e,n]}}function eR(t){return t.internalFormatFloat}function KH(t,n,e,r){let[o,i]=Op(n,e);return Py(t,o,i,eR(r),r.textureFormatFloat,t.FLOAT)}function tR(t){return t.internalFormatHalfFloat}function XH(t,n,e,r){let[o,i]=Op(n,e);return Py(t,o,i,tR(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function nR(t){return t.downloadTextureFormat}function YH(t,n,e,r){let[o,i]=Op(n,e);return Py(t,o,i,nR(r),t.RGBA,t.UNSIGNED_BYTE)}function rR(t){return t.internalFormatPackedFloat}function ZH(t,n,e,r){let[o,i]=ws(n,e);return Py(t,o,i,rR(r),t.RGBA,t.FLOAT)}function oR(t){return t.internalFormatPackedHalfFloat}function QH(t,n,e,r){let[o,i]=ws(n,e);return Py(t,o,i,oR(r),t.RGBA,r.textureTypeHalfFloat)}function JH(t,n,e){return de(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),YA(t,n,"clipSpacePos",e,3,20,0)&&YA(t,n,"uv",e,2,20,12)}function ej(t,n,e,r,o,i){de(t,()=>t.bindTexture(t.TEXTURE_2D,n));let s,a,l;o instanceof Uint8Array?(s=new Uint8Array(e*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(s=new Float32Array(e*r*4),a=t.FLOAT,l=i.internalFormatPackedFloat),s.set(o),P().getNumber("WEBGL_VERSION")===2?de(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,e,r,t.RGBA,a,s)):de(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,e,r,0,t.RGBA,a,s)),de(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function tj(t,n,e){de(t,()=>t.bindTexture(t.TEXTURE_2D,n)),e.data instanceof Uint8Array?P().getNumber("WEBGL_VERSION")===2?de(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,e.width,e.height,t.RGBA,t.UNSIGNED_BYTE,e.data)):de(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,e.data)):P().getNumber("WEBGL_VERSION")===2?de(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e)):de(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)),de(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function nj(t,n,e,r){let o=t.createBuffer();de(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,o));let a=4*4*n*e;return de(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),de(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,0)),de(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),o}function rj(t,n,e){let r=t,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function oj(t,n,e,r){let[o,i]=Op(n,e),s=4,a=new Uint8Array(hH(n*e,s));return de(t,()=>t.readPixels(0,0,o,i,r.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function ij(t,n,e,r,o,i,s,a){let l=t,u=new Float32Array(mH(i,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,n),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function sj(t,n,e){let r=new Float32Array(n*e*4);return de(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,r)),r}var Uh=class{constructor(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let e=P().getNumber("WEBGL_VERSION");if(n!=null?(this.gl=n,dH(e,n)):this.gl=po(e),n=this.gl,P().getNumber("WEBGL_VERSION")===2){let i=n;this.createVertexArray=()=>de(i,()=>i.createVertexArray()),this.bindVertexArray=s=>de(i,()=>i.bindVertexArray(s)),this.deleteVertexArray=s=>de(i,()=>i.deleteVertexArray(s)),this.getVertexArray=()=>de(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(n!=null){let i=n.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>de(n,()=>i.createVertexArrayOES()),this.bindVertexArray=s=>de(n,()=>i.bindVertexArrayOES(s)),this.deleteVertexArray=s=>de(n,()=>i.deleteVertexArrayOES(s)),this.getVertexArray=()=>de(n,()=>n.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let r="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),P().getNumber("WEBGL_VERSION")===1){let i="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=My(this.gl,i),Fo(this.gl,s))this.textureHalfFloatExtension=My(this.gl,s);else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Fo(this.gl,o))this.colorBufferHalfFloatExtension=My(this.gl,o);else if(P().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Fo(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Fo(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=jH(this.gl),this.indexBuffer=qH(this.gl),this.framebuffer=EH(this.gl),this.textureConfig=Ry(this.gl,this.textureHalfFloatExtension)}get debug(){return P().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let n=this.gl;de(n,()=>n.finish()),de(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,null)),de(n,()=>n.deleteFramebuffer(this.framebuffer)),de(n,()=>n.bindBuffer(n.ARRAY_BUFFER,null)),de(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)),de(n,()=>n.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(n,e){return this.throwIfDisposed(),KH(this.gl,n,e,this.textureConfig)}createFloat16MatrixTexture(n,e){return this.throwIfDisposed(),XH(this.gl,n,e,this.textureConfig)}createUnsignedBytesMatrixTexture(n,e){return this.throwIfDisposed(),YH(this.gl,n,e,this.textureConfig)}uploadPixelDataToTexture(n,e){this.throwIfDisposed(),tj(this.gl,n,e)}uploadDenseMatrixToTexture(n,e,r,o){this.throwIfDisposed(),ej(this.gl,n,e,r,o,this.textureConfig)}createFloat16PackedMatrixTexture(n,e){return this.throwIfDisposed(),QH(this.gl,n,e,this.textureConfig)}createPackedMatrixTexture(n,e){return this.throwIfDisposed(),ZH(this.gl,n,e,this.textureConfig)}deleteMatrixTexture(n){this.throwIfDisposed(),this.outputTexture===n&&(ZA(this.gl,this.framebuffer),this.outputTexture=null),de(this.gl,()=>this.gl.deleteTexture(n))}downloadByteEncodedFloatMatrixFromOutputTexture(n,e,r){return this.downloadMatrixDriver(n,()=>oj(this.gl,e,r,this.textureConfig))}downloadPackedMatrixFromBuffer(n,e,r,o,i,s){return ij(this.gl,n,e,r,o,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(n,e){return rj(this.gl,n,e)}createBufferFromTexture(n,e,r){this.bindTextureToFrameBuffer(n);let o=nj(this.gl,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let n=this.createFence(this.gl);return this.pollFence(n)}createFence(n){let e,r;if(P().getBool("WEBGL_FENCE_API_ENABLED")){let o=n,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=()=>{let s=o.clientWaitSync(i,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},e=i}else P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(e,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:e,isFencePassed:r}}downloadMatrixFromPackedTexture(n,e,r){return this.downloadMatrixDriver(n,()=>sj(this.gl,e,r))}createProgram(n){this.throwIfDisposed();let e=this.gl;this.vertexShader==null&&(this.vertexShader=HH(e));let r=vH(e);de(e,()=>e.attachShader(r,this.vertexShader)),de(e,()=>e.attachShader(r,n)),bH(e,r);let o=Object.assign(r,{vao:this.createVertexArray()});return this.debug&&xC(e,o),o}buildVao(n){this.setProgram(n),this.bindVertexArray(n.vao);let e=this.gl;de(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),JH(e,n,this.vertexBuffer)}deleteProgram(n){this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&(de(this.gl,()=>this.gl.deleteProgram(n)),this.deleteVertexArray(n.vao))}setProgram(n){this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&xC(this.gl,this.program),de(this.gl,()=>this.gl.useProgram(n))}getUniformLocation(n,e,r=!0){return this.throwIfDisposed(),r?TH(this.gl,n,e):_H(this.gl,n,e)}getAttributeLocation(n,e){return this.throwIfDisposed(),de(this.gl,()=>this.gl.getAttribLocation(n,e))}getUniformLocationNoThrow(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)}setInputMatrixTexture(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),NH(this.gl,n,e,r)}setOutputMatrixTexture(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)}setOutputPackedMatrixTexture(n,e,r){this.throwIfDisposed();let[o,i]=ws(e,r);this.setOutputMatrixTextureDriver(n,o,i)}setOutputMatrixWriteRegion(n,e,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,e)}setOutputPackedMatrixWriteRegion(n,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&xC(this.gl,this.program),Oy(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let n=this.gl;if(this.debug){let e=this.getVertexArray();console.assert(e===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}de(n,()=>n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),de(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=My(this.gl,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(o.TIME_ELAPSED_EXT,i),i}let n=this.getQueryTimerExtensionWebGL1(),e=n.createQueryEXT();return n.beginQueryEXT(n.TIME_ELAPSED_EXT,e),e}endQuery(){if(P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT);return}let n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}waitForQueryAndGetTime(n){return B(this,null,function*(){return yield v.repeatedTry(()=>this.disposed||this.isQueryAvailable(n,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(n,P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})}getQueryTime(n,e){if(e===0)return null;if(e===2){let r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}else{let r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(n,e){if(e===0)return!0;if(e===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{let r=this.getQueryTimerExtensionWebGL1(),o=r.getQueryObjectEXT(n,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(n){return new Promise(e=>{this.addItemToPoll(()=>n.isFencePassed(),()=>e())})}pollItems(){let n=Nbe(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=n;++e){let{resolveFn:r}=this.itemsToPoll[e];r()}this.itemsToPoll=this.itemsToPoll.slice(n+1)}addItemToPoll(n,e){if(this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),this.itemsToPoll.length>1)return;let r;"setTimeoutCustom"in P().platform&&(r=P().platform.setTimeoutCustom.bind(P().platform)),v.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,r)}bindTextureToFrameBuffer(n){this.throwIfDisposed(),vC(this.gl,n,this.framebuffer),this.debug&&Oy(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(vC(this.gl,this.outputTexture,this.framebuffer),this.debug&&Oy(this.gl)):ZA(this.gl,this.framebuffer)}downloadMatrixDriver(n,e){this.bindTextureToFrameBuffer(n);let r=e();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(n,e,r){this.throwIfDisposed();let o=this.gl;vC(o,n,this.framebuffer),this.debug&&Oy(o),this.outputTexture=n,de(o,()=>o.viewport(0,0,e,r)),de(o,()=>o.scissor(0,0,e,r))}setOutputMatrixWriteRegionDriver(n,e,r,o){this.throwIfDisposed(),de(this.gl,()=>this.gl.scissor(n,e,r,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function Nbe(t){let n=0;for(;n<t.length&&t[n]();++n);return n-1}var{addImpl:aj,bincountImpl:NC,bincountReduceImpl:lj,bitwiseAndImpl:uj,castImpl:cj,ceilImpl:pj,concatImpl:fj,equalImpl:dj,expImpl:hj,expm1Impl:mj,floorImpl:gj,gatherNdImpl:yj,gatherV2Impl:xj,greaterImpl:vj,greaterEqualImpl:bj,lessImpl:wj,lessEqualImpl:Cj,linSpaceImpl:Sj,logImpl:Ij,maxImpl:Ej,maximumImpl:Tj,minimumImpl:_j,multiplyImpl:Nj,negImpl:Dj,notEqualImpl:kj,prodImpl:Aj,raggedGatherImpl:Rj,raggedRangeImpl:Mj,raggedTensorToTensorImpl:Oj,rangeImpl:Fj,rsqrtImpl:$j,scatterImpl:Pj,sigmoidImpl:Lj,simpleAbsImpl:DC,sliceImpl:Vj,sparseFillEmptyRowsImpl:Bj,sparseReshapeImpl:zj,sparseSegmentReductionImpl:kC,sqrtImpl:Uj,staticRegexReplaceImpl:Gj,stridedSliceImpl:Wj,stringNGramsImpl:Hj,stringSplitImpl:jj,stringToHashBucketFastImpl:qj,subImpl:Kj,tileImpl:Xj,topKImpl:Yj,transposeImpl:Lp,uniqueImpl:Zj}=RA;function iR(t,n){return["x","y","z","w","u","v"].slice(0,n).map(e=>`${t}.${e}`)}function nn(t,n){return n===1?[t]:iR(t,n)}function Qj(t,n){if(t===1)return"rc";let e="";for(let r=0;r<t;r++)e+=n[r],r<t-1&&(e+=",");return e}var AC=class{constructor(n){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n,this.rank=n.length,this.enableShapeUniforms=gt(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let e=nn("rc",this.rank),r=Me(this.rank),o=this.getOutOfBoundsCondition(e),i=this.getSetup(e),s=this.getOutput(e);this.userCode=`
        void main() {
          ${r} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${s}));
          }
        }
      `}}getSourceCoordsArr(n){let e=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let i=`${r===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let s=2;s<this.rank;s++)i=`${n[n.length-1-s]},`+i;e.push(i)}return e}getOutOfBoundsCondition(n){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let e="";for(let r=this.rank-2;r<this.rank;r++)e+=`${n[r]} >= ${this.enableShapeUniforms?`outShape[${r}]`:this.outputShape[r]}`,r<this.rank-1&&(e+="||");return e}getSetup(n){if(this.rank===1)return"";let e=n.slice(-2),r=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${e[0]};
      int c = ${e[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${r};
      bool rEdge = rp1 >= ${o};
    `}getOutput(n){let e=this.getSourceCoordsArr(n);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${e[0]}),
            cEdge ? 0. : getA(${e[1]}),
            rEdge ? 0. : getA(${e[2]}),
            rEdge || cEdge ? 0. : getA(${e[3]})`}};var Gh=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=n,this.enableShapeUniforms=gt(this.outputShape.length);let r="";for(let o=0;o<4;o++){let i="thisRC = rc;";o%2===1&&(i+="thisRC.z += 1;"),o>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${Dbe(e,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?$h():Fh(n)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":n[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":n[2]};

        ${r}

        setOutput(result);
      }
    `}};function Dbe(t,n){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${n?$H(["r","c","d"],"inputShape"):zi(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}var RC=class{constructor(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(n,e,r){let o=eq(e,r),i=tq(n,o,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);let s=Jj(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return o===or.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):o===or.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):o===or.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):o===or.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):o===or.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(n,e,r,o){if(this.freeTextures==null)return;let i=eq(r,o),s=tq(e,i,o);s in this.freeTextures||(this.freeTextures[s]=[]);let a=Jj(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=P().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(n.texture),this._numBytesAllocated-=a):(this.freeTextures[s].push(n),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let u=this.usedTextures[s],c=u&&u.indexOf(n);if(c==null||c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[c]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;let n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${n})`);let e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let n in this.freeTextures)this.freeTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});for(let n in this.usedTextures)this.usedTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function kbe(t,n){let e=t;if(n===e.R32F)return 4;if(n===e.R16F)return 2;if(n===e.RGBA32F)return 16;if(n===t.RGBA)return 16;if(n===e.RGBA16F)return 8;if(n===e.RGBA8)return 4;throw new Error(`Unknown internal format ${n}`)}function Jj(t,n,e,r,o){let i=Abe(n,r),s;if(o){let[l,u]=ws(t[0],t[1]);s=l*u}else{let[l,u]=Op(t[0],t[1]);s=l*u}let a=kbe(e,i);return s*a}function Abe(t,n){switch(t){case or.PACKED_2X2_FLOAT32:return rR(n);case or.PACKED_2X2_FLOAT16:return oR(n);case or.UNPACKED_FLOAT32:return eR(n);case or.UNPACKED_FLOAT16:return tR(n);case or.PACKED_4X1_UNSIGNED_BYTE:return nR(n);default:throw new Error(`Unknown physical texture type ${t}`)}}function Rbe(t){return P().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?or.PACKED_2X2_FLOAT32:or.UNPACKED_FLOAT32:t?or.PACKED_2X2_FLOAT16:or.UNPACKED_FLOAT16}function eq(t,n){if(t===dr.UPLOAD)return or.PACKED_2X2_FLOAT32;if(t===dr.RENDER||t==null)return Rbe(n);if(t===dr.DOWNLOAD||t===dr.PIXELS)return or.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function tq(t,n,e){return`${t[0]}_${t[1]}_${n}_${e}`}var Wn=class{constructor(n,e){this.variableNames=["A"],this.outputShape=n,this.enableShapeUniforms=gt(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},gn="if (isnan(x)) return x;",nq="return x;",sR="return abs(x);";var rq="return (x >= 0.0) ? x : (exp(x) - 1.0);",oq=gn+`
  return (x < 0.0) ? 0.0 : x;
`,iq=gn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ss="return x;",sq="return 1.0 / (1.0 + exp(-1.0 * x));";var lq="return x;",uq=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,cq=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pq=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,fq="return 1.0 / (1.0 + exp(-1.0 * x));",zr=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=gt(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var MC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n,this.enableShapeUniforms=gt(this.outputShape.length);let e=n.length,r=nn("rc",e),o=Me(e),i=Qj(e,r),s=r.slice(-2),a=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var Obe=nr.whereImpl,Fbe=1e-7,$be=1e-4,OC={};function Pbe(t){return t in OC||(OC[t]={}),OC[t]}var Lbe=P().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Vbe=600;function Bbe(){return P().global.screen==null?1024:P().global.screen.height*P().global.screen.width*window.devicePixelRatio*Vbe/1024/1024}var dq=(()=>{class t extends Ws{nextDataId(){return t.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!P().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let r;if(e!=null){if(e instanceof Uh)r=e;else{let o=po(P().getNumber("WEBGL_VERSION"),e);r=new Uh(o)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let o=po(P().getNumber("WEBGL_VERSION"));r=new Uh(o),this.binaryCache=Pbe(P().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=r,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new RC(this.gpgpu),this.numMBBeforeWarning=Bbe(),this.texData=new Oc(this,Jo())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,r,o,i,s,a){let l=this.makeTensorInfo(r,o),u=this.texData.get(l.dataId);u.isPacked=!1,u.texture={texture:e,texShape:[i,s]},u.texShape=[i,s];let c=Fy(r),p=new $y(c,!1,a),f=this.runWebGLProgram(p,[l],o,[[i,s]]);return f.shape=r,u.texture=null,this.disposeIntermediateTensorInfo(l),f.dataId}write(e,r,o){if((P().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||P().getBool("DEBUG"))&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let i={id:this.nextDataId()};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:dr.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){let r=this.texData.get(e);r.refCount++}decRef(e){if(this.texData.has(e)){let r=this.texData.get(e);r.refCount--}}move(e,r,o,i,s){if(P().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:dr.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let r=this.texData.get(e),{values:o,dtype:i,complexTensorInfos:s,slice:a,shape:l,isPacked:u}=r;if(a!=null){let d;u?d=new zr(l,Ss):d=new Wn(l,Ss);let h=this.runWebGLProgram(d,[{dataId:e,shape:l,dtype:i}],i),m=this.readSync(h.dataId);return this.disposeIntermediateTensorInfo(h),m}if(o!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return o;let c=this.activeTimers!=null,p;c&&(p=v.now());let f;if(i==="complex64"){let d=this.readSync(s.real.dataId),h=this.readSync(s.imag.dataId);f=S.mergeRealAndImagArrays(d,h)}else f=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=v.now()-p),this.convertAndCacheOnCPU(e,f)}read(e){return B(this,null,function*(){if(this.pendingRead.has(e)){let m=this.pendingRead.get(e);return new Promise(g=>m.push(g))}let r=this.texData.get(e),{values:o,shape:i,slice:s,dtype:a,complexTensorInfos:l,isPacked:u}=r;if(s!=null){let m;u?m=new zr(i,Ss):m=new Wn(i,Ss);let g=this.runWebGLProgram(m,[{dataId:e,shape:i,dtype:a}],a),y=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),y}if(o!=null)return this.convertAndCacheOnCPU(e);if(P().getBool("DEBUG")&&!P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&P().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,p;if(a!=="complex64"&&P().get("WEBGL_BUFFER_SUPPORTED")){p=this.decode(e);let m=this.texData.get(p.dataId);c=this.gpgpu.createBufferFromTexture(m.texture.texture,...Ay(i))}this.pendingRead.set(e,[]),a!=="complex64"&&(yield this.gpgpu.createAndWaitForFence());let f;if(a==="complex64"){let m=yield Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),g=m[0],y=m[1];f=S.mergeRealAndImagArrays(g,y)}else if(c==null)f=this.getValuesFromTexture(e);else{let m=v.sizeFromShape(i);f=this.gpgpu.downloadFloat32MatrixFromBuffer(c,m)}if(p!=null&&this.disposeIntermediateTensorInfo(p),c!=null){let m=this.gpgpu.gl;de(m,()=>m.deleteBuffer(c))}let d=this.convertAndCacheOnCPU(e,f),h=this.pendingRead.get(e);return this.pendingRead.delete(e),h.forEach(m=>m(d)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Jo().removeDataId(e,this),this.pendingDeletes--),d})}readToGPU(e,r={}){let o=this.texData.get(e),{values:i,shape:s,slice:a,dtype:l,isPacked:u,texture:c}=o;if(l==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(a!=null){let h;u?h=new zr(s,Ss):h=new Wn(s,Ss);let m=this.runWebGLProgram(h,[{dataId:e,shape:s,dtype:l}],l),g=this.readToGPU(m,r);return this.disposeIntermediateTensorInfo(m),g}if(c==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let p=this.decode(e,r.customTexShape),f=Jo().makeTensorFromTensorInfo(p),d=this.texData.get(p.dataId);return Object.assign({tensorRef:f},d.texture)}bufferSync(e){let r=this.readSync(e.dataId);if(e.dtype==="string")try{let o=r.map(i=>v.decodeString(i));return ve(e.shape,e.dtype,o)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return ve(e.shape,e.dtype,r)}checkNumericalProblems(e){if(e!=null)for(let r=0;r<e.length;r++){let o=e[r];if(!gH(o))throw P().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${o} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${o} cannot be represented on this device.`)}}getValuesFromTexture(e){let{shape:r,dtype:o,isPacked:i}=this.texData.get(e),s=v.sizeFromShape(r);if(P().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let d=this.decode(e),h=this.texData.get(d.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(h.texture.texture,...Ay(r)).subarray(0,s);return this.disposeIntermediateTensorInfo(d),m}let a=P().getBool("WEBGL_PACK")&&i===!0,l=a?Fy(r):r,u=a?new TC(l):new EC(l),c=this.runWebGLProgram(u,[{shape:l,dtype:o,dataId:e}],"float32"),p=this.texData.get(c.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture.texture,p.texShape[0],p.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(c),f}timerAvailable(){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){let r=this.activeTimers,o=[],i=!1;this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e();let s=v.flatten(this.activeTimers.map(u=>u.query)).filter(u=>u!=null),a=v.flatten(this.activeTimers.map(u=>u.name)).filter(u=>u!=null);this.activeTimers=r,i&&(this.programTimersStack=null);let l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return B(this,null,function*(){if(P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let u=yield Promise.all(s);l.kernelMs=v.sum(u),l.getExtraProfileInfo=()=>u.map((c,p)=>({name:a[p],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l})}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:v.now(),endMs:null}}endTimer(e){return P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=v.now(),e)}getQueryTime(e){return B(this,null,function*(){if(P().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let r=e;return r.endMs-r.startMs})}disposeData(e,r=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(r?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!r&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:o}=this.texData.get(e);return o!=null&&(this.disposeData(o.real.dataId,r),this.disposeData(o.imag.dataId,r)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:r,dtype:o,texShape:i,usage:s,isPacked:a,slice:l}=this.texData.get(e),u=l&&l.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),r!=null&&(this.numBytesInGPU-=this.computeBytes(i,o),this.textureManager.releaseTexture(r,i,s,a)));let p=this.texData.get(e);p.texture=null,p.texShape=null,p.isPacked=!1,p.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,r=Lbe){return P().getBool("WEBGL_CPU_FORWARD")&&e.every(o=>this.texData.get(o.dataId).texture==null&&v.sizeFromShape(o.shape)<r)}getGPGPUContext(){return this.gpgpu}where(e){S.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let r=e.dataSync();return Obe(e.shape,r)}packedUnaryOp(e,r,o){let i=new zr(e.shape,r),s=this.compileAndRun(i,[e],o);return Jo().makeTensorFromTensorInfo(s)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){let i=DC(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(P().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,sR,e.dtype);let r=new Wn(e.shape,sR),o=this.compileAndRun(r,[e]);return Jo().makeTensorFromTensorInfo(o)}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&v.isString(o[0])){let s=o.map(a=>v.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:r}}makeOutput(e,r,o){return Jo().makeTensorFromTensorInfo(this.makeTensorInfo(e,r,o),this)}unpackTensor(e){let r=new MC(e.shape);return this.runWebGLProgram(r,[e],e.dtype)}packTensor(e){let r=new AC(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)}packedReshape(e,r){let o=[Ku(e.shape),...Xu(e.shape)],i={dtype:e.dtype,shape:o,dataId:e.dataId},s=[Ku(r),...Xu(r)],a=new Gh(s,o),l=!0,u=[o],c=this.runWebGLProgram(a,[i],e.dtype,u,l);return{dataId:c.dataId,shape:r,dtype:c.dtype}}decode(e,r){let o=this.texData.get(e),{isPacked:i,shape:s,dtype:a}=o;if(r!=null){let d=v.sizeFromShape(s),h=r[0]*r[1]*4;v.assert(d<=h,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}let l=Fy(s),u;i?u=new IC(l):u=new SC(l);let c=!0,p=[r??Ay(l)],f=this.runWebGLProgram(u,[{shape:l,dtype:a,dataId:e}],a,p,c,r);return{dtype:a,shape:s,dataId:f.dataId}}runWebGLProgram(e,r,o,i,s=!1,a){let l=this.makeTensorInfo(e.outputShape,o),u=this.texData.get(l.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===Mp.DENSE){let x=a??Ay(e.outputShape);u.texShape=x.map(b=>b*2)}if(e.outTexUsage!=null&&(u.usage=e.outTexUsage),v.sizeFromShape(l.shape)===0)return u.values=v.getTypedArrayFromDType(l.dtype,0),l;let c=[],p=r.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(x.dataId);if(b.texture==null){if(!e.packedInputs&&v.sizeFromShape(x.shape)<=P().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=x.shape)}if(this.uploadToGPU(x.dataId),!!b.isPacked!=!!e.packedInputs)x=b.isPacked?this.unpackTensor(x):this.packTensor(x),c.push(x),b=this.texData.get(x.dataId);else if(b.isPacked&&!Fp(b.shape,x.shape)){let w=x,C=x.shape;x.shape=b.shape,x=this.packedReshape(x,C),c.push(x),b=this.texData.get(x.dataId),w.shape=C}return{shape:x.shape,texData:b,isUniform:!1}});this.uploadToGPU(l.dataId);let f={shape:l.shape,texData:u,isUniform:!1},d=WH(e,p,f),h=this.getAndSaveBinary(d,()=>UH(this.gpgpu,e,p,f)),m=this.activeTimers!=null,g;m&&(g=this.startTimer()),P().get("ENGINE_COMPILE_ONLY")||GH(this.gpgpu,h,p,f,i),c.forEach(x=>this.disposeIntermediateTensorInfo(x)),m&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));let y=P().getNumber("WEBGL_FLUSH_THRESHOLD");if(y>0){let x=v.now();x-this.lastGlFlushTime>y&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!P().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&s===!1){let x=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),x}return l}compileAndRun(e,r,o,i,s=!1){return o=o||r[0].dtype,this.runWebGLProgram(e,r,o,i,s)}getAndSaveBinary(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(P().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(r=>{this.gpgpu.deleteProgram(this.binaryCache[r].webGLProgram),delete this.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=L(()=>{if(!P().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=P().getBool("DEBUG");P().set("DEBUG",!1);let r=this.abs(Se(1e-8)).dataSync()[0];if(P().set("DEBUG",e),r>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Fbe:$be}uploadToGPU(e){let r=this.texData.get(e),{shape:o,dtype:i,values:s,texture:a,usage:l,isPacked:u}=r;if(a!=null)return;let c=this.activeTimers!=null,p;c&&(p=v.now());let f=r.texShape;if(f==null&&(f=DH(o,u),r.texShape=f),s!=null){let d=Fy(o),h,m=f[1],g=f[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(u||!y)&&([m,g]=ws(f[0],f[1])),u?h=new _C(d,y):h=new $y(d,y);let x=y?[g,m]:f,b=this.makeTensorInfo(x,i),w=this.texData.get(b.dataId);y?w.usage=dr.PIXELS:w.usage=dr.UPLOAD,w.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),m,g,s);let C=[[g,m]],D=this.runWebGLProgram(h,[b],i,C,!0),k=this.texData.get(D.dataId);r.texShape=k.texShape,r.isPacked=k.isPacked,r.usage=k.usage,P().get("ENGINE_COMPILE_ONLY")?this.disposeData(D.dataId):(r.texture=k.texture,r.values=null,this.texData.delete(D.dataId)),this.disposeIntermediateTensorInfo(b),c&&(this.uploadWaitMs+=v.now()-p)}else{let d=this.acquireTexture(f,l,i,u);r.texture=d}}convertAndCacheOnCPU(e,r){let o=this.texData.get(e),{dtype:i}=o;return r!=null&&(o.values=zbe(r,i)),o.values}acquireTexture(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,r,i)}computeBytes(e,r){return e[0]*e[1]*v.bytesPerElement(r)}checkCompileCompletion(){for(let[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}checkCompileCompletionAsync(){return B(this,null,function*(){let e=[];if(this.gpgpu.parallelCompilationExtension){for(let[,r]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(r));return Promise.all(e)}else{for(let[,r]of Object.entries(this.binaryCache)){let o=new Promise(i=>{try{this.checkCompletion_(r),i(!0)}catch(s){throw s}});e.push(o)}return Promise.all(e)}})}checkCompletionAsync_(e){return B(this,null,function*(){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(yield sy(),this.checkCompletionAsync_(e))})}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(XA(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(let e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);let{variablesLocations:r,customUniformLocations:o,infLoc:i,nanLoc:s,outShapeLocation:a,outShapeStridesLocation:l,outTexShapeLocation:u}=JA(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=r,e.customUniformLocations=o,e.infLoc=i,e.nanLoc=s,e.outShapeLocation=a,e.outShapeStridesLocation=l,e.outTexShapeLocation=u}}createTensorFromGPUData(e,r,o){e.channels=e.channels||"RGBA";let{texture:i,height:s,width:a,channels:l}=e,u=Jo().backend;if(!u.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let c=u.writeTexture(i,r,o,s,a,l);return Jo().makeTensorFromDataId(c,r,o,u)}}return t.nextDataId=0,t})();function zbe(t,n){if(n==="float32"||n==="complex64")return t;if(n==="int32"||n==="bool"){let e=n==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let r=0;r<e.length;++r)e[r]=Math.round(t[r]);return e}else throw new Error(`Unknown dtype ${n}`)}Mu.isBrowser()&&m0("webgl",()=>new dq,2);var Wh=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var Ur=class{constructor(n,e,r){this.variableNames=["A","B"],this.outputShape=S.assertAndGetBroadcastShape(e,r),this.enableShapeUniforms=gt(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${n}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var ho=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;var fo=class{constructor(n,e,r,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=S.assertAndGetBroadcastShape(e,r);let i=this.outputShape.length;this.enableShapeUniforms=gt(i);let s="";if(o)if(i===0||v.sizeFromShape(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${Me(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?s+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let l=nn("coords",i);this.enableShapeUniforms?s+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:s+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${n}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}};function rn(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var hq={kernelName:is,backendName:"webgl",kernelFunc:rn};function Gr(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.makeTensorInfo(r.shape,"complex64"),s=e.texData.get(i.dataId),a=rn({inputs:{x:r},backend:e}),l=rn({inputs:{x:o},backend:e});return s.complexTensorInfos={real:a,imag:l},i}var mq={kernelName:id,backendName:"webgl",kernelFunc:Gr};var aR="return (a < 0.) ? b * a : a;",lR=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Ube(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r,s=e.makeTensorInfo([],"float32",v.createScalarValue(i,"float32")),a=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new fo(lR,o.shape,s.shape):new Ur(aR,o.shape,s.shape),l=e.runWebGLProgram(a,[o,s],"float32");return e.disposeIntermediateTensorInfo(s),l}var gq={kernelName:ru,backendName:"webgl",kernelFunc:Ube};var uR="return (a < 0.) ? b * a : a;",cR=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Gbe(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n,i=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new fo(cR,r.shape,o.shape):new Ur(uR,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],"float32")}var yq={kernelName:gu,backendName:"webgl",kernelFunc:Gbe};var hi="if (isnan(x)) return x;";function xe({opSnippet:t,packedOpSnippet:n,cpuKernelImpl:e,dtype:r}){return({inputs:o,backend:i})=>{let{x:s}=o,a=i,l=r||s.dtype;if(a.shouldExecuteOnCPU([s])&&e!=null){let p=a.texData.get(s.dataId),f=e(p.values,l);return a.makeTensorInfo(s.shape,l,f)}let u=P().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&n!=null,c;return u?c=new zr(s.shape,n):c=new Wn(s.shape,t),a.runWebGLProgram(c,[s],l)}}function ct({opSnippet:t,packedOpSnippet:n,checkOutOfBounds:e=!1,supportsComplex:r=!1,cpuKernelImpl:o,dtype:i}){return({inputs:s,backend:a})=>{let{a:l,b:u}=s,c=a;if(r&&l.dtype==="complex64"){let h=c.texData.get(l.dataId),m=c.texData.get(u.dataId),[g,y]=[[h.complexTensorInfos.real,m.complexTensorInfos.real],[h.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(b=>{let[w,C]=b,N={dataId:w.dataId,dtype:w.dtype,shape:l.shape},D={dataId:C.dataId,dtype:C.dtype,shape:u.shape},k=new Ur(t,l.shape,u.shape);return c.runWebGLProgram(k,[N,D],un(w.dtype,C.dtype))}),x=Gr({inputs:{real:g,imag:y},backend:c});return c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(y),x}let p=i||un(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||c.shouldExecuteOnCPU([l,u]))&&o!=null){let h=c.texData.get(l.dataId).values,m=c.texData.get(u.dataId).values,g=l.dtype==="string"?S.fromUint8ToStringArray(h):h,y=l.dtype==="string"?S.fromUint8ToStringArray(m):m,[x,b]=o(l.shape,u.shape,g,y,p),w=c.makeTensorInfo(b,p),C=c.texData.get(w.dataId);return C.values=x,w}let f=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&n!=null,d;return f?d=new fo(n,l.shape,u.shape,e):d=new Ur(t,l.shape,u.shape),c.runWebGLProgram(d,[l,u],p)}}function ll(t,n=!1){if(t==="linear")return n?lq:nq;if(t==="relu")return n?cq:oq;if(t==="elu")return n?uq:rq;if(t==="relu6")return n?pq:iq;if(t==="prelu")return n?cR:uR;if(t==="leakyrelu")return n?lR:aR;if(t==="sigmoid")return n?fq:sq;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}var Hh=class{constructor(n,e,r,o=!1,i=!1,s=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=gt(this.outputShape.length);let c=o?n[1]:n[2],p=Math.ceil(c/2),f=o?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",h=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",y="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");let x=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",w="rc.x";n[0]<e[0]?b=`imod(rc.x, ${n[0]})`:e[0]<n[0]&&(w=`imod(rc.x, ${e[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${p}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${b};
        int batchB = ${w};
        for (int i = 0; i < ${p}; i++) {
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${h[0]} * ${m[0]});
          result += (${h[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${x}

        ${y}

        setOutput(result);
      }
    `}};var pR={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},Ly=class{constructor(n,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=S.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${n}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var xq="return a * b;";function Vy(t){let{inputs:n,backend:e}=t,{a:r,b:o}=n,i=S.upcastType(r.dtype,o.dtype);if(r.dtype==="complex64"){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),u=new Ly(pR.REAL,r.shape,o.shape),c=new Ly(pR.IMAG,r.shape,o.shape),p=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],f=e.runWebGLProgram(u,p,"float32"),d=e.runWebGLProgram(c,p,"float32"),h=Gr({inputs:{real:f,imag:d},backend:e});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(d),h}if(e.shouldExecuteOnCPU([r,o])){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),[u,c]=Nj(r.shape,o.shape,a.values,l.values,i),p=e.makeTensorInfo(c,i),f=e.texData.get(p.dataId);return f.values=u,p}let s;return P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?s=new fo(xq,r.shape,o.shape):s=new Ur(xq,r.shape,o.shape),e.runWebGLProgram(s,[r,o],i)}var vq={kernelName:va,backendName:"webgl",kernelFunc:Vy};function bq(t,n,e){let r=[Ku(t.shape),...Xu(t.shape)],o={dtype:t.dtype,shape:r,dataId:t.dataId},i=[Ku(n),...Xu(n)],s=new Gh(i,r),a=!0,l=[r],u=e.runWebGLProgram(s,[o],t.dtype,l,a);return{dataId:u.dataId,shape:n,dtype:u.dtype}}function ne(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=e,a=v.sizeFromShape(o.shape),l=v.inferFromImplicitShape(i,a),u=v.sizeFromShape(l);v.assert(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let c=s.texData.get(o.dataId);return c.isPacked&&!Fp(o.shape,l)&&!(c.texture!==null&&Fp(c.shape,l))?bq(o,l,s):(s.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}var wq={kernelName:xu,backendName:"webgl",kernelFunc:ne};var By=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a=Math.floor(r/4)*4,l=r%4,u="sumValue += dot(values, ones);";if(e!=null){let p=1/e;u=`sumValue += dot(values * ${v.isInt(p)?p.toPrecision(2):p}, ones);`}let c="";i%r>0&&(c=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}};var FC=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a="0.0",l="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",l="min"):e==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");let c=Math.floor(r/4)*4,p=r%4,f=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${e==="min"} || ${e==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";e==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):e==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let h="";i%r>0&&(h=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${h}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${c};
        if (${p===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${p===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${p===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${u});
      }
    `}};function Hbe(t){let n=[];for(;n.length===0||n[n.length-1].outSize!==1;){let e=n.length?n[n.length-1].outSize:t[1],r=S.computeOptimalWindowSize(e);n.push({inSize:e,windowSize:r,outSize:Math.ceil(e/r)})}return n}function mo(t,n,e,r){let o=Hbe(t.shape),i=t;for(let s=0;s<o.length;s++){let{inSize:a,windowSize:l,outSize:u}=o[s],c,p;e==="mean"?c=s===0?new By({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},a):new By({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u}):c=new FC({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},e),p=i,i=r.runWebGLProgram(c,[i],n),p.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(p)}return i}var $C=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[e[s]];this.outputShape=r,this.rank=r.length;let o=Me(this.rank),i=jbe(e);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}};function jbe(t){let n=t.length;if(n>6)throw Error(`Transpose for rank ${n} is not yet supported`);let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(n);for(let o=0;o<t.length;o++)r[t[o]]=e[o];return r.join()}var PC=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let r=new Array(n.length);for(let c=0;c<r.length;c++)r[c]=n[e[c]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=Me(this.rank),i=iR("rc",this.rank),s=new Array(this.rank);for(let c=0;c<e.length;c++)s[e[c]]=i[c];let a=`vec2(${s.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,u=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}};function Yu(t,n,e){let r=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new PC(t.shape,n):new $C(t.shape,n);return e.runWebGLProgram(r,[t],t.dtype)}function Cq(t,n,e,r){let o=n,i=t.shape.length,s=v.parseAxisParam(o,t.shape),a=s,l=S.getAxesPermutation(a,i),u=l!=null,c=t;u&&(c=Yu(t,l,r),a=S.getInnerMostAxes(a.length,i)),S.assertAxesAreInnerMostDims("sum",a,i);let[p,f]=S.computeOutAndReduceShapes(c.shape,a),d=p;e&&(d=S.expandShapeToKeepDim(p,s));let h=v.sizeFromShape(f),g=v.sizeFromShape(t.shape)/h,y=ne({inputs:{x:c},attrs:{shape:[g,h]},backend:r}),x=ep(t.dtype),b=mo(y,x,"sum",r),w=ne({inputs:{x:b},attrs:{shape:d},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(b),u&&r.disposeIntermediateTensorInfo(c),w}function Vp(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;return Cq(o,i,s,e)}var Sq={kernelName:Iu,backendName:"webgl",kernelFunc:Vp};function Lt(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{perm:i}=r,s=e,a=o.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=o.shape[i[c]];let u;if(s.shouldExecuteOnCPU([o])){let p=s.texData.get(o.dataId).values,f=Lp(p,o.shape,o.dtype,i,l);u=s.makeTensorInfo(l,o.dtype);let d=s.texData.get(u.dataId);d.values=f}else u=Yu(o,i,s);return u}var Iq={kernelName:as,backendName:"webgl",kernelFunc:Lt};var fR=1e3;function Bp({a:t,b:n,transposeA:e,transposeB:r,backend:o,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:l=null}){let u=t.shape.length,c=n.shape.length,p=e?t.shape[u-2]:t.shape[u-1],f=r?n.shape[c-1]:n.shape[c-2],d=e?t.shape[u-1]:t.shape[u-2],h=r?n.shape[c-2]:n.shape[c-1],m=t.shape.slice(0,-2),g=n.shape.slice(0,-2),y=v.sizeFromShape(m),x=v.sizeFromShape(g),w=io.assertAndGetBroadcastShape(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([d,h]);v.assert(p===f,()=>`Error in matMul: inner shapes (${p}) and (${f}) of Tensors with shapes ${t.shape} and ${n.shape} and transposeA=${e} and transposeB=${r} must match.`);let C=e?[y,p,d]:[y,d,p],N=r?[x,h,f]:[x,f,h],D=ne({inputs:{x:t},backend:o,attrs:{shape:C}}),k=ne({inputs:{x:n},backend:o,attrs:{shape:N}}),O=[D,k],$=Math.max(y,x),V=e?D.shape[1]:D.shape[2],G=i!=null,W=s!=null,H=l==="leakyrelu",j=l!=null?ll(l,!0):null,Y=G||W||H||j!=null,ee;if((d===1||h===1)&&V>fR&&Y===!1){let te=D,re=k;e&&(te=Lt({inputs:{x:D},backend:o,attrs:{perm:[0,2,1]}}),O.push(te)),r&&(re=Lt({inputs:{x:k},backend:o,attrs:{perm:[0,2,1]}}),O.push(re));let oe=h!==1,ae=h===1,ie=te;oe&&(ie=ne({inputs:{x:te},backend:o,attrs:{shape:[$,V,1]}}),O.push(ie));let fe=h===1?2:1,le=re;ae&&(le=ne({inputs:{x:re},backend:o,attrs:{shape:[$,1,V]}}),O.push(le));let ye=Vy({inputs:{a:ie,b:le},backend:o});ee=Vp({inputs:{x:ye},backend:o,attrs:{axis:fe,keepDims:!0}}),O.push(ye)}else{let te=un(t.dtype,n.dtype),re=new Hh(C,N,[$,d,h],e,r,G,j,W,H),oe=[D,k];if(i!=null&&oe.push(i),W&&oe.push(s),H){let ae=o.makeTensorInfo([],"float32",v.createScalarValue(a,"float32"));oe.push(ae),O.push(ae)}ee=o.runWebGLProgram(re,oe,te)}let X=ne({inputs:{x:ee},backend:o,attrs:{shape:w}});O.push(ee);for(let te of O)o.disposeIntermediateTensorInfo(te);return X}function qbe(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:p}=r;return Bp({a:o,b:i,transposeA:l,transposeB:u,backend:e,bias:s,preluActivationWeights:a,leakyreluAlpha:p,activation:c})}var Eq={kernelName:jc,backendName:"webgl",kernelFunc:qbe};var Tq="return abs(x);";function Kbe(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let i=e.texData.get(r.dataId),s=DC(i.values);return e.makeTensorInfo(r.shape,r.dtype,s)}let o;return P().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new zr(r.shape,Tq):o=new Wn(r.shape,Tq),e.runWebGLProgram(o,[r],r.dtype)}var _q={kernelName:Vl,backendName:"webgl",kernelFunc:Kbe};var Xbe=gn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Ybe=xe({opSnippet:Xbe}),Nq={kernelName:js,backendName:"webgl",kernelFunc:Ybe};var Zbe=gn+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Qbe=xe({opSnippet:Zbe}),Dq={kernelName:qs,backendName:"webgl",kernelFunc:Qbe};var kq="return a + b;",Jbe=ct({opSnippet:kq,packedOpSnippet:kq,supportsComplex:!0,cpuKernelImpl:aj}),Aq={kernelName:_i,backendName:"webgl",kernelFunc:Jbe};var LC=class{constructor(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var VC=class{constructor(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function BC(t){let{inputs:n,backend:e}=t,r=n;if(r.length===1)return rn({inputs:{x:r[0]},backend:e});if(r.length>P().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(r.length/2),u=BC({inputs:r.slice(0,l),backend:e}),c=BC({inputs:r.slice(l),backend:e});return BC({inputs:[u,c],backend:e})}let o=r.map(l=>l.dtype).reduce((l,u)=>un(l,u)),i=r.map(l=>l.shape),a=P().getBool("WEBGL_PACK")?new VC(r[0].shape,i):new LC(r[0].shape,i);return e.runWebGLProgram(a,r,o)}var Rq={kernelName:Jf,backendName:"webgl",kernelFunc:BC};function e0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=v.parseAxisParam(i,o.shape),u=l,c=S.getAxesPermutation(u,a),p=o;c!=null&&(p=Lt({inputs:{x:o},backend:e,attrs:{perm:c}}),u=S.getInnerMostAxes(u.length,a)),S.assertAxesAreInnerMostDims("all",u,a);let[f,d]=S.computeOutAndReduceShapes(p.shape,u),h=v.sizeFromShape(d),m=ne({inputs:{x:p},backend:e,attrs:{shape:[-1,h]}}),g=mo(m,m.dtype,"all",e),y;if(s){let x=S.expandShapeToKeepDim(f,l);y=ne({inputs:{x:g},backend:e,attrs:{shape:x}})}else y=ne({inputs:{x:g},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),c!=null&&e.disposeIntermediateTensorInfo(p),y}var Mq={kernelName:ed,backendName:"webgl",kernelFunc:e0e};function t0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=v.parseAxisParam(i,o.shape),u=l,c=S.getAxesPermutation(u,a),p=o;c!=null&&(p=Lt({inputs:{x:o},backend:e,attrs:{perm:c}}),u=S.getInnerMostAxes(u.length,a)),S.assertAxesAreInnerMostDims("any",u,a);let[f,d]=S.computeOutAndReduceShapes(p.shape,u),h=v.sizeFromShape(d),m=ne({inputs:{x:p},backend:e,attrs:{shape:[-1,h]}}),g=mo(m,m.dtype,"any",e),y;if(s){let x=S.expandShapeToKeepDim(f,l);y=ne({inputs:{x:g},backend:e,attrs:{shape:x}})}else y=ne({inputs:{x:g},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),c!=null&&e.disposeIntermediateTensorInfo(p),y}var Oq={kernelName:td,backendName:"webgl",kernelFunc:t0e};var zC=class{constructor(n,e,r){this.variableNames=["A"];let{windowSize:o,batchSize:i,outSize:s}=n;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];let a=e==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var UC=class{constructor(n,e,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,v.assert(n.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);let i=n[n.length-1],s=Math.ceil(i/e);this.outputShape=n.slice(0,-1),s>1&&this.outputShape.push(s),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,l=a.length,u=Me(l),c=nn("coords",l),p,f;if(s===1){f=l+1;let k=Me(f);p=`
        ${k} sourceLocR = ${k}(${c.join()}, 0);
        ++${c[l-1]};
        ${k} sourceLocG = ${k}(${c.join()}, 0);
        ++${c[l-2]};
        ${k} sourceLocA = ${k}(${c.join()}, 0);
        --${c[l-1]};
        ${k} sourceLocB = ${k}(${c.join()}, 0);
        --${c[l-2]};`}else f=l,p=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;let d=["x","y","z","w","u","v"].slice(0,f),h="."+d[f-1],m=d.map(k=>"int "+k),g=nn("sourceLocR",f-1).concat("inIdx.r"),y=nn("sourceLocG",f-1).concat("inIdx.g"),x=nn("sourceLocB",f-1).concat("inIdx.b"),b=nn("sourceLocA",f-1).concat("inIdx.a"),w=r==="max"?"greaterThan":"lessThan",C=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${b.join()})));`,N=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${x.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,D=o?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${D}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};
        ${p}
        ivec4 srcIdx = ivec4(sourceLocR${h}, sourceLocG${h},
          sourceLocB${h}, sourceLocA${h}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${N};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${C}
          vec4 candidate = ${N};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function Fq(t,n,e,r=null){let o=n.shape[0],i=n.shape[1];r!=null&&(o=r.shape[0],i=r.shape[1]);let s=S.computeOptimalWindowSize(i),a={windowSize:s,inSize:i,batchSize:o,outSize:Math.ceil(i/s)},l=new zC(a,e,r==null),u=[n];r!=null&&u.push(r);let c=t.runWebGLProgram(l,u,"int32");if(c.shape[1]===1)return c;let p=Fq(t,n,e,c);return t.disposeIntermediateTensorInfo(c),p}function $q(t,n,e,r=null){let o=r!=null?r.shape:n.shape,i=o[o.length-1],s=S.computeOptimalWindowSize(i),a=new UC(o,s,e,r==null),l=r==null?[n]:[n,r],u=t.runWebGLProgram(a,l,"int32");if(u.shape.length===n.shape.length){let c=$q(t,n,e,u);return t.disposeIntermediateTensorInfo(u),c}return u}function GC(t,n,e,r){let o=[e];if(S.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,n.shape.length),!P().getBool("WEBGL_PACK_REDUCE")||n.shape.length<=2){let i=[],s=t.texData.get(n.dataId),a=s!==null&&s.isPacked,l=n;a&&(l=t.unpackTensor(n),i.push(l));let[u,c]=S.computeOutAndReduceShapes(l.shape,o),p=v.sizeFromShape(c),f=ne({inputs:{x:l},backend:t,attrs:{shape:[-1,p]}});i.push(f);let d=Fq(t,f,r);i.push(d);let h=ne({inputs:{x:d},backend:t,attrs:{shape:u}});return i.forEach(m=>t.disposeIntermediateTensorInfo(m)),h}return $q(t,n,r)}function n0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=v.parseAxisParam(i,o.shape),a=S.getAxesPermutation(s,o.shape.length),l=o,u=[];a!=null&&(l=Lt({inputs:{x:o},backend:e,attrs:{perm:a}}),u.push(l),s=S.getInnerMostAxes(s.length,l.shape.length)),S.assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);let c=GC(e,l,s[0],"max");return u.forEach(p=>e.disposeIntermediateTensorInfo(p)),c}var Pq={kernelName:Bl,backendName:"webgl",kernelFunc:n0e};function r0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=v.parseAxisParam(i,o.shape),a=S.getAxesPermutation(s,o.shape.length),l=o,u=[];a!=null&&(l=Lt({inputs:{x:o},backend:e,attrs:{perm:a}}),u.push(l),s=S.getInnerMostAxes(s.length,l.shape.length)),S.assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);let c=GC(e,l,s[0],"min");return u.forEach(p=>e.disposeIntermediateTensorInfo(p)),c}var Lq={kernelName:zl,backendName:"webgl",kernelFunc:r0e};var o0e=gn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,i0e=xe({opSnippet:o0e}),Vq={kernelName:Ks,backendName:"webgl",kernelFunc:i0e};var s0e=gn+"return log(x + sqrt(x * x + 1.0));",a0e=xe({opSnippet:s0e}),Bq={kernelName:Xs,backendName:"webgl",kernelFunc:a0e};var l0e=gn+`
  return atan(x);
`,u0e=xe({opSnippet:l0e}),zq={kernelName:Ys,backendName:"webgl",kernelFunc:u0e};var c0e=Wh+`
  return atan(a, b);
`,p0e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ho+`
  return result;
`,f0e=ct({opSnippet:c0e,packedOpSnippet:p0e}),Uq={kernelName:Qs,backendName:"webgl",kernelFunc:f0e};var d0e=gn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,h0e=xe({opSnippet:d0e}),Gq={kernelName:Zs,backendName:"webgl",kernelFunc:h0e};var Ui=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideHeight,l=n.strideWidth,u=n.dilationHeight,c=n.dilationWidth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,d=n.padInfo.top,h=n.padInfo.left;this.outputShape=n.outShape;let m=e==="avg",g=`((batch  * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + d`,y=`(xR * ${n.inWidth} + xC) * ${n.inChannels} + d`,x="0.0";if(m||(x="-1.0 / 1e-20"),r){let k=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${d}, ${h});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${k} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?i?g:y:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let b="max",w=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(w="avgValue / max(count, 1.0)");let C=Math.floor(s/4)*4,N=s%4,D=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${d}, ${h});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${p};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${C}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${D}
          }

          int xC = xCCorner + ${C};
          if (${N===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${N===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${N===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${D}
          }
        }
        setOutput(${w});
      }
    `}},Zu=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideDepth,l=n.strideHeight,u=n.strideWidth,c=n.dilationDepth,p=n.dilationHeight,f=n.dilationWidth,d=n.effectiveFilterDepth,h=n.effectiveFilterHeight,m=n.effectiveFilterWidth,g=n.padInfo.front,y=n.padInfo.top,x=n.padInfo.left;this.outputShape=n.outShape;let b=e==="avg",w="0.0";if(b||(w="-1.0 / 1e-20"),r){let $=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${g}, ${y}, ${x});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${n.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${h};
                wR += ${p}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${$} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?i?`(((batch * ${n.inDepth} + xD) * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`((xD * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`wD * ${h} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let C="max",N=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(N="avgValue / max(count, 1.0)");let D=Math.floor(s/4)*4,k=s%4,O=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${C}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${g}, ${y}, ${x});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h};
            wR += ${p}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${D}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${O}
            }

            int xC = xCCorner + ${D};
            if (${k===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${O}
            } else if (${k===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${O}
            } else if (${k===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${O}
            }
          }
        }
        setOutput(${N});
      }
    `}};function m0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Cs(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,u=1;v.assert(S.eitherStridesOrDilationsAreOne(s,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let c=S.computePool2DInfo(o.shape,i,s,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&v.arraysEqual(c.inShape,c.outShape))return rn({inputs:{x:o},backend:e});let p=new Ui(c,"avg",!1);return e.runWebGLProgram(p,[o],"float32")}var Wq={kernelName:Ul,backendName:"webgl",kernelFunc:m0e};function g0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:u}=r,c=[1,1,1],p=S.computePool3DInfo(o.shape,i,s,c,a,l,u),f=new Zu(p,"avg",!1);return e.runWebGLProgram(f,[o],"float32")}var Hq={kernelName:Gl,backendName:"webgl",kernelFunc:g0e};var WC=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterHeight,u=n.effectiveFilterWidth,c=l-1-n.padInfo.top,p=u-1-n.padInfo.left,f=1/(e*r);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${p});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},HC=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,u=n.dilationHeight,c=n.dilationWidth,p=n.effectiveFilterDepth,f=n.effectiveFilterHeight,d=n.effectiveFilterWidth,h=p-1-n.padInfo.front,m=f-1-n.padInfo.top,g=d-1-n.padInfo.left,y=1/(e*r*o);this.userCode=`
      const ivec3 pads = ivec3(${h}, ${m}, ${g});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function y0e(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=r,p=[1,1,1],f=S.computePool3DInfo(s.shape,a,l,p,u,c),d=new HC(f);return e.runWebGLProgram(d,[o],s.dtype)}var jq={kernelName:rd,backendName:"webgl",kernelFunc:y0e};function x0e(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;Cs([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:u}=r,c=S.computePool2DInfo(s.shape,a,l,1,u),p=new WC(c);return e.runWebGLProgram(p,[o],s.dtype)}var qq={kernelName:nd,backendName:"webgl",kernelFunc:x0e};function v0e(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;return Bp({a:o,b:i,transposeA:s,transposeB:a,backend:e})}var Kq={kernelName:Wl,backendName:"webgl",kernelFunc:v0e};var jC=class{constructor(n,e,r,o,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],S.assertAndGetBroadcastShape(n,e),S.assertAndGetBroadcastShape(n,r);let a="0.0";o!=null&&(S.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(S.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var qC=class{constructor(n,e,r,o,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],S.assertAndGetBroadcastShape(n,e),S.assertAndGetBroadcastShape(n,r);let a="vec4(0.0)";o!=null&&(S.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(S.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var b0e=({inputs:t,backend:n,attrs:e})=>{let{x:r,mean:o,variance:i,offset:s,scale:a}=t;v.assert(o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),v.assert(s==null||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),v.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=e;l==null&&(l=.001);let u=[r,o,i],c=null;s!=null&&(c=s.shape,u.push(s));let p=null;a!=null&&(p=a.shape,u.push(a));let f=P().getBool("WEBGL_PACK_NORMALIZATION")?new qC(r.shape,o.shape,i.shape,c,p,l):new jC(r.shape,o.shape,i.shape,c,p,l);return n.runWebGLProgram(f,u,u[0].dtype)},Xq={kernelName:tu,backendName:"webgl",kernelFunc:b0e};var KC=class{constructor(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;let e=Me(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let r=w0e(this.rank),o,i=n.map((s,a)=>`sourceLoc.${dR[a]} = start[${a}] + coords.${dR[a]};`);o=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${r}));
      }
    `}},dR=["x","y","z","w","u","v"];function w0e(t){if(t===1)return"sourceLoc";if(t<=6)return dR.slice(0,t).map(n=>"sourceLoc."+n).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}var XC=class{constructor(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let e=Me(this.rank),r=nn("coords",this.rank),o=nn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,s=`getChannel(getSource(${o.join()}), ${i})`,a=`
      result.x = ${s};
      if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${s};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${n[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${s};
        if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${s};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${e}(${n.map((c,p)=>`start[${p}]`).join()});`:n.map((c,p)=>`${o[p]} = ${r[p]} + start[${p}];`).join(`
`);this.userCode=`
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}};function C0e(t,n,e,r){let o=r.texData.get(t.dataId),i=r.makeTensorInfo(e,t.dtype),s=r.texData.get(i.dataId);Object.assign(s,o),s.refCount=1,s.shape=e,s.dtype=t.dtype;let a=kn.computeFlatOffset(n,v.computeStrides(t.shape));o.slice&&(a+=o.slice.flatOffset),s.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||t.dataId};let l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),i}function Gi(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r,[a,l]=kn.parseSliceParams(o,i,s);if(kn.assertParamsValid(o,a,l),v.sizeFromShape(l)===0)return e.makeTensorInfo(l,o.dtype,[]);if(e.shouldExecuteOnCPU([o])||o.dtype==="string"){let p=e.texData.get(o.dataId),f=Vj(p.values,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,f)}let{isPacked:u}=e.texData.get(o.dataId),c=kn.isSliceContinous(o.shape,a,l);if(u||!c){let p=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new XC(l):new KC(l),f=[a];return e.runWebGLProgram(p,[o],o.dtype,f)}return e.uploadToGPU(o.dataId),C0e(o,a,l,e)}var Yq={kernelName:Su,backendName:"webgl",kernelFunc:Gi};var S0e=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;v.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((x,b)=>x*b),l=S.getReshaped(o.shape,i,a),u=S.getPermuted(l.length,i.length),c=S.getReshapedPermuted(o.shape,i,a),p=S.getSliceBeginCoords(s,i.length),f=S.getSliceSize(c,s,i.length),d=[],h=ne({inputs:{x:o},backend:e,attrs:{shape:l}}),m=Lt({inputs:{x:h},backend:e,attrs:{perm:u}}),g=ne({inputs:{x:m},backend:e,attrs:{shape:c}}),y=Gi({inputs:{x:g},backend:e,attrs:{begin:p,size:f}});return d.push(h),d.push(m),d.push(g),d.forEach(x=>e.disposeIntermediateTensorInfo(x)),y},Zq={kernelName:Hl,backendName:"webgl",kernelFunc:S0e};function I0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.readSync(o.dataId),l=e.readSync(i.dataId),u=NC(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}var Qq={kernelName:od,backendName:"webgl",kernelFunc:I0e};var E0e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,T0e=`
  return float(int(a.r) & int(b.r));
`;function _0e(t){let{inputs:n,backend:e}=t,{a:r,b:o}=n,i=P().getBool("WEBGL_PACK_BINARY_OPERATIONS"),s=P().getNumber("WEBGL_VERSION");if(e.shouldExecuteOnCPU([r,o])||s===1){let l=e.texData.get(r.dataId).values,u=e.texData.get(o.dataId).values,[c,p]=uj(r.shape,o.shape,l,u,r.dtype),f=e.makeTensorInfo(p,r.dtype),d=e.texData.get(f.dataId);return d.values=c,f}let a;return i?a=new fo(E0e,r.shape,o.shape,!1):a=new Ur(T0e,r.shape,o.shape),e.runWebGLProgram(a,[r,o],r.dtype)}var Jq={kernelName:Eg,backendName:"webgl",kernelFunc:_0e};function N0e(t){let{inputs:n,backend:e}=t,{s0:r,s1:o}=n,i=e.readSync(r.dataId),s=e.readSync(o.dataId),a=S.assertAndGetBroadcastShape(Array.from(i),Array.from(s));return e.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var e5={kernelName:Pb,backendName:"webgl",kernelFunc:N0e};var D0e="return float(a != b);",hR=ct({opSnippet:D0e,cpuKernelImpl:kj,dtype:"bool"}),t5={kernelName:Hc,backendName:"webgl",kernelFunc:hR};function ul(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return rn({inputs:{x:o.complexTensorInfos.real},backend:e})}var n5={kernelName:Dd,backendName:"webgl",kernelFunc:ul};var k0e="return float(int(x));";function r5(t,n){let e=new Wn(t.shape,k0e),r=n.runWebGLProgram(e,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function mR(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return rn({inputs:{x:o},backend:e});let s=At(o.shape),a=mR({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=Gr({inputs:{real:a,imag:s},backend:e});return s.dispose(),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=ul({inputs:{input:o},backend:e}),a=mR({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!v.hasEncodingLoss(o.dtype,i)){let s=rn({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(e.shouldExecuteOnCPU([o])){let s=e.texData.get(o.dataId).values,[a,l,u]=cj(s,o.shape,o.dtype,i);return e.makeTensorInfo(a,l,u)}if(i==="int32")return r5(o,e);if(i==="bool"){let s=e.makeTensorInfo([],"bool",v.getTypedArrayFromDType("bool",1)),l=hR({inputs:{a:o,b:s},backend:e});return e.disposeIntermediateTensorInfo(s),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var o5={kernelName:os,backendName:"webgl",kernelFunc:mR};var i5="return ceil(x);",A0e=xe({opSnippet:i5,packedOpSnippet:i5,cpuKernelImpl:pj}),s5={kernelName:Js,backendName:"webgl",kernelFunc:A0e};var YC=class{constructor(n){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=n,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}};var ZC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=n,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}};function R0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{clipValueMin:i,clipValueMax:s}=r,a;P().getBool("WEBGL_PACK_CLIP")?a=new ZC(o.shape):a=new YC(o.shape);let l=[[i],[s]];return e.runWebGLProgram(a,[o],o.dtype,l)}var a5={kernelName:ea,backendName:"webgl",kernelFunc:R0e};var QC=class{constructor(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function l5(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}}function M0e(t){let{inputs:n,backend:e}=t,{x:r}=n,o=e.texData.get(r.dataId),i=new QC(r.shape),s=[l5(r,o.complexTensorInfos.real),l5(r,o.complexTensorInfos.imag)];return e.runWebGLProgram(i,s,s[0].dtype)}var u5={kernelName:jl,backendName:"webgl",kernelFunc:M0e};var JC=class{constructor(n){this.outputShape=[],this.outputShape=S.computeOutShape(n,1),this.variableNames=n.map((s,a)=>`T${a}`);let e=new Array(n.length-1);e[0]=n[0][1];for(let s=1;s<e.length;s++)e[s]=e[s-1]+n[s][1];let r=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<e.length;s++){let a=e[s-1];r.push(`else if (yC < ${e[s]}) setOutput(getT${s}(yR, yC-${a}));`)}let o=e.length,i=e[e.length-1];r.push(`else setOutput(getT${o}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}};var tS=class{constructor(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=S.computeOutShape(n,e);let r=this.outputShape,o=r.length,i=Me(o),s=nn("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=n.map((m,g)=>`T${g}`);let l=new Array(n.length-1);l[0]=n[0][e];for(let m=1;m<l.length;m++)l[m]=l[m-1]+n[m][e];let u=a[e],c=a.slice(-2),p=a.join(),f=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${p}), vec2(${c.join()}));
        }`;for(let m=1;m<l.length;m++){let g=l[m-1];f+=`
        if (${u} < ${l[m]}  && ${u} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${eS(a,u,g)}),
            vec2(${eS(c,u,g)}));
        }`}let d=l.length,h=l[l.length-1];f+=`
        return getChannel(
          getT${d}(${eS(a,u,h)}),
          vec2(${eS(c,u,h)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${f}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[o-1]} = ${s[o-1]} + 1;
        if (${s[o-1]} < ${r[o-1]}) {
          result.g = getValue(${s});
        }

        ${s[o-2]} = ${s[o-2]} + 1;
        if (${s[o-2]} < ${r[o-2]}) {
          result.a = getValue(${s});
        }

        ${s[o-1]} = ${s[o-1]} - 1;
        if (${s[o-2]} < ${r[o-2]} &&
            ${s[o-1]} < ${r[o-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}};function eS(t,n,e){let r=t.indexOf(n);return t.map((i,s)=>s===r?`${i} - ${e}`:i).join()}function zp(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return rn({inputs:{x:o.complexTensorInfos.imag},backend:e})}var c5={kernelName:wd,backendName:"webgl",kernelFunc:zp};function jh(t,n,e){let r=t[0].dtype;if(r==="complex64"){let d=t.map(x=>ul({inputs:{input:x},backend:e})),h=t.map(x=>zp({inputs:{input:x},backend:e})),m=jh(d,n,e),g=jh(h,n,e),y=Gr({inputs:{real:m,imag:g},backend:e});return d.forEach(x=>e.disposeIntermediateTensorInfo(x)),h.forEach(x=>e.disposeIntermediateTensorInfo(x)),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),y}let o=e.shouldExecuteOnCPU(t);if(r==="string"&&(o=!0),o){let d=t.map(w=>{let N=[-1,v.sizeFromShape(w.shape.slice(n))];return ne({inputs:{x:w},backend:e,attrs:{shape:N}})}),h=d.map(w=>({vals:e.readSync(w.dataId),shape:w.shape})),m=S.computeOutShape(d.map(w=>w.shape),1),g=d[0].shape[0]===1,y=fj(h,m,r,g),x=S.computeOutShape(t.map(w=>w.shape),n),b=e.makeTensorInfo(x,r,y);return d.forEach(w=>e.disposeIntermediateTensorInfo(w)),b}let i=t.filter(d=>v.sizeFromShape(d.shape)>0),s=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){let d=s?new Wn(t[0].shape,Ss):new zr(t[0].shape,Ss);return e.runWebGLProgram(d,t,r)}let a=P().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){let d=[];for(let m=0;m<i.length;m+=a){let g=i.slice(m,m+a);d.push(jh(g,n,e))}let h=jh(d,n,e);for(let m of d)e.disposeIntermediateTensorInfo(m);return h}if(s){let d=new tS(i.map(h=>h.shape),n);return e.runWebGLProgram(d,i,r)}let{tensors2D:l,outShape:u}=O0e(i,n,e),c=new JC(l.map(d=>d.shape)),p=e.runWebGLProgram(c,l,r);l.forEach(d=>e.disposeIntermediateTensorInfo(d));let f=ne({inputs:{x:p},attrs:{shape:u},backend:e});return e.disposeIntermediateTensorInfo(p),f}function O0e(t,n,e){let r=S.computeOutShape(t.map(i=>i.shape),n);return{tensors2D:t.map(i=>ne({inputs:{x:i},attrs:{shape:[-1,v.sizeFromShape(i.shape.slice(n))]},backend:e})),outShape:r}}function gR(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=v.parseAxisParam(o,n[0].shape)[0],s=n.map(u=>u.shape);S.assertParamsConsistent(s,i);let a=S.computeOutShape(n.map(u=>u.shape),i);if(v.sizeFromShape(a)===0)return e.makeTensorInfo(a,n[0].dtype,[]);let l=n.filter(u=>v.sizeFromShape(u.shape)>0);return l.length===1?rn({inputs:{x:l[0]},backend:e}):jh(l,i,e)}var p5={kernelName:ql,backendName:"webgl",kernelFunc:gR};var qh=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,p=n.dilationWidth,f=n.filterHeight,d=n.filterWidth,h=Math.floor(n.inChannels/4)*4,m=n.inChannels%4,g=n.dataFormat==="channelsLast",y=g?1:2,x=g?2:3,b=g?3:1,w="",C="";r&&(o?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:w=`
          float activation(float x) {
            ${r}
          }
        `,C="result = activation(result);");let N=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${x}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${p};

            if (xC < 0 || xC >= ${n.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${h}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${h}) *
                    getW(wR, wC, ${h}, d2);
              } else {
                dotProd +=
                    getX(batch, ${h}, xR, xC) *
                    getW(wR, wC, ${h}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${h}, d2),
                getW(wR, wC, ${h} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${h}),
                  getX(batch, xR, xC, ${h} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${h}, xR, xC),
                  getX(batch, ${h} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${h}, d2),
                getW(wR, wC, ${h} + 1, d2),
                getW(wR, wC, ${h} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${h}),
                  getX(batch, xR, xC, ${h} + 1),
                  getX(batch, xR, xC, ${h} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${h}, xR, xC),
                  getX(batch, ${h} + 1, xR, xC),
                  getX(batch, ${h} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${N}
        ${C}
        setOutput(result);
      }
    `}},nS=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let e=n.padInfo.front,r=n.padInfo.top,o=n.padInfo.left,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,u=n.dilationHeight,c=n.dilationWidth,p=n.filterDepth,f=n.filterHeight,d=n.filterWidth,h=Math.floor(n.inChannels/4)*4,m=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${s}, ${a});
      const ivec3 pads = ivec3(${e}, ${r}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${p}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${h}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${h}) *
                  getW(wF, wR, wC, ${h}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${h}),
                  getX(batch, xF, xR, xC, ${h} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${h}, d2),
                  getW(wF, wR, wC, ${h} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${h}),
                  getX(batch, xF, xR, xC, ${h} + 1),
                  getX(batch, xF, xR, xC, ${h} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${h}, d2),
                  getW(wF, wR, wC, ${h} + 1, d2),
                  getW(wF, wR, wC, ${h} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var Kh=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=n.outShape,this.enableShapeUniforms=gt(this.outputShape.length);let s=n.padInfo.left,a=n.strideWidth,l=n.dilationWidth,u=n.filterHeight,c=n.filterWidth,p=c,f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<c;g++)f+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;f+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${n.inChannels}; d1 += 2) {
       `;for(let g=0;g<c;g++)f+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(p+1)/2;g++){let y=g*2;if(f+=`
           xC = xCCorner + ${y*l};
           `,a===1){if(y<c&&(s%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,l===1&&y>0?f+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<c)){let x=s%2===0?v.nearestLargerEven(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${x};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:f+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):x===1?f+=`
                     xC${y+1} = xTexelC${y};
                     `:f+=`
                     xCOffset = xC + ${x};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<c&&(s%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<c&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<c&&(f+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<c&&(f+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${n.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<c&&(f+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${n.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let d="",h="";r&&(o?d=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${r}
         }`:i?d=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${r}
         }`:d=`vec4 activation(vec4 x) {
           ${r}
         }`,h="result = activation(result);");let m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${d}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${h}
         setOutput(result);
       }
     `}};var rS=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=n,this.enableShapeUniforms=gt(this.outputShape.length);let{dataFormat:r}=e,o=jt(),i=r==="channelsLast",s=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${n[2]} && pos < ${n[1]}) {`,u="";for(let c=0;c<=1;c++)for(let p=0;p<=1;p++)u+=`
          blockIndex = rc.z + ${p};
          pos = rc.y + ${c};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${s}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+p}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+p}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${o.output} = result;
      }
    `}};function oS(t,n){let e=t.length;return e>=3?n?[...t.slice(0,-3),t[e-3]*t[e-2],t[e-1]]:[...t.slice(0,-3),t[e-3],t[e-2]*t[e-1]]:!n&&e===1&&t[0]>1?[t[0],1]:null}function iS({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let l=t.shape,u=r.texData.get(t.dataId),c=e.inChannels,p=l[0]*l[1]*l[2],f=e.outChannels,d=e.dataFormat==="channelsLast",h=!1,m=!1,g,y=[];if(i!=null){let w=oS(i.shape,d);w!=null&&(i=ne({inputs:{x:i},backend:r,attrs:{shape:w}}),y.push(i))}if(o!=null){let w=oS(o.shape,d);w!=null&&(o=ne({inputs:{x:o},backend:r,attrs:{shape:w}}),y.push(o))}if(!((p===1||f===1)&&c>fR)&&u.isPacked&&d&&u.texture!=null&&l[2]%2!==0&&v.arraysEqual(u.shape.slice(-3),l.slice(-3))){let w=l[0]*l[1]*(l[2]+1),C={dataId:t.dataId,shape:[1,w,e.inChannels],dtype:t.dtype},N=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,v.assert(Fp(u.shape,C.shape),()=>`packed reshape ${u.shape} to ${C.shape} isn't free`);let D=ne({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}});y.push(D);let k=Bp({a:C,b:D,backend:r,transposeA:h,transposeB:m,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s}),O=r.texData.get(k.dataId);v.assert(O.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=N,O.shape=e.outShape,g=rn({inputs:{x:k},backend:r}),g.shape=e.outShape,y.push(k)}else{let w=e.outHeight*e.outWidth,C=ne({inputs:{x:t},backend:r,attrs:{shape:d?[e.batchSize,w,e.inChannels]:[e.batchSize,e.inChannels,w]}}),N=ne({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}}),D=Bp({a:d?C:N,b:d?N:C,transposeA:!d,transposeB:m,backend:r,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s});g=ne({inputs:{x:D},backend:r,attrs:{shape:e.outShape}}),y.push(C),y.push(N),y.push(D)}for(let w of y)r.disposeIntermediateTensorInfo(w);return g}function sS({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let{filterWidth:l,filterHeight:u,inChannels:c,outWidth:p,outHeight:f,dataFormat:d}=e,h=d==="channelsLast",m=l*u*c,g=f*p,y=[e.batchSize,m,g],x=!0,b=!1,w=[];if(i!=null){let X=oS(i.shape,h);X!=null&&(i=ne({inputs:{x:i},backend:r,attrs:{shape:X}}),w.push(i))}if(o!=null){let X=oS(o.shape,h);X!=null&&(o=ne({inputs:{x:o},backend:r,attrs:{shape:X}}),w.push(o))}let C=ne({inputs:{x:n},backend:r,attrs:{shape:[1,m,v.sizeFromShape(n.shape)/m]}});w.push(C);let N=new rS(y,e),D=[t.shape,[e.padInfo.top,e.padInfo.left],[e.strideHeight,e.strideWidth],[e.dilationHeight,e.dilationWidth],[e.inChannels],[e.filterWidth*e.inChannels],[e.outWidth]],k=r.runWebGLProgram(N,[t],"float32",D),O=ne({inputs:{x:k},backend:r,attrs:{shape:y}});w.push(k),w.push(O);let $=o!=null,V=i!=null,G=a==="leakyrelu",W=a?ll(a,!0):null,H=new Hh(h?O.shape:C.shape,h?C.shape:O.shape,h?[e.batchSize,g,e.outChannels]:[e.batchSize,e.outChannels,g],x,b,$,W,V,G),j=h?[O,C]:[C,O];if(o&&j.push(o),V&&j.push(i),G){let X=r.makeTensorInfo([],"float32",v.createScalarValue(s,"float32"));j.push(X),w.push(X)}let Y=r.runWebGLProgram(H,j,"float32"),ee=ne({inputs:{x:Y},backend:r,attrs:{shape:e.outShape}});w.push(Y);for(let X of w)r.disposeIntermediateTensorInfo(X);return ee}function F0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=r,p=S.convertConv2DDataFormat(l),f=S.computeConv2DInfo(o.shape,i.shape,s,u,a,c,!1,p),d;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))d=iS({x:o,filter:i,convInfo:f,backend:e});else if(f.strideWidth<=2&&p==="channelsLast"&&P().getBool("WEBGL_EXP_CONV")){let m=new Kh(f),g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];d=e.runWebGLProgram(m,[o,i],"float32",g)}else if(P().getBool("WEBGL_CONV_IM2COL"))d=sS({x:o,filter:i,convInfo:f,backend:e});else{let m=new qh(f);d=e.runWebGLProgram(m,[o,i],"float32")}let h=ne({inputs:{x:d},backend:e,attrs:{shape:f.outShape}});return e.disposeIntermediateTensorInfo(d),h}var f5={kernelName:Kl,backendName:"webgl",kernelFunc:F0e};var aS=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              ${s?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}},lS=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dataFormat==="channelsLast",a=e-1-n.padInfo.top,l=r-1-n.padInfo.left,u=s?1:2,c=s?2:3,p=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${p}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${n.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},uS=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.padInfo.front,s=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yF = 0; yF < ${n.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${i};

            if (xF < 0 || xF >= ${n.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${n.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${s};

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${n.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},cS=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=e-1-n.padInfo.front,u=r-1-n.padInfo.top,c=o-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${n.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${n.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function $0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=r,p=S.convertConv2DDataFormat(l),f=S.computeConv2DInfo(o.shape,c,s,1,a,u,!1,p),d=new aS(f);return e.runWebGLProgram(d,[o,i],"float32")}var d5={kernelName:sd,backendName:"webgl",kernelFunc:$0e};var pS=class{constructor(n){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=n.inShape,this.enableShapeUniforms=gt(this.outputShape.length);let e=n.filterHeight,r=n.filterWidth,o=e-1-n.padInfo.top,i=r-1-n.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            int wCPerm = ${r} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${n.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${n.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${n.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${n.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${n.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}};function P0e(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=r,p=S.convertConv2DDataFormat(u),f=S.computeConv2DInfo(s,i.shape,a,1,l,c,!1,p);if(P().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&p==="channelsLast"){let d=[[f.strideHeight,f.strideWidth]],h=new pS(f);return e.runWebGLProgram(h,[o,i],"float32",d)}else{let d=new lS(f);return e.runWebGLProgram(d,[o,i],"float32")}}var h5={kernelName:Xl,backendName:"webgl",kernelFunc:P0e};function L0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,u=S.computeConv3DInfo(o.shape,i.shape,s,l,a),c=new nS(u);return e.runWebGLProgram(c,[o,i],"float32")}var m5={kernelName:Yl,backendName:"webgl",kernelFunc:L0e};function V0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r,u=S.computeConv3DInfo(o.shape,l,s,1,a),c=new uS(u);return e.runWebGLProgram(c,[o,i],"float32")}var g5={kernelName:ad,backendName:"webgl",kernelFunc:V0e};function B0e(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r,u=S.computeConv3DInfo(l,i.shape,a,1,s),c=new cS(u);return e.runWebGLProgram(c,[o,i],"float32")}var y5={kernelName:ld,backendName:"webgl",kernelFunc:B0e};var z0e=hi+`
  return cos(x);
`,U0e=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${ho}
  return result;
`,G0e=xe({opSnippet:z0e,packedOpSnippet:U0e}),x5={kernelName:ta,backendName:"webgl",kernelFunc:G0e};var W0e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,H0e=xe({opSnippet:W0e}),v5={kernelName:na,backendName:"webgl",kernelFunc:H0e};var fS=class{constructor(n,e,r,o,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,a,l,u]=n,[c]=e,[p,f]=r;this.outputShape=[c,p,f,u];let d=o==="bilinear"?1:0,[h,m]=[`${a-1}.0`,`${l-1}.0`],[g,y,x]=p>1?[`${(a-1)/(p-1)}`,"(y2-y1) * height_ratio",`y1*${h} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${h}`],[b,w,C]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${w};

        float in_y = ${x};
        if( in_y < 0.0 || in_y > ${h} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${C};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var j0e=t=>{let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:u}=r,c=new fS(o.shape,i.shape,a,l,u);return e.runWebGLProgram(c,[o,i,s],"float32")},b5={kernelName:cd,backendName:"webgl",kernelFunc:j0e};var Xh=function(t){return t.Prod="*",t.Sum="+",t}(Xh||{}),zy=class{constructor(n,e,r,o){this.op=n,this.outputShape=e,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let i=this.outputShape.length,s=this.op===Xh.Prod?"1.0":"0.0",a=r?s:`getX(${w5(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1],u="",c="";r?(u=o?`end != ${l-1}`:"end != 0",c=o?"end + 1":"end - 1"):(u=o?`end + pow2 < ${l}`:"end >= pow2",c=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Me(i)} coords = getOutputCoords();
        int end = ${C5(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${c};
          ${C5(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${w5(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}};function w5(t,n,e){if(t===1)return`${n}`;if(t===2)return`${n}.x, ${n}.y`;if(t===3)return`${n}.x, ${n}.y, ${n}.z`;if(t===4)return`${n}.x, ${n}.y, ${n}.z, ${n}.w`;throw new Error(`Cumulative ${e} for rank ${t} is not yet supported`)}function C5(t,n,e){if(t===1)return`${n}`;if(t===2)return`${n}.y`;if(t===3)return`${n}.z`;if(t===4)return`${n}.w`;throw new Error(`Cumulative ${e} for rank ${t} is not yet supported`)}function dS(t,n,e,r,o,i){let s=n.shape.length,a=S.getAxesPermutation([r],s),l=n;a!=null&&(l=Lt({inputs:{x:n},backend:e,attrs:{perm:a}}));let u=S.getInnerMostAxes(1,s)[0];if(u!==s-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${n.shape.length-1} but got axis=${r}`);let c=l.shape[u],p=rn({inputs:{x:l},backend:e});for(let f=0;f<=Math.ceil(Math.log2(c))-1;f++){let d=new zy(t,l.shape,!1,i),h=[[f]],m=p;p=e.runWebGLProgram(d,[p],p.dtype,h),e.disposeIntermediateTensorInfo(m)}if(o){let f=new zy(t,l.shape,o,i),d=p;p=e.runWebGLProgram(f,[p],p.dtype),e.disposeIntermediateTensorInfo(d)}if(a!=null){let f=S.getUndoAxesPermutation(a),d=Lt({inputs:{x:p},backend:e,attrs:{perm:f}});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(l),d}return p}function q0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r;return dS(Xh.Prod,o,e,i,s,a)}var S5={kernelName:ud,backendName:"webgl",kernelFunc:q0e};function K0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r;return dS(Xh.Sum,o,e,i,s,a)}var I5={kernelName:Zl,backendName:"webgl",kernelFunc:K0e};function X0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.readSync(o.dataId),u=e.readSync(i.dataId),c=NC(l,u,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}else if(o.shape.length===2){let l=e.bufferSync(o),u=e.bufferSync(i),c=lj(l,u,s,a);return e.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var E5={kernelName:pd,backendName:"webgl",kernelFunc:X0e};var hS=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function Y0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r,a=o.shape[0],l=s==="NHWC"?o.shape[1]:o.shape[2],u=s==="NHWC"?o.shape[2]:o.shape[3],c=s==="NHWC"?o.shape[3]:o.shape[1],p=l*i,f=u*i,d=c/(i*i),h=s==="NHWC"?[a,p,f,d]:[a,d,p,f],m=new hS(h,i,s);return e.runWebGLProgram(m,[o],o.dtype)}var T5={kernelName:fd,backendName:"webgl",kernelFunc:Y0e};var Yh=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=n.outShape,this.enableShapeUniforms=gt(this.outputShape.length);let s=n.filterHeight,a=n.filterWidth,l=n.outChannels/n.inChannels,u="",c="";r&&(o?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:u=`
          float activation(float x) {
            ${r}
          }
        `,c="result = activation(result);");let p=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${s}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${p}
        ${c}
        setOutput(result);
      }
    `}};var Zh=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=n.outShape,this.enableShapeUniforms=gt(this.outputShape.length);let s=n.outChannels/n.inChannels,a=n.padInfo.left,l=n.strideWidth,u=n.dilationWidth,c=n.filterHeight,p=n.filterWidth,f=p,d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<p;y++)d+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;d+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let y=0;y<p;y++)d+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(f+1)/2;y++){let x=y*2;if(d+=`
          xC = xCCorner + ${x*u};
          `,l===1){if(x<p&&(a%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }
              `,u===1&&x>0?d+=`
                xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                  } else {
                    xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xC${x} = xTexelC${x};
                `,x+1<p)){let b=a%2===0?v.nearestLargerEven(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                    xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${x+1}.zw = vec2(0.0);
                    }
                    xTexelC${x+1}Ready = 1;
                  }
                  `,u>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                    } else {
                     xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                    }
                    `:d+=`
                    xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                    `):b===1?d+=`
                    xC${x+1} = xTexelC${x};
                    `:d+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                      xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${x+1}.zw = vec2(0.0);
                      }
                      xTexelC${x+1}Ready = 1;
                    }

                    xC${x+1} = xTexelC${x+1};
                    `}}else x<p&&(a%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.0);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
              `,x+1<p&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(
                  xTexelC${x}.xy, xTexelC${x+1}.xy);
              `,x+1<p&&(d+=`
                  xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                `)));x<p&&(d+=`
            wTexel = getW(r, ${x}, d1, q);
            dotProd += xC${x} * vec4(wTexel.xz, wTexel.xz);
          `,x+1<p&&(d+=`
              wTexel = getW(r, ${x+1}, d1, q);
              dotProd += xC${x+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  `,d+=`
      }
    `;let h="",m="";r&&(o?h=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?h=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:h=`vec4 activation(vec4 x) {
          ${r}
        }`,m="result = activation(result);");let g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${h}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}};function Z0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:u}=r,c=l;c==null&&(c=[1,1]),v.assert(S.eitherStridesOrDilationsAreOne(s,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let p=S.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!0),f;P().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?f=new Zh(p):f=new Yh(p);let d=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return e.runWebGLProgram(f,[o,i],"float32",d)}var _5={kernelName:Ql,backendName:"webgl",kernelFunc:Z0e};var mS=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},gS=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=e-1-n.padInfo.top,a=r-1-n.padInfo.left,l=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Q0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=r,p=S.computeConv2DInfo(o.shape,c,s,a,l,u,!0),f=new mS(p);return e.runWebGLProgram(f,[o,i],"float32")}var N5={kernelName:dd,backendName:"webgl",kernelFunc:Q0e};function J0e(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=r,p=S.computeConv2DInfo(c,i.shape,s,a,l,u,!0),f=new gS(p);return e.runWebGLProgram(f,[o,i],"float32")}var D5={kernelName:hd,backendName:"webgl",kernelFunc:J0e};var yS=class{constructor(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function ewe(t){let{inputs:n,backend:e}=t,{x:r}=n,o=[...r.shape,...r.shape],i=v.sizeFromShape(r.shape),s=ne({inputs:{x:r},backend:e,attrs:{shape:[i]}}),a=new yS(i),l=e.runWebGLProgram(a,[s],s.dtype),u=ne({inputs:{x:l},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(l),u}var k5={kernelName:Lb,backendName:"webgl",kernelFunc:ewe};var xS=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let{inHeight:e,inWidth:r,padInfo:o,strideHeight:i,strideWidth:s,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:c}=n,{top:p,left:f}=o;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${s});
      const ivec2 pads = ivec2(${p}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function twe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,u=S.computeDilation2DInfo(o.shape,i.shape,s,a,"NHWC",l),c,p=new xS(u);c=e.runWebGLProgram(p,[o,i],"float32");let f=ne({inputs:{x:c},backend:e,attrs:{shape:u.outShape}});return e.disposeIntermediateTensorInfo(c),f}var A5={kernelName:Jl,backendName:"webgl",kernelFunc:twe};function nwe(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=S.decodeEinsumEquation(o,i.length);S.checkEinsumDimSizes(s.length,l,i);let{path:u,steps:c}=S.getEinsumComputePath(a,l),p=c.length,f=null,d=s.length,h=[];for(let m=0;m<p;++m){for(let g of c[m]){let{permutationIndices:y,expandDims:x}=S.getEinsumPermutation(d,l[g]),b;S.isIdentityPermutation(y)?b=i[g]:(b=Lt({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),h.push(b));let w=b.shape.slice();for(let C=0;C<x.length;++C)w.splice(x[C],0,1);v.arraysEqual(b.shape,w)||(b=ne({inputs:{x:b},backend:e,attrs:{shape:w}}),h.push(b)),f===null?f=b:(f=Vy({inputs:{a:b,b:f},backend:e}),h.push(f))}m<p-1&&(u[m]>=0&&(f=Vp({inputs:{x:f},backend:e,attrs:{axis:u[m]-(s.length-d),keepDims:!1}}),h.push(f)),d--)}for(let m of h)m!==f&&e.disposeIntermediateTensorInfo(m);return f}var R5={kernelName:md,backendName:"webgl",kernelFunc:nwe};var rwe="return (x >= 0.0) ? x : (exp(x) - 1.0);",owe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,iwe=xe({opSnippet:rwe,packedOpSnippet:owe}),M5={kernelName:oa,backendName:"webgl",kernelFunc:iwe};var swe="return (b >= 0.0) ? a : a * (b + 1.0);",awe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,lwe=t=>{let{inputs:n,backend:e}=t,{dy:r,y:o}=n,i=P().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new fo(awe,r.shape,o.shape):new Ur(swe,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)},O5={kernelName:gd,backendName:"webgl",kernelFunc:lwe};var uwe=`
  return vec4(equal(a, b));
`,cwe="return float(a == b);",pwe=ct({opSnippet:cwe,packedOpSnippet:uwe,dtype:"bool",cpuKernelImpl:dj}),F5={kernelName:Lc,backendName:"webgl",kernelFunc:pwe};var fwe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${S.ERF_P};
  float a1 = ${S.ERF_A1};
  float a2 = ${S.ERF_A2};
  float a3 = ${S.ERF_A3};
  float a4 = ${S.ERF_A4};
  float a5 = ${S.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,dwe=xe({opSnippet:fwe}),$5={kernelName:ia,backendName:"webgl",kernelFunc:dwe};var hwe=hi+`
  return exp(x);
`,mwe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,yR=xe({opSnippet:hwe,packedOpSnippet:mwe,cpuKernelImpl:hj,dtype:"float32"}),P5={kernelName:sa,backendName:"webgl",kernelFunc:yR};function vS(t){let{inputs:n,attrs:e,backend:r}=t,{dim:o}=e,{input:i}=n,s=i.shape.length,a=i.shape.slice(),l=o;return o<0&&(v.assert(-(s+1)<=o,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+o+1),a.splice(l,0,1),ne({inputs:{x:i},backend:r,attrs:{shape:a}})}var L5={kernelName:eu,backendName:"webgl",kernelFunc:vS};var V5="return exp(x) - 1.0;",gwe=xe({opSnippet:V5,packedOpSnippet:V5,cpuKernelImpl:mj}),B5={kernelName:aa,backendName:"webgl",kernelFunc:gwe};var Uy=class{constructor(n,e,r){this.variableNames=["real","imag"];let o=e[1];this.outputShape=e;let i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=r?`${o}.0`:"1.0",a;if(n==="real")a="return real * expR - imag * expI;";else if(n==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${n}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function bS(t,n,e){let r=e.texData.get(t.dataId),o=v.sizeFromShape(t.shape),i=t.shape[t.shape.length-1],s=o/i,a=ne({inputs:{x:t},backend:e,attrs:{shape:[s,i]}}),l=a.shape,u=new Uy("real",l,n),c=new Uy("imag",l,n),p=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],f=e.runWebGLProgram(u,p,"float32"),d=e.runWebGLProgram(c,p,"float32"),h=Gr({inputs:{real:f,imag:d},backend:e});e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(d);let m=ne({inputs:{x:h},backend:e,attrs:{shape:t.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(h),m}function ywe(t){let{inputs:n,backend:e}=t,{input:r}=n;return bS(r,!1,e)}var z5={kernelName:yd,backendName:"webgl",kernelFunc:ywe};var wS=class{constructor(n,e){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}};function cl(t){let{backend:n,attrs:e}=t,{shape:r,value:o}=e,{dtype:i}=e;if(i=i||v.inferDtype(o),i==="string"){let s=v.getArrayFromDType(i,v.sizeFromShape(r));return s.fill(o),n.makeTensorInfo(r,i,s)}else{let s=new wS(r,o),a=[[o]];return n.runWebGLProgram(s,[],i,a)}}var U5={kernelName:xd,backendName:"webgl",kernelFunc:cl};var CS=class{constructor(n){this.variableNames=["Image"],this.outputShape=[];let e=n[2];this.outputShape=n,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var G5={kernelName:vd,backendName:"webgl",kernelFunc:({inputs:t,backend:n})=>{let{image:e}=t,r=n,o=new CS(e.shape);return r.runWebGLProgram(o,[e],e.dtype)}};var W5="return floor(x);",xwe=xe({opSnippet:W5,packedOpSnippet:W5,cpuKernelImpl:gj}),H5={kernelName:la,backendName:"webgl",kernelFunc:xwe};var vwe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,bwe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,wwe=ct({opSnippet:vwe,packedOpSnippet:bwe,dtype:"int32"}),j5={kernelName:ua,backendName:"webgl",kernelFunc:wwe};var SS=class{constructor(n){this.variableNames=["A"];let e=jt(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${r}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var IS=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let e=jt(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${r}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}};var q5={kernelName:GP,backendName:"webgl",kernelFunc:Cwe},Qh,xR=P().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Cwe(t){let{inputs:n,backend:e,attrs:r}=t,{pixels:o}=n,{numChannels:i}=r,s=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,u]=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=[u,l],p=[u,l,i];if(a||s){let m=P().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Qh==null||m!==xR)&&(xR=m,Qh=document.createElement("canvas").getContext("2d",{willReadFrequently:xR})),Qh.canvas.width=l,Qh.canvas.height=u,Qh.drawImage(o,0,0,l,u),o=Qh.canvas}let f=e.makeTensorInfo(c,"int32");e.texData.get(f.dataId).usage=dr.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(f.dataId),o);let d=P().getBool("WEBGL_PACK")?new IS(p):new SS(p),h=e.runWebGLProgram(d,[f],"int32");return e.disposeData(f.dataId),h}function Swe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f,activation:d,leakyreluAlpha:h}=r,m=S.convertConv2DDataFormat(c),g=S.computeConv2DInfo(o.shape,i.shape,l,p,u,f,!1,m),y,x=[],b=s!=null,w=a!=null,C=d==="leakyrelu",N=()=>{let k=[o,i],O=($,V)=>{if(V==="NCHW"&&$.shape.length===1&&$.shape[0]!==1){let G=ne({inputs:{x:$},backend:e,attrs:{shape:[$.shape[0],1,1]}});return x.push(G),G}return $};if(b&&k.push(O(s,c)),w&&k.push(O(a,c)),C){let $=e.makeTensorInfo([],"float32",v.createScalarValue(h,"float32"));k.push($),x.push($)}return k};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=iS({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:d,preluActivationWeights:a,leakyreluAlpha:h});else if(g.strideWidth<=2&&m==="channelsLast"&&P().getBool("WEBGL_EXP_CONV")){let k=d?ll(d,!0):null,O=new Kh(g,b,k,w,C),$=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],V=N();y=e.runWebGLProgram(O,V,"float32",$)}else if(P().getBool("WEBGL_CONV_IM2COL"))y=sS({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:d,preluActivationWeights:a,leakyreluAlpha:h});else{let k=d?ll(d,!1):null,O=new qh(g,b,k,w,C),$=N();y=e.runWebGLProgram(O,$,"float32")}let D=ne({inputs:{x:y},backend:e,attrs:{shape:g.outShape}});return x.push(y),x.forEach(k=>e.disposeIntermediateTensorInfo(k)),D}var K5={kernelName:qc,backendName:"webgl",kernelFunc:Swe};function Iwe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:u,dilations:c,dimRoundingMode:p,activation:f,leakyreluAlpha:d}=r,h=[],m=c;m==null&&(m=[1,1]),v.assert(S.eitherStridesOrDilationsAreOne(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);let g=S.computeConv2DInfo(o.shape,i.shape,l,m,u,p,!0),y=P().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,x=f?ll(f,y):null,b=[o,i],w=s!=null,C=a!=null,N=f==="leakyrelu";if(w&&b.push(s),C&&b.push(a),N){let $=e.makeTensorInfo([],"float32",v.createScalarValue(d,"float32"));b.push($),h.push($)}let D;y?D=new Zh(g,w,x,C,N):D=new Yh(g,w,x,C,N);let k=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],O=e.runWebGLProgram(D,b,"float32",k);return h.forEach($=>e.disposeIntermediateTensorInfo($)),O}var X5={kernelName:Kc,backendName:"webgl",kernelFunc:Iwe};var ES=class{constructor(n,e,r,o){this.sliceDim=n,this.strides=e,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=r;let i=Me(r.length),s=`
    int index;`;for(let a=0;a<this.sliceDim;a++)s+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${s}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}};function Ewe(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=o.shape,s=i[i.length-1],a=v.sizeFromShape(r.shape),[l,u,c,p]=S.prepareAndValidate(r,o),f=ne({inputs:{x:o},backend:e,attrs:{shape:[u,s]}}),d=ne({inputs:{x:r},backend:e,attrs:{shape:[v.sizeFromShape(r.shape)/c,c]}});if(e.shouldExecuteOnCPU([r,o])||r.dtype==="string"){let y=e.readSync(o.dataId),x=e.bufferSync(r),b=yj(y,x,r.dtype,u,s,c,p,r.shape,a);return e.makeTensorInfo(l,r.dtype,b.values)}let h=new ES(s,p,[u,c],r.shape),m=e.runWebGLProgram(h,[d,f],d.dtype),g=ne({inputs:{x:m},backend:e,attrs:{shape:l}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(m),g}var Y5={kernelName:Vb,backendName:"webgl",kernelFunc:Ewe};var TS=class{constructor(n,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;let r=Me(this.rank),o=Twe(n,2);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${n[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}};function Twe(t,n){let e=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<t.length;o++)o===2?r.push("index"):r.push(`${e[o]}`);return r.join()}function vR(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r,l=v.parseAxisParam(s,o.shape)[0];if(P().get("DEBUG")){let x=e.readSync(i.dataId),b=o.shape[l];for(let w=0;w<x.length;++w){let C=x[w];v.assert(C<=b-1&&C>=0,()=>`GatherV2: the index value ${C} is not in [0, ${b-1}]`)}}let u=S.segment_util.collectGatherOpShapeInfo(o,i,l,a),c=v.sizeFromShape(i.shape),p=[],f=ne({inputs:{x:o},backend:e,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),d=ne({inputs:{x:i},backend:e,attrs:{shape:[u.batchSize,c/u.batchSize]}});p.push(f),p.push(d);let h=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(e.shouldExecuteOnCPU([o,i])||o.dtype==="string"){let x=e.bufferSync(d),b=e.bufferSync(f),w=xj(b,x,h);return p.forEach(C=>e.disposeIntermediateTensorInfo(C)),e.makeTensorInfo(u.outputShape,w.dtype,w.values)}let m=new TS(f.shape,h),g=e.runWebGLProgram(m,[f,d],f.dtype);p.push(g);let y=ne({inputs:{x:g},backend:e,attrs:{shape:u.outputShape}});return p.forEach(x=>e.disposeIntermediateTensorInfo(x)),y}var Z5={kernelName:nu,backendName:"webgl",kernelFunc:vR};var _we="return float(a > b);",Nwe=`
  return vec4(greaterThan(a, b));
`,Dwe=ct({opSnippet:_we,packedOpSnippet:Nwe,cpuKernelImpl:vj,dtype:"bool"}),Q5={kernelName:Vc,backendName:"webgl",kernelFunc:Dwe};var kwe="return float(a >= b);",Awe=`
  return vec4(greaterThanEqual(a, b));
`,Rwe=ct({opSnippet:kwe,packedOpSnippet:Awe,dtype:"bool",cpuKernelImpl:bj}),J5={kernelName:ca,backendName:"webgl",kernelFunc:Rwe};function Mwe(t){let{inputs:n,backend:e}=t,{input:r}=n;return bS(r,!0,e)}var e6={kernelName:bd,backendName:"webgl",kernelFunc:Mwe};var Owe="return float(!isnan(x) && !isinf(x));",Fwe=xe({opSnippet:Owe,dtype:"bool"}),t6={kernelName:pa,backendName:"webgl",kernelFunc:Fwe};var $we="return float(isinf(x));",Pwe=xe({opSnippet:$we,dtype:"bool"}),n6={kernelName:fa,backendName:"webgl",kernelFunc:Pwe};var Lwe="return float(isnan(x));",Vwe=xe({opSnippet:Lwe,dtype:"bool"}),r6={kernelName:da,backendName:"webgl",kernelFunc:Vwe};var Bwe="return float(a < b);",zwe=`
  return vec4(lessThan(a, b));
`,Uwe=ct({opSnippet:Bwe,packedOpSnippet:zwe,cpuKernelImpl:wj,dtype:"bool"}),o6={kernelName:Bc,backendName:"webgl",kernelFunc:Uwe};var Gwe="return float(a <= b);",Wwe=`
  return vec4(lessThanEqual(a, b));
`,Hwe=ct({opSnippet:Gwe,packedOpSnippet:Wwe,cpuKernelImpl:Cj,dtype:"bool"}),i6={kernelName:zc,backendName:"webgl",kernelFunc:Hwe};function jwe(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=Sj(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var s6={kernelName:Bb,backendName:"webgl",kernelFunc:jwe};var qwe=hi+`
  return x < 0.0 ? 0./0. : log(x);
`,Kwe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Xwe=xe({opSnippet:qwe,packedOpSnippet:Kwe,cpuKernelImpl:Ij}),a6={kernelName:ha,backendName:"webgl",kernelFunc:Xwe};var Ywe=hi+`
  return log(1.0 + x);
`,Zwe=xe({opSnippet:Ywe}),l6={kernelName:ma,backendName:"webgl",kernelFunc:Zwe};var Qwe="return float(a >= 1.0 && b >= 1.0);",Jwe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,eCe=ct({opSnippet:Qwe,packedOpSnippet:Jwe,dtype:"bool"}),u6={kernelName:Uc,backendName:"webgl",kernelFunc:eCe};var tCe="return float(!(x >= 1.0));",nCe=xe({opSnippet:tCe}),c6={kernelName:Gc,backendName:"webgl",kernelFunc:nCe};var rCe="return float(a >= 1.0 || b >= 1.0);",oCe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,iCe=ct({opSnippet:rCe,packedOpSnippet:oCe,dtype:"bool"}),p6={kernelName:Wc,backendName:"webgl",kernelFunc:iCe};var _S=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[];let s=e,a=n[3]-1;this.outputShape=n;let l,u=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}};var NS=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let s=e,a=n[3]-1;this.outputShape=n;let l,u=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${u})`:i===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}};var sCe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r,u=P().getBool("WEBGL_PACK_NORMALIZATION")?new NS(o.shape,i,s,a,l):new _S(o.shape,i,s,a,l);return e.runWebGLProgram(u,[o],o.dtype)},f6={kernelName:ou,backendName:"webgl",kernelFunc:sCe};var DS=class{constructor(n,e,r,o,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=r,this.alpha=o,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var aCe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:u,beta:c}=r,p=new DS(o.shape,a,l,u,c);return e.runWebGLProgram(p,[o,i,s],o.dtype)},d6={kernelName:Cd,backendName:"webgl",kernelFunc:aCe};function h6(t,n,e,r){let o=v.sizeFromShape(n),s=v.sizeFromShape(t.shape)/o,a=ne({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=mo(a,t.dtype,"max",r),u=ne({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}function bR(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=o.shape.length,l=v.parseAxisParam(i,o.shape),u=l,c=S.getAxesPermutation(u,a),p=c!=null,f=e.shouldExecuteOnCPU([o]),d=o;if(p){if(f){let b=e.texData.get(d.dataId).values,w=new Array(a);for(let D=0;D<w.length;D++)w[D]=o.shape[c[D]];let C=Lp(b,o.shape,o.dtype,c,w);d=e.makeTensorInfo(w,o.dtype);let N=e.texData.get(d.dataId);N.values=C}else d=Yu(o,c,e);u=S.getInnerMostAxes(u.length,a)}S.assertAxesAreInnerMostDims("max",u,a);let[h,m]=S.computeOutAndReduceShapes(d.shape,u),g=h;s&&(g=S.expandShapeToKeepDim(h,l));let y;if(f){let b=e.texData.get(d.dataId).values,w=Ej(b,v.sizeFromShape(m),g,o.dtype);y=e.makeTensorInfo(g,o.dtype);let C=e.texData.get(y.dataId);C.values=w}else y=h6(d,m,g,e);return p&&e.disposeIntermediateTensorInfo(d),y}var m6={kernelName:iu,backendName:"webgl",kernelFunc:bR};var lCe=Wh+`
  return max(a, b);
`,uCe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ho+`
  return result;
`,cCe=ct({opSnippet:lCe,packedOpSnippet:uCe,cpuKernelImpl:Tj}),g6={kernelName:ga,backendName:"webgl",kernelFunc:cCe};function pCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Cs(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,u=1;v.assert(S.eitherStridesOrDilationsAreOne(s,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let c=S.computePool2DInfo(o.shape,i,s,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&v.arraysEqual(c.inShape,c.outShape))return rn({inputs:{x:o},backend:e});let p=new Ui(c,"max",!1);return e.runWebGLProgram(p,[o],o.dtype)}var y6={kernelName:su,backendName:"webgl",kernelFunc:pCe};function fCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dataFormat:l,dimRoundingMode:u}=r,c=[1,1,1],p=S.computePool3DInfo(o.shape,i,s,c,a,u,l),f=new Zu(p,"max",!1);return e.runWebGLProgram(f,[o],o.dtype)}var x6={kernelName:au,backendName:"webgl",kernelFunc:fCe};var kS=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideHeight,r=n.strideWidth,o=n.dilationHeight,i=n.effectiveFilterHeight,s=n.effectiveFilterWidth,a=i-1-n.padInfo.top,l=s-1-n.padInfo.left,u=i*s-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},AS=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.dilationDepth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterDepth,u=n.effectiveFilterHeight,c=n.effectiveFilterWidth,p=l-1-n.padInfo.front,f=u-1-n.padInfo.top,d=c-1-n.padInfo.left,h=l*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(${p}, ${f}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${h} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function dCe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=r,p=[1,1,1],f=S.computePool3DInfo(s.shape,a,l,p,u,c),d=new Zu(f,"max",!0),h=e.runWebGLProgram(d,[s],s.dtype),m=new AS(f),g=e.runWebGLProgram(m,[o,h],s.dtype);return e.disposeIntermediateTensorInfo(h),g}var v6={kernelName:Id,backendName:"webgl",kernelFunc:dCe};function hCe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;Cs([i,s],"maxPoolGrad");let{filterSize:l,strides:u,pad:c,dimRoundingMode:p}=r,f=S.computePool2DInfo(a.shape,l,u,1,c,p),d=!0,h=new Ui(f,"max",d),m=e.runWebGLProgram(h,[a],a.dtype),g=new kS(f),y=e.runWebGLProgram(g,[o,m],a.dtype);return e.disposeIntermediateTensorInfo(m),y}var b6={kernelName:Sd,backendName:"webgl",kernelFunc:hCe};function w6(t,n,e,r){let o=new Ui(e,"max",!1),i=r.runWebGLProgram(o,[t],"float32");o=new Ui(e,"max",!0,!0,n);let s=r.runWebGLProgram(o,[t],"float32");return[i,s]}var C6={kernelName:zb,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;v.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let u=[1,1];v.assert(S.eitherStridesOrDilationsAreOne(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);let c=S.computePool2DInfo(r.shape,o,i,u,s),[p,f]=w6(r,a,c,l);return[p,f]}};function S6(t,n,e,r){let o=v.sizeFromShape(n),s=v.sizeFromShape(t.shape)/o,a=ne({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=mo(a,"float32","mean",r),u=ne({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}var I6={kernelName:lu,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{keepDims:o,axis:i}=n,s=e,a=r.shape.length,l=v.parseAxisParam(i,r.shape),u=l,c=S.getAxesPermutation(u,a),p=c!=null,f=s.shouldExecuteOnCPU([r]),d=[],h=r;if(p){if(f){let w=s.texData.get(h.dataId).values,C=new Array(a);for(let k=0;k<C.length;k++)C[k]=r.shape[c[k]];let N=Lp(w,r.shape,r.dtype,c,C);h=s.makeTensorInfo(C,r.dtype);let D=s.texData.get(h.dataId);D.values=N}else h=Yu(r,c,s);d.push(h),u=S.getInnerMostAxes(u.length,a)}S.assertAxesAreInnerMostDims("sum",u,a);let[m,g]=S.computeOutAndReduceShapes(h.shape,u),y=m;o&&(y=S.expandShapeToKeepDim(m,l));let x=S6(h,g,y,s);for(let b of d)s.disposeIntermediateTensorInfo(b);return x}};function mCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=v.parseAxisParam(i,o.shape),u=l,c=S.getAxesPermutation(u,a),p=o;c!=null&&(p=Lt({inputs:{x:o},backend:e,attrs:{perm:c}}),u=S.getInnerMostAxes(u.length,o.shape.length)),S.assertAxesAreInnerMostDims("min",u,a);let[f,d]=S.computeOutAndReduceShapes(p.shape,u),h=v.sizeFromShape(d),m=ne({inputs:{x:p},backend:e,attrs:{shape:[-1,h]}}),g=mo(m,m.dtype,"min",e),y;if(s){let x=S.expandShapeToKeepDim(f,l);y=ne({inputs:{x:g},backend:e,attrs:{shape:x}})}else y=ne({inputs:{x:g},backend:e,attrs:{shape:f}});return e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(g),c!=null&&e.disposeIntermediateTensorInfo(p),y}var E6={kernelName:uu,backendName:"webgl",kernelFunc:mCe};var gCe=Wh+`
  return min(a, b);
`,yCe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ho+`
  return result;
`,xCe=ct({opSnippet:gCe,packedOpSnippet:yCe,cpuKernelImpl:_j}),T6={kernelName:ya,backendName:"webgl",kernelFunc:xCe};var RS=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((c,p)=>c[0]+n[p]+c[1]);let o=n.length,i=Me(o),s=e.map(c=>c[0]).join(","),a=e.map((c,p)=>c[0]+n[p]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),u=r==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}};var MS=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((h,m)=>h[0]+n[m]+h[1]);let o=n.length,i=Me(o),s=e.map(h=>h[0]).join(","),a=e.map((h,m)=>h[0]+n[m]).join(","),l=nn("rc",o),u=nn("source",o),c=`${l[o-1]} < ${this.outputShape[o-1]}`,p=o===1?"source":`vec2(${u.slice(-2).join()})`,f=r==="reflect"?0:1,d="";if(o===1){let h=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;d=`
        ${i} rc = outputLoc;
        ${h}
        result[0] = getChannel(getX(${u.join()}), ${p});
        ${l[o-1]} += 1;
        if(${c}) {
          ${h}
          result[1] = getChannel(getX(${u.join()}), ${p});
        }
      `}else{let h=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;d=`
        ${i} rc = outputLoc;
        ${h}
        result[0] = getChannel(getX(${u.join()}), ${p});
        ${l[o-1]} += 1;
        if(${c}) {
          ${h}
          result[1] = getChannel(getX(${u.join()}), ${p});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${h}
          result[2] = getChannel(getX(${u.join()}), ${p});
          ${l[o-1]} += 1;
          if(${c}) {
            ${h}
            result[3] = getChannel(getX(${u.join()}), ${p});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}};var vCe=({inputs:t,backend:n,attrs:e})=>{let{x:r}=t,{paddings:o,mode:i}=e,s=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new MS(r.shape,o,i):new RS(r.shape,o,i);return n.runWebGLProgram(s,[r],r.dtype)},_6={kernelName:cu,backendName:"webgl",kernelFunc:vCe};var bCe=`if (b == 0.0) return NAN;
  return mod(a, b);`,wCe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ho+`
  return result;
`,CCe=ct({opSnippet:bCe,packedOpSnippet:wCe}),N6={kernelName:xa,backendName:"webgl",kernelFunc:CCe};var OS=class{constructor(n,e,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[n,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}};var SCe=`
if (a == b) {
  return 1.0;
};
return a / b;`,ICe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,wR=ct({opSnippet:SCe,packedOpSnippet:ICe,checkOutOfBounds:!0}),D6={kernelName:ra,backendName:"webgl",kernelFunc:wR};var k6="return a - b;",CR=ct({opSnippet:k6,packedOpSnippet:k6,supportsComplex:!0,cpuKernelImpl:Kj}),A6={kernelName:Oa,backendName:"webgl",kernelFunc:CR};function SR(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=v.parseAxisParam([i],o.shape),a=bR({inputs:{x:o},backend:e,attrs:{reductionIndices:s,keepDims:!1}}),l=S.expandShapeToKeepDim(a.shape,s),u=ne({inputs:{x:a},backend:e,attrs:{shape:l}}),c=CR({inputs:{a:o,b:u},backend:e}),p=yR({inputs:{x:c},backend:e}),f=Vp({inputs:{x:p},backend:e,attrs:{axis:s,keepDims:!1}}),d=ne({inputs:{x:f},backend:e,attrs:{shape:l}}),h=wR({inputs:{a:p,b:d},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(d),h}var R6={kernelName:_u,backendName:"webgl",kernelFunc:SR};function ECe(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r,l=a?o:SR({inputs:{logits:o},backend:e,attrs:{dim:o.shape.length-1}}),u=l.shape[0],c=l.shape[1],p=new OS(u,c,i),f=[[s]],d=e.runWebGLProgram(p,[l],"int32",f);return a||e.disposeIntermediateTensorInfo(l),d}var M6={kernelName:Ub,backendName:"webgl",kernelFunc:ECe};var TCe=gn+`
  return -x;
`,_Ce=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function NCe(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])){let i=e.texData.get(r.dataId),[s,a]=Dj(i.values,r.shape,r.dtype);return e.makeTensorInfo(a,r.dtype,s)}let o;return P().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new zr(r.shape,_Ce):o=new Wn(r.shape,TCe),e.runWebGLProgram(o,[r],r.dtype)}var O6={kernelName:pu,backendName:"webgl",kernelFunc:NCe};var DCe=nr.nonMaxSuppressionV3Impl;function kCe(t){S.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r,u=e.readSync(o.dataId),c=e.readSync(i.dataId),{selectedIndices:p}=DCe(u,c,s,a,l);return e.makeTensorInfo([p.length],"int32",new Int32Array(p))}var F6={kernelName:Ed,backendName:"webgl",kernelFunc:kCe};var ACe=nr.nonMaxSuppressionV4Impl;function RCe(t){S.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=r,c=e.readSync(o.dataId),p=e.readSync(i.dataId),{selectedIndices:f,validOutputs:d}=ACe(c,p,s,a,l,u);return[e.makeTensorInfo([f.length],"int32",new Int32Array(f)),e.makeTensorInfo([],"int32",new Int32Array([d]))]}var $6={kernelName:Td,backendName:"webgl",kernelFunc:RCe};var MCe=nr.nonMaxSuppressionV5Impl;function OCe(t){S.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=r,c=e.readSync(o.dataId),p=e.readSync(i.dataId),f=s,d=a,h=l,m=u,{selectedIndices:g,selectedScores:y}=MCe(c,p,f,d,h,m);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var P6={kernelName:_d,backendName:"webgl",kernelFunc:OCe};var FS=class{constructor(n,e,r,o){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${r}),
                      float(index == coords.y)));
      }
    `}};var FCe=t=>{let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{dtype:i,depth:s,onValue:a,offValue:l}=r,u=v.sizeFromShape(o.shape),c=new FS(u,s,a,l),p=ne({inputs:{x:o},backend:e,attrs:{shape:[u]}}),f=e.runWebGLProgram(c,[p],i);e.disposeIntermediateTensorInfo(p);let d=[...o.shape,s],h=ne({inputs:{x:f},backend:e,attrs:{shape:d}});return e.disposeIntermediateTensorInfo(f),h},L6={kernelName:du,backendName:"webgl",kernelFunc:FCe};function Gy(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="complex64"){let o=ul({inputs:{input:r},backend:e}),i=Gy({inputs:{x:o},backend:e}),s=zp({inputs:{input:r},backend:e}),a=Gy({inputs:{x:s},backend:e}),l=Gr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return cl({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:e})}var V6={kernelName:ku,backendName:"webgl",kernelFunc:Gy};function B6(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let o=ul({inputs:{input:r},backend:e}),i=B6({inputs:{x:o},backend:e}),s=zp({inputs:{input:r},backend:e}),a=Gy({inputs:{x:s},backend:e}),l=Gr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return cl({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:e})}var z6={kernelName:fu,backendName:"webgl",kernelFunc:B6};function $Ce(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return vS({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(c=>{v.assertShapesMatch(i,c.shape,"All tensors passed to stack must have matching shapes"),v.assert(s===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(c=>{let p=vS({inputs:{input:c},backend:e,attrs:{dim:o}});return a.push(p),p}),u=gR({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(c=>e.disposeIntermediateTensorInfo(c)),u}var U6={kernelName:hu,backendName:"webgl",kernelFunc:$Ce};var $S=class{constructor(n,e,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((u,c)=>u[0]+n[c]+u[1]);let o=n.length,i=Me(o),s=e.map(u=>u[0]).join(","),a=e.map((u,c)=>u[0]+n[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}};var PS=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=e.map((m,g)=>m[0]+n[g]+m[1]);let o=n.length,i=Me(o),s=e.map(m=>m[0]).join(","),a=e.map((m,g)=>m[0]+n[g]).join(","),l=nn("rc",o),u=nn("source",o),c=`${l[o-1]} < ${this.outputShape[o-1]}`,p=o===1?"source":`vec2(${u.slice(-2).join()})`,f=[`${i} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${c}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${c}) {`],d=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="";for(let m=0,g=o===1?2:4;m<g;m++)h+=`
        ${f[m]}
        if (${d}) {
          result[${m}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${m}] = getChannel(getX(${u.join()}), ${p});
        }
      `;h+=o===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${h}
        setOutput(result);
      }
    `}};var IR=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r;if(v.sizeFromShape(o.shape)===0){let u=i.map((c,p)=>c[0]+o.shape[p]+c[1]);return cl({backend:e,attrs:{shape:u,value:s,dtype:o.dtype}})}let a=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new PS(o.shape,i,s):new $S(o.shape,i,s),l=[[s]];return e.runWebGLProgram(a,[o],o.dtype,l)},G6={kernelName:mu,backendName:"webgl",kernelFunc:IR};var PCe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,LCe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ho+`
  return result;
`,VCe=ct({opSnippet:PCe,packedOpSnippet:LCe}),W6={kernelName:ba,backendName:"webgl",kernelFunc:VCe};function BCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=[],u=v.parseAxisParam(i,o.shape),c=u,p=S.getAxesPermutation(c,a),f=o;p!=null&&(f=Lt({inputs:{x:o},backend:e,attrs:{perm:p}}),c=S.getInnerMostAxes(c.length,a),l.push(f)),S.assertAxesAreInnerMostDims("prod",c,a);let d;if(e.shouldExecuteOnCPU([f])){let h=e.texData.get(f.dataId).values,{outVals:m,outShape:g,outDtype:y}=Aj(f.shape,f.dtype,h,c);d=e.makeTensorInfo(g,y,m)}else{let[h,m]=S.computeOutAndReduceShapes(f.shape,c),g=v.sizeFromShape(m),y=ne({inputs:{x:f},backend:e,attrs:{shape:[-1,g]}}),x=ep(o.dtype),b=mo(y,x,"prod",e);d=ne({inputs:{x:b},backend:e,attrs:{shape:h}}),l.push(y),l.push(b)}if(s){l.push(d);let h=S.expandShapeToKeepDim(d.shape,u);d=ne({inputs:{x:d},backend:e,attrs:{shape:h}})}return l.forEach(h=>e.disposeIntermediateTensorInfo(h)),d}var H6={kernelName:yu,backendName:"webgl",kernelFunc:BCe};function zCe(t){let{inputs:n,backend:e,attrs:r}=t,{paramsNestedSplits:o,paramsDenseValues:i,indices:s}=n,{outputRaggedRank:a}=r,l=o.map(y=>e.readSync(y.dataId)),u=o.map(y=>y.shape),c=e.readSync(i.dataId),p=e.readSync(s.dataId),[f,d,h]=Rj(l,u,c,i.shape,i.dtype,p,s.shape,a),m=f.map(y=>e.makeTensorInfo([y.length],"int32",y)),g=e.makeTensorInfo(h,i.dtype,d);return m.concat([g])}var j6={kernelName:Gb,backendName:"webgl",kernelFunc:zCe};function UCe(t){let{inputs:n,backend:e}=t,{starts:r,limits:o,deltas:i}=n,s=e.readSync(r.dataId),a=e.readSync(o.dataId),l=e.readSync(i.dataId),[u,c]=Mj(s,r.shape,r.dtype,a,o.shape,l,i.shape),p=e.makeTensorInfo([u.length],"int32",u),f=e.makeTensorInfo([c.length],r.dtype,c);return[p,f]}var q6={kernelName:Wb,backendName:"webgl",kernelFunc:UCe};function GCe(t){let{inputs:n,backend:e,attrs:r}=t,{shape:o,values:i,defaultValue:s,rowPartitionTensors:a}=n,{rowPartitionTypes:l}=r,u=e.readSync(o.dataId),c=e.readSync(i.dataId),p=e.readSync(s.dataId),f=a.map(g=>e.readSync(g.dataId)),d=a.map(g=>g.shape),[h,m]=Oj(u,o.shape,c,i.shape,i.dtype,p,s.shape,f,d,l);return e.makeTensorInfo(h,i.dtype,m)}var K6={kernelName:Hb,backendName:"webgl",kernelFunc:GCe};var ER=t=>{let{backend:n,attrs:e}=t,{start:r,stop:o,step:i,dtype:s}=e,a=Fj(r,o,i,s);return n.makeTensorInfo([a.length],s,a)},X6={kernelName:Nd,backendName:"webgl",kernelFunc:ER};var WCe="return 1.0 / x;",HCe=xe({opSnippet:WCe}),Y6={kernelName:wa,backendName:"webgl",kernelFunc:HCe};var jCe=gn+`
  return (x < 0.0) ? 0.0 : x;
`,qCe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,KCe=xe({opSnippet:jCe,packedOpSnippet:qCe}),Z6={kernelName:Ca,backendName:"webgl",kernelFunc:KCe};var XCe=gn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,YCe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ZCe=xe({opSnippet:XCe,packedOpSnippet:YCe}),Q6={kernelName:Sa,backendName:"webgl",kernelFunc:ZCe};var LS=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,u]=n;this.outputShape=[s,e,r,u];let c=[o&&e>1?a-1:a,o&&r>1?l-1:l],p=[o&&e>1?e-1:e,o&&r>1?r-1:r],f;i?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/p[0]},
          ${c[1]/p[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var VS=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,u]=n;this.outputShape=[s,e,r,u];let c=[o&&e>1?a-1:a,o&&r>1?l-1:l],p=[o&&e>1?e-1:e,o&&r>1?r-1:r],f;i?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/p[0]},
          ${c[1]/p[1]},
          ${c[1]/p[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function QCe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,u]=a,c=P().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new VS(o.shape,l,u,i,s):new LS(o.shape,l,u,i,s);return e.runWebGLProgram(c,[o],"float32")}var J6={kernelName:bu,backendName:"webgl",kernelFunc:QCe};var BS=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],u=[r&&s>1?s-1:s,r&&a>1?a-1:a],c=l[0]/u[0],p=l[1]/u[1],f=1/c,d=1/p,h=Math.ceil(f)*2+2,m=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${p});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${h});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function JCe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new BS(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var e8={kernelName:Ad,backendName:"webgl",kernelFunc:JCe};var zS=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,u]=n;this.outputShape=[s,e,r,u];let c=[o&&e>1?a-1:a,o&&r>1?l-1:l],p=[o&&e>1?e-1:e,o&&r>1?r-1:r],f=o?"0.5":"0.0",d;i?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/p[0]},
          ${c[1]/p[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var US=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,u]=n;this.outputShape=[s,e,r,u];let c=[o&&e>1?a-1:a,o&&r>1?l-1:l],p=[o&&e>1?e-1:e,o&&r>1?r-1:r],f=o?"0.5":"0.0",d;i?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/p[0]},
          ${c[1]/p[1]},
          ${c[1]/p[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function eSe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,u]=a,c=P().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new US(o.shape,l,u,i,s):new zS(o.shape,l,u,i,s);return e.runWebGLProgram(c,[o],o.dtype)}var t8={kernelName:vu,backendName:"webgl",kernelFunc:eSe};var GS=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],u=[r&&s>1?s-1:s,r&&a>1?a-1:a],c=l[0]/u[0],p=l[1]/u[1],f=1/c,d=1/p,h=Math.ceil(f)*2+2,m=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${p});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${h});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function tSe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new GS(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var n8={kernelName:kd,backendName:"webgl",kernelFunc:tSe};var WS=class{constructor(n,e){this.variableNames=["x"];let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=n,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${n[0]} - coord - 1));
        }
      `;return}let o=a=>e.indexOf(a)!==-1&&n[a]!==1?`${n[a]} - coords[${a}] - 1`:`coords[${a}]`,i=n.map((a,l)=>o(l)).join(","),s=Me(r);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}};var HS=class{constructor(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=n;let o=nn("rc",r),i=`${o[r-1]} + 1 < ${this.outputShape[r-1]}`,s=`${o[r-2]} + 1 < ${this.outputShape[r-2]}`,a=Me(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${n[0]} - rc - 1),
            ${n[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${n[0]} - (rc  + 1) - 1),
                ${n[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${i}){
            result.g = ${u(o.slice())};
          }
          if(${s}) {
            result.b = ${c(o.slice())};
            if(${i}) {
              result.a = ${p(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(h){return f(h)}function u(h){return h[r-1]="("+h[r-1]+" + 1)",f(h)}function c(h){return h[r-2]="("+h[r-2]+" + 1)",f(h)}function p(h){return h[r-1]="("+h[r-1]+" + 1)",h[r-2]="("+h[r-2]+" + 1)",f(h)}function f(h){let m=n.map((x,b)=>d(b,h)),g=m.join(","),y=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${y}))`}function d(h,m){return e.indexOf(h)!==-1&&n[h]!==1?`${n[h]} - ${m[h]} - 1`:`${m[h]}`}}};function nSe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r,s=o.shape.length,a=v.parseAxisParam(i,o.shape);if(s===0)return rn({inputs:{x:o},backend:e});let l=P().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new HS(o.shape,a):new WS(o.shape,a);return e.runWebGLProgram(l,[o],o.dtype)}var r8={kernelName:wu,backendName:"webgl",kernelFunc:nSe};var jS=class{constructor(n,e){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let r=n[1],o=n[2];this.outputShape=n;let i="";typeof e=="number"?i=`float outputValue = ${e.toFixed(2)};`:i=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var o8={kernelName:Pd,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=new jS(r.shape,i),[u,c]=S.getImageCenter(s,r.shape[1],r.shape[2]),p=[[u,c,Math.sin(o),Math.cos(o)]];return a.runWebGLProgram(l,[r],r.dtype,p)}};var rSe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,oSe=xe({opSnippet:rSe}),i8={kernelName:Ia,backendName:"webgl",kernelFunc:oSe};var iSe="return inversesqrt(x);",sSe=xe({opSnippet:iSe,cpuKernelImpl:$j}),s8={kernelName:Ea,backendName:"webgl",kernelFunc:sSe};var Qu=class{constructor(n,e,r,o,i,s,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let u=Me(i.length),c=Me(s.length),p="";r===1?p="i":r===2&&(p="i, j");let f=`getIndices(${p})`,d="";o===1?d="i":o===2&&(d="i, coords[1]");let h=`getUpdates(${d})`,m="";l&&(m="coords[0], coords[1]");let g=`getDefaultValue(${m})`,y=e>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${n}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${f});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${h};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}};var qS=class{constructor(n,e,r,o,i,s,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s;let u=Me(i.length),c=Me(s.length),p="";r===1?p="i":r===2&&(p="i, j");let f=`getIndices(${p})`,d="";o===1?d="i":o===2&&(d="i, coords[1]");let h=`getUpdates(${d})`,m="";l&&(m="coords[0], coords[1]");let g=`getDefaultValue(${m})`,y=e>1?"strides[j]":"strides",x=e>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${n}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${e}; j+=2) {
              ivec4 index = round(${f});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${e}) {
                flattenedIndex += index.yw * ${x};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${h};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}};function aSe(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:p}=S.calculateShapes(i,o,s),f=[p/u,u];if(p===0)return e.makeTensorInfo(s,o.dtype);let d=ne({inputs:{x:o},backend:e,attrs:{shape:[l,a]}}),h=ne({inputs:{x:i},backend:e,attrs:{shape:[l,u]}}),m=e.makeTensorInfo([],"float32",new Float32Array([0])),g;P().getBool("WEBGL_PACK")?g=new qS(l,a,d.shape.length,h.shape.length,c,f):g=new Qu(l,a,d.shape.length,h.shape.length,c,f);let y=e.runWebGLProgram(g,[h,d,m],h.dtype),x=ne({inputs:{x:y},backend:e,attrs:{shape:s}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(m),x}var a8={kernelName:jb,backendName:"webgl",kernelFunc:aSe};var KS=class{constructor(n,e,r,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[n,r];let i="while (left < right) {",s=`for (int i = 0; i < ${Math.ceil(Math.log2(e+1))}; ++i) { if (left >= right) break;`,a=P().getNumber("WEBGL_VERSION")===2?i:s,l=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}};function lSe(t){let{inputs:n,backend:e,attrs:r}=t,{sortedSequence:o,values:i}=n,{side:s}=r,a=new KS(o.shape[0],o.shape[1],i.shape[1],s),l=[[o.shape[1]]];return e.runWebGLProgram(a,[o,i],"int32",l)}var l8={kernelName:Kb,backendName:"webgl",kernelFunc:lSe};var XS=class{constructor(n,e,r){this.variableNames=["c","a","b"],this.outputShape=e;let o,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let c=0;c<e.length;c++)u.push(`${a[c]}`),c<n&&l.push(`${a[c]}`);o=l.join(),i=u.join()}let s=Me(r);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}};function uSe(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n,s=new XS(r.shape.length,o.shape,o.shape.length);return e.runWebGLProgram(s,[r,o,i],un(o.dtype,i.dtype))}var u8={kernelName:Cu,backendName:"webgl",kernelFunc:uSe};var cSe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${S.SELU_SCALEALPHA};
  float scale = ${S.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,pSe=xe({opSnippet:cSe}),c8={kernelName:Ta,backendName:"webgl",kernelFunc:pSe};var fSe=hi+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,dSe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,hSe=xe({opSnippet:fSe,packedOpSnippet:dSe,cpuKernelImpl:Lj}),p8={kernelName:ka,backendName:"webgl",kernelFunc:hSe};var mSe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,gSe=xe({opSnippet:mSe}),f8={kernelName:Da,backendName:"webgl",kernelFunc:gSe};var ySe=hi+`
  return sin(x);
`,xSe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${ho}
  return result;
`,vSe=xe({opSnippet:ySe,packedOpSnippet:xSe}),d8={kernelName:_a,backendName:"webgl",kernelFunc:vSe};var bSe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,wSe=xe({opSnippet:bSe}),h8={kernelName:Na,backendName:"webgl",kernelFunc:wSe};var CSe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,SSe=xe({opSnippet:CSe}),m8={kernelName:Aa,backendName:"webgl",kernelFunc:SSe};var ISe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;v.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((y,x)=>y*x),l=[[0,0]];l.push(...s);for(let y=1+i.length;y<o.shape.length;++y)l.push([0,0]);let u=[],c=IR({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),p=S.getReshaped(c.shape,i,a,!1),f=S.getPermuted(p.length,i.length,!1),d=S.getReshapedPermuted(c.shape,i,a,!1),h=ne({inputs:{x:c},backend:e,attrs:{shape:p}}),m=Lt({inputs:{x:h},backend:e,attrs:{perm:f}}),g=ne({inputs:{x:m},backend:e,attrs:{shape:d}});return u.push(c),u.push(h),u.push(m),u.forEach(y=>e.disposeIntermediateTensorInfo(y)),g},g8={kernelName:Eu,backendName:"webgl",kernelFunc:ISe};function ESe(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.readSync(r.dataId),l=e.readSync(o.dataId),u=e.readSync(i.dataId),c=e.readSync(s.dataId)[0],[p,f,d,h,m]=Bj(a,r.shape,r.dtype,l,o.dtype,u,c);return[e.makeTensorInfo(f,r.dtype,p),e.makeTensorInfo([f[0]],o.dtype,d),e.makeTensorInfo([h.length],"bool",new Uint8Array(h.map(g=>Number(g)))),e.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}var y8={kernelName:Xb,backendName:"webgl",kernelFunc:ESe};function TSe(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.readSync(o.dataId)),a=e.readSync(r.dataId),l=Array.from(e.readSync(i.dataId)),[u,c,p]=zj(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(c,r.dtype,u),e.makeTensorInfo([p.length],i.dtype,new Int32Array(p))]}var x8={kernelName:Yb,backendName:"webgl",kernelFunc:TSe};function _Se(t){let{inputs:n,backend:e}=t,{data:r,indices:o,segmentIds:i}=n;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);let s=e.readSync(r.dataId),a=e.readSync(o.dataId),l=e.readSync(i.dataId),[u,c]=kC(s,r.shape,r.dtype,a,l,!0);return e.makeTensorInfo(c,r.dtype,u)}var v8={kernelName:Zb,backendName:"webgl",kernelFunc:_Se};function NSe(t){let{inputs:n,backend:e}=t,{data:r,indices:o,segmentIds:i}=n;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);let s=e.readSync(r.dataId),a=e.readSync(o.dataId),l=e.readSync(i.dataId),[u,c]=kC(s,r.shape,r.dtype,a,l);return e.makeTensorInfo(c,r.dtype,u)}var b8={kernelName:Qb,backendName:"webgl",kernelFunc:NSe};function DSe(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:u,sliceSize:c,strides:p,outputSize:f}=S.calculateShapes(i,o,a),d=!1;if(i.dtype==="string"){let y=e.bufferSync(o),x=e.bufferSync(i),b=v.decodeString(e.readSync(s.dataId)[0]),w=Pj(y,x,a,f,c,u,l,p,b,d);return e.makeTensorInfo(a,w.dtype,w.values)}let h=new Qu(u,l,o.shape.length,i.shape.length,p,[f,1],d),m=e.runWebGLProgram(h,[i,o,s],i.dtype),g=ne({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(m),g}var w8={kernelName:Jb,backendName:"webgl",kernelFunc:DSe};function kSe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=v.parseAxisParam(s,o.shape)[0],l=S.prepareSplitSize(o,i,a),u=o.shape.length,c=new Array(u).fill(0),p=o.shape.slice();return l.map(f=>{let d=[...p];d[a]=f;let h=Gi({inputs:{x:o},backend:e,attrs:{begin:c,size:d}});return c[a]+=f,h})}var C8={kernelName:Tu,backendName:"webgl",kernelFunc:kSe};var S8="return sqrt(x);",ASe=xe({opSnippet:S8,packedOpSnippet:S8,cpuKernelImpl:Uj}),I8={kernelName:Ra,backendName:"webgl",kernelFunc:ASe};var RSe="return x * x;",MSe=xe({opSnippet:RSe}),E8={kernelName:Rd,backendName:"webgl",kernelFunc:MSe};var T8="return (a - b) * (a - b);",OSe=ct({opSnippet:T8,packedOpSnippet:T8}),_8={kernelName:Ma,backendName:"webgl",kernelFunc:OSe};function FSe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;if(o.dtype!=="string")throw new Error("Input must be of datatype string");let i=e.readSync(o.dataId),s=S.fromUint8ToStringArray(i),a=Gj(s,"string",r);return e.makeTensorInfo(o.shape,"string",a)}var N8={kernelName:Ng,backendName:"webgl",kernelFunc:FSe};function $Se({inputs:t,attrs:n,backend:e}){let{x:r}=t,o=gn+`
    return x > 0.0 ? 1.0 : float(${n.alpha});
  `,i=new Wn(r.shape,o);return e.runWebGLProgram(i,[r],r.dtype)}var D8={kernelName:Pa,backendName:"webgl",kernelFunc:$Se};var YS=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=r;let o=r.length,i=Me(r.length),s=Me(r.length),a="";if(o===1)a="coords * strides + begin";else{let l=0;a=r.map((u,c)=>(l++,r.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${l-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${n});
      ${i} strides = ${i}(${e});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function PSe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:p,shrinkAxisMask:f}=r,{finalShapeSparse:d,finalShape:h,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:x,end:b,strides:w}=kn.sliceInfo(o.shape,i,s,a,l,u,c,p,f),C;if(m)C=ne({inputs:{x:o},backend:e,attrs:{shape:h}});else if(g||y){v.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let D=kn.computeOutShape(x,b,w),k=Gi({inputs:{x:o},backend:e,attrs:{begin:x,size:D}});C=ne({inputs:{x:k},backend:e,attrs:{shape:h}}),e.disposeIntermediateTensorInfo(k)}else if(e.shouldExecuteOnCPU([o])){let k=e.readSync(o.dataId),O=ve(o.shape,o.dtype,k),$=Wj(d,O,w,x);C=e.makeTensorInfo(h,o.dtype,$.values)}else{let k=new YS(x,w,d);C=e.runWebGLProgram(k,[o],o.dtype)}let N=ne({inputs:{x:C},backend:e,attrs:{shape:h}});return e.disposeIntermediateTensorInfo(C),N}var k8={kernelName:Md,backendName:"webgl",kernelFunc:PSe};function LSe(t){let{inputs:n,backend:e,attrs:r}=t,{separator:o,nGramWidths:i,leftPad:s,rightPad:a,padWidth:l,preserveShortSequences:u}=r,{data:c,dataSplits:p}=n,f=e.readSync(c.dataId),d=e.readSync(p.dataId),[h,m]=Hj(f,d,o,i,s,a,l,u);return[e.makeTensorInfo([h.length],"string",h),e.makeTensorInfo(p.shape,"int32",m)]}var A8={kernelName:e0,backendName:"webgl",kernelFunc:LSe};function VSe(t){let{inputs:n,backend:e,attrs:r}=t,{skipEmpty:o}=r,{input:i,delimiter:s}=n;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(s.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${s.shape}`);let a=e.readSync(i.dataId),l=e.readSync(s.dataId)[0],[u,c,p]=jj(a,l,o),f=c.length;return[e.makeTensorInfo([f,2],"int32",u),e.makeTensorInfo([f],"string",c),e.makeTensorInfo([2],"int32",new Int32Array(p))]}var R8={kernelName:t0,backendName:"webgl",kernelFunc:VSe};function BSe(t){let{inputs:n,backend:e,attrs:r}=t,{numBuckets:o}=r,{input:i}=n;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let s=e.readSync(i.dataId),a=qj(s,o);return e.makeTensorInfo(i.shape,"int32",a)}var M8={kernelName:n0,backendName:"webgl",kernelFunc:BSe};var zSe="return tan(x);",USe=xe({opSnippet:zSe}),O8={kernelName:Fa,backendName:"webgl",kernelFunc:USe};var GSe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,WSe=xe({opSnippet:GSe}),F8={kernelName:$a,backendName:"webgl",kernelFunc:WSe};function HSe(t){let{inputs:n,backend:e,attrs:r}=t,{tensor:o,indices:i,updates:s}=n,{}=r,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:p}=S.calculateShapes(s,i,o.shape),f=[p/u,u];if(p===0)return e.makeTensorInfo(o.shape,i.dtype);let d=ne({inputs:{x:i},backend:e,attrs:{shape:[l,a]}}),h=ne({inputs:{x:s},backend:e,attrs:{shape:[l,u]}}),m=ne({inputs:{x:o},backend:e,attrs:{shape:f}}),g=new Qu(l,a,d.shape.length,h.shape.length,c,f,!1,!0),y=e.runWebGLProgram(g,[h,d,m],m.dtype),x=ne({inputs:{x:y},backend:e,attrs:{shape:o.shape}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),x}var $8={kernelName:qb,backendName:"webgl",kernelFunc:HSe};var ZS=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[s]*e[s];this.outputShape=r,this.rank=r.length;let o=Me(this.rank),i=jSe(n);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}};function jSe(t){let n=t.length;if(n>5)throw Error(`Tile for rank ${n} is not yet supported`);if(n===1)return`imod(resRC, ${t[0]})`;let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<t.length;o++)r.push(`imod(${e[o]}, ${t[o]})`);return r.join()}function TR(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;if(o.dtype==="string"||o.shape.length>5){let l=e.readSync(o.dataId),u=o.dtype==="string"?l.map(f=>v.decodeString(f)):l,c=ve(o.shape,o.dtype,u),p=Xj(c,i);return e.makeTensorInfo(p.shape,p.dtype,p.values)}let s=new ZS(o.shape,i);return e.runWebGLProgram(s,[o],o.dtype)}var P8={kernelName:ss,backendName:"webgl",kernelFunc:TR};var QS=class{constructor(n){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=n,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}},JS=class{constructor(n){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=n,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}};function Up(t,n){n!==null&&t.disposeIntermediateTensorInfo(n)}function L8(t){let n=1;for(;n<t;)n*=2;return n}function qSe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r,a=P().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=P().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=o.shape,c=u[u.length-1];if(e.shouldExecuteOnCPU([o])||c<a||i>l){let $=e.readSync(o.dataId),[V,G]=Yj($,u,o.dtype,i,s);return[e.makeTensorInfo(V.shape,V.dtype,V.values),e.makeTensorInfo(G.shape,G.dtype,G.values)]}if(i===0)return u[u.length-1]=0,[e.makeTensorInfo(u,o.dtype,[]),e.makeTensorInfo(u,"int32",[])];if(c===1)return[o,cl({attrs:{shape:u,dtype:"int32",value:0},backend:e})];let p=e.texData.get(o.dataId),f=p!==null&&p.isPacked,d=f?e.unpackTensor(o):o,m=v.sizeFromShape(u)/c,g=ne({inputs:{x:d},attrs:{shape:[m,c]},backend:e});f&&Up(e,d);let y=L8(i),x=L8(c),b=null,w=()=>b===null?[g,g]:[g,b],C=($,V,G)=>{let W=w(),H=new QS(G),Y=[[c],[b===null?1:0],[Number.NEGATIVE_INFINITY],[$],[V]],ee=b;b=e.runWebGLProgram(H,W,"int32",Y),Up(e,ee)};for(let $=1;$<y;$*=2){let V=$*2;for(let G=$;G>=1;G/=2)C(V,G,[m,x])}for(let $=x;$>y;$/=2){let V=w(),G=new JS([m,$/2]),H=[[c],[b===null?1:0],[y]],j=b;b=e.runWebGLProgram(G,V,"int32",H),Up(e,j);let Y=y/2,ee=Y*2;for(let X=Y;X>=1;X/=2)C(ee,X,b.shape)}let N=b;b=Gi({inputs:{x:b},backend:e,attrs:{begin:0,size:[m,i]}}),Up(e,N);let D=vR({inputs:{x:g,indices:b},backend:e,attrs:{axis:1,batchDims:1}});Up(e,g);let k=u.slice(0,-1);k.push(i),N=b,b=ne({inputs:{x:b},attrs:{shape:k},backend:e}),Up(e,N);let O=D;return D=ne({inputs:{x:D},attrs:{shape:k},backend:e}),Up(e,O),[D,b]}var V8={kernelName:Od,backendName:"webgl",kernelFunc:qSe};var eI=class{constructor(n,e,r,o,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;let a=r==="nearest"?1:2,l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${n} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${n}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function KSe(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:u}=r,[c,p,f,d]=o.shape,[h,m]=u??[p,f],g=[c,h,m,d],y=new eI(p,f,s,a,l,g);return e.runWebGLProgram(y,[o,i],"float32")}var B8={kernelName:Fd,backendName:"webgl",kernelFunc:KSe};function XSe(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;Cs(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let s=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:u}=Zj(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([u.length],"int32",u)]}var z8={kernelName:$d,backendName:"webgl",kernelFunc:XSe};function YSe(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o,a=s.shape.length,l=o.shape[i],u=new Array(a-1),c=0;for(let m=0;m<a;m++)m!==i&&(u[c++]=s.shape[m]);let p=[],f=new Array(a).fill(0),d=s.shape.slice();d[i]=1;let h=new Array(l);for(let m=0;m<h.length;m++){f[i]=m;let g=Gi({inputs:{x:s},backend:e,attrs:{begin:f,size:d}}),y=ne({inputs:{x:g},backend:e,attrs:{shape:u}});h[m]=y,p.push(g)}return p.forEach(m=>e.disposeIntermediateTensorInfo(m)),h}var U8={kernelName:Nu,backendName:"webgl",kernelFunc:YSe};var tI=class{constructor(n,e){this.variableNames=["x","segmentIds"];let r=n.windowSize,o=n.batchSize,i=n.inSize,s=n.numSegments,a=s*Math.ceil(i/r);this.outputShape=[o,a];let l="0.0",u="sumValue",c=Math.floor(r/4)*4,p=r%4,f=`
        sumValue += dot(values, segFilter);
    `,d="";i%r>0&&(d=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let h="";i%r>0&&(h=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${h}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${c};
        if (${p===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${p===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${p===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${u});
      }
    `}};function ZSe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r,a=o.shape.length,l=[],u=0,c=S.getAxesPermutation([u],a),p=o;c!=null&&(p=Lt({inputs:{x:o},backend:e,attrs:{perm:c}}),l.push(p),u=S.getInnerMostAxes(1,a)[0]);let f=S.segment_util.computeOutShape(p.shape,u,s),d=v.sizeFromShape([p.shape[u]]),h=ne({inputs:{x:p},backend:e,attrs:{shape:[-1,d]}});l.push(h);let m=ep(o.dtype),g=(w,C,N,D,k)=>{let O=w.shape[0],$=w.shape[1],V=S.segment_util.segOpComputeOptimalWindowSize($,k),G={windowSize:V,inSize:$,batchSize:O,numSegments:k},W=new tI(G,C),H=e.compileAndRun(W,[w,N],D);if(l.push(H),H.shape[1]===k)return H;let j=ER({backend:e,attrs:{start:0,stop:k,step:1,dtype:"float32"}}),Y=TR({inputs:{x:j},backend:e,attrs:{reps:[$/V]}});return l.push(j),l.push(Y),g(H,C,Y,D,k)},y=g(h,"unsortedSegmentSum",i,m,s),x=ne({inputs:{x:y},backend:e,attrs:{shape:f}}),b=x;if(c!=null){l.push(x);let w=S.getUndoAxesPermutation(c);b=Lt({inputs:{x:b},backend:e,attrs:{perm:w}})}return l.forEach(w=>e.disposeIntermediateTensorInfo(w)),b}var G8={kernelName:Du,backendName:"webgl",kernelFunc:ZSe};var QSe=[Eq,_q,Nq,Dq,Aq,Rq,Mq,Oq,Pq,Lq,Vq,Bq,zq,Uq,Gq,Wq,Hq,jq,qq,Kq,Xq,Zq,Qq,Jq,e5,o5,s5,a5,mq,u5,p5,f5,d5,h5,m5,g5,y5,x5,v5,b5,S5,I5,E5,T5,_5,N5,D5,k5,A5,R5,M5,O5,F5,$5,P5,L5,B5,z5,U5,G5,H5,j5,q5,K5,X5,Y5,Z5,Q5,J5,hq,e6,c5,t6,n6,r6,gq,o6,i6,s6,a6,l6,u6,c6,p6,f6,d6,m6,g6,y6,x6,v6,b6,C6,I6,E6,T6,_6,N6,M6,vq,O6,F6,$6,P6,t5,L6,z6,U6,G6,W6,yq,H6,j6,q6,K6,X6,n5,D6,Y6,Z6,Q6,wq,J6,e8,t8,n8,r8,o8,i8,s8,a8,l8,u8,c8,p8,f8,d8,h8,Yq,R6,m8,g8,y8,x8,v8,b8,w8,C8,I8,E8,_8,N8,D8,k8,A8,R8,M8,A6,Sq,O8,F8,$8,P8,V8,B8,Iq,z8,U8,G8,V6];for(let t of QSe)o0(t);var eIe={value:()=>{}};function H8(){for(var t=0,n=arguments.length,e={},r;t<n;++t){if(!(r=arguments[t]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new nI(e)}function nI(t){this._=t}function tIe(t,n){return t.trim().split(/^|\s+/).map(function(e){var r="",o=e.indexOf(".");if(o>=0&&(r=e.slice(o+1),e=e.slice(0,o)),e&&!n.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}nI.prototype=H8.prototype={constructor:nI,on:function(t,n){var e=this._,r=tIe(t+"",e),o,i=-1,s=r.length;if(arguments.length<2){for(;++i<s;)if((o=(t=r[i]).type)&&(o=nIe(e[o],t.name)))return o;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++i<s;)if(o=(t=r[i]).type)e[o]=W8(e[o],t.name,n);else if(n==null)for(o in e)e[o]=W8(e[o],t.name,null);return this},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new nI(t)},call:function(t,n){if((o=arguments.length-2)>0)for(var e=new Array(o),r=0,o,i;r<o;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(n,e)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],o=0,i=r.length;o<i;++o)r[o].value.apply(n,e)}};function nIe(t,n){for(var e=0,r=t.length,o;e<r;++e)if((o=t[e]).name===n)return o.value}function W8(t,n,e){for(var r=0,o=t.length;r<o;++r)if(t[r].name===n){t[r]=eIe,t=t.slice(0,r).concat(t.slice(r+1));break}return e!=null&&t.push({name:n,value:e}),t}var Gp=H8;function rI(t,n,e){t.prototype=n.prototype=e,e.constructor=t}function _R(t,n){var e=Object.create(t.prototype);for(var r in n)e[r]=n[r];return e}function jy(){}var Wy=.7,sI=1/Wy,Jh="\\s*([+-]?\\d+)\\s*",Hy="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Is="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",rIe=/^#([0-9a-f]{3,8})$/,oIe=new RegExp(`^rgb\\(${Jh},${Jh},${Jh}\\)$`),iIe=new RegExp(`^rgb\\(${Is},${Is},${Is}\\)$`),sIe=new RegExp(`^rgba\\(${Jh},${Jh},${Jh},${Hy}\\)$`),aIe=new RegExp(`^rgba\\(${Is},${Is},${Is},${Hy}\\)$`),lIe=new RegExp(`^hsl\\(${Hy},${Is},${Is}\\)$`),uIe=new RegExp(`^hsla\\(${Hy},${Is},${Is},${Hy}\\)$`),j8={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};rI(jy,yo,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:q8,formatHex:q8,formatHex8:cIe,formatHsl:pIe,formatRgb:K8,toString:K8});function q8(){return this.rgb().formatHex()}function cIe(){return this.rgb().formatHex8()}function pIe(){return eK(this).formatHsl()}function K8(){return this.rgb().formatRgb()}function yo(t){var n,e;return t=(t+"").trim().toLowerCase(),(n=rIe.exec(t))?(e=n[1].length,n=parseInt(n[1],16),e===6?X8(n):e===3?new go(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):e===8?oI(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):e===4?oI(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=oIe.exec(t))?new go(n[1],n[2],n[3],1):(n=iIe.exec(t))?new go(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=sIe.exec(t))?oI(n[1],n[2],n[3],n[4]):(n=aIe.exec(t))?oI(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=lIe.exec(t))?Q8(n[1],n[2]/100,n[3]/100,1):(n=uIe.exec(t))?Q8(n[1],n[2]/100,n[3]/100,n[4]):j8.hasOwnProperty(t)?X8(j8[t]):t==="transparent"?new go(NaN,NaN,NaN,0):null}function X8(t){return new go(t>>16&255,t>>8&255,t&255,1)}function oI(t,n,e,r){return r<=0&&(t=n=e=NaN),new go(t,n,e,r)}function fIe(t){return t instanceof jy||(t=yo(t)),t?(t=t.rgb(),new go(t.r,t.g,t.b,t.opacity)):new go}function em(t,n,e,r){return arguments.length===1?fIe(t):new go(t,n,e,r??1)}function go(t,n,e,r){this.r=+t,this.g=+n,this.b=+e,this.opacity=+r}rI(go,em,_R(jy,{brighter(t){return t=t==null?sI:Math.pow(sI,t),new go(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Wy:Math.pow(Wy,t),new go(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new go(Hp(this.r),Hp(this.g),Hp(this.b),aI(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Y8,formatHex:Y8,formatHex8:dIe,formatRgb:Z8,toString:Z8}));function Y8(){return`#${Wp(this.r)}${Wp(this.g)}${Wp(this.b)}`}function dIe(){return`#${Wp(this.r)}${Wp(this.g)}${Wp(this.b)}${Wp((isNaN(this.opacity)?1:this.opacity)*255)}`}function Z8(){let t=aI(this.opacity);return`${t===1?"rgb(":"rgba("}${Hp(this.r)}, ${Hp(this.g)}, ${Hp(this.b)}${t===1?")":`, ${t})`}`}function aI(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Hp(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Wp(t){return t=Hp(t),(t<16?"0":"")+t.toString(16)}function Q8(t,n,e,r){return r<=0?t=n=e=NaN:e<=0||e>=1?t=n=NaN:n<=0&&(t=NaN),new Wi(t,n,e,r)}function eK(t){if(t instanceof Wi)return new Wi(t.h,t.s,t.l,t.opacity);if(t instanceof jy||(t=yo(t)),!t)return new Wi;if(t instanceof Wi)return t;t=t.rgb();var n=t.r/255,e=t.g/255,r=t.b/255,o=Math.min(n,e,r),i=Math.max(n,e,r),s=NaN,a=i-o,l=(i+o)/2;return a?(n===i?s=(e-r)/a+(e<r)*6:e===i?s=(r-n)/a+2:s=(n-e)/a+4,a/=l<.5?i+o:2-i-o,s*=60):a=l>0&&l<1?0:s,new Wi(s,a,l,t.opacity)}function tK(t,n,e,r){return arguments.length===1?eK(t):new Wi(t,n,e,r??1)}function Wi(t,n,e,r){this.h=+t,this.s=+n,this.l=+e,this.opacity=+r}rI(Wi,tK,_R(jy,{brighter(t){return t=t==null?sI:Math.pow(sI,t),new Wi(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Wy:Math.pow(Wy,t),new Wi(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,n=isNaN(t)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*n,o=2*e-r;return new go(NR(t>=240?t-240:t+120,o,r),NR(t,o,r),NR(t<120?t+240:t-120,o,r),this.opacity)},clamp(){return new Wi(J8(this.h),iI(this.s),iI(this.l),aI(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=aI(this.opacity);return`${t===1?"hsl(":"hsla("}${J8(this.h)}, ${iI(this.s)*100}%, ${iI(this.l)*100}%${t===1?")":`, ${t})`}`}}));function J8(t){return t=(t||0)%360,t<0?t+360:t}function iI(t){return Math.max(0,Math.min(1,t||0))}function NR(t,n,e){return(t<60?n+(e-n)*t/60:t<180?e:t<240?n+(e-n)*(240-t)/60:n)*255}function DR(t,n,e,r,o){var i=t*t,s=i*t;return((1-3*t+3*i-s)*n+(4-6*i+3*s)*e+(1+3*t+3*i-3*s)*r+s*o)/6}function nK(t){var n=t.length-1;return function(e){var r=e<=0?e=0:e>=1?(e=1,n-1):Math.floor(e*n),o=t[r],i=t[r+1],s=r>0?t[r-1]:2*o-i,a=r<n-1?t[r+2]:2*i-o;return DR((e-r/n)*n,s,o,i,a)}}function rK(t){var n=t.length;return function(e){var r=Math.floor(((e%=1)<0?++e:e)*n),o=t[(r+n-1)%n],i=t[r%n],s=t[(r+1)%n],a=t[(r+2)%n];return DR((e-r/n)*n,o,i,s,a)}}var kR=t=>()=>t;function hIe(t,n){return function(e){return t+e*n}}function mIe(t,n,e){return t=Math.pow(t,e),n=Math.pow(n,e)-t,e=1/e,function(r){return Math.pow(t+r*n,e)}}function oK(t){return(t=+t)==1?lI:function(n,e){return e-n?mIe(n,e,t):kR(isNaN(n)?e:n)}}function lI(t,n){var e=n-t;return e?hIe(t,e):kR(isNaN(t)?n:t)}var xo=function t(n){var e=oK(n);function r(o,i){var s=e((o=em(o)).r,(i=em(i)).r),a=e(o.g,i.g),l=e(o.b,i.b),u=lI(o.opacity,i.opacity);return function(c){return o.r=s(c),o.g=a(c),o.b=l(c),o.opacity=u(c),o+""}}return r.gamma=t,r}(1);function iK(t){return function(n){var e=n.length,r=new Array(e),o=new Array(e),i=new Array(e),s,a;for(s=0;s<e;++s)a=em(n[s]),r[s]=a.r||0,o[s]=a.g||0,i[s]=a.b||0;return r=t(r),o=t(o),i=t(i),a.opacity=1,function(l){return a.r=r(l),a.g=o(l),a.b=i(l),a+""}}}var gIe=iK(nK),yIe=iK(rK);function Ar(t,n){return t=+t,n=+n,function(e){return t*(1-e)+n*e}}var RR=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,AR=new RegExp(RR.source,"g");function xIe(t){return function(){return t}}function vIe(t){return function(n){return t(n)+""}}function jp(t,n){var e=RR.lastIndex=AR.lastIndex=0,r,o,i,s=-1,a=[],l=[];for(t=t+"",n=n+"";(r=RR.exec(t))&&(o=AR.exec(n));)(i=o.index)>e&&(i=n.slice(e,i),a[s]?a[s]+=i:a[++s]=i),(r=r[0])===(o=o[0])?a[s]?a[s]+=o:a[++s]=o:(a[++s]=null,l.push({i:s,x:Ar(r,o)})),e=AR.lastIndex;return e<n.length&&(i=n.slice(e),a[s]?a[s]+=i:a[++s]=i),a.length<2?l[0]?vIe(l[0].x):xIe(n):(n=l.length,function(u){for(var c=0,p;c<n;++c)a[(p=l[c]).i]=p.x(u);return a.join("")})}var sK=180/Math.PI,uI={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function MR(t,n,e,r,o,i){var s,a,l;return(s=Math.sqrt(t*t+n*n))&&(t/=s,n/=s),(l=t*e+n*r)&&(e-=t*l,r-=n*l),(a=Math.sqrt(e*e+r*r))&&(e/=a,r/=a,l/=a),t*r<n*e&&(t=-t,n=-n,l=-l,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(n,t)*sK,skewX:Math.atan(l)*sK,scaleX:s,scaleY:a}}var cI;function aK(t){let n=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return n.isIdentity?uI:MR(n.a,n.b,n.c,n.d,n.e,n.f)}function lK(t){return t==null?uI:(cI||(cI=document.createElementNS("http://www.w3.org/2000/svg","g")),cI.setAttribute("transform",t),(t=cI.transform.baseVal.consolidate())?(t=t.matrix,MR(t.a,t.b,t.c,t.d,t.e,t.f)):uI)}function uK(t,n,e,r){function o(u){return u.length?u.pop()+" ":""}function i(u,c,p,f,d,h){if(u!==p||c!==f){var m=d.push("translate(",null,n,null,e);h.push({i:m-4,x:Ar(u,p)},{i:m-2,x:Ar(c,f)})}else(p||f)&&d.push("translate("+p+n+f+e)}function s(u,c,p,f){u!==c?(u-c>180?c+=360:c-u>180&&(u+=360),f.push({i:p.push(o(p)+"rotate(",null,r)-2,x:Ar(u,c)})):c&&p.push(o(p)+"rotate("+c+r)}function a(u,c,p,f){u!==c?f.push({i:p.push(o(p)+"skewX(",null,r)-2,x:Ar(u,c)}):c&&p.push(o(p)+"skewX("+c+r)}function l(u,c,p,f,d,h){if(u!==p||c!==f){var m=d.push(o(d)+"scale(",null,",",null,")");h.push({i:m-4,x:Ar(u,p)},{i:m-2,x:Ar(c,f)})}else(p!==1||f!==1)&&d.push(o(d)+"scale("+p+","+f+")")}return function(u,c){var p=[],f=[];return u=t(u),c=t(c),i(u.translateX,u.translateY,c.translateX,c.translateY,p,f),s(u.rotate,c.rotate,p,f),a(u.skewX,c.skewX,p,f),l(u.scaleX,u.scaleY,c.scaleX,c.scaleY,p,f),u=c=null,function(d){for(var h=-1,m=f.length,g;++h<m;)p[(g=f[h]).i]=g.x(d);return p.join("")}}}var qp=uK(aK,"px, ","px)","deg)"),Kp=uK(lK,", ",")",")");var pI="http://www.w3.org/1999/xhtml",OR={svg:"http://www.w3.org/2000/svg",xhtml:pI,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function pl(t){var n=t+="",e=n.indexOf(":");return e>=0&&(n=t.slice(0,e))!=="xmlns"&&(t=t.slice(e+1)),OR.hasOwnProperty(n)?{space:OR[n],local:t}:t}function bIe(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===pI&&n.documentElement.namespaceURI===pI?n.createElement(t):n.createElementNS(e,t)}}function wIe(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function fI(t){var n=pl(t);return(n.local?wIe:bIe)(n)}function CIe(){}function Xp(t){return t==null?CIe:function(){return this.querySelector(t)}}function cK(t){typeof t!="function"&&(t=Xp(t));for(var n=this._groups,e=n.length,r=new Array(e),o=0;o<e;++o)for(var i=n[o],s=i.length,a=r[o]=new Array(s),l,u,c=0;c<s;++c)(l=i[c])&&(u=t.call(l,l.__data__,c,i))&&("__data__"in l&&(u.__data__=l.__data__),a[c]=u);return new Hn(r,this._parents)}function FR(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function SIe(){return[]}function qy(t){return t==null?SIe:function(){return this.querySelectorAll(t)}}function IIe(t){return function(){return FR(t.apply(this,arguments))}}function pK(t){typeof t=="function"?t=IIe(t):t=qy(t);for(var n=this._groups,e=n.length,r=[],o=[],i=0;i<e;++i)for(var s=n[i],a=s.length,l,u=0;u<a;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),o.push(l));return new Hn(r,o)}function Ky(t){return function(){return this.matches(t)}}function dI(t){return function(n){return n.matches(t)}}var EIe=Array.prototype.find;function TIe(t){return function(){return EIe.call(this.children,t)}}function _Ie(){return this.firstElementChild}function fK(t){return this.select(t==null?_Ie:TIe(typeof t=="function"?t:dI(t)))}var NIe=Array.prototype.filter;function DIe(){return Array.from(this.children)}function kIe(t){return function(){return NIe.call(this.children,t)}}function dK(t){return this.selectAll(t==null?DIe:kIe(typeof t=="function"?t:dI(t)))}function hK(t){typeof t!="function"&&(t=Ky(t));for(var n=this._groups,e=n.length,r=new Array(e),o=0;o<e;++o)for(var i=n[o],s=i.length,a=r[o]=[],l,u=0;u<s;++u)(l=i[u])&&t.call(l,l.__data__,u,i)&&a.push(l);return new Hn(r,this._parents)}function hI(t){return new Array(t.length)}function mK(){return new Hn(this._enter||this._groups.map(hI),this._parents)}function Xy(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}Xy.prototype={constructor:Xy,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function gK(t){return function(){return t}}function AIe(t,n,e,r,o,i){for(var s=0,a,l=n.length,u=i.length;s<u;++s)(a=n[s])?(a.__data__=i[s],r[s]=a):e[s]=new Xy(t,i[s]);for(;s<l;++s)(a=n[s])&&(o[s]=a)}function RIe(t,n,e,r,o,i,s){var a,l,u=new Map,c=n.length,p=i.length,f=new Array(c),d;for(a=0;a<c;++a)(l=n[a])&&(f[a]=d=s.call(l,l.__data__,a,n)+"",u.has(d)?o[a]=l:u.set(d,l));for(a=0;a<p;++a)d=s.call(t,i[a],a,i)+"",(l=u.get(d))?(r[a]=l,l.__data__=i[a],u.delete(d)):e[a]=new Xy(t,i[a]);for(a=0;a<c;++a)(l=n[a])&&u.get(f[a])===l&&(o[a]=l)}function MIe(t){return t.__data__}function yK(t,n){if(!arguments.length)return Array.from(this,MIe);var e=n?RIe:AIe,r=this._parents,o=this._groups;typeof t!="function"&&(t=gK(t));for(var i=o.length,s=new Array(i),a=new Array(i),l=new Array(i),u=0;u<i;++u){var c=r[u],p=o[u],f=p.length,d=OIe(t.call(c,c&&c.__data__,u,r)),h=d.length,m=a[u]=new Array(h),g=s[u]=new Array(h),y=l[u]=new Array(f);e(c,p,m,g,y,d,n);for(var x=0,b=0,w,C;x<h;++x)if(w=m[x]){for(x>=b&&(b=x+1);!(C=g[b])&&++b<h;);w._next=C||null}}return s=new Hn(s,r),s._enter=a,s._exit=l,s}function OIe(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function xK(){return new Hn(this._exit||this._groups.map(hI),this._parents)}function vK(t,n,e){var r=this.enter(),o=this,i=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),n!=null&&(o=n(o),o&&(o=o.selection())),e==null?i.remove():e(i),r&&o?r.merge(o).order():o}function bK(t){for(var n=t.selection?t.selection():t,e=this._groups,r=n._groups,o=e.length,i=r.length,s=Math.min(o,i),a=new Array(o),l=0;l<s;++l)for(var u=e[l],c=r[l],p=u.length,f=a[l]=new Array(p),d,h=0;h<p;++h)(d=u[h]||c[h])&&(f[h]=d);for(;l<o;++l)a[l]=e[l];return new Hn(a,this._parents)}function wK(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var r=t[n],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function CK(t){t||(t=FIe);function n(p,f){return p&&f?t(p.__data__,f.__data__):!p-!f}for(var e=this._groups,r=e.length,o=new Array(r),i=0;i<r;++i){for(var s=e[i],a=s.length,l=o[i]=new Array(a),u,c=0;c<a;++c)(u=s[c])&&(l[c]=u);l.sort(n)}return new Hn(o,this._parents).order()}function FIe(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function SK(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function IK(){return Array.from(this)}function EK(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function TK(){let t=0;for(let n of this)++t;return t}function _K(){return!this.node()}function NK(t){for(var n=this._groups,e=0,r=n.length;e<r;++e)for(var o=n[e],i=0,s=o.length,a;i<s;++i)(a=o[i])&&t.call(a,a.__data__,i,o);return this}function $Ie(t){return function(){this.removeAttribute(t)}}function PIe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function LIe(t,n){return function(){this.setAttribute(t,n)}}function VIe(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function BIe(t,n){return function(){var e=n.apply(this,arguments);e==null?this.removeAttribute(t):this.setAttribute(t,e)}}function zIe(t,n){return function(){var e=n.apply(this,arguments);e==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}function DK(t,n){var e=pl(t);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((n==null?e.local?PIe:$Ie:typeof n=="function"?e.local?zIe:BIe:e.local?VIe:LIe)(e,n))}function mI(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function UIe(t){return function(){this.style.removeProperty(t)}}function GIe(t,n,e){return function(){this.style.setProperty(t,n,e)}}function WIe(t,n,e){return function(){var r=n.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,e)}}function kK(t,n,e){return arguments.length>1?this.each((n==null?UIe:typeof n=="function"?WIe:GIe)(t,n,e??"")):Ju(this.node(),t)}function Ju(t,n){return t.style.getPropertyValue(n)||mI(t).getComputedStyle(t,null).getPropertyValue(n)}function HIe(t){return function(){delete this[t]}}function jIe(t,n){return function(){this[t]=n}}function qIe(t,n){return function(){var e=n.apply(this,arguments);e==null?delete this[t]:this[t]=e}}function AK(t,n){return arguments.length>1?this.each((n==null?HIe:typeof n=="function"?qIe:jIe)(t,n)):this.node()[t]}function RK(t){return t.trim().split(/^|\s+/)}function $R(t){return t.classList||new MK(t)}function MK(t){this._node=t,this._names=RK(t.getAttribute("class")||"")}MK.prototype={add:function(t){var n=this._names.indexOf(t);n<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function OK(t,n){for(var e=$R(t),r=-1,o=n.length;++r<o;)e.add(n[r])}function FK(t,n){for(var e=$R(t),r=-1,o=n.length;++r<o;)e.remove(n[r])}function KIe(t){return function(){OK(this,t)}}function XIe(t){return function(){FK(this,t)}}function YIe(t,n){return function(){(n.apply(this,arguments)?OK:FK)(this,t)}}function $K(t,n){var e=RK(t+"");if(arguments.length<2){for(var r=$R(this.node()),o=-1,i=e.length;++o<i;)if(!r.contains(e[o]))return!1;return!0}return this.each((typeof n=="function"?YIe:n?KIe:XIe)(e,n))}function ZIe(){this.textContent=""}function QIe(t){return function(){this.textContent=t}}function JIe(t){return function(){var n=t.apply(this,arguments);this.textContent=n??""}}function PK(t){return arguments.length?this.each(t==null?ZIe:(typeof t=="function"?JIe:QIe)(t)):this.node().textContent}function eEe(){this.innerHTML=""}function tEe(t){return function(){this.innerHTML=t}}function nEe(t){return function(){var n=t.apply(this,arguments);this.innerHTML=n??""}}function LK(t){return arguments.length?this.each(t==null?eEe:(typeof t=="function"?nEe:tEe)(t)):this.node().innerHTML}function rEe(){this.nextSibling&&this.parentNode.appendChild(this)}function VK(){return this.each(rEe)}function oEe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function BK(){return this.each(oEe)}function zK(t){var n=typeof t=="function"?t:fI(t);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function iEe(){return null}function UK(t,n){var e=typeof t=="function"?t:fI(t),r=n==null?iEe:typeof n=="function"?n:Xp(n);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})}function sEe(){var t=this.parentNode;t&&t.removeChild(this)}function GK(){return this.each(sEe)}function aEe(){var t=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function lEe(){var t=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function WK(t){return this.select(t?lEe:aEe)}function HK(t){return arguments.length?this.property("__data__",t):this.node().__data__}function uEe(t){return function(n){t.call(this,n,this.__data__)}}function cEe(t){return t.trim().split(/^|\s+/).map(function(n){var e="",r=n.indexOf(".");return r>=0&&(e=n.slice(r+1),n=n.slice(0,r)),{type:n,name:e}})}function pEe(t){return function(){var n=this.__on;if(n){for(var e=0,r=-1,o=n.length,i;e<o;++e)i=n[e],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):n[++r]=i;++r?n.length=r:delete this.__on}}}function fEe(t,n,e){return function(){var r=this.__on,o,i=uEe(n);if(r){for(var s=0,a=r.length;s<a;++s)if((o=r[s]).type===t.type&&o.name===t.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=e),o.value=n;return}}this.addEventListener(t.type,i,e),o={type:t.type,name:t.name,value:n,listener:i,options:e},r?r.push(o):this.__on=[o]}}function jK(t,n,e){var r=cEe(t+""),o,i=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,c;l<u;++l)for(o=0,c=a[l];o<i;++o)if((s=r[o]).type===c.type&&s.name===c.name)return c.value}return}for(a=n?fEe:pEe,o=0;o<i;++o)this.each(a(r[o],n,e));return this}function qK(t,n,e){var r=mI(t),o=r.CustomEvent;typeof o=="function"?o=new o(n,e):(o=r.document.createEvent("Event"),e?(o.initEvent(n,e.bubbles,e.cancelable),o.detail=e.detail):o.initEvent(n,!1,!1)),t.dispatchEvent(o)}function dEe(t,n){return function(){return qK(this,t,n)}}function hEe(t,n){return function(){return qK(this,t,n.apply(this,arguments))}}function KK(t,n){return this.each((typeof n=="function"?hEe:dEe)(t,n))}function*XK(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var mEe=[null];function Hn(t,n){this._groups=t,this._parents=n}function YK(){return new Hn([[document.documentElement]],mEe)}function gEe(){return this}Hn.prototype=YK.prototype={constructor:Hn,select:cK,selectAll:pK,selectChild:fK,selectChildren:dK,filter:hK,data:yK,enter:mK,exit:xK,join:vK,merge:bK,selection:gEe,order:wK,sort:CK,call:SK,nodes:IK,node:EK,size:TK,empty:_K,each:NK,attr:DK,style:kK,property:AK,classed:$K,text:PK,html:LK,raise:VK,lower:BK,append:zK,insert:UK,remove:GK,clone:WK,datum:HK,on:jK,dispatch:KK,[Symbol.iterator]:XK};var fl=YK;var tm=0,Zy=0,Yy=0,QK=1e3,gI,Qy,yI=0,Yp=0,xI=0,Jy=typeof performance=="object"&&performance.now?performance:Date,JK=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function dl(){return Yp||(JK(yEe),Yp=Jy.now()+xI)}function yEe(){Yp=0}function ex(){this._call=this._time=this._next=null}ex.prototype=ec.prototype={constructor:ex,restart:function(t,n,e){if(typeof t!="function")throw new TypeError("callback is not a function");e=(e==null?dl():+e)+(n==null?0:+n),!this._next&&Qy!==this&&(Qy?Qy._next=this:gI=this,Qy=this),this._call=t,this._time=e,PR()},stop:function(){this._call&&(this._call=null,this._time=1/0,PR())}};function ec(t,n,e){var r=new ex;return r.restart(t,n,e),r}function e9(){dl(),++tm;for(var t=gI,n;t;)(n=Yp-t._time)>=0&&t._call.call(void 0,n),t=t._next;--tm}function ZK(){Yp=(yI=Jy.now())+xI,tm=Zy=0;try{e9()}finally{tm=0,vEe(),Yp=0}}function xEe(){var t=Jy.now(),n=t-yI;n>QK&&(xI-=n,yI=t)}function vEe(){for(var t,n=gI,e,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:gI=e);Qy=t,PR(r)}function PR(t){if(!tm){Zy&&(Zy=clearTimeout(Zy));var n=t-Yp;n>24?(t<1/0&&(Zy=setTimeout(ZK,t-Jy.now()-xI)),Yy&&(Yy=clearInterval(Yy))):(Yy||(yI=Jy.now(),Yy=setInterval(xEe,QK)),tm=1,JK(ZK))}}function Es(t,n,e){var r=new ex;return n=n==null?0:+n,r.restart(o=>{r.stop(),t(o+n)},n,e),r}var bEe=Gp("start","end","cancel","interrupt"),wEe=[],r9=0,t9=1,bI=2,vI=3,n9=4,wI=5,tx=6;function tc(t,n,e,r,o,i){var s=t.__transition;if(!s)t.__transition={};else if(e in s)return;CEe(t,e,{name:n,index:r,group:o,on:bEe,tween:wEe,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:r9})}function nx(t,n){var e=jn(t,n);if(e.state>r9)throw new Error("too late; already scheduled");return e}function hr(t,n){var e=jn(t,n);if(e.state>vI)throw new Error("too late; already running");return e}function jn(t,n){var e=t.__transition;if(!e||!(e=e[n]))throw new Error("transition not found");return e}function CEe(t,n,e){var r=t.__transition,o;r[n]=e,e.timer=ec(i,0,e.time);function i(u){e.state=t9,e.timer.restart(s,e.delay,e.time),e.delay<=u&&s(u-e.delay)}function s(u){var c,p,f,d;if(e.state!==t9)return l();for(c in r)if(d=r[c],d.name===e.name){if(d.state===vI)return Es(s);d.state===n9?(d.state=tx,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[c]):+c<n&&(d.state=tx,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[c])}if(Es(function(){e.state===vI&&(e.state=n9,e.timer.restart(a,e.delay,e.time),a(u))}),e.state=bI,e.on.call("start",t,t.__data__,e.index,e.group),e.state===bI){for(e.state=vI,o=new Array(f=e.tween.length),c=0,p=-1;c<f;++c)(d=e.tween[c].value.call(t,t.__data__,e.index,e.group))&&(o[++p]=d);o.length=p+1}}function a(u){for(var c=u<e.duration?e.ease.call(null,u/e.duration):(e.timer.restart(l),e.state=wI,1),p=-1,f=o.length;++p<f;)o[p].call(t,c);e.state===wI&&(e.on.call("end",t,t.__data__,e.index,e.group),l())}function l(){e.state=tx,e.timer.stop(),delete r[n];for(var u in r)return;delete t.__transition}}function LR(t,n){var e=t.__transition,r,o,i=!0,s;if(e){n=n==null?null:n+"";for(s in e){if((r=e[s]).name!==n){i=!1;continue}o=r.state>bI&&r.state<wI,r.state=tx,r.timer.stop(),r.on.call(o?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete e[s]}i&&delete t.__transition}}function o9(t){return this.each(function(){LR(this,t)})}function SEe(t,n){var e,r;return function(){var o=hr(this,t),i=o.tween;if(i!==e){r=e=i;for(var s=0,a=r.length;s<a;++s)if(r[s].name===n){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function IEe(t,n,e){var r,o;if(typeof e!="function")throw new Error;return function(){var i=hr(this,t),s=i.tween;if(s!==r){o=(r=s).slice();for(var a={name:n,value:e},l=0,u=o.length;l<u;++l)if(o[l].name===n){o[l]=a;break}l===u&&o.push(a)}i.tween=o}}function i9(t,n){var e=this._id;if(t+="",arguments.length<2){for(var r=jn(this.node(),e).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===t)return s.value;return null}return this.each((n==null?SEe:IEe)(e,t,n))}function nm(t,n,e){var r=t._id;return t.each(function(){var o=hr(this,r);(o.value||(o.value={}))[n]=e.apply(this,arguments)}),function(o){return jn(o,r).value[n]}}function CI(t,n){var e;return(typeof n=="number"?Ar:n instanceof yo?xo:(e=yo(n))?(n=e,xo):jp)(t,n)}function EEe(t){return function(){this.removeAttribute(t)}}function TEe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function _Ee(t,n,e){var r,o=e+"",i;return function(){var s=this.getAttribute(t);return s===o?null:s===r?i:i=n(r=s,e)}}function NEe(t,n,e){var r,o=e+"",i;return function(){var s=this.getAttributeNS(t.space,t.local);return s===o?null:s===r?i:i=n(r=s,e)}}function DEe(t,n,e){var r,o,i;return function(){var s,a=e(this),l;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=a+"",s===l?null:s===r&&l===o?i:(o=l,i=n(r=s,a)))}}function kEe(t,n,e){var r,o,i;return function(){var s,a=e(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=a+"",s===l?null:s===r&&l===o?i:(o=l,i=n(r=s,a)))}}function s9(t,n){var e=pl(t),r=e==="transform"?Kp:CI;return this.attrTween(t,typeof n=="function"?(e.local?kEe:DEe)(e,r,nm(this,"attr."+t,n)):n==null?(e.local?TEe:EEe)(e):(e.local?NEe:_Ee)(e,r,n))}function AEe(t,n){return function(e){this.setAttribute(t,n.call(this,e))}}function REe(t,n){return function(e){this.setAttributeNS(t.space,t.local,n.call(this,e))}}function MEe(t,n){var e,r;function o(){var i=n.apply(this,arguments);return i!==r&&(e=(r=i)&&REe(t,i)),e}return o._value=n,o}function OEe(t,n){var e,r;function o(){var i=n.apply(this,arguments);return i!==r&&(e=(r=i)&&AEe(t,i)),e}return o._value=n,o}function a9(t,n){var e="attr."+t;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;var r=pl(t);return this.tween(e,(r.local?MEe:OEe)(r,n))}function FEe(t,n){return function(){nx(this,t).delay=+n.apply(this,arguments)}}function $Ee(t,n){return n=+n,function(){nx(this,t).delay=n}}function l9(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?FEe:$Ee)(n,t)):jn(this.node(),n).delay}function PEe(t,n){return function(){hr(this,t).duration=+n.apply(this,arguments)}}function LEe(t,n){return n=+n,function(){hr(this,t).duration=n}}function u9(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?PEe:LEe)(n,t)):jn(this.node(),n).duration}function VEe(t,n){if(typeof n!="function")throw new Error;return function(){hr(this,t).ease=n}}function c9(t){var n=this._id;return arguments.length?this.each(VEe(n,t)):jn(this.node(),n).ease}function BEe(t,n){return function(){var e=n.apply(this,arguments);if(typeof e!="function")throw new Error;hr(this,t).ease=e}}function p9(t){if(typeof t!="function")throw new Error;return this.each(BEe(this._id,t))}function f9(t){typeof t!="function"&&(t=Ky(t));for(var n=this._groups,e=n.length,r=new Array(e),o=0;o<e;++o)for(var i=n[o],s=i.length,a=r[o]=[],l,u=0;u<s;++u)(l=i[u])&&t.call(l,l.__data__,u,i)&&a.push(l);return new Wr(r,this._parents,this._name,this._id)}function d9(t){if(t._id!==this._id)throw new Error;for(var n=this._groups,e=t._groups,r=n.length,o=e.length,i=Math.min(r,o),s=new Array(r),a=0;a<i;++a)for(var l=n[a],u=e[a],c=l.length,p=s[a]=new Array(c),f,d=0;d<c;++d)(f=l[d]||u[d])&&(p[d]=f);for(;a<r;++a)s[a]=n[a];return new Wr(s,this._parents,this._name,this._id)}function zEe(t){return(t+"").trim().split(/^|\s+/).every(function(n){var e=n.indexOf(".");return e>=0&&(n=n.slice(0,e)),!n||n==="start"})}function UEe(t,n,e){var r,o,i=zEe(n)?nx:hr;return function(){var s=i(this,t),a=s.on;a!==r&&(o=(r=a).copy()).on(n,e),s.on=o}}function h9(t,n){var e=this._id;return arguments.length<2?jn(this.node(),e).on.on(t):this.each(UEe(e,t,n))}function GEe(t){return function(){var n=this.parentNode;for(var e in this.__transition)if(+e!==t)return;n&&n.removeChild(this)}}function m9(){return this.on("end.remove",GEe(this._id))}function g9(t){var n=this._name,e=this._id;typeof t!="function"&&(t=Xp(t));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var a=r[s],l=a.length,u=i[s]=new Array(l),c,p,f=0;f<l;++f)(c=a[f])&&(p=t.call(c,c.__data__,f,a))&&("__data__"in c&&(p.__data__=c.__data__),u[f]=p,tc(u[f],n,e,f,u,jn(c,e)));return new Wr(i,this._parents,n,e)}function y9(t){var n=this._name,e=this._id;typeof t!="function"&&(t=qy(t));for(var r=this._groups,o=r.length,i=[],s=[],a=0;a<o;++a)for(var l=r[a],u=l.length,c,p=0;p<u;++p)if(c=l[p]){for(var f=t.call(c,c.__data__,p,l),d,h=jn(c,e),m=0,g=f.length;m<g;++m)(d=f[m])&&tc(d,n,e,m,f,h);i.push(f),s.push(c)}return new Wr(i,s,n,e)}var WEe=fl.prototype.constructor;function x9(){return new WEe(this._groups,this._parents)}function HEe(t,n){var e,r,o;return function(){var i=Ju(this,t),s=(this.style.removeProperty(t),Ju(this,t));return i===s?null:i===e&&s===r?o:o=n(e=i,r=s)}}function v9(t){return function(){this.style.removeProperty(t)}}function jEe(t,n,e){var r,o=e+"",i;return function(){var s=Ju(this,t);return s===o?null:s===r?i:i=n(r=s,e)}}function qEe(t,n,e){var r,o,i;return function(){var s=Ju(this,t),a=e(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),Ju(this,t))),s===l?null:s===r&&l===o?i:(o=l,i=n(r=s,a))}}function KEe(t,n){var e,r,o,i="style."+n,s="end."+i,a;return function(){var l=hr(this,t),u=l.on,c=l.value[i]==null?a||(a=v9(n)):void 0;(u!==e||o!==c)&&(r=(e=u).copy()).on(s,o=c),l.on=r}}function b9(t,n,e){var r=(t+="")=="transform"?qp:CI;return n==null?this.styleTween(t,HEe(t,r)).on("end.style."+t,v9(t)):typeof n=="function"?this.styleTween(t,qEe(t,r,nm(this,"style."+t,n))).each(KEe(this._id,t)):this.styleTween(t,jEe(t,r,n),e).on("end.style."+t,null)}function XEe(t,n,e){return function(r){this.style.setProperty(t,n.call(this,r),e)}}function YEe(t,n,e){var r,o;function i(){var s=n.apply(this,arguments);return s!==o&&(r=(o=s)&&XEe(t,s,e)),r}return i._value=n,i}function w9(t,n,e){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(n==null)return this.tween(r,null);if(typeof n!="function")throw new Error;return this.tween(r,YEe(t,n,e??""))}function ZEe(t){return function(){this.textContent=t}}function QEe(t){return function(){var n=t(this);this.textContent=n??""}}function C9(t){return this.tween("text",typeof t=="function"?QEe(nm(this,"text",t)):ZEe(t==null?"":t+""))}function JEe(t){return function(n){this.textContent=t.call(this,n)}}function eTe(t){var n,e;function r(){var o=t.apply(this,arguments);return o!==e&&(n=(e=o)&&JEe(o)),n}return r._value=t,r}function S9(t){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,eTe(t))}function I9(){for(var t=this._name,n=this._id,e=SI(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,l,u=0;u<a;++u)if(l=s[u]){var c=jn(l,n);tc(l,t,e,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Wr(r,this._parents,t,e)}function E9(){var t,n,e=this,r=e._id,o=e.size();return new Promise(function(i,s){var a={value:s},l={value:function(){--o===0&&i()}};e.each(function(){var u=hr(this,r),c=u.on;c!==t&&(n=(t=c).copy(),n._.cancel.push(a),n._.interrupt.push(a),n._.end.push(l)),u.on=n}),o===0&&i()})}var tTe=0;function Wr(t,n,e,r){this._groups=t,this._parents=n,this._name=e,this._id=r}function T9(t){return fl().transition(t)}function SI(){return++tTe}var hl=fl.prototype;Wr.prototype=T9.prototype={constructor:Wr,select:g9,selectAll:y9,selectChild:hl.selectChild,selectChildren:hl.selectChildren,filter:f9,merge:d9,selection:x9,transition:I9,call:hl.call,nodes:hl.nodes,node:hl.node,size:hl.size,empty:hl.empty,each:hl.each,on:h9,attr:s9,attrTween:a9,style:b9,styleTween:w9,text:C9,textTween:S9,remove:m9,tween:i9,delay:l9,duration:u9,ease:c9,easeVarying:p9,end:E9,[Symbol.iterator]:hl[Symbol.iterator]};function nc(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var nTe={time:null,delay:0,duration:250,ease:nc};function rTe(t,n){for(var e;!(e=t.__transition)||!(e=e[n]);)if(!(t=t.parentNode))throw new Error(`transition ${n} not found`);return e}function _9(t){var n,e;t instanceof Wr?(n=t._id,t=t._name):(n=SI(),(e=nTe).time=dl(),t=t==null?null:t+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,l,u=0;u<a;++u)(l=s[u])&&tc(l,t,n,u,s,e||rTe(l,n));return new Wr(r,this._parents,t,n)}fl.prototype.interrupt=o9;fl.prototype.transition=_9;var{abs:ygn,max:xgn,min:vgn}=Math;function N9(t){return[+t[0],+t[1]]}function oTe(t){return[N9(t[0]),N9(t[1])]}var bgn={name:"x",handles:["w","e"].map(VR),input:function(t,n){return t==null?null:[[+t[0],n[0][1]],[+t[1],n[1][1]]]},output:function(t){return t&&[t[0][0],t[1][0]]}},wgn={name:"y",handles:["n","s"].map(VR),input:function(t,n){return t==null?null:[[n[0][0],+t[0]],[n[1][0],+t[1]]]},output:function(t){return t&&[t[0][1],t[1][1]]}},Cgn={name:"xy",handles:["n","w","e","s","nw","ne","sw","se"].map(VR),input:function(t){return t==null?null:oTe(t)},output:function(t){return t}};function VR(t){return{type:t}}var II="http://www.w3.org/1999/xhtml",BR={svg:"http://www.w3.org/2000/svg",xhtml:II,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ml(t){var n=t+="",e=n.indexOf(":");return e>=0&&(n=t.slice(0,e))!=="xmlns"&&(t=t.slice(e+1)),BR.hasOwnProperty(n)?{space:BR[n],local:t}:t}function iTe(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===II&&n.documentElement.namespaceURI===II?n.createElement(t):n.createElementNS(e,t)}}function sTe(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function EI(t){var n=ml(t);return(n.local?sTe:iTe)(n)}function aTe(){}function Zp(t){return t==null?aTe:function(){return this.querySelector(t)}}function D9(t){typeof t!="function"&&(t=Zp(t));for(var n=this._groups,e=n.length,r=new Array(e),o=0;o<e;++o)for(var i=n[o],s=i.length,a=r[o]=new Array(s),l,u,c=0;c<s;++c)(l=i[c])&&(u=t.call(l,l.__data__,c,i))&&("__data__"in l&&(u.__data__=l.__data__),a[c]=u);return new yn(r,this._parents)}function zR(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function lTe(){return[]}function rx(t){return t==null?lTe:function(){return this.querySelectorAll(t)}}function uTe(t){return function(){return zR(t.apply(this,arguments))}}function k9(t){typeof t=="function"?t=uTe(t):t=rx(t);for(var n=this._groups,e=n.length,r=[],o=[],i=0;i<e;++i)for(var s=n[i],a=s.length,l,u=0;u<a;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),o.push(l));return new yn(r,o)}function ox(t){return function(){return this.matches(t)}}function TI(t){return function(n){return n.matches(t)}}var cTe=Array.prototype.find;function pTe(t){return function(){return cTe.call(this.children,t)}}function fTe(){return this.firstElementChild}function A9(t){return this.select(t==null?fTe:pTe(typeof t=="function"?t:TI(t)))}var dTe=Array.prototype.filter;function hTe(){return Array.from(this.children)}function mTe(t){return function(){return dTe.call(this.children,t)}}function R9(t){return this.selectAll(t==null?hTe:mTe(typeof t=="function"?t:TI(t)))}function M9(t){typeof t!="function"&&(t=ox(t));for(var n=this._groups,e=n.length,r=new Array(e),o=0;o<e;++o)for(var i=n[o],s=i.length,a=r[o]=[],l,u=0;u<s;++u)(l=i[u])&&t.call(l,l.__data__,u,i)&&a.push(l);return new yn(r,this._parents)}function _I(t){return new Array(t.length)}function O9(){return new yn(this._enter||this._groups.map(_I),this._parents)}function ix(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}ix.prototype={constructor:ix,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function F9(t){return function(){return t}}function gTe(t,n,e,r,o,i){for(var s=0,a,l=n.length,u=i.length;s<u;++s)(a=n[s])?(a.__data__=i[s],r[s]=a):e[s]=new ix(t,i[s]);for(;s<l;++s)(a=n[s])&&(o[s]=a)}function yTe(t,n,e,r,o,i,s){var a,l,u=new Map,c=n.length,p=i.length,f=new Array(c),d;for(a=0;a<c;++a)(l=n[a])&&(f[a]=d=s.call(l,l.__data__,a,n)+"",u.has(d)?o[a]=l:u.set(d,l));for(a=0;a<p;++a)d=s.call(t,i[a],a,i)+"",(l=u.get(d))?(r[a]=l,l.__data__=i[a],u.delete(d)):e[a]=new ix(t,i[a]);for(a=0;a<c;++a)(l=n[a])&&u.get(f[a])===l&&(o[a]=l)}function xTe(t){return t.__data__}function $9(t,n){if(!arguments.length)return Array.from(this,xTe);var e=n?yTe:gTe,r=this._parents,o=this._groups;typeof t!="function"&&(t=F9(t));for(var i=o.length,s=new Array(i),a=new Array(i),l=new Array(i),u=0;u<i;++u){var c=r[u],p=o[u],f=p.length,d=vTe(t.call(c,c&&c.__data__,u,r)),h=d.length,m=a[u]=new Array(h),g=s[u]=new Array(h),y=l[u]=new Array(f);e(c,p,m,g,y,d,n);for(var x=0,b=0,w,C;x<h;++x)if(w=m[x]){for(x>=b&&(b=x+1);!(C=g[b])&&++b<h;);w._next=C||null}}return s=new yn(s,r),s._enter=a,s._exit=l,s}function vTe(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function P9(){return new yn(this._exit||this._groups.map(_I),this._parents)}function L9(t,n,e){var r=this.enter(),o=this,i=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),n!=null&&(o=n(o),o&&(o=o.selection())),e==null?i.remove():e(i),r&&o?r.merge(o).order():o}function V9(t){for(var n=t.selection?t.selection():t,e=this._groups,r=n._groups,o=e.length,i=r.length,s=Math.min(o,i),a=new Array(o),l=0;l<s;++l)for(var u=e[l],c=r[l],p=u.length,f=a[l]=new Array(p),d,h=0;h<p;++h)(d=u[h]||c[h])&&(f[h]=d);for(;l<o;++l)a[l]=e[l];return new yn(a,this._parents)}function B9(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var r=t[n],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function z9(t){t||(t=bTe);function n(p,f){return p&&f?t(p.__data__,f.__data__):!p-!f}for(var e=this._groups,r=e.length,o=new Array(r),i=0;i<r;++i){for(var s=e[i],a=s.length,l=o[i]=new Array(a),u,c=0;c<a;++c)(u=s[c])&&(l[c]=u);l.sort(n)}return new yn(o,this._parents).order()}function bTe(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function U9(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function G9(){return Array.from(this)}function W9(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function H9(){let t=0;for(let n of this)++t;return t}function j9(){return!this.node()}function q9(t){for(var n=this._groups,e=0,r=n.length;e<r;++e)for(var o=n[e],i=0,s=o.length,a;i<s;++i)(a=o[i])&&t.call(a,a.__data__,i,o);return this}function wTe(t){return function(){this.removeAttribute(t)}}function CTe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function STe(t,n){return function(){this.setAttribute(t,n)}}function ITe(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function ETe(t,n){return function(){var e=n.apply(this,arguments);e==null?this.removeAttribute(t):this.setAttribute(t,e)}}function TTe(t,n){return function(){var e=n.apply(this,arguments);e==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}function K9(t,n){var e=ml(t);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((n==null?e.local?CTe:wTe:typeof n=="function"?e.local?TTe:ETe:e.local?ITe:STe)(e,n))}function NI(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function _Te(t){return function(){this.style.removeProperty(t)}}function NTe(t,n,e){return function(){this.style.setProperty(t,n,e)}}function DTe(t,n,e){return function(){var r=n.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,e)}}function X9(t,n,e){return arguments.length>1?this.each((n==null?_Te:typeof n=="function"?DTe:NTe)(t,n,e??"")):rc(this.node(),t)}function rc(t,n){return t.style.getPropertyValue(n)||NI(t).getComputedStyle(t,null).getPropertyValue(n)}function kTe(t){return function(){delete this[t]}}function ATe(t,n){return function(){this[t]=n}}function RTe(t,n){return function(){var e=n.apply(this,arguments);e==null?delete this[t]:this[t]=e}}function Y9(t,n){return arguments.length>1?this.each((n==null?kTe:typeof n=="function"?RTe:ATe)(t,n)):this.node()[t]}function Z9(t){return t.trim().split(/^|\s+/)}function UR(t){return t.classList||new Q9(t)}function Q9(t){this._node=t,this._names=Z9(t.getAttribute("class")||"")}Q9.prototype={add:function(t){var n=this._names.indexOf(t);n<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function J9(t,n){for(var e=UR(t),r=-1,o=n.length;++r<o;)e.add(n[r])}function e7(t,n){for(var e=UR(t),r=-1,o=n.length;++r<o;)e.remove(n[r])}function MTe(t){return function(){J9(this,t)}}function OTe(t){return function(){e7(this,t)}}function FTe(t,n){return function(){(n.apply(this,arguments)?J9:e7)(this,t)}}function t7(t,n){var e=Z9(t+"");if(arguments.length<2){for(var r=UR(this.node()),o=-1,i=e.length;++o<i;)if(!r.contains(e[o]))return!1;return!0}return this.each((typeof n=="function"?FTe:n?MTe:OTe)(e,n))}function $Te(){this.textContent=""}function PTe(t){return function(){this.textContent=t}}function LTe(t){return function(){var n=t.apply(this,arguments);this.textContent=n??""}}function n7(t){return arguments.length?this.each(t==null?$Te:(typeof t=="function"?LTe:PTe)(t)):this.node().textContent}function VTe(){this.innerHTML=""}function BTe(t){return function(){this.innerHTML=t}}function zTe(t){return function(){var n=t.apply(this,arguments);this.innerHTML=n??""}}function r7(t){return arguments.length?this.each(t==null?VTe:(typeof t=="function"?zTe:BTe)(t)):this.node().innerHTML}function UTe(){this.nextSibling&&this.parentNode.appendChild(this)}function o7(){return this.each(UTe)}function GTe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function i7(){return this.each(GTe)}function s7(t){var n=typeof t=="function"?t:EI(t);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function WTe(){return null}function a7(t,n){var e=typeof t=="function"?t:EI(t),r=n==null?WTe:typeof n=="function"?n:Zp(n);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})}function HTe(){var t=this.parentNode;t&&t.removeChild(this)}function l7(){return this.each(HTe)}function jTe(){var t=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function qTe(){var t=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function u7(t){return this.select(t?qTe:jTe)}function c7(t){return arguments.length?this.property("__data__",t):this.node().__data__}function KTe(t){return function(n){t.call(this,n,this.__data__)}}function XTe(t){return t.trim().split(/^|\s+/).map(function(n){var e="",r=n.indexOf(".");return r>=0&&(e=n.slice(r+1),n=n.slice(0,r)),{type:n,name:e}})}function YTe(t){return function(){var n=this.__on;if(n){for(var e=0,r=-1,o=n.length,i;e<o;++e)i=n[e],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):n[++r]=i;++r?n.length=r:delete this.__on}}}function ZTe(t,n,e){return function(){var r=this.__on,o,i=KTe(n);if(r){for(var s=0,a=r.length;s<a;++s)if((o=r[s]).type===t.type&&o.name===t.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=e),o.value=n;return}}this.addEventListener(t.type,i,e),o={type:t.type,name:t.name,value:n,listener:i,options:e},r?r.push(o):this.__on=[o]}}function p7(t,n,e){var r=XTe(t+""),o,i=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,c;l<u;++l)for(o=0,c=a[l];o<i;++o)if((s=r[o]).type===c.type&&s.name===c.name)return c.value}return}for(a=n?ZTe:YTe,o=0;o<i;++o)this.each(a(r[o],n,e));return this}function f7(t,n,e){var r=NI(t),o=r.CustomEvent;typeof o=="function"?o=new o(n,e):(o=r.document.createEvent("Event"),e?(o.initEvent(n,e.bubbles,e.cancelable),o.detail=e.detail):o.initEvent(n,!1,!1)),t.dispatchEvent(o)}function QTe(t,n){return function(){return f7(this,t,n)}}function JTe(t,n){return function(){return f7(this,t,n.apply(this,arguments))}}function d7(t,n){return this.each((typeof n=="function"?JTe:QTe)(t,n))}function*h7(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var GR=[null];function yn(t,n){this._groups=t,this._parents=n}function m7(){return new yn([[document.documentElement]],GR)}function e_e(){return this}yn.prototype=m7.prototype={constructor:yn,select:D9,selectAll:k9,selectChild:A9,selectChildren:R9,filter:M9,data:$9,enter:O9,exit:P9,join:L9,merge:V9,selection:e_e,order:B9,sort:z9,call:U9,nodes:G9,node:W9,size:H9,empty:j9,each:q9,attr:K9,style:X9,property:Y9,classed:t7,text:n7,html:r7,raise:o7,lower:i7,append:s7,insert:a7,remove:l7,clone:u7,datum:c7,on:p7,dispatch:d7,[Symbol.iterator]:h7};var gl=m7;function rm(t){return typeof t=="string"?new yn([[document.querySelector(t)]],[document.documentElement]):new yn([[t]],GR)}var t_e=Gp("start","end","cancel","interrupt"),n_e=[],x7=0,g7=1,kI=2,DI=3,y7=4,AI=5,sx=6;function oc(t,n,e,r,o,i){var s=t.__transition;if(!s)t.__transition={};else if(e in s)return;r_e(t,e,{name:n,index:r,group:o,on:t_e,tween:n_e,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:x7})}function ax(t,n){var e=qn(t,n);if(e.state>x7)throw new Error("too late; already scheduled");return e}function mr(t,n){var e=qn(t,n);if(e.state>DI)throw new Error("too late; already running");return e}function qn(t,n){var e=t.__transition;if(!e||!(e=e[n]))throw new Error("transition not found");return e}function r_e(t,n,e){var r=t.__transition,o;r[n]=e,e.timer=ec(i,0,e.time);function i(u){e.state=g7,e.timer.restart(s,e.delay,e.time),e.delay<=u&&s(u-e.delay)}function s(u){var c,p,f,d;if(e.state!==g7)return l();for(c in r)if(d=r[c],d.name===e.name){if(d.state===DI)return Es(s);d.state===y7?(d.state=sx,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[c]):+c<n&&(d.state=sx,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[c])}if(Es(function(){e.state===DI&&(e.state=y7,e.timer.restart(a,e.delay,e.time),a(u))}),e.state=kI,e.on.call("start",t,t.__data__,e.index,e.group),e.state===kI){for(e.state=DI,o=new Array(f=e.tween.length),c=0,p=-1;c<f;++c)(d=e.tween[c].value.call(t,t.__data__,e.index,e.group))&&(o[++p]=d);o.length=p+1}}function a(u){for(var c=u<e.duration?e.ease.call(null,u/e.duration):(e.timer.restart(l),e.state=AI,1),p=-1,f=o.length;++p<f;)o[p].call(t,c);e.state===AI&&(e.on.call("end",t,t.__data__,e.index,e.group),l())}function l(){e.state=sx,e.timer.stop(),delete r[n];for(var u in r)return;delete t.__transition}}function v7(t,n){var e=t.__transition,r,o,i=!0,s;if(e){n=n==null?null:n+"";for(s in e){if((r=e[s]).name!==n){i=!1;continue}o=r.state>kI&&r.state<AI,r.state=sx,r.timer.stop(),r.on.call(o?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete e[s]}i&&delete t.__transition}}function b7(t){return this.each(function(){v7(this,t)})}function o_e(t,n){var e,r;return function(){var o=mr(this,t),i=o.tween;if(i!==e){r=e=i;for(var s=0,a=r.length;s<a;++s)if(r[s].name===n){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function i_e(t,n,e){var r,o;if(typeof e!="function")throw new Error;return function(){var i=mr(this,t),s=i.tween;if(s!==r){o=(r=s).slice();for(var a={name:n,value:e},l=0,u=o.length;l<u;++l)if(o[l].name===n){o[l]=a;break}l===u&&o.push(a)}i.tween=o}}function w7(t,n){var e=this._id;if(t+="",arguments.length<2){for(var r=qn(this.node(),e).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===t)return s.value;return null}return this.each((n==null?o_e:i_e)(e,t,n))}function om(t,n,e){var r=t._id;return t.each(function(){var o=mr(this,r);(o.value||(o.value={}))[n]=e.apply(this,arguments)}),function(o){return qn(o,r).value[n]}}function RI(t,n){var e;return(typeof n=="number"?Ar:n instanceof yo?xo:(e=yo(n))?(n=e,xo):jp)(t,n)}function s_e(t){return function(){this.removeAttribute(t)}}function a_e(t){return function(){this.removeAttributeNS(t.space,t.local)}}function l_e(t,n,e){var r,o=e+"",i;return function(){var s=this.getAttribute(t);return s===o?null:s===r?i:i=n(r=s,e)}}function u_e(t,n,e){var r,o=e+"",i;return function(){var s=this.getAttributeNS(t.space,t.local);return s===o?null:s===r?i:i=n(r=s,e)}}function c_e(t,n,e){var r,o,i;return function(){var s,a=e(this),l;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=a+"",s===l?null:s===r&&l===o?i:(o=l,i=n(r=s,a)))}}function p_e(t,n,e){var r,o,i;return function(){var s,a=e(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=a+"",s===l?null:s===r&&l===o?i:(o=l,i=n(r=s,a)))}}function C7(t,n){var e=ml(t),r=e==="transform"?Kp:RI;return this.attrTween(t,typeof n=="function"?(e.local?p_e:c_e)(e,r,om(this,"attr."+t,n)):n==null?(e.local?a_e:s_e)(e):(e.local?u_e:l_e)(e,r,n))}function f_e(t,n){return function(e){this.setAttribute(t,n.call(this,e))}}function d_e(t,n){return function(e){this.setAttributeNS(t.space,t.local,n.call(this,e))}}function h_e(t,n){var e,r;function o(){var i=n.apply(this,arguments);return i!==r&&(e=(r=i)&&d_e(t,i)),e}return o._value=n,o}function m_e(t,n){var e,r;function o(){var i=n.apply(this,arguments);return i!==r&&(e=(r=i)&&f_e(t,i)),e}return o._value=n,o}function S7(t,n){var e="attr."+t;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;var r=ml(t);return this.tween(e,(r.local?h_e:m_e)(r,n))}function g_e(t,n){return function(){ax(this,t).delay=+n.apply(this,arguments)}}function y_e(t,n){return n=+n,function(){ax(this,t).delay=n}}function I7(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?g_e:y_e)(n,t)):qn(this.node(),n).delay}function x_e(t,n){return function(){mr(this,t).duration=+n.apply(this,arguments)}}function v_e(t,n){return n=+n,function(){mr(this,t).duration=n}}function E7(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?x_e:v_e)(n,t)):qn(this.node(),n).duration}function b_e(t,n){if(typeof n!="function")throw new Error;return function(){mr(this,t).ease=n}}function T7(t){var n=this._id;return arguments.length?this.each(b_e(n,t)):qn(this.node(),n).ease}function w_e(t,n){return function(){var e=n.apply(this,arguments);if(typeof e!="function")throw new Error;mr(this,t).ease=e}}function _7(t){if(typeof t!="function")throw new Error;return this.each(w_e(this._id,t))}function N7(t){typeof t!="function"&&(t=ox(t));for(var n=this._groups,e=n.length,r=new Array(e),o=0;o<e;++o)for(var i=n[o],s=i.length,a=r[o]=[],l,u=0;u<s;++u)(l=i[u])&&t.call(l,l.__data__,u,i)&&a.push(l);return new Hr(r,this._parents,this._name,this._id)}function D7(t){if(t._id!==this._id)throw new Error;for(var n=this._groups,e=t._groups,r=n.length,o=e.length,i=Math.min(r,o),s=new Array(r),a=0;a<i;++a)for(var l=n[a],u=e[a],c=l.length,p=s[a]=new Array(c),f,d=0;d<c;++d)(f=l[d]||u[d])&&(p[d]=f);for(;a<r;++a)s[a]=n[a];return new Hr(s,this._parents,this._name,this._id)}function C_e(t){return(t+"").trim().split(/^|\s+/).every(function(n){var e=n.indexOf(".");return e>=0&&(n=n.slice(0,e)),!n||n==="start"})}function S_e(t,n,e){var r,o,i=C_e(n)?ax:mr;return function(){var s=i(this,t),a=s.on;a!==r&&(o=(r=a).copy()).on(n,e),s.on=o}}function k7(t,n){var e=this._id;return arguments.length<2?qn(this.node(),e).on.on(t):this.each(S_e(e,t,n))}function I_e(t){return function(){var n=this.parentNode;for(var e in this.__transition)if(+e!==t)return;n&&n.removeChild(this)}}function A7(){return this.on("end.remove",I_e(this._id))}function R7(t){var n=this._name,e=this._id;typeof t!="function"&&(t=Zp(t));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var a=r[s],l=a.length,u=i[s]=new Array(l),c,p,f=0;f<l;++f)(c=a[f])&&(p=t.call(c,c.__data__,f,a))&&("__data__"in c&&(p.__data__=c.__data__),u[f]=p,oc(u[f],n,e,f,u,qn(c,e)));return new Hr(i,this._parents,n,e)}function M7(t){var n=this._name,e=this._id;typeof t!="function"&&(t=rx(t));for(var r=this._groups,o=r.length,i=[],s=[],a=0;a<o;++a)for(var l=r[a],u=l.length,c,p=0;p<u;++p)if(c=l[p]){for(var f=t.call(c,c.__data__,p,l),d,h=qn(c,e),m=0,g=f.length;m<g;++m)(d=f[m])&&oc(d,n,e,m,f,h);i.push(f),s.push(c)}return new Hr(i,s,n,e)}var E_e=gl.prototype.constructor;function O7(){return new E_e(this._groups,this._parents)}function T_e(t,n){var e,r,o;return function(){var i=rc(this,t),s=(this.style.removeProperty(t),rc(this,t));return i===s?null:i===e&&s===r?o:o=n(e=i,r=s)}}function F7(t){return function(){this.style.removeProperty(t)}}function __e(t,n,e){var r,o=e+"",i;return function(){var s=rc(this,t);return s===o?null:s===r?i:i=n(r=s,e)}}function N_e(t,n,e){var r,o,i;return function(){var s=rc(this,t),a=e(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),rc(this,t))),s===l?null:s===r&&l===o?i:(o=l,i=n(r=s,a))}}function D_e(t,n){var e,r,o,i="style."+n,s="end."+i,a;return function(){var l=mr(this,t),u=l.on,c=l.value[i]==null?a||(a=F7(n)):void 0;(u!==e||o!==c)&&(r=(e=u).copy()).on(s,o=c),l.on=r}}function $7(t,n,e){var r=(t+="")=="transform"?qp:RI;return n==null?this.styleTween(t,T_e(t,r)).on("end.style."+t,F7(t)):typeof n=="function"?this.styleTween(t,N_e(t,r,om(this,"style."+t,n))).each(D_e(this._id,t)):this.styleTween(t,__e(t,r,n),e).on("end.style."+t,null)}function k_e(t,n,e){return function(r){this.style.setProperty(t,n.call(this,r),e)}}function A_e(t,n,e){var r,o;function i(){var s=n.apply(this,arguments);return s!==o&&(r=(o=s)&&k_e(t,s,e)),r}return i._value=n,i}function P7(t,n,e){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(n==null)return this.tween(r,null);if(typeof n!="function")throw new Error;return this.tween(r,A_e(t,n,e??""))}function R_e(t){return function(){this.textContent=t}}function M_e(t){return function(){var n=t(this);this.textContent=n??""}}function L7(t){return this.tween("text",typeof t=="function"?M_e(om(this,"text",t)):R_e(t==null?"":t+""))}function O_e(t){return function(n){this.textContent=t.call(this,n)}}function F_e(t){var n,e;function r(){var o=t.apply(this,arguments);return o!==e&&(n=(e=o)&&O_e(o)),n}return r._value=t,r}function V7(t){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,F_e(t))}function B7(){for(var t=this._name,n=this._id,e=MI(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,l,u=0;u<a;++u)if(l=s[u]){var c=qn(l,n);oc(l,t,e,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new Hr(r,this._parents,t,e)}function z7(){var t,n,e=this,r=e._id,o=e.size();return new Promise(function(i,s){var a={value:s},l={value:function(){--o===0&&i()}};e.each(function(){var u=mr(this,r),c=u.on;c!==t&&(n=(t=c).copy(),n._.cancel.push(a),n._.interrupt.push(a),n._.end.push(l)),u.on=n}),o===0&&i()})}var $_e=0;function Hr(t,n,e,r){this._groups=t,this._parents=n,this._name=e,this._id=r}function U7(t){return gl().transition(t)}function MI(){return++$_e}var yl=gl.prototype;Hr.prototype=U7.prototype={constructor:Hr,select:R7,selectAll:M7,selectChild:yl.selectChild,selectChildren:yl.selectChildren,filter:N7,merge:D7,selection:O7,transition:B7,call:yl.call,nodes:yl.nodes,node:yl.node,size:yl.size,empty:yl.empty,each:yl.each,on:k7,attr:C7,attrTween:S7,style:$7,styleTween:P7,text:L7,textTween:V7,remove:A7,tween:w7,delay:I7,duration:E7,ease:T7,easeVarying:_7,end:z7,[Symbol.iterator]:yl[Symbol.iterator]};var P_e={time:null,delay:0,duration:250,ease:nc};function L_e(t,n){for(var e;!(e=t.__transition)||!(e=e[n]);)if(!(t=t.parentNode))throw new Error(`transition ${n} not found`);return e}function G7(t){var n,e;t instanceof Hr?(n=t._id,t=t._name):(n=MI(),(e=P_e).time=dl(),t=t==null?null:t+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,l,u=0;u<a;++u)(l=s[u])&&oc(l,t,n,u,s,e||L_e(l,n));return new Hr(r,this._parents,t,n)}gl.prototype.interrupt=b7;gl.prototype.transition=G7;var OI="http://www.w3.org/1999/xhtml",WR={svg:"http://www.w3.org/2000/svg",xhtml:OI,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function xl(t){var n=t+="",e=n.indexOf(":");return e>=0&&(n=t.slice(0,e))!=="xmlns"&&(t=t.slice(e+1)),WR.hasOwnProperty(n)?{space:WR[n],local:t}:t}function V_e(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===OI&&n.documentElement.namespaceURI===OI?n.createElement(t):n.createElementNS(e,t)}}function B_e(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function FI(t){var n=xl(t);return(n.local?B_e:V_e)(n)}function z_e(){}function Qp(t){return t==null?z_e:function(){return this.querySelector(t)}}function W7(t){typeof t!="function"&&(t=Qp(t));for(var n=this._groups,e=n.length,r=new Array(e),o=0;o<e;++o)for(var i=n[o],s=i.length,a=r[o]=new Array(s),l,u,c=0;c<s;++c)(l=i[c])&&(u=t.call(l,l.__data__,c,i))&&("__data__"in l&&(u.__data__=l.__data__),a[c]=u);return new Kn(r,this._parents)}function HR(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function U_e(){return[]}function lx(t){return t==null?U_e:function(){return this.querySelectorAll(t)}}function G_e(t){return function(){return HR(t.apply(this,arguments))}}function H7(t){typeof t=="function"?t=G_e(t):t=lx(t);for(var n=this._groups,e=n.length,r=[],o=[],i=0;i<e;++i)for(var s=n[i],a=s.length,l,u=0;u<a;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),o.push(l));return new Kn(r,o)}function ux(t){return function(){return this.matches(t)}}function $I(t){return function(n){return n.matches(t)}}var W_e=Array.prototype.find;function H_e(t){return function(){return W_e.call(this.children,t)}}function j_e(){return this.firstElementChild}function j7(t){return this.select(t==null?j_e:H_e(typeof t=="function"?t:$I(t)))}var q_e=Array.prototype.filter;function K_e(){return Array.from(this.children)}function X_e(t){return function(){return q_e.call(this.children,t)}}function q7(t){return this.selectAll(t==null?K_e:X_e(typeof t=="function"?t:$I(t)))}function K7(t){typeof t!="function"&&(t=ux(t));for(var n=this._groups,e=n.length,r=new Array(e),o=0;o<e;++o)for(var i=n[o],s=i.length,a=r[o]=[],l,u=0;u<s;++u)(l=i[u])&&t.call(l,l.__data__,u,i)&&a.push(l);return new Kn(r,this._parents)}function PI(t){return new Array(t.length)}function X7(){return new Kn(this._enter||this._groups.map(PI),this._parents)}function cx(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}cx.prototype={constructor:cx,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Y7(t){return function(){return t}}function Y_e(t,n,e,r,o,i){for(var s=0,a,l=n.length,u=i.length;s<u;++s)(a=n[s])?(a.__data__=i[s],r[s]=a):e[s]=new cx(t,i[s]);for(;s<l;++s)(a=n[s])&&(o[s]=a)}function Z_e(t,n,e,r,o,i,s){var a,l,u=new Map,c=n.length,p=i.length,f=new Array(c),d;for(a=0;a<c;++a)(l=n[a])&&(f[a]=d=s.call(l,l.__data__,a,n)+"",u.has(d)?o[a]=l:u.set(d,l));for(a=0;a<p;++a)d=s.call(t,i[a],a,i)+"",(l=u.get(d))?(r[a]=l,l.__data__=i[a],u.delete(d)):e[a]=new cx(t,i[a]);for(a=0;a<c;++a)(l=n[a])&&u.get(f[a])===l&&(o[a]=l)}function Q_e(t){return t.__data__}function Z7(t,n){if(!arguments.length)return Array.from(this,Q_e);var e=n?Z_e:Y_e,r=this._parents,o=this._groups;typeof t!="function"&&(t=Y7(t));for(var i=o.length,s=new Array(i),a=new Array(i),l=new Array(i),u=0;u<i;++u){var c=r[u],p=o[u],f=p.length,d=J_e(t.call(c,c&&c.__data__,u,r)),h=d.length,m=a[u]=new Array(h),g=s[u]=new Array(h),y=l[u]=new Array(f);e(c,p,m,g,y,d,n);for(var x=0,b=0,w,C;x<h;++x)if(w=m[x]){for(x>=b&&(b=x+1);!(C=g[b])&&++b<h;);w._next=C||null}}return s=new Kn(s,r),s._enter=a,s._exit=l,s}function J_e(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Q7(){return new Kn(this._exit||this._groups.map(PI),this._parents)}function J7(t,n,e){var r=this.enter(),o=this,i=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),n!=null&&(o=n(o),o&&(o=o.selection())),e==null?i.remove():e(i),r&&o?r.merge(o).order():o}function eX(t){for(var n=t.selection?t.selection():t,e=this._groups,r=n._groups,o=e.length,i=r.length,s=Math.min(o,i),a=new Array(o),l=0;l<s;++l)for(var u=e[l],c=r[l],p=u.length,f=a[l]=new Array(p),d,h=0;h<p;++h)(d=u[h]||c[h])&&(f[h]=d);for(;l<o;++l)a[l]=e[l];return new Kn(a,this._parents)}function tX(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var r=t[n],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function nX(t){t||(t=eNe);function n(p,f){return p&&f?t(p.__data__,f.__data__):!p-!f}for(var e=this._groups,r=e.length,o=new Array(r),i=0;i<r;++i){for(var s=e[i],a=s.length,l=o[i]=new Array(a),u,c=0;c<a;++c)(u=s[c])&&(l[c]=u);l.sort(n)}return new Kn(o,this._parents).order()}function eNe(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function rX(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function oX(){return Array.from(this)}function iX(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function sX(){let t=0;for(let n of this)++t;return t}function aX(){return!this.node()}function lX(t){for(var n=this._groups,e=0,r=n.length;e<r;++e)for(var o=n[e],i=0,s=o.length,a;i<s;++i)(a=o[i])&&t.call(a,a.__data__,i,o);return this}function tNe(t){return function(){this.removeAttribute(t)}}function nNe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function rNe(t,n){return function(){this.setAttribute(t,n)}}function oNe(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function iNe(t,n){return function(){var e=n.apply(this,arguments);e==null?this.removeAttribute(t):this.setAttribute(t,e)}}function sNe(t,n){return function(){var e=n.apply(this,arguments);e==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}function uX(t,n){var e=xl(t);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((n==null?e.local?nNe:tNe:typeof n=="function"?e.local?sNe:iNe:e.local?oNe:rNe)(e,n))}function LI(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function aNe(t){return function(){this.style.removeProperty(t)}}function lNe(t,n,e){return function(){this.style.setProperty(t,n,e)}}function uNe(t,n,e){return function(){var r=n.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,e)}}function cX(t,n,e){return arguments.length>1?this.each((n==null?aNe:typeof n=="function"?uNe:lNe)(t,n,e??"")):ic(this.node(),t)}function ic(t,n){return t.style.getPropertyValue(n)||LI(t).getComputedStyle(t,null).getPropertyValue(n)}function cNe(t){return function(){delete this[t]}}function pNe(t,n){return function(){this[t]=n}}function fNe(t,n){return function(){var e=n.apply(this,arguments);e==null?delete this[t]:this[t]=e}}function pX(t,n){return arguments.length>1?this.each((n==null?cNe:typeof n=="function"?fNe:pNe)(t,n)):this.node()[t]}function fX(t){return t.trim().split(/^|\s+/)}function jR(t){return t.classList||new dX(t)}function dX(t){this._node=t,this._names=fX(t.getAttribute("class")||"")}dX.prototype={add:function(t){var n=this._names.indexOf(t);n<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function hX(t,n){for(var e=jR(t),r=-1,o=n.length;++r<o;)e.add(n[r])}function mX(t,n){for(var e=jR(t),r=-1,o=n.length;++r<o;)e.remove(n[r])}function dNe(t){return function(){hX(this,t)}}function hNe(t){return function(){mX(this,t)}}function mNe(t,n){return function(){(n.apply(this,arguments)?hX:mX)(this,t)}}function gX(t,n){var e=fX(t+"");if(arguments.length<2){for(var r=jR(this.node()),o=-1,i=e.length;++o<i;)if(!r.contains(e[o]))return!1;return!0}return this.each((typeof n=="function"?mNe:n?dNe:hNe)(e,n))}function gNe(){this.textContent=""}function yNe(t){return function(){this.textContent=t}}function xNe(t){return function(){var n=t.apply(this,arguments);this.textContent=n??""}}function yX(t){return arguments.length?this.each(t==null?gNe:(typeof t=="function"?xNe:yNe)(t)):this.node().textContent}function vNe(){this.innerHTML=""}function bNe(t){return function(){this.innerHTML=t}}function wNe(t){return function(){var n=t.apply(this,arguments);this.innerHTML=n??""}}function xX(t){return arguments.length?this.each(t==null?vNe:(typeof t=="function"?wNe:bNe)(t)):this.node().innerHTML}function CNe(){this.nextSibling&&this.parentNode.appendChild(this)}function vX(){return this.each(CNe)}function SNe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function bX(){return this.each(SNe)}function wX(t){var n=typeof t=="function"?t:FI(t);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function INe(){return null}function CX(t,n){var e=typeof t=="function"?t:FI(t),r=n==null?INe:typeof n=="function"?n:Qp(n);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})}function ENe(){var t=this.parentNode;t&&t.removeChild(this)}function SX(){return this.each(ENe)}function TNe(){var t=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function _Ne(){var t=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function IX(t){return this.select(t?_Ne:TNe)}function EX(t){return arguments.length?this.property("__data__",t):this.node().__data__}function NNe(t){return function(n){t.call(this,n,this.__data__)}}function DNe(t){return t.trim().split(/^|\s+/).map(function(n){var e="",r=n.indexOf(".");return r>=0&&(e=n.slice(r+1),n=n.slice(0,r)),{type:n,name:e}})}function kNe(t){return function(){var n=this.__on;if(n){for(var e=0,r=-1,o=n.length,i;e<o;++e)i=n[e],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):n[++r]=i;++r?n.length=r:delete this.__on}}}function ANe(t,n,e){return function(){var r=this.__on,o,i=NNe(n);if(r){for(var s=0,a=r.length;s<a;++s)if((o=r[s]).type===t.type&&o.name===t.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=e),o.value=n;return}}this.addEventListener(t.type,i,e),o={type:t.type,name:t.name,value:n,listener:i,options:e},r?r.push(o):this.__on=[o]}}function TX(t,n,e){var r=DNe(t+""),o,i=r.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,u=a.length,c;l<u;++l)for(o=0,c=a[l];o<i;++o)if((s=r[o]).type===c.type&&s.name===c.name)return c.value}return}for(a=n?ANe:kNe,o=0;o<i;++o)this.each(a(r[o],n,e));return this}function _X(t,n,e){var r=LI(t),o=r.CustomEvent;typeof o=="function"?o=new o(n,e):(o=r.document.createEvent("Event"),e?(o.initEvent(n,e.bubbles,e.cancelable),o.detail=e.detail):o.initEvent(n,!1,!1)),t.dispatchEvent(o)}function RNe(t,n){return function(){return _X(this,t,n)}}function MNe(t,n){return function(){return _X(this,t,n.apply(this,arguments))}}function NX(t,n){return this.each((typeof n=="function"?MNe:RNe)(t,n))}function*DX(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var ONe=[null];function Kn(t,n){this._groups=t,this._parents=n}function kX(){return new Kn([[document.documentElement]],ONe)}function FNe(){return this}Kn.prototype=kX.prototype={constructor:Kn,select:W7,selectAll:H7,selectChild:j7,selectChildren:q7,filter:K7,data:Z7,enter:X7,exit:Q7,join:J7,merge:eX,selection:FNe,order:tX,sort:nX,call:rX,nodes:oX,node:iX,size:sX,empty:aX,each:lX,attr:uX,style:cX,property:pX,classed:gX,text:yX,html:xX,raise:vX,lower:bX,append:wX,insert:CX,remove:SX,clone:IX,datum:EX,on:TX,dispatch:NX,[Symbol.iterator]:DX};var vl=kX;var $Ne=Gp("start","end","cancel","interrupt"),PNe=[],MX=0,AX=1,BI=2,VI=3,RX=4,zI=5,px=6;function sc(t,n,e,r,o,i){var s=t.__transition;if(!s)t.__transition={};else if(e in s)return;LNe(t,e,{name:n,index:r,group:o,on:$Ne,tween:PNe,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:MX})}function fx(t,n){var e=Xn(t,n);if(e.state>MX)throw new Error("too late; already scheduled");return e}function gr(t,n){var e=Xn(t,n);if(e.state>VI)throw new Error("too late; already running");return e}function Xn(t,n){var e=t.__transition;if(!e||!(e=e[n]))throw new Error("transition not found");return e}function LNe(t,n,e){var r=t.__transition,o;r[n]=e,e.timer=ec(i,0,e.time);function i(u){e.state=AX,e.timer.restart(s,e.delay,e.time),e.delay<=u&&s(u-e.delay)}function s(u){var c,p,f,d;if(e.state!==AX)return l();for(c in r)if(d=r[c],d.name===e.name){if(d.state===VI)return Es(s);d.state===RX?(d.state=px,d.timer.stop(),d.on.call("interrupt",t,t.__data__,d.index,d.group),delete r[c]):+c<n&&(d.state=px,d.timer.stop(),d.on.call("cancel",t,t.__data__,d.index,d.group),delete r[c])}if(Es(function(){e.state===VI&&(e.state=RX,e.timer.restart(a,e.delay,e.time),a(u))}),e.state=BI,e.on.call("start",t,t.__data__,e.index,e.group),e.state===BI){for(e.state=VI,o=new Array(f=e.tween.length),c=0,p=-1;c<f;++c)(d=e.tween[c].value.call(t,t.__data__,e.index,e.group))&&(o[++p]=d);o.length=p+1}}function a(u){for(var c=u<e.duration?e.ease.call(null,u/e.duration):(e.timer.restart(l),e.state=zI,1),p=-1,f=o.length;++p<f;)o[p].call(t,c);e.state===zI&&(e.on.call("end",t,t.__data__,e.index,e.group),l())}function l(){e.state=px,e.timer.stop(),delete r[n];for(var u in r)return;delete t.__transition}}function qR(t,n){var e=t.__transition,r,o,i=!0,s;if(e){n=n==null?null:n+"";for(s in e){if((r=e[s]).name!==n){i=!1;continue}o=r.state>BI&&r.state<zI,r.state=px,r.timer.stop(),r.on.call(o?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete e[s]}i&&delete t.__transition}}function OX(t){return this.each(function(){qR(this,t)})}function VNe(t,n){var e,r;return function(){var o=gr(this,t),i=o.tween;if(i!==e){r=e=i;for(var s=0,a=r.length;s<a;++s)if(r[s].name===n){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function BNe(t,n,e){var r,o;if(typeof e!="function")throw new Error;return function(){var i=gr(this,t),s=i.tween;if(s!==r){o=(r=s).slice();for(var a={name:n,value:e},l=0,u=o.length;l<u;++l)if(o[l].name===n){o[l]=a;break}l===u&&o.push(a)}i.tween=o}}function FX(t,n){var e=this._id;if(t+="",arguments.length<2){for(var r=Xn(this.node(),e).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===t)return s.value;return null}return this.each((n==null?VNe:BNe)(e,t,n))}function im(t,n,e){var r=t._id;return t.each(function(){var o=gr(this,r);(o.value||(o.value={}))[n]=e.apply(this,arguments)}),function(o){return Xn(o,r).value[n]}}function UI(t,n){var e;return(typeof n=="number"?Ar:n instanceof yo?xo:(e=yo(n))?(n=e,xo):jp)(t,n)}function zNe(t){return function(){this.removeAttribute(t)}}function UNe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function GNe(t,n,e){var r,o=e+"",i;return function(){var s=this.getAttribute(t);return s===o?null:s===r?i:i=n(r=s,e)}}function WNe(t,n,e){var r,o=e+"",i;return function(){var s=this.getAttributeNS(t.space,t.local);return s===o?null:s===r?i:i=n(r=s,e)}}function HNe(t,n,e){var r,o,i;return function(){var s,a=e(this),l;return a==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=a+"",s===l?null:s===r&&l===o?i:(o=l,i=n(r=s,a)))}}function jNe(t,n,e){var r,o,i;return function(){var s,a=e(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=a+"",s===l?null:s===r&&l===o?i:(o=l,i=n(r=s,a)))}}function $X(t,n){var e=xl(t),r=e==="transform"?Kp:UI;return this.attrTween(t,typeof n=="function"?(e.local?jNe:HNe)(e,r,im(this,"attr."+t,n)):n==null?(e.local?UNe:zNe)(e):(e.local?WNe:GNe)(e,r,n))}function qNe(t,n){return function(e){this.setAttribute(t,n.call(this,e))}}function KNe(t,n){return function(e){this.setAttributeNS(t.space,t.local,n.call(this,e))}}function XNe(t,n){var e,r;function o(){var i=n.apply(this,arguments);return i!==r&&(e=(r=i)&&KNe(t,i)),e}return o._value=n,o}function YNe(t,n){var e,r;function o(){var i=n.apply(this,arguments);return i!==r&&(e=(r=i)&&qNe(t,i)),e}return o._value=n,o}function PX(t,n){var e="attr."+t;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;var r=xl(t);return this.tween(e,(r.local?XNe:YNe)(r,n))}function ZNe(t,n){return function(){fx(this,t).delay=+n.apply(this,arguments)}}function QNe(t,n){return n=+n,function(){fx(this,t).delay=n}}function LX(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?ZNe:QNe)(n,t)):Xn(this.node(),n).delay}function JNe(t,n){return function(){gr(this,t).duration=+n.apply(this,arguments)}}function eDe(t,n){return n=+n,function(){gr(this,t).duration=n}}function VX(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?JNe:eDe)(n,t)):Xn(this.node(),n).duration}function tDe(t,n){if(typeof n!="function")throw new Error;return function(){gr(this,t).ease=n}}function BX(t){var n=this._id;return arguments.length?this.each(tDe(n,t)):Xn(this.node(),n).ease}function nDe(t,n){return function(){var e=n.apply(this,arguments);if(typeof e!="function")throw new Error;gr(this,t).ease=e}}function zX(t){if(typeof t!="function")throw new Error;return this.each(nDe(this._id,t))}function UX(t){typeof t!="function"&&(t=ux(t));for(var n=this._groups,e=n.length,r=new Array(e),o=0;o<e;++o)for(var i=n[o],s=i.length,a=r[o]=[],l,u=0;u<s;++u)(l=i[u])&&t.call(l,l.__data__,u,i)&&a.push(l);return new jr(r,this._parents,this._name,this._id)}function GX(t){if(t._id!==this._id)throw new Error;for(var n=this._groups,e=t._groups,r=n.length,o=e.length,i=Math.min(r,o),s=new Array(r),a=0;a<i;++a)for(var l=n[a],u=e[a],c=l.length,p=s[a]=new Array(c),f,d=0;d<c;++d)(f=l[d]||u[d])&&(p[d]=f);for(;a<r;++a)s[a]=n[a];return new jr(s,this._parents,this._name,this._id)}function rDe(t){return(t+"").trim().split(/^|\s+/).every(function(n){var e=n.indexOf(".");return e>=0&&(n=n.slice(0,e)),!n||n==="start"})}function oDe(t,n,e){var r,o,i=rDe(n)?fx:gr;return function(){var s=i(this,t),a=s.on;a!==r&&(o=(r=a).copy()).on(n,e),s.on=o}}function WX(t,n){var e=this._id;return arguments.length<2?Xn(this.node(),e).on.on(t):this.each(oDe(e,t,n))}function iDe(t){return function(){var n=this.parentNode;for(var e in this.__transition)if(+e!==t)return;n&&n.removeChild(this)}}function HX(){return this.on("end.remove",iDe(this._id))}function jX(t){var n=this._name,e=this._id;typeof t!="function"&&(t=Qp(t));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var a=r[s],l=a.length,u=i[s]=new Array(l),c,p,f=0;f<l;++f)(c=a[f])&&(p=t.call(c,c.__data__,f,a))&&("__data__"in c&&(p.__data__=c.__data__),u[f]=p,sc(u[f],n,e,f,u,Xn(c,e)));return new jr(i,this._parents,n,e)}function qX(t){var n=this._name,e=this._id;typeof t!="function"&&(t=lx(t));for(var r=this._groups,o=r.length,i=[],s=[],a=0;a<o;++a)for(var l=r[a],u=l.length,c,p=0;p<u;++p)if(c=l[p]){for(var f=t.call(c,c.__data__,p,l),d,h=Xn(c,e),m=0,g=f.length;m<g;++m)(d=f[m])&&sc(d,n,e,m,f,h);i.push(f),s.push(c)}return new jr(i,s,n,e)}var sDe=vl.prototype.constructor;function KX(){return new sDe(this._groups,this._parents)}function aDe(t,n){var e,r,o;return function(){var i=ic(this,t),s=(this.style.removeProperty(t),ic(this,t));return i===s?null:i===e&&s===r?o:o=n(e=i,r=s)}}function XX(t){return function(){this.style.removeProperty(t)}}function lDe(t,n,e){var r,o=e+"",i;return function(){var s=ic(this,t);return s===o?null:s===r?i:i=n(r=s,e)}}function uDe(t,n,e){var r,o,i;return function(){var s=ic(this,t),a=e(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),ic(this,t))),s===l?null:s===r&&l===o?i:(o=l,i=n(r=s,a))}}function cDe(t,n){var e,r,o,i="style."+n,s="end."+i,a;return function(){var l=gr(this,t),u=l.on,c=l.value[i]==null?a||(a=XX(n)):void 0;(u!==e||o!==c)&&(r=(e=u).copy()).on(s,o=c),l.on=r}}function YX(t,n,e){var r=(t+="")=="transform"?qp:UI;return n==null?this.styleTween(t,aDe(t,r)).on("end.style."+t,XX(t)):typeof n=="function"?this.styleTween(t,uDe(t,r,im(this,"style."+t,n))).each(cDe(this._id,t)):this.styleTween(t,lDe(t,r,n),e).on("end.style."+t,null)}function pDe(t,n,e){return function(r){this.style.setProperty(t,n.call(this,r),e)}}function fDe(t,n,e){var r,o;function i(){var s=n.apply(this,arguments);return s!==o&&(r=(o=s)&&pDe(t,s,e)),r}return i._value=n,i}function ZX(t,n,e){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(n==null)return this.tween(r,null);if(typeof n!="function")throw new Error;return this.tween(r,fDe(t,n,e??""))}function dDe(t){return function(){this.textContent=t}}function hDe(t){return function(){var n=t(this);this.textContent=n??""}}function QX(t){return this.tween("text",typeof t=="function"?hDe(im(this,"text",t)):dDe(t==null?"":t+""))}function mDe(t){return function(n){this.textContent=t.call(this,n)}}function gDe(t){var n,e;function r(){var o=t.apply(this,arguments);return o!==e&&(n=(e=o)&&mDe(o)),n}return r._value=t,r}function JX(t){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,gDe(t))}function eY(){for(var t=this._name,n=this._id,e=GI(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,l,u=0;u<a;++u)if(l=s[u]){var c=Xn(l,n);sc(l,t,e,u,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new jr(r,this._parents,t,e)}function tY(){var t,n,e=this,r=e._id,o=e.size();return new Promise(function(i,s){var a={value:s},l={value:function(){--o===0&&i()}};e.each(function(){var u=gr(this,r),c=u.on;c!==t&&(n=(t=c).copy(),n._.cancel.push(a),n._.interrupt.push(a),n._.end.push(l)),u.on=n}),o===0&&i()})}var yDe=0;function jr(t,n,e,r){this._groups=t,this._parents=n,this._name=e,this._id=r}function nY(t){return vl().transition(t)}function GI(){return++yDe}var bl=vl.prototype;jr.prototype=nY.prototype={constructor:jr,select:jX,selectAll:qX,selectChild:bl.selectChild,selectChildren:bl.selectChildren,filter:UX,merge:GX,selection:KX,transition:eY,call:bl.call,nodes:bl.nodes,node:bl.node,size:bl.size,empty:bl.empty,each:bl.each,on:WX,attr:$X,attrTween:PX,style:YX,styleTween:ZX,text:QX,textTween:JX,remove:HX,tween:FX,delay:LX,duration:VX,ease:BX,easeVarying:zX,end:tY,[Symbol.iterator]:bl[Symbol.iterator]};var xDe={time:null,delay:0,duration:250,ease:nc};function vDe(t,n){for(var e;!(e=t.__transition)||!(e=e[n]);)if(!(t=t.parentNode))throw new Error(`transition ${n} not found`);return e}function rY(t){var n,e;t instanceof jr?(n=t._id,t=t._name):(n=GI(),(e=xDe).time=dl(),t=t==null?null:t+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],a=s.length,l,u=0;u<a;++u)(l=s[u])&&sc(l,t,n,u,s,e||vDe(l,n));return new jr(r,this._parents,t,n)}vl.prototype.interrupt=OX;vl.prototype.transition=rY;function ac(t,n,e){this.k=t,this.x=n,this.y=e}ac.prototype={constructor:ac,scale:function(t){return t===1?this:new ac(this.k*t,this.x,this.y)},translate:function(t,n){return t===0&n===0?this:new ac(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var KR=new ac(1,0,0);XR.prototype=ac.prototype;function XR(t){for(;!t.__zoom;)if(!(t=t.parentNode))return KR;return t.__zoom}var wDe=["gameCanvas"],CDe=["networkVisualization"];function SDe(t,n){t&1&&(z(0,"div",70)(1,"div",71)(2,"h4"),q(3,"\u{1F916} AI vs AI Training"),U(),z(4,"p"),q(5,"Watch two neural networks learn to play Pong!"),U(),z(6,"p"),q(7,'Click "START TRAINING" to begin'),U()()())}function IDe(t,n){if(t&1&&(z(0,"div",72)(1,"h4",73),q(2),U(),z(3,"div",51)(4,"span",52),q(5,"Wins:"),U(),z(6,"span",53),q(7),U()(),z(8,"div",51)(9,"span",52),q(10,"Win Rate:"),U(),z(11,"span",53),q(12),U()(),z(13,"div",51)(14,"span",52),q(15,"Avg Reward:"),U(),z(16,"span",53),q(17),U()(),z(18,"div",51)(19,"span",52),q(20,"Exploration:"),U(),z(21,"span",53),q(22),U()(),z(23,"div",51)(24,"span",52),q(25,"Games:"),U(),z(26,"span",53),q(27),U()()()),t&2){let e=n.ngIf;he(2),Qn("\u{1F534} ",e.name,""),he(5),dn(e.wins),he(5),Qn("",e.winRate,"%"),he(5),dn(e.avgReward),he(5),dn(e.epsilon),he(5),dn(e.gamesPlayed)}}function EDe(t,n){if(t&1&&(z(0,"div",72)(1,"h4",73),q(2),U(),z(3,"div",51)(4,"span",52),q(5,"Wins:"),U(),z(6,"span",53),q(7),U()(),z(8,"div",51)(9,"span",52),q(10,"Win Rate:"),U(),z(11,"span",53),q(12),U()(),z(13,"div",51)(14,"span",52),q(15,"Avg Reward:"),U(),z(16,"span",53),q(17),U()(),z(18,"div",51)(19,"span",52),q(20,"Exploration:"),U(),z(21,"span",53),q(22),U()(),z(23,"div",51)(24,"span",52),q(25,"Games:"),U(),z(26,"span",53),q(27),U()()()),t&2){let e=n.ngIf;he(2),Qn("\u{1F535} ",e.name,""),he(5),dn(e.wins),he(5),Qn("",e.winRate,"%"),he(5),dn(e.avgReward),he(5),dn(e.epsilon),he(5),dn(e.gamesPlayed)}}function TDe(t,n){if(t&1&&(z(0,"div",77)(1,"span",78),q(2),RF(3,"date"),U(),z(4,"span",79),q(5),U()()),t&2){let e=n.$implicit;he(2),dn(MF(3,2,e.timestamp,"HH:mm:ss")),he(3),dn(e.message)}}function _De(t,n){if(t&1&&(z(0,"div",74)(1,"h3"),q(2,"\u{1F4DD} TRAINING LOGS"),U(),z(3,"div",75),Mr(4,TDe,6,5,"div",76),U()()),t&2){let e=Ot();he(4),vt("ngForOf",e.trainingLogs)("ngForTrackBy",e.trackByIndex)}}var WI=class t{canvasRef;networkVisRef;backToMenu=new Jt;ctx;animationId;isTraining=!1;gameNumber=0;episode=0;canvas={width:800,height:400};ball={x:400,y:200,dx:6,dy:4,radius:8};paddle1={x:20,y:175,width:10,height:80};paddle2={x:770,y:175,width:10,height:80};agent1=null;agent2=null;trainingLogs=[];maxLogs=100;config={learningRate:.003,epsilon:.9,epsilonDecay:.998,epsilonMin:.05,batchSize:64,memorySize:2e4,targetUpdateFreq:50,gameSpeed:5,episodes:1e3,stepsPerFrame:10,trainFrequency:4,prioritizedReplay:!0,doubleQLearning:!0,maxGameLength:1e3};stats={agent1Wins:0,agent2Wins:0,totalGames:0,avgRewardAgent1:0,avgRewardAgent2:0,agent1WinRate:0,agent2WinRate:0,agent1Rewards:[],agent2Rewards:[]};lossHistory=[];rewardHistory={agent1:[],agent2:[]};winRateHistory={agent1:[],agent2:[]};networkSvg;networkConfig={layers:[8,128,64,32,3],nodeRadius:8,layerSpacing:120,nodeSpacing:25};frameCount=0;lastFrameTime=0;fps=0;gameStepCount=0;renderSkipFrames=5;trainingBuffer=[];ngOnInit(){this.initializeCanvas()}ngAfterViewInit(){this.setupVisualization()}ngOnDestroy(){this.stopTraining(),this.cleanup()}initializeCanvas(){let n=this.canvasRef.nativeElement;n.width=this.canvas.width,n.height=this.canvas.height,this.ctx=n.getContext("2d")}setupVisualization(){return B(this,null,function*(){yield CL(),console.log("TensorFlow.js ready for AI training!"),setTimeout(()=>{this.initializeNetworkVisualization()},100)})}createNeuralNetwork(){let n=G1({layers:[il.dense({inputShape:[8],units:64,activation:"relu",kernelInitializer:"heNormal"}),il.batchNormalization(),il.dropout({rate:.1}),il.dense({units:32,activation:"relu",kernelInitializer:"heNormal"}),il.batchNormalization(),il.dense({units:3,activation:"linear",kernelInitializer:"zeros"})]});return n.compile({optimizer:hs.adam(this.config.learningRate,.9,.999,1e-7),loss:"huberLoss",metrics:["mse"]}),n}trainingLoop(){return B(this,null,function*(){if(!this.isTraining||!this.agent1||!this.agent2)return;let n=performance.now();for(let e=0;e<this.config.stepsPerFrame&&(yield this.gameStep(),this.gameStepCount++,this.gameNumber===Math.floor(this.gameStepCount/100));e++);this.trainingBuffer.length>=this.config.batchSize&&this.gameStepCount%this.config.trainFrequency===0&&(yield this.processBatchedTraining()),this.frameCount++,this.frameCount%this.renderSkipFrames===0&&(this.render(),this.updateFPS(n)),this.gameNumber%20===0&&this.gameNumber>0&&this.updateVisualization(),this.animationId=requestAnimationFrame(()=>this.trainingLoop())})}startTraining(){return B(this,null,function*(){this.isTraining||(this.isTraining=!0,this.gameNumber=0,this.episode=0,this.gameStepCount=0,this.frameCount=0,this.addTrainingLog("\u{1F680} High-performance training session started"),this.addTrainingLog("\u{1F9E0} Initializing optimized neural networks..."),this.agent1={id:"agent1",name:"Red AI",model:this.createNeuralNetwork(),targetModel:this.createNeuralNetwork(),memory:[],epsilon:this.config.epsilon,score:0,totalReward:0,gamesPlayed:0,color:"#ff4444",actionCache:new Map,lastState:null,lastAction:1},this.agent2={id:"agent2",name:"Blue AI",model:this.createNeuralNetwork(),targetModel:this.createNeuralNetwork(),memory:[],epsilon:this.config.epsilon,score:0,totalReward:0,gamesPlayed:0,color:"#4444ff",actionCache:new Map,lastState:null,lastAction:1},this.agent1.targetModel.setWeights(this.agent1.model.getWeights()),this.agent2.targetModel.setWeights(this.agent2.model.getWeights()),this.addTrainingLog("\u2705 Optimized agents initialized successfully"),this.addTrainingLog(`\u{1F3AE} Running at ${this.config.stepsPerFrame}x speed multiplier`),this.resetGame(),this.trainingLoop())})}stopTraining(){if(this.isTraining=!1,this.animationId&&cancelAnimationFrame(this.animationId),this.gameNumber>0){this.addTrainingLog(`\u23F9\uFE0F Training stopped after ${this.gameNumber} games`);let n=this.stats.agent1WinRate.toFixed(1),e=this.stats.agent2WinRate.toFixed(1);this.addTrainingLog(`\u{1F4CA} Final win rates - Red: ${n}%, Blue: ${e}%`)}}gameStep(){return B(this,null,function*(){if(!this.agent1||!this.agent2)return;let n=this.getGameState(),e=yield this.getActionOptimized(this.agent1,n),r=yield this.getActionOptimized(this.agent2,n),o=[...n];this.executeAction(1,e),this.executeAction(2,r);for(let a=0;a<this.config.gameSpeed;a++){this.updateBall();let l=this.checkGameEnd();if(l.gameEnded){let u=this.getGameState(),c=this.calculateEnhancedRewards(l,o,u);this.trainingBuffer.push({agent:this.agent1,state:o,action:e,reward:c.agent1,nextState:u,done:!0},{agent:this.agent2,state:o,action:r,reward:c.agent2,nextState:u,done:!0}),this.handleGameEnd(l.winner),this.resetGame(),this.gameNumber++;return}}let i=this.getGameState(),s=this.calculateEnhancedRewards({gameEnded:!1,winner:null},o,i);this.trainingBuffer.push({agent:this.agent1,state:o,action:e,reward:s.agent1,nextState:i,done:!1},{agent:this.agent2,state:o,action:r,reward:s.agent2,nextState:i,done:!1}),this.episode++,this.episode%this.config.targetUpdateFreq===0&&this.updateTargetNetworks()})}getActionOptimized(n,e){return B(this,null,function*(){let r=e.map(l=>Math.round(l*100)/100).join(",");if(n.actionCache.has(r)&&Math.random()>.1)return n.actionCache.get(r);if(Math.random()<n.epsilon){let l=(e[1]+1)*this.canvas.height/2,u=n.id==="agent1"?(e[4]+1)*this.canvas.height/2:(e[5]+1)*this.canvas.height/2,c;return Math.abs(l-u)<20?c=1:c=l>u?2:0,n.lastAction=c,n.actionCache.set(r,c),c}let o=Lr([e]),i=n.model.predict(o,{batchSize:1}),s=yield i.data();o.dispose(),i.dispose();let a=s.indexOf(Math.max(...Array.from(s)));if(n.lastAction=a,n.actionCache.set(r,a),n.actionCache.size>1e3){let u=n.actionCache.keys().next().value;u!==void 0&&n.actionCache.delete(u)}return a})}calculateEnhancedRewards(n,e,r){let o=0,i=0;if(n.gameEnded)n.winner===1?(o=100,i=-100):n.winner===2&&(o=-100,i=100);else{let s=(r[0]+1)*this.canvas.width/2,a=(r[1]+1)*this.canvas.height/2,l=r[2]*10,u=(r[4]+1)*this.canvas.height/2,c=(r[5]+1)*this.canvas.height/2,p=Math.abs(a-u),f=Math.abs(a-c);o=2-p/100,i=2-f/100,l<0&&s<this.canvas.width/2&&(o+=Math.max(0,3-p/20)),l>0&&s>this.canvas.width/2&&(i+=Math.max(0,3-f/20)),this.agent1?.lastAction===1&&(o-=.1),this.agent2?.lastAction===1&&(i-=.1)}return{agent1:o,agent2:i}}executeAction(n,e){let r=n===1?this.paddle1:this.paddle2,o=12;switch(e){case 0:r.y=Math.max(0,r.y-o);break;case 1:break;case 2:r.y=Math.min(this.canvas.height-r.height,r.y+o);break}}updateBall(){this.ball.x+=this.ball.dx*this.config.gameSpeed,this.ball.y+=this.ball.dy*this.config.gameSpeed,(this.ball.y-this.ball.radius<=0||this.ball.y+this.ball.radius>=this.canvas.height)&&(this.ball.dy=-this.ball.dy),(this.ballCollidesWithPaddle(this.paddle1)||this.ballCollidesWithPaddle(this.paddle2))&&(this.ball.dx=-this.ball.dx,this.ball.dy+=(Math.random()-.5)*2)}ballCollidesWithPaddle(n){return this.ball.x-this.ball.radius<=n.x+n.width&&this.ball.x+this.ball.radius>=n.x&&this.ball.y-this.ball.radius<=n.y+n.height&&this.ball.y+this.ball.radius>=n.y}checkGameEnd(){return this.ball.x<0?{gameEnded:!0,winner:2}:this.ball.x>this.canvas.width?{gameEnded:!0,winner:1}:{gameEnded:!1,winner:null}}sampleBatch(n,e){let r=[];for(let o=0;o<e;o++){let i=Math.floor(Math.random()*n.length);r.push(n[i])}return r}updateTargetNetworks(){this.agent1&&this.agent2&&(this.agent1.targetModel.setWeights(this.agent1.model.getWeights()),this.agent2.targetModel.setWeights(this.agent2.model.getWeights()))}handleGameEnd(n){if(!this.agent1||!this.agent2)return;this.agent1.gamesPlayed++,this.agent2.gamesPlayed++;let e="";n===1?(this.agent1.score++,this.stats.agent1Wins++,e=`\u{1F534} Red AI wins game ${this.gameNumber+1}`):n===2?(this.agent2.score++,this.stats.agent2Wins++,e=`\u{1F535} Blue AI wins game ${this.gameNumber+1}`):e=`\u26BD Game ${this.gameNumber+1} ended in a draw`,this.stats.totalGames++,this.updateStats(),this.gameNumber%25===0&&this.addTrainingLog(e),this.agent1.epsilon<=.5&&this.agent1.epsilon>.49&&this.addTrainingLog("\u{1F3AF} Exploration reduced to 50% - agents becoming more strategic"),this.agent1.epsilon<=.1&&this.agent1.epsilon>.09&&this.addTrainingLog("\u{1F9E0} Exploration at 10% - agents mostly exploiting learned strategies")}updateEpsilonDecay(n){this.config.epsilonDecay=n,this.addTrainingLog(`Epsilon decay updated to ${n.toFixed(4)}`)}updateVisualization(){this.agent1&&this.agent2&&(this.rewardHistory.agent1.push(this.agent1.totalReward),this.rewardHistory.agent2.push(this.agent2.totalReward),this.winRateHistory.agent1.push(this.stats.agent1WinRate),this.winRateHistory.agent2.push(this.stats.agent2WinRate),this.rewardHistory.agent1.length>100&&(this.rewardHistory.agent1.shift(),this.rewardHistory.agent2.shift(),this.winRateHistory.agent1.shift(),this.winRateHistory.agent2.shift()))}render(){this.ctx.fillStyle="#0f0f23",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.strokeStyle="#00ff00",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2,0),this.ctx.lineTo(this.canvas.width/2,this.canvas.height),this.ctx.stroke(),this.ctx.setLineDash([]),this.agent1&&(this.ctx.fillStyle=this.agent1.color,this.ctx.fillRect(this.paddle1.x,this.paddle1.y,this.paddle1.width,this.paddle1.height)),this.agent2&&(this.ctx.fillStyle=this.agent2.color,this.ctx.fillRect(this.paddle2.x,this.paddle2.y,this.paddle2.width,this.paddle2.height)),this.ctx.fillStyle="#00ff00",this.ctx.beginPath(),this.ctx.arc(this.ball.x,this.ball.y,this.ball.radius,0,Math.PI*2),this.ctx.fill(),this.updateNetworkVisualization()}initializeNetworkVisualization(){if(!this.networkVisRef?.nativeElement)return;let n=rm(this.networkVisRef.nativeElement);n.selectAll("*").remove();let e=1e3,r=400,o=450,i=350,s=n.append("svg").attr("width",e).attr("height",r).style("background","rgba(15, 15, 35, 0.8)").style("border","2px solid #00ff00").style("border-radius","15px"),a=s.append("g").attr("transform","translate(25, 25)");this.createAgentNetwork(a,o,i,"agent1","#ff4444");let l=s.append("g").attr("transform",`translate(${25+o+50}, 25)`);this.createAgentNetwork(l,o,i,"agent2","#4444ff"),s.append("text").attr("x",e/2).attr("y",20).attr("text-anchor","middle").style("fill","#00ff00").style("font-family","monospace").style("font-size","16px").style("font-weight","bold").text("\u{1F9E0} REAL-TIME NEURAL NETWORK VISUALIZATION")}createAgentNetwork(n,e,r,o,i){let s=[8,32,16,3],a=6,l=e/(s.length+1);n.append("text").attr("x",e/2).attr("y",15).attr("text-anchor","middle").style("fill",i).style("font-family","monospace").style("font-size","14px").style("font-weight","bold").text(`${o==="agent1"?"RED AI":"BLUE AI"} BRAIN`);let u=[],c=[];for(let h=0;h<s.length;h++){let m=h===1?8:s[h],g=(h+1)*l,y=(r-(m-1)*25)/2;for(let x=0;x<m;x++){let b=y+x*25;if(u.push({id:`${o}-${h}-${x}`,x:g,y:b,layer:h,index:x,agentId:o,activation:0}),h<s.length-1){let w=h+1===1?8:s[h+1];for(let C=0;C<w;C++)c.push({id:`${o}-link-${h}-${x}-${C}`,source:`${o}-${h}-${x}`,target:`${o}-${h+1}-${C}`,weight:(Math.random()-.5)*2,agentId:o})}}}n.selectAll(".network-link").data(c).enter().append("line").attr("class",`network-link ${o}-link`).attr("x1",h=>u.find(m=>m.id===h.source)?.x??0).attr("y1",h=>u.find(m=>m.id===h.source)?.y??0).attr("x2",h=>u.find(m=>m.id===h.target)?.x??0).attr("y2",h=>u.find(m=>m.id===h.target)?.y??0).attr("stroke","#666").attr("stroke-width",1).attr("stroke-opacity",.2),n.selectAll(".network-node").data(u).enter().append("circle").attr("class",`network-node ${o}-node`).attr("cx",h=>h.x).attr("cy",h=>h.y).attr("r",a).attr("fill","#333").attr("stroke",i).attr("stroke-width",1);let p=["Ball X","Ball Y","Ball \u0394X","Ball \u0394Y","My Paddle","Enemy Paddle","Distance X","Distance Y"];u.filter(h=>h.layer===0).forEach((h,m)=>{n.append("text").attr("x",h.x-45).attr("y",h.y+3).attr("text-anchor","end").style("fill","#ccc").style("font-family","monospace").style("font-size","8px").text(p[m]||`Input ${m+1}`)});let f=["Move Up","Stay","Move Down"];u.filter(h=>h.layer===s.length-1).forEach((h,m)=>{n.append("text").attr("x",h.x+15).attr("y",h.y+3).attr("text-anchor","start").style("fill","#ccc").style("font-family","monospace").style("font-size","8px").text(f[m]||`Output ${m+1}`)});let d=["INPUTS","HIDDEN","HIDDEN","ACTIONS"];for(let h=0;h<s.length;h++)n.append("text").attr("x",(h+1)*l).attr("y",r-10).attr("text-anchor","middle").style("fill",i).style("font-family","monospace").style("font-size","10px").style("font-weight","bold").text(d[h]);n.append("text").attr("class",`${o}-activation-text`).attr("x",e/2).attr("y",r+15).attr("text-anchor","middle").style("fill",i).style("font-family","monospace").style("font-size","10px").text("Thinking...")}updateNetworkVisualization(){return B(this,null,function*(){if(!this.networkVisRef?.nativeElement||!this.agent1||!this.agent2)return;let n=this.getGameState(),e=[],r=[];try{if(this.agent1){let o=Lr([n]),i=this.agent1.model.predict(o);e=Array.from(yield i.data()),o.dispose(),i.dispose()}if(this.agent2){let o=Lr([n]),i=this.agent2.model.predict(o);r=Array.from(yield i.data()),o.dispose(),i.dispose()}}catch(o){console.warn("Error getting network predictions:",o)}this.updateAgentVisualization("agent1",n,e,"#ff4444"),this.updateAgentVisualization("agent2",n,r,"#4444ff")})}updateAgentVisualization(n,e,r,o){let i=rm(this.networkVisRef.nativeElement).select("svg");if(i.selectAll(`.${n}-node`).filter(s=>s.layer===0).transition().duration(100).attr("fill",s=>{let a=Math.abs(e[s.index]||0),l=Math.min(a,1);return xo("#000",o)(l*.8+.2)}).attr("r",s=>6+Math.abs(e[s.index]||0)*3),i.selectAll(`.${n}-node`).filter(s=>s.layer>0&&s.layer<3).transition().duration(150).attr("fill",s=>{let a=e.reduce((u,c,p)=>u+Math.abs(c)*Math.sin(p+s.index),0)/e.length,l=Math.abs(Math.sin(a+Date.now()/1e3+s.index))*.7+.3;return xo("#000",o)(l)}).attr("r",6),r.length>=3){let s=Math.max(...r),a=r.indexOf(s);i.selectAll(`.${n}-node`).filter(u=>u.layer===3).transition().duration(100).attr("fill",u=>{let p=((r[u.index]||0)+10)/20,f=Math.max(0,Math.min(1,p));return xo("#000",o)(f)}).attr("r",u=>u.index===a?10:6).attr("stroke-width",u=>u.index===a?3:1);let l=["Moving Up","Staying","Moving Down"];i.select(`.${n}-activation-text`).text(`Decision: ${l[a]} (Q: ${s.toFixed(2)})`)}i.selectAll(`.${n}-link`).transition().duration(200).attr("stroke-opacity",()=>.1+Math.random()*.3).attr("stroke-width",()=>.5+Math.random()*1.5).attr("stroke",()=>Math.random()>.7?o:"#666")}getAgent1Stats(){return this.agent1?{name:"RED AI",wins:this.stats.agent1Wins,winRate:this.stats.totalGames>0?(this.stats.agent1Wins/this.stats.totalGames*100).toFixed(1):"0.0",avgReward:this.stats.agent1Rewards.length>0?(this.stats.agent1Rewards.reduce((n,e)=>n+e,0)/this.stats.agent1Rewards.length).toFixed(2):"0.00",epsilon:this.agent1.epsilon.toFixed(3),gamesPlayed:this.stats.totalGames}:null}getAgent2Stats(){return this.agent2?{name:"BLUE AI",wins:this.stats.agent2Wins,winRate:this.stats.totalGames>0?(this.stats.agent2Wins/this.stats.totalGames*100).toFixed(1):"0.0",avgReward:this.stats.agent2Rewards.length>0?(this.stats.agent2Rewards.reduce((n,e)=>n+e,0)/this.stats.agent2Rewards.length).toFixed(2):"0.00",epsilon:this.agent2.epsilon.toFixed(3),gamesPlayed:this.stats.totalGames}:null}getFPS(){return this.fps}getTrainingSpeed(){return`${this.config.stepsPerFrame*this.config.gameSpeed}x`}getGameState(){return[this.ball.x/this.canvas.width*2-1,this.ball.y/this.canvas.height*2-1,this.ball.dx/10,this.ball.dy/10,this.paddle1.y/this.canvas.height*2-1,this.paddle2.y/this.canvas.height*2-1,(this.ball.x-this.paddle1.x)/this.canvas.width,(this.ball.x-this.paddle2.x)/this.canvas.width]}processBatchedTraining(){return B(this,null,function*(){if(this.trainingBuffer.length===0)return;let n=this.trainingBuffer.filter(o=>o.agent.id==="agent1"),e=this.trainingBuffer.filter(o=>o.agent.id==="agent2"),r=[];n.length>=this.config.batchSize/2&&r.push(this.trainAgentBatched(this.agent1,n)),e.length>=this.config.batchSize/2&&r.push(this.trainAgentBatched(this.agent2,e)),yield Promise.all(r),this.trainingBuffer.length=0})}trainAgentBatched(n,e){return B(this,null,function*(){if(e.length<8)return;for(e.forEach(g=>{n.memory.push({state:g.state,action:g.action,reward:g.reward,nextState:g.nextState,done:g.done}),n.totalReward+=g.reward});n.memory.length>this.config.memorySize;)n.memory.shift();if(n.memory.length<this.config.batchSize)return;let r=this.config.prioritizedReplay?this.samplePrioritizedBatch(n.memory,Math.min(this.config.batchSize,e.length*2)):this.sampleBatch(n.memory,Math.min(this.config.batchSize,e.length*2)),o=r.map(g=>g.state),i=r.map(g=>g.nextState),s=n.model.predict(Lr(o),{batchSize:r.length}),a=n.targetModel.predict(Lr(i),{batchSize:r.length}),l=null;this.config.doubleQLearning&&(l=n.model.predict(Lr(i),{batchSize:r.length}));let u=yield s.data(),c=yield a.data(),p=l?yield l.data():null,f=[],d=[];for(let g=0;g<r.length;g++){let y=r[g],x=Array.from(u.slice(g*3,(g+1)*3)),b=Array.from(c.slice(g*3,(g+1)*3)),w=y.reward;if(!y.done)if(this.config.doubleQLearning&&p){let C=Array.from(p.slice(g*3,(g+1)*3)),N=C.indexOf(Math.max(...C));w=y.reward+.99*b[N]}else w=y.reward+.99*Math.max(...b);x[y.action]=w,f.push(y.state),d.push(x)}let h=Lr(f),m=Lr(d);yield n.model.fit(h,m,{epochs:1,verbose:0,batchSize:Math.min(32,r.length),shuffle:!0}),s.dispose(),a.dispose(),l&&l.dispose(),h.dispose(),m.dispose(),n.epsilon=Math.max(this.config.epsilonMin,n.epsilon*this.config.epsilonDecay)})}samplePrioritizedBatch(n,e){let r=n.slice(-Math.floor(n.length*.3)),o=n.filter(a=>Math.abs(a.reward)>1),i=[...r,...o],s=[];for(let a=0;a<Math.min(e,i.length);a++){let l=Math.floor(Math.random()*i.length);s.push(i[l])}for(;s.length<e&&s.length<n.length;){let a=Math.floor(Math.random()*n.length);s.push(n[a])}return s}updateFPS(n){let e=performance.now(),r=e-this.lastFrameTime;r>0&&(this.fps=Math.round(1e3/r)),this.lastFrameTime=e}resetGame(){this.ball.x=this.canvas.width/2,this.ball.y=this.canvas.height/2,this.ball.dx=(Math.random()>.5?1:-1)*8,this.ball.dy=(Math.random()-.5)*8,this.paddle1.y=(this.canvas.height-this.paddle1.height)/2,this.paddle2.y=(this.canvas.height-this.paddle2.height)/2,this.agent1&&this.agent1.actionCache.clear(),this.agent2&&this.agent2.actionCache.clear()}updateLearningRate(n){if(this.config.learningRate=n,this.addTrainingLog(`Learning rate updated to ${n.toFixed(4)}`),this.agent1&&this.agent2){let e=hs.adam(this.config.learningRate,.9,.999,1e-7);this.agent1.model.compile({optimizer:e,loss:"huberLoss",metrics:["mse"]}),this.agent2.model.compile({optimizer:e,loss:"huberLoss",metrics:["mse"]})}}updateGameSpeed(n){this.config.gameSpeed=n,this.addTrainingLog(`Game speed updated to ${n}x`)}updateStepsPerFrame(n){this.config.stepsPerFrame=n,this.addTrainingLog(`Steps per frame updated to ${n}`)}addTrainingLog(n){let e={timestamp:new Date().toLocaleTimeString(),gameNumber:this.gameNumber,agent1Score:this.agent1?.score??0,agent2Score:this.agent2?.score??0,agent1Reward:this.agent1?.totalReward??0,agent2Reward:this.agent2?.totalReward??0,agent1Epsilon:this.agent1?.epsilon??0,agent2Epsilon:this.agent2?.epsilon??0,message:n};this.trainingLogs.unshift(e),this.trainingLogs.length>this.maxLogs&&(this.trainingLogs=this.trainingLogs.slice(0,this.maxLogs))}updateStats(){this.stats.totalGames>0&&(this.stats.agent1WinRate=this.stats.agent1Wins/this.stats.totalGames*100,this.stats.agent2WinRate=this.stats.agent2Wins/this.stats.totalGames*100),this.agent1&&this.agent2&&(this.stats.avgRewardAgent1=this.agent1.totalReward/Math.max(1,this.agent1.gamesPlayed),this.stats.avgRewardAgent2=this.agent2.totalReward/Math.max(1,this.agent2.gamesPlayed))}exportModel(n){return B(this,null,function*(){let e=n==="agent1"?this.agent1:this.agent2;if(e)try{let r={modelWeights:e.model.getWeights().map(a=>a.arraySync()),config:{epsilon:e.epsilon,totalReward:e.totalReward,gamesPlayed:e.gamesPlayed,score:e.score},exportDate:new Date().toISOString(),agentType:n},o=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download=`pong-ai-${n}-${Date.now()}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i),this.addTrainingLog(`${n} model exported successfully`)}catch(r){console.error("Error exporting model:",r),this.addTrainingLog(`Error exporting ${n} model`)}})}importModel(n,e){return B(this,null,function*(){if(e)try{this.addTrainingLog(`\u{1F4E5} Importing model for ${n}...`);let r=yield e.text(),o=JSON.parse(r),i=n==="agent1"?this.agent1:this.agent2;if(!i){this.addTrainingLog(`\u274C Cannot import to ${n} - agent not initialized`);return}let s=o.modelWeights.map(a=>Fr(a));i.model.setWeights(s),i.targetModel.setWeights(s),o.config&&(i.epsilon=o.config.epsilon??i.epsilon,i.totalReward=o.config.totalReward??0,i.gamesPlayed=o.config.gamesPlayed??0,i.score=o.config.score??0),s.forEach(a=>a.dispose()),this.addTrainingLog(`\u2705 Model imported successfully for ${i.name}`),this.addTrainingLog(`\u{1F4CA} Restored stats: ${i.gamesPlayed} games, ${i.score} wins`)}catch(r){console.error("Error importing model:",r),this.addTrainingLog(`\u274C Failed to import model for ${n}`)}})}resetTraining(){this.stopTraining(),this.addTrainingLog("\u{1F504} Resetting training session..."),this.stats={agent1Wins:0,agent2Wins:0,totalGames:0,avgRewardAgent1:0,avgRewardAgent2:0,agent1WinRate:0,agent2WinRate:0,agent1Rewards:[],agent2Rewards:[]},this.rewardHistory.agent1.length=0,this.rewardHistory.agent2.length=0,this.winRateHistory.agent1.length=0,this.winRateHistory.agent2.length=0,this.lossHistory.length=0,this.gameNumber=0,this.episode=0,this.agent1&&(this.agent1.model.dispose(),this.agent1.targetModel.dispose(),this.agent1=null),this.agent2&&(this.agent2.model.dispose(),this.agent2.targetModel.dispose(),this.agent2=null),this.networkVisRef?.nativeElement&&rm(this.networkVisRef.nativeElement).selectAll("*").remove(),this.addTrainingLog("\u2705 Training session reset complete"),this.addTrainingLog("\u{1F3AF} Ready to start new training session")}goBackToMenu(){this.stopTraining(),this.backToMenu.emit()}trackByIndex(n,e){return n}cleanup(){this.agent1&&(this.agent1.model.dispose(),this.agent1.targetModel.dispose()),this.agent2&&(this.agent2.model.dispose(),this.agent2.targetModel.dispose()),this.networkVisRef?.nativeElement&&rm(this.networkVisRef.nativeElement).selectAll("*").remove()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=Ji({type:t,selectors:[["app-ai-learning"]],viewQuery:function(e,r){if(e&1&&($m(wDe,7),$m(CDe,7)),e&2){let o;Pm(o=Lm())&&(r.canvasRef=o.first),Pm(o=Lm())&&(r.networkVisRef=o.first)}},outputs:{backToMenu:"backToMenu"},decls:175,vars:30,consts:[["gameCanvas",""],["networkVisualization",""],[1,"ai-learning-container"],[1,"header-section"],[1,"title"],[1,"back-btn",3,"click"],[1,"back-icon"],[1,"control-panel"],[1,"control-section"],[1,"controls-grid"],[1,"control-group"],["for","learning-rate"],["type","range","id","learning-rate","min","0.0001","max","0.01","step","0.0001",1,"slider",3,"input","value"],[1,"value-display"],["for","game-speed"],["type","range","id","game-speed","min","1","max","20","step","1",1,"slider",3,"input","value"],["for","steps-per-frame"],["type","range","id","steps-per-frame","min","1","max","50","step","1",1,"slider",3,"input","value"],["for","epsilon-decay"],["type","range","id","epsilon-decay","min","0.99","max","0.9999","step","0.0001",1,"slider",3,"input","value"],["for","episodes"],["type","number","id","episodes","min","1","max","10000",1,"number-input",3,"ngModelChange","ngModel"],["for","batch-size"],["type","range","id","batch-size","min","16","max","128","step","16",1,"slider",3,"input","value"],[1,"action-buttons"],[1,"btn","btn-primary",3,"click","disabled"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"btn","btn-warning",3,"click"],[1,"performance-stats"],[1,"perf-item"],[1,"perf-label"],[1,"perf-value"],[1,"optimization-toggles"],[1,"toggle-label"],["type","checkbox",3,"ngModelChange","change","ngModel"],[1,"model-controls"],[1,"export-controls"],[1,"btn","btn-success",3,"click"],[1,"import-controls"],[1,"file-input-label"],["type","file","accept",".json",1,"file-input",3,"change"],[1,"main-content"],[1,"game-section"],[1,"game-container"],["width","600","height","400",1,"game-canvas"],["class","game-overlay",4,"ngIf"],[1,"stats-section"],[1,"stats-grid"],["class","agent-stats",4,"ngIf"],[1,"overall-stats"],[1,"stats-title"],[1,"stat-item"],[1,"stat-label"],[1,"stat-value"],[1,"progress-bar"],[1,"progress-fill"],[1,"visualization-section"],[1,"network-container"],[1,"network-info"],[1,"legend"],[1,"legend-item"],[1,"legend-color",2,"background","#440154"],[1,"legend-color",2,"background","#31688e"],[1,"legend-color",2,"background","#35b779"],[1,"legend-color",2,"background","#fde725"],[1,"network-viz"],["class","logs-section",4,"ngIf"],[1,"analytics-section"],[1,"charts-container"],[1,"chart-placeholder"],[1,"game-overlay"],[1,"overlay-content"],[1,"agent-stats"],[1,"agent-title"],[1,"logs-section"],[1,"logs-container"],["class","log-entry",4,"ngFor","ngForOf","ngForTrackBy"],[1,"log-entry"],[1,"log-timestamp"],[1,"log-message"]],template:function(e,r){if(e&1){let o=Qr();z(0,"div",2)(1,"div",3)(2,"h1",4),q(3,"\u{1F9E0} AI LEARNING LAB"),U(),z(4,"button",5),Je("click",function(){return He(o),je(r.goBackToMenu())}),z(5,"span",6),q(6,"\u2190"),U(),q(7," BACK TO MENU "),U()(),z(8,"div",7)(9,"div",8)(10,"h3"),q(11,"\u{1F3AE} TRAINING CONTROLS"),U(),z(12,"div",9)(13,"div",10)(14,"label",11),q(15,"Learning Rate"),U(),z(16,"input",12),Je("input",function(s){return He(o),je(r.updateLearningRate(+s.target.value))}),U(),z(17,"span",13),q(18),U()(),z(19,"div",10)(20,"label",14),q(21,"Game Speed"),U(),z(22,"input",15),Je("input",function(s){return He(o),je(r.updateGameSpeed(+s.target.value))}),U(),z(23,"span",13),q(24),U()(),z(25,"div",10)(26,"label",16),q(27,"Steps Per Frame"),U(),z(28,"input",17),Je("input",function(s){return He(o),je(r.updateStepsPerFrame(+s.target.value))}),U(),z(29,"span",13),q(30),U()(),z(31,"div",10)(32,"label",18),q(33,"Epsilon Decay"),U(),z(34,"input",19),Je("input",function(s){return He(o),je(r.updateEpsilonDecay(+s.target.value))}),U(),z(35,"span",13),q(36),U()(),z(37,"div",10)(38,"label",20),q(39,"Episodes"),U(),z(40,"input",21),Eo("ngModelChange",function(s){return He(o),jo(r.config.episodes,s)||(r.config.episodes=s),je(s)}),U()(),z(41,"div",10)(42,"label",22),q(43,"Batch Size"),U(),z(44,"input",23),Je("input",function(s){return He(o),je(r.config.batchSize=+s.target.value)}),U(),z(45,"span",13),q(46),U()()(),z(47,"div",24)(48,"button",25),Je("click",function(){return He(o),je(r.startTraining())}),q(49),U(),z(50,"button",26),Je("click",function(){return He(o),je(r.stopTraining())}),q(51," \u23F9\uFE0F STOP "),U(),z(52,"button",27),Je("click",function(){return He(o),je(r.resetTraining())}),q(53," \u{1F504} RESET "),U()()(),z(54,"div",8)(55,"h3"),q(56,"\u26A1 PERFORMANCE MONITOR"),U(),z(57,"div",28)(58,"div",29)(59,"span",30),q(60,"FPS:"),U(),z(61,"span",31),q(62),U()(),z(63,"div",29)(64,"span",30),q(65,"Training Speed:"),U(),z(66,"span",31),q(67),U()(),z(68,"div",29)(69,"span",30),q(70,"Double DQN:"),U(),z(71,"span",31),q(72),U()(),z(73,"div",29)(74,"span",30),q(75,"Prioritized Replay:"),U(),z(76,"span",31),q(77),U()()(),z(78,"div",32)(79,"label",33)(80,"input",34),Eo("ngModelChange",function(s){return He(o),jo(r.config.doubleQLearning,s)||(r.config.doubleQLearning=s),je(s)}),Je("change",function(){return He(o),je(r.addTrainingLog("Double DQN toggled: "+r.config.doubleQLearning))}),U(),q(81," Enable Double DQN "),U(),z(82,"label",33)(83,"input",34),Eo("ngModelChange",function(s){return He(o),jo(r.config.prioritizedReplay,s)||(r.config.prioritizedReplay=s),je(s)}),Je("change",function(){return He(o),je(r.addTrainingLog("Prioritized Replay toggled: "+r.config.prioritizedReplay))}),U(),q(84," Prioritized Experience Replay "),U()()(),z(85,"div",8)(86,"h3"),q(87,"\u{1F4BE} MODEL MANAGEMENT"),U(),z(88,"div",35)(89,"div",36)(90,"button",37),Je("click",function(){return He(o),je(r.exportModel("agent1"))}),q(91," \u{1F4E4} Export Agent 1 "),U(),z(92,"button",37),Je("click",function(){return He(o),je(r.exportModel("agent2"))}),q(93," \u{1F4E4} Export Agent 2 "),U()(),z(94,"div",38)(95,"label",39),q(96," \u{1F4E5} Import Agent 1 Model "),z(97,"input",40),Je("change",function(s){return He(o),je(r.importModel("agent1",s.target.files[0]))}),U()(),z(98,"label",39),q(99," \u{1F4E5} Import Agent 2 Model "),z(100,"input",40),Je("change",function(s){return He(o),je(r.importModel("agent2",s.target.files[0]))}),U()()()()()(),z(101,"div",41)(102,"div",42)(103,"h3"),q(104,"\u{1F3AF} TRAINING ARENA"),U(),z(105,"div",43),So(106,"canvas",44,0),Mr(108,SDe,8,0,"div",45),U()(),z(109,"div",46)(110,"h3"),q(111,"\u{1F4CA} PERFORMANCE METRICS"),U(),z(112,"div",47),Mr(113,IDe,28,6,"div",48)(114,EDe,28,6,"div",48),z(115,"div",49)(116,"h4",50),q(117,"\u{1F3C6} OVERALL"),U(),z(118,"div",51)(119,"span",52),q(120,"Total Games:"),U(),z(121,"span",53),q(122),U()(),z(123,"div",51)(124,"span",52),q(125,"Current Episode:"),U(),z(126,"span",53),q(127),U()(),z(128,"div",51)(129,"span",52),q(130,"Training Progress:"),U(),z(131,"div",54),So(132,"div",55),U(),z(133,"span",53),q(134),U()()()()()(),z(135,"div",56)(136,"h3"),q(137,"\u{1F9E0} NEURAL NETWORK VISUALIZATION"),U(),z(138,"div",57)(139,"div",58)(140,"p"),q(141,"Watch the neural network in action! Nodes light up based on activation levels."),U(),z(142,"div",59)(143,"div",60),So(144,"div",61),z(145,"span"),q(146,"Low Activation"),U()(),z(147,"div",60),So(148,"div",62),z(149,"span"),q(150,"Medium Activation"),U()(),z(151,"div",60),So(152,"div",63),z(153,"span"),q(154,"High Activation"),U()(),z(155,"div",60),So(156,"div",64),z(157,"span"),q(158,"Maximum Activation"),U()()()(),So(159,"div",65,1),U()(),Mr(161,_De,5,2,"div",66),z(162,"div",67)(163,"h3"),q(164,"\u{1F4C8} LEARNING ANALYTICS"),U(),z(165,"div",68)(166,"div",69)(167,"p"),q(168,"\u{1F4CA} Performance charts will appear here during training"),U(),z(169,"p"),q(170,"\u2022 Win rate over time"),U(),z(171,"p"),q(172,"\u2022 Reward progression"),U(),z(173,"p"),q(174,"\u2022 Loss function convergence"),U()()()()()}e&2&&(he(16),vt("value",r.config.learningRate),he(2),dn(r.config.learningRate.toFixed(4)),he(4),vt("value",r.config.gameSpeed),he(2),Qn("",r.config.gameSpeed,"x"),he(4),vt("value",r.config.stepsPerFrame),he(2),Qn("",r.config.stepsPerFrame,"x"),he(4),vt("value",r.config.epsilonDecay),he(2),dn(r.config.epsilonDecay.toFixed(4)),he(4),Io("ngModel",r.config.episodes),he(4),vt("value",r.config.batchSize),he(2),dn(r.config.batchSize),he(2),vt("disabled",r.isTraining),he(),Qn(" ",r.isTraining?"\u{1F504} TRAINING...":"\u{1F680} START TRAINING"," "),he(),vt("disabled",!r.isTraining),he(12),dn(r.getFPS()),he(5),dn(r.getTrainingSpeed()),he(5),dn(r.config.doubleQLearning?"\u2705":"\u274C"),he(5),dn(r.config.prioritizedReplay?"\u2705":"\u274C"),he(3),Io("ngModel",r.config.doubleQLearning),he(3),Io("ngModel",r.config.prioritizedReplay),he(25),vt("ngIf",!r.isTraining&&r.gameNumber===0),he(5),vt("ngIf",r.getAgent1Stats()),he(),vt("ngIf",r.getAgent2Stats()),he(8),dn(r.stats.totalGames),he(5),Vm("",r.episode,"/",r.config.episodes,""),he(5),C_("width",r.episode/r.config.episodes*100,"%"),he(2),Qn("",(r.episode/r.config.episodes*100).toFixed(1),"%"),he(27),vt("ngIf",r.isTraining))},dependencies:[ts,Yv,zs,A_,Ab,jf,xg,_N,Nb,bg,vg,yg],styles:['.ai-learning-container[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(135deg,#0f0f23,#1a1a3a,#0f0f23);color:#fff;font-family:Courier New,monospace;padding:1rem;box-sizing:border-box;overflow-x:hidden;overflow-y:auto;max-height:100vh}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;flex-wrap:wrap;gap:1rem}.title[_ngcontent-%COMP%]{font-size:2.5rem;margin:0;background:linear-gradient(45deg,#0f0,#4a90e2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 0 20px rgba(0,255,0,.5);animation:_ngcontent-%COMP%_glow 2s ease-in-out infinite alternate}@keyframes _ngcontent-%COMP%_glow{0%{filter:drop-shadow(0 0 5px #00ff00)}to{filter:drop-shadow(0 0 15px #00ff00)}}.back-btn[_ngcontent-%COMP%]{background:linear-gradient(45deg,#f44,#f66);border:none;color:#fff;padding:.75rem 1.5rem;border-radius:10px;font-family:inherit;font-weight:700;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:.5rem;box-shadow:0 4px 15px #ff44444d}.back-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #f446}.back-icon[_ngcontent-%COMP%]{font-size:1.2rem}.control-panel[_ngcontent-%COMP%]{background:#0009;border:2px solid #00ff00;border-radius:15px;padding:1.5rem;margin-bottom:2rem;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);box-shadow:0 8px 32px #00ff001a}.control-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#0f0;margin:0 0 1rem;font-size:1.3rem;text-shadow:0 0 10px rgba(0,255,0,.5)}.controls-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-bottom:1.5rem}.control-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.control-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:#ccc;font-weight:700;font-size:.9rem}.slider[_ngcontent-%COMP%]{width:100%;height:6px;border-radius:3px;background:#333;outline:none;-webkit-appearance:none;appearance:none}.slider[_ngcontent-%COMP%]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:#0f0;cursor:pointer;box-shadow:0 0 10px #00ff0080}.slider[_ngcontent-%COMP%]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:#0f0;cursor:pointer;border:none;box-shadow:0 0 10px #00ff0080}.value-display[_ngcontent-%COMP%]{color:#0f0;font-weight:700;text-align:center;padding:.25rem;background:#00ff001a;border-radius:5px;border:1px solid #00ff00}.training-controls[_ngcontent-%COMP%], .action-buttons[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap;justify-content:center;margin-top:1rem}.btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border:none;border-radius:8px;font-family:inherit;font-weight:700;cursor:pointer;transition:all .3s ease;text-transform:uppercase;letter-spacing:.5px;position:relative;overflow:hidden}.btn[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:left .5s ease}.btn[_ngcontent-%COMP%]:hover:before{left:100%}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(45deg,#4a90e2,#5ba0f2);color:#fff;box-shadow:0 4px 15px #4a90e24d}.btn-primary[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #4a90e266}.btn-danger[_ngcontent-%COMP%]{background:linear-gradient(45deg,#f44,#f66);color:#fff;box-shadow:0 4px 15px #ff44444d}.btn-danger[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #f446}.btn-secondary[_ngcontent-%COMP%]{background:linear-gradient(45deg,#666,#888);color:#fff;box-shadow:0 4px 15px #6666664d}.btn-secondary[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #6666}.btn-success[_ngcontent-%COMP%]{background:linear-gradient(45deg,#28a745,#34ce57);color:#fff;box-shadow:0 4px 15px #28a7454d}.btn-success[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #28a74566}.btn-warning[_ngcontent-%COMP%]{background:linear-gradient(45deg,#f39c12,#e67e22);color:#fff;box-shadow:0 4px 15px #f39c124d}.btn-warning[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #f39c1266}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none!important}.number-input[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:2px solid #00ff00;border-radius:5px;background:#0009;color:#0f0;font-family:inherit;font-weight:700;text-align:center}.number-input[_ngcontent-%COMP%]:focus{outline:none;box-shadow:0 0 10px #00ff0080}.model-controls[_ngcontent-%COMP%]{margin-top:1rem;padding-top:1rem;border-top:1px solid #333}.main-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin-bottom:2rem;align-items:start}.game-section[_ngcontent-%COMP%]{background:#0009;border:2px solid #00ff00;border-radius:15px;padding:1.5rem;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);box-shadow:0 8px 32px #00ff001a;height:fit-content}.game-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#0f0;margin:0 0 1rem;text-align:center;font-size:1.2rem;text-shadow:0 0 10px rgba(0,255,0,.5)}.game-container[_ngcontent-%COMP%]{position:relative;display:flex;justify-content:center;align-items:center;min-height:400px;width:100%}.game-canvas[_ngcontent-%COMP%]{border:2px solid #333;border-radius:10px;background:#000;box-shadow:0 0 30px #0f03;width:100%;max-width:600px;height:auto;aspect-ratio:4/3}.game-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000c;display:flex;justify-content:center;align-items:center;border-radius:10px;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px)}.overlay-content[_ngcontent-%COMP%]{text-align:center;padding:2rem;background:#00ff001a;border:2px solid #00ff00;border-radius:15px;box-shadow:0 0 30px #00ff004d}.overlay-content[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#0f0;margin:0 0 1rem;font-size:1.5rem;text-shadow:0 0 15px #00ff00}.overlay-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0;color:#ccc}.stats-section[_ngcontent-%COMP%]{background:#0009;border:2px solid #4a90e2;border-radius:15px;padding:1.5rem;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);box-shadow:0 8px 32px #4a90e21a}.stats-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#4a90e2;margin:0 0 1rem;text-align:center;font-size:1.2rem;text-shadow:0 0 10px rgba(74,144,226,.5)}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1rem}.agent-stats[_ngcontent-%COMP%]{background:#0006;border-radius:10px;padding:1rem;border:2px solid}.agent-stats[_ngcontent-%COMP%]:nth-child(1){border-color:#f44}.agent-stats[_ngcontent-%COMP%]:nth-child(2){border-color:#44f}.agent-title[_ngcontent-%COMP%]{margin:0 0 .75rem;font-size:1rem;text-align:center;font-weight:700}.stat-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.5rem;padding:.25rem 0;border-bottom:1px solid rgba(255,255,255,.1)}.stat-label[_ngcontent-%COMP%]{color:#ccc;font-size:.9rem}.stat-value[_ngcontent-%COMP%]{color:#0f0;font-weight:700;font-size:.9rem}.overall-stats[_ngcontent-%COMP%]{background:#0006;border:2px solid #00ff00;border-radius:10px;padding:1rem;margin-top:1rem}.stats-title[_ngcontent-%COMP%]{color:#0f0;margin:0 0 .75rem;text-align:center;font-size:1rem;text-shadow:0 0 10px rgba(0,255,0,.5)}.visualization-section[_ngcontent-%COMP%]{grid-column:1 / -1;background:#0009;border:2px solid #9b59b6;border-radius:15px;padding:1.5rem;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);box-shadow:0 8px 32px #9b59b61a;margin-top:2rem}.visualization-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#9b59b6;margin:0 0 1rem;text-align:center;font-size:1.2rem;text-shadow:0 0 10px rgba(155,89,182,.5)}.network-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;min-height:400px;background:#0f0f23cc;border-radius:10px;border:1px solid #9b59b6;padding:1rem;width:100%;overflow:visible}.network-info[_ngcontent-%COMP%]{text-align:center;color:#ccc;margin-bottom:1rem}.legend[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;margin-top:.5rem}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.8rem}.legend-color[_ngcontent-%COMP%]{width:12px;height:12px;border-radius:50%;border:1px solid rgba(255,255,255,.3)}.network-viz[_ngcontent-%COMP%]{min-height:350px;width:100%;display:flex;justify-content:center;align-items:center;position:relative}.network-viz[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:100%;height:100%;min-height:350px;background:transparent}.network-viz[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{stroke:#fff;stroke-width:1.5px}.network-viz[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{stroke:#999;stroke-opacity:.6}.network-viz[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]   text[_ngcontent-%COMP%]{font-family:Courier New,monospace;font-size:10px;fill:#fff;text-anchor:middle;dominant-baseline:central}.logs-section[_ngcontent-%COMP%]{grid-column:1 / -1;background:#0009;border:2px solid #f39c12;border-radius:15px;padding:1.5rem;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);box-shadow:0 8px 32px #f39c121a;max-height:400px;overflow:hidden;margin-top:2rem}.logs-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#f39c12;margin:0 0 1rem;text-align:center;font-size:1.2rem;text-shadow:0 0 10px rgba(243,156,18,.5)}.logs-container[_ngcontent-%COMP%]{max-height:300px;overflow-y:auto;background:#0006;border-radius:8px;padding:1rem;border:1px solid #333}.logs-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.logs-container[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#333;border-radius:4px}.logs-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#f39c12;border-radius:4px}.logs-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#e67e22}.log-entry[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:.5rem;padding:.5rem;background:#0000004d;border-radius:5px;border-left:3px solid #f39c12;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translate(-10px)}to{opacity:1;transform:translate(0)}}.log-timestamp[_ngcontent-%COMP%]{color:#666;font-size:.8rem;min-width:80px;flex-shrink:0}.log-message[_ngcontent-%COMP%]{color:#ccc;font-size:.9rem;flex:1}.progress-bar[_ngcontent-%COMP%]{width:100%;height:20px;background:#0006;border-radius:10px;border:1px solid #00ff00;overflow:hidden;margin:.25rem 0}.progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#0f0,#4a90e2);border-radius:9px;transition:width .3s ease;box-shadow:0 0 10px #00ff004d}.analytics-section[_ngcontent-%COMP%]{grid-column:1 / -1;background:#0009;border:2px solid #e74c3c;border-radius:15px;padding:1.5rem;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);box-shadow:0 8px 32px #e74c3c1a;margin-top:2rem}.analytics-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#e74c3c;margin:0 0 1rem;text-align:center;font-size:1.2rem;text-shadow:0 0 10px rgba(231,76,60,.5)}.charts-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px}.chart-placeholder[_ngcontent-%COMP%]{text-align:center;color:#666;font-style:italic}.chart-placeholder[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0}.performance-stats[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:1rem;margin-bottom:1rem;padding:1rem;background:#0006;border-radius:10px;border:1px solid #333}.perf-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem;background:#00ff000d;border-radius:5px;border:1px solid rgba(0,255,0,.2)}.perf-label[_ngcontent-%COMP%]{color:#ccc;font-size:.9rem;font-weight:700}.perf-value[_ngcontent-%COMP%]{color:#0f0;font-weight:700;font-size:1rem;text-shadow:0 0 5px rgba(0,255,0,.3)}.optimization-toggles[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.75rem;margin-top:1rem;padding:1rem;background:#0006;border-radius:10px;border:1px solid #333}.toggle-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;color:#ccc;font-size:.9rem;cursor:pointer;transition:color .3s ease}.toggle-label[_ngcontent-%COMP%]:hover{color:#0f0}.toggle-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{width:20px;height:20px;accent-color:#00ff00;cursor:pointer}.control-section[_ngcontent-%COMP%]{margin-bottom:2rem;padding-bottom:1.5rem;border-bottom:1px solid rgba(255,255,255,.1)}.control-section[_ngcontent-%COMP%]:last-child{border-bottom:none;margin-bottom:0}.model-controls[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.export-controls[_ngcontent-%COMP%], .import-controls[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem;flex-wrap:wrap;justify-content:center}.file-input-label[_ngcontent-%COMP%]{background:linear-gradient(45deg,#6c757d,#868e96);color:#fff;padding:.75rem 1.5rem;border-radius:8px;cursor:pointer;transition:all .3s ease;font-weight:700;display:inline-block;text-align:center;box-shadow:0 4px 15px #6c757d4d;font-size:.9rem}.file-input-label[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 20px #6c757d66;background:linear-gradient(45deg,#7c8591,#969ea6)}.file-input[_ngcontent-%COMP%]{display:none}.perf-value.high-fps[_ngcontent-%COMP%]{color:#2ecc71;animation:_ngcontent-%COMP%_pulse 1s ease-in-out infinite alternate}.perf-value.medium-fps[_ngcontent-%COMP%]{color:#f39c12}.perf-value.low-fps[_ngcontent-%COMP%]{color:#e74c3c}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:.8}to{opacity:1}}.training-speed-high[_ngcontent-%COMP%]{color:#e74c3c;font-weight:700;text-shadow:0 0 10px rgba(231,76,60,.5)}.training-speed-medium[_ngcontent-%COMP%]{color:#f39c12;font-weight:700;text-shadow:0 0 10px rgba(243,156,18,.5)}.training-speed-low[_ngcontent-%COMP%]{color:#2ecc71;font-weight:700;text-shadow:0 0 10px rgba(46,204,113,.5)}.toggle-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{position:relative;appearance:none;width:20px;height:20px;border:2px solid #00ff00;border-radius:4px;background:#0009;cursor:pointer;transition:all .3s ease}.toggle-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked{background:#0f0;box-shadow:0 0 10px #00ff0080}.toggle-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked:after{content:"\\2713";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-weight:700;font-size:14px}.toggle-label[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:hover{box-shadow:0 0 15px #00ff004d}.perf-value.loading[_ngcontent-%COMP%]{color:#666}.perf-value.loading[_ngcontent-%COMP%]:after{content:"...";animation:_ngcontent-%COMP%_dots 1.5s steps(4,end) infinite}@keyframes _ngcontent-%COMP%_dots{0%,20%{content:""}40%{content:"."}60%{content:".."}80%,to{content:"..."}}@media (max-width: 768px){.performance-stats[_ngcontent-%COMP%]{grid-template-columns:1fr}.optimization-toggles[_ngcontent-%COMP%]{gap:.5rem}.export-controls[_ngcontent-%COMP%], .import-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:center}}.control-panel.training-active[_ngcontent-%COMP%]{border-color:#0f0;box-shadow:0 0 30px #0f03;animation:_ngcontent-%COMP%_trainingGlow 2s ease-in-out infinite alternate}@keyframes _ngcontent-%COMP%_trainingGlow{0%{box-shadow:0 0 30px #0f03}to{box-shadow:0 0 50px #0f06}}@media (max-width: 1200px){.main-content[_ngcontent-%COMP%]{grid-template-columns:1fr}.controls-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.title[_ngcontent-%COMP%]{font-size:2rem}}@media (max-width: 768px){.ai-learning-container[_ngcontent-%COMP%]{padding:.5rem}.header-section[_ngcontent-%COMP%]{flex-direction:column;text-align:center}.title[_ngcontent-%COMP%]{font-size:1.8rem}.controls-grid[_ngcontent-%COMP%], .stats-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.training-controls[_ngcontent-%COMP%], .action-buttons[_ngcontent-%COMP%], .export-controls[_ngcontent-%COMP%], .import-controls[_ngcontent-%COMP%]{flex-direction:column;align-items:center}.control-panel[_ngcontent-%COMP%], .game-section[_ngcontent-%COMP%], .stats-section[_ngcontent-%COMP%], .visualization-section[_ngcontent-%COMP%], .logs-section[_ngcontent-%COMP%]{padding:1rem}.game-canvas[_ngcontent-%COMP%]{max-width:100%;height:auto}}@media (max-width: 480px){.title[_ngcontent-%COMP%]{font-size:1.5rem}.btn[_ngcontent-%COMP%], .file-input-label[_ngcontent-%COMP%]{padding:.6rem 1rem;font-size:.9rem}.log-entry[_ngcontent-%COMP%]{flex-direction:column;gap:.25rem}.log-timestamp[_ngcontent-%COMP%]{font-size:.7rem;min-width:auto}.log-message[_ngcontent-%COMP%]{font-size:.8rem}}.game-canvas[_ngcontent-%COMP%], .network-container[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{will-change:transform}.btn[_ngcontent-%COMP%], .slider[_ngcontent-%COMP%]::-webkit-slider-thumb, .slider[_ngcontent-%COMP%]::-moz-range-thumb{will-change:transform}@media (prefers-color-scheme: dark){.ai-learning-container[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0a0a0a,#1a1a2e,#0a0a0a)}}@media (prefers-contrast: high){.title[_ngcontent-%COMP%]{text-shadow:none;-webkit-text-fill-color:#00ff00}.game-section[_ngcontent-%COMP%], .stats-section[_ngcontent-%COMP%], .visualization-section[_ngcontent-%COMP%], .logs-section[_ngcontent-%COMP%]{border-width:3px}.btn[_ngcontent-%COMP%]{border:2px solid currentColor}}.text-center[_ngcontent-%COMP%]{text-align:center}.mb-1[_ngcontent-%COMP%]{margin-bottom:1rem}.mt-1[_ngcontent-%COMP%]{margin-top:1rem}.log-entry.error[_ngcontent-%COMP%]{border-left-color:#e74c3c}.log-entry.success[_ngcontent-%COMP%]{border-left-color:#2ecc71}.log-entry.warning[_ngcontent-%COMP%]{border-left-color:#f39c12}.log-entry.info[_ngcontent-%COMP%]{border-left-color:#3498db}']})};function NDe(t,n){if(t&1){let e=Qr();z(0,"app-game-menu",4),Je("startGame",function(o){He(e);let i=Ot();return je(i.onStartGame(o))})("watchAILearn",function(){He(e);let o=Ot();return je(o.onWatchAILearn())}),U()}}function DDe(t,n){if(t&1){let e=Qr();z(0,"app-pong-game",5),Je("gameEnded",function(){He(e);let o=Ot();return je(o.onGameEnded())}),U()}if(t&2){let e=Ot();vt("settings",e.gameSettings)}}function kDe(t,n){if(t&1){let e=Qr();z(0,"app-ai-learning",6),Je("backToMenu",function(){He(e);let o=Ot();return je(o.onBackToMenu())}),U()}}var HI=class t{title="pong-rl";currentView="menu";gameSettings=null;onStartGame(n){this.gameSettings=n,this.currentView="game"}onWatchAILearn(){this.currentView="ai-learning"}onGameEnded(){this.currentView="menu",this.gameSettings=null}onBackToMenu(){this.currentView="menu",this.gameSettings=null}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=Ji({type:t,selectors:[["app-root"]],decls:4,vars:3,consts:[[1,"app-container"],[3,"startGame","watchAILearn",4,"ngIf"],[3,"settings","gameEnded",4,"ngIf"],[3,"backToMenu",4,"ngIf"],[3,"startGame","watchAILearn"],[3,"gameEnded","settings"],[3,"backToMenu"]],template:function(e,r){e&1&&(z(0,"div",0),Mr(1,NDe,1,0,"app-game-menu",1)(2,DDe,1,1,"app-pong-game",2)(3,kDe,1,0,"app-ai-learning",3),U()),e&2&&(he(),vt("ngIf",r.currentView==="menu"),he(),vt("ngIf",r.currentView==="game"&&r.gameSettings),he(),vt("ngIf",r.currentView==="ai-learning"))},dependencies:[ts,zs,Rb,Mb,WI],styles:[".app-container[_ngcontent-%COMP%]{width:100%;height:100vh;margin:0;padding:0;overflow:hidden}*[_ngcontent-%COMP%]{box-sizing:border-box}"]})};z_(HI,aP).catch(t=>console.error(t));
